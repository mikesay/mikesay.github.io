<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Podmanä»‹ç»å’Œä½¿ç”¨</title>
    <link href="/2021/10/10/podman-introduction-and-usage/"/>
    <url>/2021/10/10/podman-introduction-and-usage/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘Dockerå…¬å¸æ”¹å˜äº†Dockeræ¡Œé¢ç‰ˆï¼ˆDocker for Macå’ŒDocker for Windowsï¼‰çš„å•†ä¸šç­–ç•¥ï¼šæœ€æ™šåˆ°2022/1/31å·ï¼Œéœ€è¦è´­ä¹°ä»˜è´¹è®¢é˜…äº†ï¼Œä½†å¯¹äºå‘˜å·¥äººæ•°å°äº250ï¼Œä¸”å¹´æ”¶å…¥å°‘äº1000ä¸‡ç¾å…ƒçš„å…¬å¸ä»ç„¶å…è´¹ã€‚è™½è¯´å¯¹äºä¸ªäººä½¿ç”¨Dockeræ¡Œé¢ç‰ˆæ²¡æœ‰å½±å“ï¼Œä½†åœ¨å…¬å¸é‡Œè¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚ ä½œä¸ºå¯¹Dockeræ¡Œé¢ç‰ˆçš„æ›¿æ¢ï¼Œæœ¬æ–‡å°†å¯¹PodmanåŠå…¶ä½¿ç”¨åšä¸€ç®€å•çš„ä»‹ç»ã€‚</p><span id="more"></span><h1 id="Podman"><a href="#Podman" class="headerlink" title="Podman"></a>Podman</h1><p><a href="https://podman.io/">Podman</a>æ˜¯ä¸€ä¸ªæ— å®ˆæŠ¤è¿›ç¨‹çš„å¼€æºLinux åŸç”Ÿå·¥å…·ï¼Œæ—¨åœ¨ä½¿ç”¨å¼€æ”¾å®¹å™¨åè®® (OCI) å®¹å™¨å’Œå®¹å™¨é•œåƒè½»æ¾æŸ¥æ‰¾ã€è¿è¡Œã€æ„å»ºã€å…±äº«å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚å¯¹äºæ— å®ˆæŠ¤è¿›ç¨‹è¿™ä¸€è¯´æ³•ï¼Œä¸»è¦æ˜¯é’ˆå¯¹è¿è¡Œåœ¨Linuxç³»ç»Ÿä¸­çš„Podmanï¼Œå› ä¸ºPodmanåŸç”Ÿæ˜¯æ”¯æŒLinuxç³»ç»Ÿçš„ï¼Œè€Œåœ¨Macå’ŒWindowsç³»ç»Ÿä¸­ï¼Œä»ç„¶éœ€è¦å¯åŠ¨ä¸€ä¸ªLinuxè™šæ‹Ÿæœºæ¥ç®¡ç†å’Œè¿è¡Œå®¹å™¨ã€‚Podmançš„æ¶æ„å¦‚ä¸‹ï¼š<br><img src="/2021/10/10/podman-introduction-and-usage/1.jpg"></p><p>Podmanæ˜¯ä»CRI-Oç‹¬ç«‹å‡ºæ¥çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç›®çš„æ˜¯è®©CRI-Oå’ŒPodmanèƒ½å¤Ÿç‹¬ç«‹å‘å±•ã€‚Podmanä¸»è¦åŒ…å«ä¸€ä¸ªå…¼å®¹Dockerå‘½ä»¤çš„CLIæ¨¡å—å’Œlibpodï¼Œlibpodé€šè¿‡runcåˆ›å»ºå’Œæ‰§è¡Œå®¹å™¨è¿›ç¨‹ã€‚ç”±äºPodmanåº•å±‚ä½¿ç”¨çš„runcè¿è¡Œæ—¶ï¼Œæ‰€ä»¥Podmanèƒ½å¤Ÿä½¿ç”¨ä»»ä½•ç¬¦åˆOCIæ ‡å‡†çš„é•œåƒåŒ…æ‹¬Dockeré•œåƒã€‚</p><h1 id="åœ¨Macä¸Šå®‰è£…Podman"><a href="#åœ¨Macä¸Šå®‰è£…Podman" class="headerlink" title="åœ¨Macä¸Šå®‰è£…Podman"></a>åœ¨Macä¸Šå®‰è£…Podman</h1><p>é€šè¿‡brewå‘½ä»¤æ¥å®‰è£…Podmanï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install podman<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨Macä¸»æœºä¸Šå¯åŠ¨ä¸€ä¸ªPodmanç®¡ç†çš„è™šæ‹Ÿæœºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman machine init<br>podman machine start<br></code></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ä¸€ä¸‹å‘½ä»¤åˆ—å‡ºPodmanç®¡ç†çš„è™šæ‹Ÿæœºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman machine list<br></code></pre></td></tr></table></figure><p><img src="/2021/10/10/podman-introduction-and-usage/2.jpg"></p><h1 id="æ‹‰å–å’Œæ‰§è¡ŒDockeré•œåƒ"><a href="#æ‹‰å–å’Œæ‰§è¡ŒDockeré•œåƒ" class="headerlink" title="æ‹‰å–å’Œæ‰§è¡ŒDockeré•œåƒ"></a>æ‹‰å–å’Œæ‰§è¡ŒDockeré•œåƒ</h1><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‹‰å–Dockeré•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman pull nginx<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ‰€æœ‰Podmanç®¡ç†çš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman images<br></code></pre></td></tr></table></figure><p><img src="/2021/10/10/podman-introduction-and-usage/3.jpg"></p><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman run --name nginx -d -p 8000:80 nginx:latest<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºè¿è¡Œçš„å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman ps<br></code></pre></td></tr></table></figure><p><img src="/2021/10/10/podman-introduction-and-usage/4.jpg"></p><p>åœæ­¢ï¼Œåˆ é™¤è¿è¡Œçš„å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">podman stop nginx<br>podman rm nginx<br></code></pre></td></tr></table></figure><h1 id="è®¾ç½®dockeråˆ«å"><a href="#è®¾ç½®dockeråˆ«å" class="headerlink" title="è®¾ç½®dockeråˆ«å"></a>è®¾ç½®dockeråˆ«å</h1><p>ç”±äºpodmanä¸Docker CLIå‘½ä»¤å…·æœ‰ä¸€å¯¹å¤šæ˜ å°„ï¼Œå› æ­¤å»ºè®®æŒ‰å¦‚ä¸‹æ‰€ç¤ºè®¾ç½®dockeråˆ«åã€‚è¿™æ ·ä¹Ÿå¯ä»¥ç¡®ä¿ç»§ç»­ä½¿ç”¨ä¹‹å‰çš„Dockerå‘½ä»¤ç»éªŒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> docker=podman<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>Container</tag>
      
      <tag>Podman</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kindåˆ›å»ºæœ¬åœ°Kubernetesé›†ç¾¤</title>
    <link href="/2021/10/10/create-kubernetes-kind/"/>
    <url>/2021/10/10/create-kubernetes-kind/</url>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="https://www.mikesay.com/2021/10/06/create-kubernetes-minikube/">Minikubeåˆ›å»ºæœ¬åœ°Kubernetesé›†ç¾¤</a>ä¸€æ–‡ä¸­æåˆ°è¿‡ç”¨Dockeré©±åŠ¨åˆ›å»ºçš„Kubernetesé›†ç¾¤æ—¢ä¸æ”¯æŒingressï¼Œä¹Ÿä¸æ”¯æŒLoadBalancerç±»å‹çš„æœåŠ¡ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šä¸å¯ç”¨ã€‚é€šè¿‡Hypervisoré©±åŠ¨åˆ›å»ºçš„Kubernetesé›†ç¾¤åœ¨VPNçš„æƒ…å†µä¸‹ä¹Ÿæ— æ³•è®¿é—®ã€‚æ­£å¥½åŒäº‹åˆåœ¨å°è¯•ä¸€æ¬¾æ–°çš„å·¥å…·Kindï¼ˆè®ºæœ‰ä¸€ä¸ªä¸æ–­è¿›å–çš„åŒäº‹çš„é‡è¦æ€§<span class="github-emoji" alias="smile" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8">&#x1f604;</span>ï¼‰ï¼Œè€Œä¸”è¿˜è§£å†³äº†Minikubeä¸­é‡åˆ°çš„é—®é¢˜ã€‚æœ¬æ–‡å°†ç®€å•ä»‹ç»ä¸‹Kindï¼Œå¹¶åœ¨Macä¸»æœºä¸Šç”¨Kindåˆ›å»ºä¸€ä¸ªKubernetesé›†ç¾¤ã€‚</p><span id="more"></span><h1 id="Kindä»‹ç»"><a href="#Kindä»‹ç»" class="headerlink" title="Kindä»‹ç»"></a>Kindä»‹ç»</h1><p>Kind(Kubernetes In Docker)ä¹Ÿæ˜¯ä¸€ä¸ªåˆ›å»ºæœ¬åœ°Kubernetesé›†ç¾¤çš„å·¥å…·ï¼Œç±»ä¼¼äºMinikubeé€šè¿‡Dockeré©±åŠ¨åˆ›å»ºKubernetesé›†ç¾¤ï¼Œå³åœ¨å®¹å™¨ä¸­åˆ›å»ºå¹¶è¿è¡ŒKubernetesé›†ç¾¤ã€‚é€šè¿‡Kindåˆ›å»ºå‡ºæ¥çš„é›†ç¾¤æ”¯æŒIngresså’ŒLoadBalancerç±»å‹çš„æœåŠ¡ï¼Œä¹Ÿèƒ½å’ŒVPNå¾ˆå¥½çš„å…±å­˜ã€‚</p><h2 id="é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›"><a href="#é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›" class="headerlink" title="é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›"></a>é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›</h2><p>Kindä¹Ÿæä¾›äº†ä¸°å¯Œçš„é›†ç¾¤é…ç½®é€‰é¡¹ï¼Œæœ‰é›†ç¾¤çº§åˆ«çš„ï¼Œä¹Ÿæœ‰èŠ‚ç‚¹çº§åˆ«çš„ã€‚Kindç¼ºçœä¹Ÿæ˜¯ä½¿ç”¨kubeadmåˆ›å»ºå’Œé…ç½®Kubernetesé›†ç¾¤ï¼Œé€šè¿‡Kubeadm Config Patchesæœºåˆ¶æä¾›äº†é’ˆå¯¹Kubeadmçš„å„ç§é…ç½®ã€‚è¯¦ç»†å¯å‚è€ƒKind<a href="https://kind.sigs.k8s.io/docs/user/configuration/">é…ç½®</a>è¿™ä¸€èŠ‚ã€‚</p><h1 id="Kindæ¶æ„"><a href="#Kindæ¶æ„" class="headerlink" title="Kindæ¶æ„"></a>Kindæ¶æ„</h1><p><img src="/2021/10/10/create-kubernetes-kind/1.png"></p><p>å·¥ä½œèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªDockerå®¹å™¨ï¼Œæ‰€æœ‰çš„Kubernetesé›†ç¾¤çš„ç»„ä»¶ä»¥åŠç”¨æˆ·Podéƒ½è¿è¡Œåœ¨è¿™ä¸ªå®¹å™¨ä¸­ã€‚</p><h1 id="åˆ›å»ºKubernetesé›†ç¾¤"><a href="#åˆ›å»ºKubernetesé›†ç¾¤" class="headerlink" title="åˆ›å»ºKubernetesé›†ç¾¤"></a>åˆ›å»ºKubernetesé›†ç¾¤</h1><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å’Œé…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹çš„Kubernetesé›†ç¾¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kind create cluster --config mykind1.yaml<br></code></pre></td></tr></table></figure><p>mykind1.yaml:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">Cluster</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kind.x-k8s.io/v1alpha4</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">mykind1</span><br><span class="hljs-attr">networking:</span><br>  <span class="hljs-comment"># the default CNI will not be installed</span><br>  <span class="hljs-attr">disableDefaultCNI:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># WARNING: It is _strongly_ recommended that you keep this the default</span><br>  <span class="hljs-comment"># (127.0.0.1) for security reasons. However it is possible to change this.</span><br>  <span class="hljs-attr">apiServerAddress:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>  <span class="hljs-comment"># By default the API server listens on a random open port.</span><br>  <span class="hljs-comment"># You may choose a specific port but probably don&#x27;t need to in most cases.</span><br>  <span class="hljs-comment"># Using a random port makes it easier to spin up multiple clusters.</span><br>  <span class="hljs-attr">apiServerPort:</span> <span class="hljs-number">6443</span><br>  <span class="hljs-attr">podSubnet:</span> <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br>  <span class="hljs-attr">serviceSubnet:</span> <span class="hljs-string">&quot;10.96.0.0/12&quot;</span><br>  <span class="hljs-attr">kubeProxyMode:</span> <span class="hljs-string">&quot;ipvs&quot;</span><br><span class="hljs-attr">nodes:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">control-plane</span><br>  <span class="hljs-attr">kubeadmConfigPatches:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">|</span><br><span class="hljs-string">    kind: InitConfiguration</span><br><span class="hljs-string">    nodeRegistration:</span><br><span class="hljs-string">      kubeletExtraArgs:</span><br><span class="hljs-string">        node-labels: &quot;ingress-ready=true&quot;</span><br><span class="hljs-string"></span>  <span class="hljs-comment"># port forward 80 on the host to 80 on this node</span><br>  <span class="hljs-attr">extraPortMappings:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">hostPort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-comment"># optional: set the bind address on the host</span><br>    <span class="hljs-comment"># 0.0.0.0 is the current default</span><br>    <span class="hljs-attr">listenAddress:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    <span class="hljs-comment"># optional: set the protocol to one of TCP, UDP, SCTP.</span><br>    <span class="hljs-comment"># TCP is the default</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">hostPort:</span> <span class="hljs-number">443</span><br>    <span class="hljs-comment"># optional: set the bind address on the host</span><br>    <span class="hljs-comment"># 0.0.0.0 is the current default</span><br>    <span class="hljs-attr">listenAddress:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    <span class="hljs-comment"># optional: set the protocol to one of TCP, UDP, SCTP.</span><br>    <span class="hljs-comment"># TCP is the default</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">worker</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">worker</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">worker</span><br></code></pre></td></tr></table></figure><p>ä¸€äº›é…ç½®å‚æ•°è¯´æ˜ï¼š</p><ul><li><p>ä¸å®‰è£…Kindçš„ç¼ºçœç½‘ç»œå®ç°ï¼ˆâ€kindnetdâ€ï¼‰ï¼Œå¦åˆ™åœ¨åˆ›å»ºå‡ºæ¥çš„Kubernetesé›†ç¾¤æ— æ³•è§£æå¤–ç½‘åŸŸåï¼Œä»…ç®¡CoreDNSçœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•å¼‚å¸¸ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">networking:</span><br>  <span class="hljs-comment"># the default CNI will not be installed</span><br>  <span class="hljs-attr">disableDefaultCNI:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li><li><p>control-planeä¸­çš„é…ç½®ç”¨æ¥å°†ä¹‹åå®‰è£…çš„ingress controller Podè°ƒåº¦åˆ°ä¸»èŠ‚ç‚¹ä¸Šï¼Œå¹¶å°†NodePortç±»å‹çš„ingress controlleræœåŠ¡çš„80å’Œ443ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„80å’Œ443ç«¯å£ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸»æœºIPè®¿é—®IngressæœåŠ¡ã€‚</p></li></ul><h2 id="é…ç½®Kubernetesé›†ç¾¤"><a href="#é…ç½®Kubernetesé›†ç¾¤" class="headerlink" title="é…ç½®Kubernetesé›†ç¾¤"></a>é…ç½®Kubernetesé›†ç¾¤</h2><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶Calico"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶Calico" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶Calico"></a>å®‰è£…ç½‘ç»œæ’ä»¶Calico</h3><ul><li><p>ä¸‹è½½Calicoå®‰è£…è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://docs.projectcalico.org/manifests/calico.yaml -O<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡FELIX_IGNORELOOSERPFçš„å€¼ä¸ºtrueï¼Œç¦ç”¨Calicoæ£€æŸ¥ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Source: calico/templates/calico-node.yaml</span><br><span class="hljs-comment"># This manifest installs the calico-node container, as well</span><br><span class="hljs-comment"># as the CNI plugins and network config on</span><br><span class="hljs-comment"># each master and worker node in a Kubernetes cluster.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">updateStrategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br>    <span class="hljs-attr">rollingUpdate:</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-string">...</span><br>      <span class="hljs-attr">initContainers:</span><br>        <span class="hljs-string">....</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-comment"># Runs calico-node container on each Kubernetes node. This</span><br>        <span class="hljs-comment"># container programs network policy and routes on each</span><br>        <span class="hljs-comment"># host.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/node:v3.20.1</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-comment"># Disable the Calico RPF check</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_IGNORELOOSERPF</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;true&quot;</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>è¯¦ç»†å‚è€ƒ<a href="https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises#install-calico-with-kubernetes-api-datastore-50-nodes-or-less">Calicoå®˜æ–¹å®‰è£…æ–‡æ¡£</a>ï¼Œä»¥åŠåšå®¢æ–‡ç« <a href="https://alexbrand.dev/post/creating-a-kind-cluster-with-calico-networking/">Creating a Kind Cluster With Calico Networking</a>ã€‚</p></blockquote><h3 id="å®‰è£…Ingress-Controller"><a href="#å®‰è£…Ingress-Controller" class="headerlink" title="å®‰è£…Ingress Controller"></a>å®‰è£…Ingress Controller</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…METALLB"><a href="#å®‰è£…METALLB" class="headerlink" title="å®‰è£…METALLB"></a>å®‰è£…METALLB</h3><p>MetalLBæ˜¯è£¸æœºKubernetesé›†ç¾¤çš„è´Ÿè½½å‡è¡¡å®ç°ï¼Œä½¿ç”¨æ ‡å‡†è·¯ç”±åè®®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/master/manifests/namespace.yaml<br>kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=<span class="hljs-string">&quot;<span class="hljs-subst">$(openssl rand -base64 128)</span>&quot;</span> <br>kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/master/manifests/metallb.yaml<br>kubectl apply -f metallb-configmap.yaml<br></code></pre></td></tr></table></figure><p>metallb-configmap.yamlï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">metallb-system</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">config</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">config:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    address-pools:</span><br><span class="hljs-string">    - name: default</span><br><span class="hljs-string">      protocol: layer2</span><br><span class="hljs-string">      addresses:</span><br><span class="hljs-string">      - 172.18.255.150-172.18.255.250</span><br></code></pre></td></tr></table></figure><p>ä»èŠ‚ç‚¹ç½‘æ®µä¸­é€‰å–ä¸€ä¸ªIPåœ°å€èŒƒå›´è®¾ç½®åœ¨metallb-configmap.yamlä¸­ç”¨æ¥ç»™LoadBalancerç±»å‹æœåŠ¡çš„IPåœ°å€ã€‚</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‹å‘½ä»¤è·å–nodeç½‘æ®µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker network inspect -f <span class="hljs-string">&#x27;&#123;&#123;.IPAM.Config&#125;&#125;&#x27;</span> kind<br><br>[&#123;172.18.0.0/16  172.18.0.1 map[]&#125; &#123;fc00:f853:ccd:e793::/64  fc00:f853:ccd:e793::1 map[]&#125;]<br></code></pre></td></tr></table></figure><h1 id="Kind-vs-Minikube"><a href="#Kind-vs-Minikube" class="headerlink" title="Kind vs Minikube"></a>Kind vs Minikube</h1><ul><li><p>Kindæ²¡æœ‰æä¾›ç±»ä¼¼äºMinikubeçš„æ’ä»¶æœºåˆ¶ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿåœ°éƒ¨ç½²Kubernetesã€‚</p></li><li><p>Kindå¹¶æ²¡æœ‰æä¾›åœæ­¢ä¸€ä¸ªé›†ç¾¤çš„åŠŸèƒ½ã€‚</p></li><li><p>å’ŒMinikubeç›¸æ¯”ï¼ŒKindæ¯”è¾ƒè½»é‡ï¼Œå°±æ˜¯ä½¿ç”¨Dockerå®¹å™¨åˆ›å»ºå¹¶è¿è¡ŒKubernetesé›†ç¾¤çš„å·¥å…·ï¼Œä½†æ¯”Minikubeçš„Dockeré©±åŠ¨æ›´å…¨é¢ã€‚ä¸ªäººè®¤ä¸ºå¦‚æœèƒ½å¤ŸæŠŠKindé›†æˆåˆ°Minikubeä¸­ä½œä¸ºDockeré©±åŠ¨çš„å®ç°ï¼Œåº”è¯¥èƒ½æ›´æœ‰åŠ©äºä¸¤ä¸ªé¡¹ç›®çš„å‘å±•ï¼Œç”¨æˆ·ä¹Ÿä¸éœ€è¦å­¦ä¹ ä¸¤ä¸ªå·¥å…·äº†ã€‚</p></li></ul><h1 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h1><p>æœ¬æ–‡æ—¨åœ¨ç®€å•ä»‹ç»Kindï¼Œå®ƒçš„æ¶æ„ä»¥åŠä½¿ç”¨ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©è¯»è€…å¯¹Kindæœ‰ä¸ªæ¡†æ¶æ€§çš„äº†è§£ï¼Œä»è€Œå†³å®šæ˜¯å¦éœ€è¦æ·±å…¥ä½¿ç”¨ã€‚å¯¹äºKindæ›´è¯¦ç»†çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<a href="https://kind.sigs.k8s.io/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Kubernetes</tag>
      
      <tag>K8s</tag>
      
      <tag>Kind</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Minikubeåˆ›å»ºæœ¬åœ°Kubernetesé›†ç¾¤</title>
    <link href="/2021/10/06/create-kubernetes-minikube/"/>
    <url>/2021/10/06/create-kubernetes-minikube/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ å’Œä½¿ç”¨Kubernetesçš„è¿‡ç¨‹ä¸­ï¼Œéƒ½å¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„Kubernetesé›†ç¾¤ç”¨ä½œæµ‹è¯•ä¹‹ç”¨ã€‚ä¹‹å‰ä¸€ç›´ä½¿ç”¨dockerå…¬å¸çš„docker for macåˆ›å»ºçš„Kubernetesé›†ç¾¤ï¼Œä½†æ˜¯ç»å¸¸å‡ºç°å¯åŠ¨ä¸èµ·æ¥çš„é—®é¢˜ï¼Œä¹Ÿæ²¡æœ‰è¯¦ç»†çš„æ—¥å¿—æ¥å®šä½é—®é¢˜ï¼Œå¦å¤–docker for macåˆ›å»ºçš„é›†ç¾¤ä¸æ”¯æŒæ”¹å˜ç³»ç»Ÿç»„ä»¶çš„é…ç½®ï¼Œæ¯”å¦‚ä¿®æ”¹API Serveræˆ–Kubeletçš„å‚æ•°ï¼Œå¼€å¯æŸäº›Alpahaç‰ˆæœ¬çš„ç‰¹æ€§ç­‰ã€‚è™½ç„¶Minikubeå·²ç»å­˜åœ¨å¾ˆä¹…ï¼Œè€Œä¸”æ—©äºdocker for macï¼Œä½†æ˜¯ç”±äºç§ç§åŸå› æ²¡èƒ½å°è¯•ï¼Œåç»åŒäº‹æ¨èï¼Œå°è¯•äº†ä¸€ä¸‹ï¼Œç¡®å®è›®å¼ºå¤§ã€‚æœ¬æ–‡å°†ç®€å•ä»‹ç»ä¸‹Minikubeï¼Œä»¥åŠåœ¨Macä¸»æœºä¸Šç”¨Minikubeåˆ›å»ºå’Œé…ç½®ä¸€ä¸ªæœ¬åœ°é›†ç¾¤ã€‚</p><span id="more"></span><h1 id="Minikubeä»‹ç»"><a href="#Minikubeä»‹ç»" class="headerlink" title="Minikubeä»‹ç»"></a>Minikubeä»‹ç»</h1><p>Minikubeæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ç”¨æ¥åœ¨macOSï¼ŒLinuxå’ŒWindowså¹³å°ä¸­å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç”¨äºå­¦ä¹ å’Œå¼€å‘ä¸ºç›®çš„çš„Kubernetesé›†ç¾¤ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸°å¯Œçš„é›†ç¾¤ç®¡ç†åŠŸèƒ½ã€‚å› ä¸ºMinikubçš„ç›®æ ‡ä¸æ˜¯ç”¨æ¥åˆ›å»ºå’Œç®¡ç†ç”Ÿäº§ç”¨çš„Kubernetesé›†ç¾¤ï¼Œæ‰€ä»¥ä¸ä¼šæ”¯æŒæ‰€æœ‰å¯èƒ½çš„Kuberneteséƒ¨ç½²é…ç½®ï¼Œä¾‹å¦‚ä¸åŒç±»å‹çš„å­˜å‚¨ï¼Œç½‘ç»œç­‰ã€‚ä»¥ä¸‹æ˜¯Minikubeçš„ä¸€äº›æŒ‡å¯¼åŸåˆ™ï¼š</p><ul><li>ç”¨æˆ·å‹å¥½</li><li>æ”¯æŒæ‰€æœ‰Kuberenetesç‰¹æ€§</li><li>è·¨å¹³å°</li><li>å¯é </li><li>æœ€å°‘çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ä¾èµ–</li><li>æœ€å°‘çš„èµ„æºæ¶ˆè€—</li></ul><h2 id="é›†ç¾¤åˆ›å»ºèƒ½åŠ›çš„æŠ½è±¡"><a href="#é›†ç¾¤åˆ›å»ºèƒ½åŠ›çš„æŠ½è±¡" class="headerlink" title="é›†ç¾¤åˆ›å»ºèƒ½åŠ›çš„æŠ½è±¡"></a>é›†ç¾¤åˆ›å»ºèƒ½åŠ›çš„æŠ½è±¡</h2><p>Minikubeç¼ºçœä½¿ç”¨kubeadmåˆ›å»ºå’Œé…ç½®Kubernetesé›†ç¾¤ï¼Œä½†æ˜¯é€šè¿‡å‚æ•°(-b, â€“bootstrapper)å°†åº•å±‚åˆ›å»ºé›†ç¾¤çš„èƒ½åŠ›æŠ½åƒå‡ºæ¥ï¼Œè¿™å°±ä¸ºé›†æˆå…¶å®ƒçš„Kubernetesé›†ç¾¤åˆ›å»ºå·¥å…·æä¾›äº†å¯èƒ½ã€‚</p><h2 id="ä¸°å¯Œçš„æ’ä»¶"><a href="#ä¸°å¯Œçš„æ’ä»¶" class="headerlink" title="ä¸°å¯Œçš„æ’ä»¶"></a>ä¸°å¯Œçš„æ’ä»¶</h2><p>Minikubeæä¾›äº†ä¸°å¯Œçš„å¼€ç®±å³ç”¨çš„æ’ä»¶ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿåœ°é…ç½®Kubernetesé›†ç¾¤ï¼Œæ¯”å¦‚ingressæ’ä»¶ç”¨æ¥å®‰è£…ingress controllerï¼Œdashboardæ’ä»¶ç”¨æ¥å®‰è£…Kubernetesçš„ç®¡ç†é—¨æˆ·ã€‚é€šè¿‡å‘½ä»¤<code>minikube addons list</code>å¯ä»¥åˆ—å‡ºæ”¯æŒçš„æ‰€æœ‰æ’ä»¶ï¼š<br><img src="/2021/10/06/create-kubernetes-minikube/2.jpg"></p><h2 id="ä¸°å¯Œçš„é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›"><a href="#ä¸°å¯Œçš„é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›" class="headerlink" title="ä¸°å¯Œçš„é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›"></a>ä¸°å¯Œçš„é›†ç¾¤ç»„ä»¶é…ç½®èƒ½åŠ›</h2><p>æ¯”èµ·docker for macåˆ›å»ºçš„Kubernetesé›†ç¾¤ï¼ŒMinikubeæä¾›äº†ä¸°å¯Œçš„å‚æ•°ç±»å‹ç”¨æ¥é…ç½®é›†ç¾¤ç»„ä»¶ã€‚å¯ä»¥å‚è€ƒ<a href="https://minikube.sigs.k8s.io/docs/commands/start/">https://minikube.sigs.k8s.io/docs/commands/start/</a> æŸ¥çœ‹<code>minikube start</code>å‘½ä»¤ä¸­ç”¨äºé…ç½®é›†ç¾¤çš„å‚æ•°ï¼Œå°¤å…¶æ˜¯<code>--extra-config</code>å‚æ•°å¯ä»¥ç”¨æ¥å¯¹ä¸åŒç»„ä»¶è¿›è¡Œè®¾ç½®ã€‚å‚è€ƒ<a href="https://minikube.sigs.k8s.io/docs/handbook/config/">https://minikube.sigs.k8s.io/docs/handbook/config/</a> æŸ¥çœ‹è¯¦ç»†çš„é›†ç¾¤é…ç½®åŠŸèƒ½ã€‚</p><h2 id="ä¸°å¯Œçš„é›†ç¾¤ç®¡ç†å‘½ä»¤"><a href="#ä¸°å¯Œçš„é›†ç¾¤ç®¡ç†å‘½ä»¤" class="headerlink" title="ä¸°å¯Œçš„é›†ç¾¤ç®¡ç†å‘½ä»¤"></a>ä¸°å¯Œçš„é›†ç¾¤ç®¡ç†å‘½ä»¤</h2><p>Minikubeçš„startï¼Œstopå’Œpauseï¼Œunpauseå‘½ä»¤æä¾›äº†ä¸åŒçº§åˆ«çš„é›†ç¾¤å¯åœåŠŸèƒ½ï¼Œä»è€Œé‡Šæ”¾å‡ºCPUï¼Œå†…å­˜èµ„æºã€‚Minikube stopå‘½ä»¤ä¼šåœæ‰è¿è¡ŒKubernetesé›†ç¾¤çš„è™šæ‹Ÿæœºï¼ŒåŒæ—¶ä¹Ÿä¼šæ¸…ç†æ‰æ‰€æœ‰çš„å®¹å™¨é•œåƒå’ŒæŒä¹…å·ï¼Œä½†ä»æ—§ä¼šä¿ç•™å½“å‰é›†ç¾¤çš„æ‰€æœ‰çš„é…ç½®ï¼Œè€ŒMinikube startå‘½ä»¤åˆ™ä¼šé‡å¯è™šæ‹Ÿæœºã€‚Minikube pauseå‘½ä»¤ä¸ä¼šåœæ‰è¿è¡ŒKubernetesé›†ç¾¤çš„è™šæ‹Ÿæœºä»¥åŠæ¸…ç†æ‰æ‰€æœ‰çš„å®¹å™¨é•œåƒå’ŒæŒä¹…å·ï¼Œåªä¼šåœæ‰Kubernetesé›†ç¾¤ï¼Œä½†ä¹Ÿä¸ä¼šåœæ‰dockerçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œè€ŒMinikube unpauseå‘½ä»¤ä¼šé‡æ–°å¯åŠ¨Kubernetesé›†ç¾¤ã€‚</p><h1 id="Minikubeçš„æ¶æ„"><a href="#Minikubeçš„æ¶æ„" class="headerlink" title="Minikubeçš„æ¶æ„"></a>Minikubeçš„æ¶æ„</h1><p><img src="/2021/10/06/create-kubernetes-minikube/1.jpg"></p><ul><li><p>Minikubeé©±åŠ¨å±‚ä½¿ç”¨docker-machineåˆ›å»ºä¸åŒç±»å‹çš„è¿è¡ŒKubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ã€‚</p></li><li><p>Masterå’ŒWorkerå°±æ˜¯Minikubeé€šè¿‡é©±åŠ¨å±‚åˆ›å»ºå‡ºæ¥çš„Kubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ã€‚å·¥ä½œèŠ‚ç‚¹å¯ä»¥æ˜¯è¿è¡Œåœ¨ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºã€ç‹¬ç«‹çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å·²ç»å­˜åœ¨çš„ä¸”å·²ç»é…ç½®å¥½çš„è™šæ‹Ÿæœºï¼ˆæœ¬åœ°æˆ–è¿œç¨‹çš„ï¼‰ï¼Œæˆ–è€…å°±æ˜¯ä¸»æœºæœ¬èº«ã€‚</p></li></ul><h2 id="Hypervisoré©±åŠ¨"><a href="#Hypervisoré©±åŠ¨" class="headerlink" title="Hypervisoré©±åŠ¨"></a>Hypervisoré©±åŠ¨</h2><p>Minikubeä¼šæ ¹æ®æŒ‡å®šçš„Hypervisoré©±åŠ¨åœ¨ä¸»æœºä¸Šå¯åŠ¨ä¸€åˆ°å¤šä¸ªè™šæ‹Ÿæœºï¼Œå¹¶å°†å®ƒä»¬é…ç½®æˆå³å°†åˆ›å»ºçš„Kubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ã€‚ä¸åŒç±»å‹çš„ä¸»æœº(Mac, Linux, Windows)æ”¯æŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯æœ‰å·®å¼‚ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸åŒçš„Hypervisoré©±åŠ¨ã€‚</p><h3 id="Linuxä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"><a href="#Linuxä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨" class="headerlink" title="Linuxä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"></a>Linuxä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨</h3><ul><li>KVM2</li><li>VirtualBox</li></ul><h3 id="Macä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"><a href="#Macä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨" class="headerlink" title="Macä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"></a>Macä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨</h3><ul><li>Hyperkit</li><li>VirtualBox</li><li>Parallels</li><li>VMware</li></ul><h3 id="Windowsä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"><a href="#Windowsä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨" class="headerlink" title="Windowsä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨"></a>Windowsä¸»æœºæ”¯æŒçš„Hypervisoré©±åŠ¨</h3><ul><li>Hyper-V</li><li>VirtualBox</li><li>VMware</li></ul><h2 id="Dockeré©±åŠ¨"><a href="#Dockeré©±åŠ¨" class="headerlink" title="Dockeré©±åŠ¨"></a>Dockeré©±åŠ¨</h2><p>å½“é€‰æ‹©Dockeré©±åŠ¨é€‰é¡¹æ—¶ï¼ŒMinikubeä¼šåˆ©ç”¨docker in dockeræŠ€æœ¯å¯åŠ¨ä¸€åˆ°å¤šä¸ªå®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬é…ç½®æˆå³å°†åˆ›å»ºçš„Kubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ï¼Œå³æ‰€è°“çš„Kubernetes in dockerã€‚</p><h3 id="Linuxä¸»æœºçš„Dockeré©±åŠ¨"><a href="#Linuxä¸»æœºçš„Dockeré©±åŠ¨" class="headerlink" title="Linuxä¸»æœºçš„Dockeré©±åŠ¨"></a>Linuxä¸»æœºçš„Dockeré©±åŠ¨</h3><ul><li>Docker - container-based</li><li>Podman - containerï¼ˆè¯•éªŒé˜¶æ®µï¼‰</li></ul><p>Dockeræ˜¯åŸç”Ÿæ”¯æŒLinuxç³»ç»Ÿçš„ï¼Œæ‰€ä»¥åœ¨Linuxä¸»æœºä¸­Dockerçš„å®ˆæŠ¤è¿›ç¨‹æ˜¯ç›´æ¥è¿è¡Œåœ¨ä¸»æœºä¸­çš„ï¼Œç›¸å¯¹æ¥è¯´æ€§èƒ½ä¼šé«˜ç‚¹ã€‚Podmanæ˜¯å¦ä¸€ä¸ªå–ä»£Dockerçš„å®¹å™¨å·¥å…·ï¼Œå®Œå…¨å…¼å®¹OCIæ ‡å‡†ã€‚Podmanä¹Ÿæ˜¯åŸç”Ÿæ”¯æŒLinuxç³»ç»Ÿï¼Œè€Œä¸”åœ¨Linuxç³»ç»Ÿä¸­å®ƒæ˜¯æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹çš„ï¼Œæ‰€è°“çš„daemonlessã€‚ç›®å‰Minikubeæ”¯æŒPodmanè¿˜å¤„äºè¯•éªŒé˜¶æ®µã€‚</p><h3 id="Macä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨"><a href="#Macä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨" class="headerlink" title="Macä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨"></a>Macä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨</h3><ul><li>Docker - VM + Container (preferred)</li></ul><p>Dockerå¹¶æ²¡æœ‰åŸç”Ÿæ”¯æŒMacï¼Œæ‰€ä»¥Dockerä¼šåœ¨Macä¸»æœºä¸Šå¯åŠ¨ä¸€ä¸ªHyperkitçš„è™šæ‹Ÿæœºï¼Œå¹¶å°†å®ƒé…ç½®ä¸ºDockerçš„æœåŠ¡ç«¯ï¼Œè€Œåœ¨Macä¸»æœºä¸Šçš„å®¢æˆ·ç«¯åˆ™é€šè¿‡Unix Socketä¸DockeræœåŠ¡é€šä¿¡ã€‚</p><h3 id="Windowsä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨"><a href="#Windowsä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨" class="headerlink" title="Windowsä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨"></a>Windowsä¸»æœºæ”¯æŒçš„Dockeré©±åŠ¨</h3><ul><li>Docker - VM + Container (preferred)</li></ul><p>é€šMacä¸€æ ·ï¼ŒDockerä¹Ÿæ²¡æœ‰åŸç”Ÿæ”¯æŒWIndowsï¼Œæ‰€ä»¥éœ€è¦åœ¨Windowsä¸»æœºä¸Šå¯åŠ¨ä¸€Hyper-Vè™šæ‹Ÿæœºã€‚</p><h2 id="SSHé©±åŠ¨"><a href="#SSHé©±åŠ¨" class="headerlink" title="SSHé©±åŠ¨"></a>SSHé©±åŠ¨</h2><p>å½“ä½¿ç”¨SSHé©±åŠ¨æ—¶ï¼ŒMinikubeå®é™…ä¸Šæ˜¯é€šè¿‡SSHåœ¨å·²ç»å­˜åœ¨å¹¶é…ç½®å¥½çš„ä¸€å°è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºKuberenetesé›†ç¾¤ã€‚</p><h2 id="Noneé©±åŠ¨"><a href="#Noneé©±åŠ¨" class="headerlink" title="Noneé©±åŠ¨"></a>Noneé©±åŠ¨</h2><p>ç›®å‰åªæ”¯æŒLinuxä¸»æœºï¼Œä¹Ÿå°±æ˜¯Minikubeç›´æ¥åœ¨å½“å‰çš„Linuxä¸»æœºä¸Šåˆ›å»ºKuberentesé›†ç¾¤ã€‚</p><h1 id="åˆ›å»ºKubernetesé›†ç¾¤"><a href="#åˆ›å»ºKubernetesé›†ç¾¤" class="headerlink" title="åˆ›å»ºKubernetesé›†ç¾¤"></a>åˆ›å»ºKubernetesé›†ç¾¤</h1><h2 id="ç”¨Dockeré©±åŠ¨å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé›†ç¾¤"><a href="#ç”¨Dockeré©±åŠ¨å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé›†ç¾¤" class="headerlink" title="ç”¨Dockeré©±åŠ¨å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé›†ç¾¤"></a>ç”¨Dockeré©±åŠ¨å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube start -p mkdockerk8s --driver=docker<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤åŸºäºDockeré©±åŠ¨åˆ›å»ºäº†ä¸€ä¸ªå•èŠ‚ç‚¹çš„Kubernetesé›†ç¾¤ã€‚å‚æ•°-pç”¨æ¥æŒ‡å®šé›†ç¾¤çš„åå­—ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ›å»ºçš„é›†ç¾¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube profile list<br></code></pre></td></tr></table></figure><p><img src="/2021/10/06/create-kubernetes-minikube/3.jpg"></p><p>æ‰§è¡Œkubectlå‘½ä»¤å¯ä»¥çœ‹åˆ°é›†ç¾¤å·²ç»è¢«åŠ åˆ°kubeconfigä¸­äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl config get-contexts<br></code></pre></td></tr></table></figure><p><img src="/2021/10/06/create-kubernetes-minikube/4.jpg"></p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…dashboard:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> metrics-server<br>minikube addons <span class="hljs-built_in">enable</span> dashboard<br></code></pre></td></tr></table></figure><blockquote><p>Dashboardçš„ä¸€äº›ç‰¹æ€§ä¾èµ–äºmetrics-serverï¼Œæ‰€ä»¥å…ˆå®‰è£…metrics-serverã€‚</p></blockquote><p><strong>ä½†æ˜¯ç”¨docker driveråˆ›å»ºçš„Kubernetesé›†ç¾¤æœ‰å¾ˆå¤§çš„ä¸è¶³ï¼ŒåŸºæœ¬ä¸Šæ— æ³•æ»¡è¶³å¼€å‘å·¥ä½œï¼š</strong></p><ul><li><p>ä¸æ”¯æŒingressï¼Œå½“æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å»å®‰è£…ingress controlleræ—¶ï¼Œä¼šå‡ºé”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> ingress<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">âŒ  Exiting due to MK_USAGE: Due to networking limitations of driver docker on darwin, ingress addon is not supported.<br>Alternatively to use this addon you can use a vm-based driver:<br><br><span class="hljs-string">&#x27;minikube start --vm=true&#x27;</span><br><br>To track the update on this work <span class="hljs-keyword">in</span> progress feature please check:<br>https://github.com/kubernetes/minikube/issues/7332<br><br></code></pre></td></tr></table></figure></li><li><p>ä¸æ”¯æŒLoadBalanceç±»å‹çš„æœåŠ¡ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤æ—¶ï¼Œä¹Ÿä¼šå‡ºé”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube tunnel<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ğŸ¤·  The control plane node must be running <span class="hljs-keyword">for</span> this <span class="hljs-built_in">command</span><br>ğŸ‘‰  To start a cluster, run: <span class="hljs-string">&quot;minikube start&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>åŒæ ·æ— æ³•æ‰“å¼€å‰é¢å®‰è£…å¥½çš„dashboard</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube dashboard<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ğŸ¤·  The control plane node must be running <span class="hljs-keyword">for</span> this <span class="hljs-built_in">command</span><br>ğŸ‘‰  To start a cluster, run: <span class="hljs-string">&quot;minikube start&quot;</span><br></code></pre></td></tr></table></figure></li></ul><p>æ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡æŸä¸ªHypervisoré©±åŠ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºä½œä¸ºKubernetesé›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ï¼Œè¿™æ ·æ—¢èƒ½æ”¯æŒingressï¼Œåˆèƒ½æ”¯æŒLoadbalanceç±»å‹çš„æœåŠ¡ï¼ŒåŒæ—¶è¿˜èƒ½æ‰“å¼€dashboardã€‚ä¸‹é¢å°†é€šè¿‡VirtualBoxé©±åŠ¨åˆ›å»ºé›†ç¾¤ã€‚</p><h2 id="ç”¨VirtualBoxé©±åŠ¨åˆ›å»ºé›†ç¾¤"><a href="#ç”¨VirtualBoxé©±åŠ¨åˆ›å»ºé›†ç¾¤" class="headerlink" title="ç”¨VirtualBoxé©±åŠ¨åˆ›å»ºé›†ç¾¤"></a>ç”¨VirtualBoxé©±åŠ¨åˆ›å»ºé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube start --cpus=4 --memory=<span class="hljs-string">&#x27;6g&#x27;</span> --cni=<span class="hljs-string">&#x27;flannel&#x27;</span> --disk-size=<span class="hljs-string">&#x27;60g&#x27;</span> --driver=<span class="hljs-string">&#x27;virtualbox&#x27;</span> --kubernetes-version=<span class="hljs-string">&#x27;v1.23.5&#x27;</span> --extra-config=apiserver.service-node-port-range=1-65535 --extra-config=controller-manager.bind-address=0.0.0.0 --extra-config=scheduler.bind-address=0.0.0.0<br></code></pre></td></tr></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªåŸºäºVirtualBoxé©±åŠ¨çš„å•èŠ‚ç‚¹é›†ç¾¤ã€‚é€šè¿‡å„ä¸ªå‚æ•°è¯¦ç»†åœ°é…ç½®äº†é›†ç¾¤ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>â€“cpus=4</td><td>æŒ‡å®šäº†èŠ‚ç‚¹æœ€å¤§CPUæ•°ä¸º4</td></tr><tr><td>â€“memory=â€™6gâ€™</td><td>æŒ‡å®šäº†å·¥ä½œèŠ‚ç‚¹çš„æœ€å¤§å†…å­˜æ•°ä¸º6g</td></tr><tr><td>â€“disk-size=â€™60gâ€™</td><td>æŒ‡å®šäº†èŠ‚ç‚¹çš„ç£ç›˜å¤§å°</td></tr><tr><td>-kubernetes-version=â€™v1.23.5â€™</td><td>æŒ‡å®šåˆ›å»ºçš„é›†ç¾¤ç‰ˆæœ¬ä¸ºv1.23.5</td></tr><tr><td>-extra-config=apiserver.service-node-port-range=1-65535</td><td>é€šè¿‡â€“extra-configé…ç½®apiserverï¼Œä½¿å¾—è¿è¡ŒNodePortç±»å‹çš„æœåŠ¡èƒ½å¤Ÿä½¿ç”¨1-65535èŒƒå›´çš„ç«¯å£</td></tr><tr><td>â€“extra-config=controller-manager.bind-address=0.0.0.0</td><td>é€šè¿‡â€“extra-configé…ç½®controller-managerï¼Œä½¿èƒ½å¤Ÿä»å¤–é¢è®¿é—®controller-managerçš„API</td></tr><tr><td>â€“extra-config=scheduler.bind-address=0.0.0.0</td><td>é€šè¿‡â€“extra-configé…ç½®schedulerï¼Œä½¿èƒ½å¤Ÿä»å¤–é¢è®¿é—®schedulerçš„API</td></tr></tbody></table><p>åŒæ ·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ›å»ºçš„é›†ç¾¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube profile list<br></code></pre></td></tr></table></figure><p><img src="/2021/10/06/create-kubernetes-minikube/5.jpg"></p><h3 id="å®‰è£…MetalLBæ”¯æŒLoadBalancerç±»å‹çš„æœåŠ¡"><a href="#å®‰è£…MetalLBæ”¯æŒLoadBalancerç±»å‹çš„æœåŠ¡" class="headerlink" title="å®‰è£…MetalLBæ”¯æŒLoadBalancerç±»å‹çš„æœåŠ¡"></a>å®‰è£…MetalLBæ”¯æŒLoadBalancerç±»å‹çš„æœåŠ¡</h3><blockquote><p>å‚è€ƒ<a href="https://metallb.universe.tf/installation/">MetalLBå®˜æ–¹å®‰è£…å’Œé…ç½®æ–‡æ¡£</a></p></blockquote><ul><li><p>è®¾ç½®kube-proxyä½¿ç”¨ipvsæ¨¡å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">kubectl</span> <span class="hljs-string">edit</span> <span class="hljs-string">configmap</span> <span class="hljs-string">-n</span> <span class="hljs-string">kube-system</span> <span class="hljs-string">kube-proxy</span><br></code></pre></td></tr></table></figure><p>è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubeproxy.config.k8s.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeProxyConfiguration</span><br><span class="hljs-attr">mode:</span> <span class="hljs-string">&quot;ipvs&quot;</span><br><span class="hljs-attr">ipvs:</span><br>  <span class="hljs-attr">strictARP:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡minikubeçš„metallbæ’ä»¶å®‰è£…metallb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> metallb<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹MetalLBçš„é…ç½®æ·»åŠ IPåœ°å€æ± <br>å‚è€ƒ<a href="https://minikube.sigs.k8s.io/docs/handbook/vpn_and_proxy/">Proxies and VPNs</a>ï¼Œä½¿ç”¨VirtualBoxé©±åŠ¨åˆ›å»ºçš„åŸºäºVMçš„é›†ç¾¤èŠ‚ç‚¹IPåœ°å€æ± ä¸º192.168.59.0/24ã€‚å¯ä»¥ä»ä¸­é€‰å–ä¸€æ®µç”¨ä½œç»™Loadbalancerç±»å‹çš„æœåŠ¡åˆ†é…IPåœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl edit cm config  -n metallb-system<br></code></pre></td></tr></table></figure><p>è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>data:<br>  config: |<br>    address-pools:<br>    - name: default<br>      protocol: layer2<br>      addresses:<br>      - 192.168.59.200 - 192.168.59.250<br></code></pre></td></tr></table></figure><p>é‡å¯metallb controller Podã€‚</p></li></ul><h3 id="å®‰è£…Nginx-Ingress-Controllerï¼š"><a href="#å®‰è£…Nginx-Ingress-Controllerï¼š" class="headerlink" title="å®‰è£…Nginx Ingress Controllerï¼š"></a>å®‰è£…Nginx Ingress Controllerï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> ingress<br></code></pre></td></tr></table></figure><blockquote><p>minikubeè‡ªå¸¦çš„Nginx Ingress Controlleræ’ä»¶çš„æœåŠ¡ç±»å‹æ˜¯NodePortï¼Œæ‰€ä»¥é€šè¿‡ä»»ä½•ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„IPå°±å¯ä»¥è®¿é—®ã€‚</p></blockquote><h3 id="å®‰è£…Kong-Ingress-Controller"><a href="#å®‰è£…Kong-Ingress-Controller" class="headerlink" title="å®‰è£…Kong Ingress Controller"></a>å®‰è£…Kong Ingress Controller</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> kong<br></code></pre></td></tr></table></figure><blockquote><p>minikubeè‡ªå¸¦çš„Kong Ingress Controllerçš„æœåŠ¡ç±»å‹æ˜¯LoadBalancerç±»å‹ï¼ŒMetalLBä¼šåˆ†é…å¯¹åº”çš„IPåœ°å€ã€‚</p></blockquote><h3 id="å®‰è£…dashboard"><a href="#å®‰è£…dashboard" class="headerlink" title="å®‰è£…dashboard"></a>å®‰è£…dashboard</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube addons <span class="hljs-built_in">enable</span> metrics-server<br>minikube addons <span class="hljs-built_in">enable</span> dashboard<br></code></pre></td></tr></table></figure><blockquote><p>Dashboardä¸­çš„æŸäº›æ•°æ®ä¾èµ–äºmetrics-serverã€‚</p></blockquote><p>å¯åŠ¨Dashboard</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube dashboard<br></code></pre></td></tr></table></figure><h3 id="ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤"><a href="#ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤"></a>ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3><ul><li><p>ç™»å½•è¿›å·¥ä½œèŠ‚ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube ssh<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢å·¥ä½œèŠ‚ç‚¹çš„IPåœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">minikube ip<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">minikube status</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="Minikbueåœ¨HTTP-HTTPSä»£ç†ä¸‹çš„ä½¿ç”¨"><a href="#Minikbueåœ¨HTTP-HTTPSä»£ç†ä¸‹çš„ä½¿ç”¨" class="headerlink" title="Minikbueåœ¨HTTP/HTTPSä»£ç†ä¸‹çš„ä½¿ç”¨"></a>Minikbueåœ¨HTTP/HTTPSä»£ç†ä¸‹çš„ä½¿ç”¨</h1><p>å½“è¦è®¾ç½®HTTP/HTTPSä»£ç†æ‰èƒ½ä¸Šç½‘æ—¶ï¼Œéœ€è¦å°†å·¥ä½œèŠ‚ç‚¹çš„ä¸»æœºç½‘ç»œåœ°å€æ®µè®¾ç½®åˆ°NO_PROXYä¸­ï¼Œå¦åˆ™Minikubeä¼šæ— æ³•è®¿é—®ä¸»æœºé‡Œçš„èµ„æºã€‚</p><blockquote><p>è¯¦ç»†å‚è€ƒ<a href="https://minikube.sigs.k8s.io/docs/handbook/vpn_and_proxy/">Proxieså’ŒVPN</a>ä¸­Proxyä¸€èŠ‚ã€‚</p></blockquote><h1 id="Minikbueåœ¨VPNä¸‹çš„ä½¿ç”¨"><a href="#Minikbueåœ¨VPNä¸‹çš„ä½¿ç”¨" class="headerlink" title="Minikbueåœ¨VPNä¸‹çš„ä½¿ç”¨"></a>Minikbueåœ¨VPNä¸‹çš„ä½¿ç”¨</h1><p>ä½¿ç”¨VPNæ¥å…¥å…¬å¸ç½‘ç»œæˆ–è€…è‡ªå·±çš„ç§æœ‰ç½‘ç»œæ—¶ï¼ŒVPNä¼šæˆªè·Minikubeè®¿é—®ä¸»æœºçš„æµé‡ä»è€Œå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®ï¼Œå› ä¸ºVPNä¼šå¼ºåˆ¶ä¿®æ”¹æœ¬åœ°è·¯ç”±ï¼Œé™¤éå…¬å¸ITåŒæ„å°†ä½ çš„Minikubeç”¨åˆ°çš„ç½‘æ®µåŠ å…¥VPNçš„ç™½åå•ï¼ˆè¿™å¾€å¾€ä¸ç°å®ï¼‰ã€‚è§£å†³åŠæ³•æ˜¯é€šè¿‡ç«¯å£è½¬å‘çš„æ–¹æ³•å°†å¯¹ä¸»æœºlocalhostæˆ–127.0.0.1çš„ç«¯å£è®¿é—®è½¬å‘åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹çš„å¯¹åº”çš„ç«¯å£ä¸Šï¼ˆå‰ææ˜¯ä½¿ç”¨VMçš„é©±åŠ¨åˆ›å»ºçš„é›†ç¾¤ï¼‰ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹äºVirtualBoxé©±åŠ¨åˆ›å»ºçš„é›†ç¾¤æ·»åŠ çš„ç«¯å£è½¬å‘è§„åˆ™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">VBoxManage controlvm minikube natpf1 k8s-apiserver,tcp,127.0.0.1,8443,,8443<br>VBoxManage controlvm minikube natpf1 k8s-ingress,tcp,127.0.0.1,9080,,80<br>VBoxManage controlvm minikube natpf1 k8s-ingress-secure,tcp,127.0.0.1,9443,,443<br>VBoxManage controlvm minikube natpf1 docker,tcp,127.0.0.1,2376,,2376<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚é’ˆå¯¹é›†ç¾¤API Serverï¼Œå°†VirtualBoxåœ¨æœ¬æœºæ‰“å¼€çš„8443ç«¯å£è½¬å‘åˆ°é›†ç¾¤èŠ‚ç‚¹(VM)çš„8443ç«¯å£(é›†ç¾¤API Serverå¯¹åº”çš„ç«¯å£)ã€‚è¿™æ ·åœ¨kubeconfigçš„é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥é€šè¿‡<code>https://127.0.0.1:8443</code>æ¥è®¿é—®é›†ç¾¤API Serverï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority:</span> <span class="hljs-string">/Users/mike/.minikube/ca.crt</span><br>    <span class="hljs-attr">extensions:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">extension:</span><br>        <span class="hljs-attr">last-update:</span> <span class="hljs-string">Sat,</span> <span class="hljs-number">09</span> <span class="hljs-string">Apr</span> <span class="hljs-number">2022 18:42:47 </span><span class="hljs-string">CST</span><br>        <span class="hljs-attr">provider:</span> <span class="hljs-string">minikube.sigs.k8s.io</span><br>        <span class="hljs-attr">version:</span> <span class="hljs-string">v1.25.2</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">cluster_info</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://127.0.0.1:8443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minikube</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">minikube</span><br></code></pre></td></tr></table></figure><p>ç”±äºVirtualBoxåœ¨Macä¸Šæ˜¯ä»¥érootè´¦å·è¿è¡Œçš„ï¼Œæ‰€ä»¥åªèƒ½æ‰“å¼€æœ¬æœº1024ä»¥ä¸Šçš„ç«¯å£ï¼Œä½†è®¿é—®ingressæš´éœ²çš„HTTP/HTTPSæœåŠ¡æ—¶å°±éœ€è¦åŠ ä¸Šç«¯å£å·ï¼Œä½¿ç”¨èµ·æ¥å¹¶ä¸å‹å¥½ã€‚å¯ä»¥é€šè¿‡åŒ…è¿‡æ»¤é˜²ç«å¢™å»ºç«‹æœ¬æœº80ï¼Œ443ç«¯å£åˆ°ä¸Šé¢ingressçš„9080å’Œ9443ç«¯å£çš„è½¬å‘ã€‚Macçš„é…ç½®å‚è€ƒå¦‚ä¸‹ï¼š</p><h2 id="macOS-YosemiteåŠä»¥ä¸Šç‰ˆæœ¬"><a href="#macOS-YosemiteåŠä»¥ä¸Šç‰ˆæœ¬" class="headerlink" title="macOS YosemiteåŠä»¥ä¸Šç‰ˆæœ¬"></a>macOS YosemiteåŠä»¥ä¸Šç‰ˆæœ¬</h2><p>ipfwå·²ç»ä»macOS Yosemiteå’Œä»¥ä¸Šç‰ˆæœ¬è¢«ç§»é™¤äº†ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹æ³•ä½¿ç”¨pfã€‚</p><ul><li><p>åˆ›å»ºä¸€ä¸ªé”šæ–‡ä»¶<br>ä¾‹å¦‚ï¼Œ/etc/pf.anchors/minikube.nginx-ingress-controller</p></li><li><p>åœ¨/etc/pf.anchors/minikube.nginx-ingress-controlleré”šæ–‡ä»¶ä¸­, è¾“å…¥:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">rdr pass on lo0 inet proto tcp from any to 127.0.0.1 port 80 -&gt; 127.0.0.1 port 9080<br>rdr pass on lo0 inet proto tcp from any to 127.0.0.1 port 443 -&gt; 127.0.0.1 port 9443<br><br></code></pre></td></tr></table></figure><p>ç¡®ä¿åœ¨æœ«å°¾åŠ ä¸€è¡Œç©ºç™½è¡Œï¼Œå¦åˆ™ä¼šæŠ¥æ ¼å¼é”™è¯¯ã€‚</p></li><li><p>æµ‹è¯•è¿™ä¸ªé”šæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo pfctl -vnf /etc/pf.anchors/minikube.nginx-ingress-controller<br></code></pre></td></tr></table></figure></li><li><p>å°†è¿™ä¸ªé”šæ–‡ä»¶åŠ åˆ°pf.confæ–‡ä»¶ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vi /etc/pf.conf<br></code></pre></td></tr></table></figure><p>åœ¨å¯¹åº”çš„èŠ‚ä¸‹æ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rdr-anchor <span class="hljs-string">&quot;forwarding&quot;</span> <br>load anchor <span class="hljs-string">&quot;forwarding&quot;</span> from <span class="hljs-string">&quot;/etc/pf.anchors/minikube.nginx-ingress-controller&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>è‡ªåŠ¨åŠ è½½pf.confæ–‡ä»¶<br>å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ä»¥åœ¨å¯åŠ¨æ—¶åŠ è½½å’Œå¯ç”¨é…ç½®ï¼Œæˆ–è€…ç¼–è¾‘å½“å‰çš„pfå®ˆæŠ¤è¿›ç¨‹åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vi /System/Library/LaunchDaemons/com.apple.pfctl.plist<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ä»¥ä¸‹çš„èŠ‚ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;key&gt;ProgramArguments&lt;/key&gt;<br></code></pre></td></tr></table></figure><p>å¢åŠ é¢å¤–çš„ä¸€è¡Œå­—ç¬¦ä¸²â€-eâ€ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>pfctl<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>-e<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>-f<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/etc/pf.conf<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜åé‡å¯ç”µè„‘ã€‚</p><blockquote><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>sudo pfctl -ef /etc/pf.conf</code>æ‰‹åŠ¨æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼ˆä¸éœ€è¦é‡å¯ï¼‰ã€‚<br>å¦å¤–ï¼Œå¦‚æœä¸æƒ³æ”¹åŠ¨é…ç½®æ¥æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<br>echo â€œ<br>  rdr pass on lo0 inet proto tcp from any to 127.0.0.1 port 80 -&gt; 127.0.0.1 port 9080<br>  rdr pass on lo0 inet proto tcp from any to 127.0.0.1 port 443 -&gt; 127.0.0.1 port 9443<br>  â€œ | sudo pfctl -ef -</p></blockquote></li></ul><h2 id="macOS-10-9å’Œæ›´æ—©ç‰ˆæœ¬"><a href="#macOS-10-9å’Œæ›´æ—©ç‰ˆæœ¬" class="headerlink" title="macOS 10.9å’Œæ›´æ—©ç‰ˆæœ¬"></a>macOS 10.9å’Œæ›´æ—©ç‰ˆæœ¬</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é…ç½®ç«¯å£è½¬å‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo /sbin/ipfw add 102 fwd 127.0.0.1,9080 tcp from any to any 80 <span class="hljs-keyword">in</span><br>sudo /sbin/ipfw add 102 fwd 127.0.0.1,9443 tcp from any to any 443 <span class="hljs-keyword">in</span><br></code></pre></td></tr></table></figure><h1 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h1><p>æœ¬æ–‡æ—¨åœ¨ç®€å•ä»‹ç»Minikubeï¼Œå®ƒçš„æ¶æ„ä»¥åŠä½¿ç”¨ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©è¯»è€…å¯¹Minikubeæœ‰ä¸ªæ¡†æ¶æ€§çš„äº†è§£ï¼Œä»è€Œå†³å®šæ˜¯å¦éœ€è¦æ·±å…¥ä½¿ç”¨ã€‚å¯¹äºMinikubeæ›´è¯¦ç»†çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<a href="https://minikube.sigs.k8s.io/docs/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Kubernetes</tag>
      
      <tag>K8s</tag>
      
      <tag>Minikube</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡é˜¿é‡Œäº‘Kubernetesé›†ç¾¤å†…éƒ¨æœåŠ¡åŸŸåè§£æä¸ç¨³å®šçš„æ’æŸ¥</title>
    <link href="/2021/09/06/aliyun-coredns-issue-tracking/"/>
    <url>/2021/09/06/aliyun-coredns-issue-tracking/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ï¼Œç”±äºé¡¹ç›®éœ€æ±‚æ–°å»ºäº†ä¸€ä¸ªé˜¿é‡Œäº‘æ‰˜ç®¡ç‰ˆKubernetesé›†ç¾¤(Managed ACK)ï¼Œä½†æ˜¯å‘ç°éƒ¨ç½²åœ¨é›†ç¾¤ä¸­çš„å¾®æœåŠ¡ç›¸äº’è°ƒç”¨ä¸ç¨³å®šï¼Œå¯¼è‡´ä¸šåŠ¡ä¸å¯ç”¨ã€‚ç»è¿‡æ’æŸ¥ï¼Œæœ€ç»ˆå‘ç°æ·»åŠ åœ¨é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ä¸Šçš„å®‰å…¨ç»„ä¸å½“å‰é›†ç¾¤çš„å®‰å…¨ç»„ä¸ä¸€è‡´ï¼Œä½¿å¾—è·¨èŠ‚ç‚¹çš„Podè®¿é—®æµé‡è¢«é˜»æ­¢æ‰äº†ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¿™ä¸€é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ã€‚</p><span id="more"></span><h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨Podä¸­é€šè¿‡åŸŸåè®¿é—®æŸä¸ªæœåŠ¡æ—¶ï¼Œæœ‰æ—¶èƒ½æ­£å¸¸è®¿é—®ï¼Œæœ‰æ—¶è®¿é—®ä¸äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..100&#125;;<span class="hljs-keyword">do</span> curl http://&lt;service name&gt;.&lt;namespace&gt;.svc.cluster.local;<span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>é”™è¯¯å¤§è‡´ä¸º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Couldn<span class="hljs-string">&#x27;t resolve host xxxx</span><br></code></pre></td></tr></table></figure><p>ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œæ˜¯åŸŸåè§£æå‡ºäº†é—®é¢˜ã€‚ç”¨nslookupå‘½ä»¤å»æ£€æŸ¥åŸŸåè§£æï¼Œå‘ç°è§£æç¡®å®ä¸ç¨³å®šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..100&#125;;nslookup &lt;service name&gt;.&lt;namespace&gt;.svc.cluster.local;<span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h1 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h1><h2 id="ACKé›†ç¾¤çš„ç»“æ„ä»‹ç»"><a href="#ACKé›†ç¾¤çš„ç»“æ„ä»‹ç»" class="headerlink" title="ACKé›†ç¾¤çš„ç»“æ„ä»‹ç»"></a>ACKé›†ç¾¤çš„ç»“æ„ä»‹ç»</h2><p>åœ¨è¯¦ç»†æ’æŸ¥é—®é¢˜ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹é˜¿é‡Œäº‘ACKé›†ç¾¤çš„ç»“æ„ã€‚<a href="https://help.aliyun.com/document_detail/93689.html?spm=a2c4g.11186623.6.581.77ae30b7l5Hupx">é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡Kubernetesç‰ˆï¼ˆAlibaba Cloud Container Service for Kubernetesï¼Œç®€ç§°å®¹å™¨æœåŠ¡ACKï¼‰</a>åŒ…å«äº†ä¸“æœ‰ç‰ˆKubernetesï¼ˆDedicated Kubernetesï¼‰ã€æ‰˜ç®¡ç‰ˆKubernetesï¼ˆManaged Kubernetesï¼‰ã€Serverless Kubernetesä¸‰ç§å½¢æ€ã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯æ‰˜ç®¡ç‰ˆACKï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2021/09/06/aliyun-coredns-issue-tracking/1.png"></p><p>é›†ç¾¤çš„è¯¦ç»†ä¿¡æ¯ï¼š<br><img src="/2021/09/06/aliyun-coredns-issue-tracking/2.jpeg"></p><ul><li>Podç½‘ç»œç±»å‹æ˜¯Flannelï¼ŒCIDR: 172.20.0.0/16ã€‚æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹çš„æœ€å¤§çš„Podæ•°é‡ä¸º64 (ECS-1 CIDR: 172.20.0.192/26, ECS-2 CIDR: 172.20.0.128/26 â€¦)</li><li>Service CIDR: 172.21.0.0/20</li><li>ç³»ç»Ÿç»„ä»¶CoreDNSç›®å‰æœ‰ä¸¤ä¸ªPodï¼Œåˆ†åˆ«è¿è¡Œåœ¨ä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Š</li></ul><h2 id="æ£€æŸ¥å‰çš„å‡†å¤‡"><a href="#æ£€æŸ¥å‰çš„å‡†å¤‡" class="headerlink" title="æ£€æŸ¥å‰çš„å‡†å¤‡"></a>æ£€æŸ¥å‰çš„å‡†å¤‡</h2><p>åˆ†åˆ«åœ¨CoreDNS Podsæ‰€åœ¨çš„ä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šå„å¯åŠ¨ä¸€ä¸ªæµ‹è¯•Podï¼šPod(Busybox)ï¼ŒService(Nginx) + Pod(Nginx)ã€‚</p><blockquote><p>å°†æµ‹è¯•Podsåˆ†æ•£åœ¨ä¸åŒçš„å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¹¶è°ƒåº¦åˆ°CoreDNS Podsæ‰€åœ¨çš„å·¥ä½œèŠ‚ç‚¹ä¸­ï¼Œè¿™æ ·æ—¢èƒ½æµ‹è¯•åŒä¸€èŠ‚ç‚¹ä¸Šçš„CoreDNSè®¿é—®ï¼Œä¹Ÿèƒ½æµ‹è¯•è·¨èŠ‚ç‚¹çš„CoreDNSè®¿é—®ã€‚</p></blockquote><ul><li><p>åœ¨ECS-1ä¸»æœºä¸Šå¯åŠ¨Pod(Busybox)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">busybox</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">busybox</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>        <span class="hljs-attr">kubernetes.io/hostname:</span> <span class="hljs-string">cn-shanghai.10.0.1.121</span><br>      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">300</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">yauritux/busybox-curl:latest</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">sh</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;sleep 36000&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡nodeSelectorç»‘å®šåˆ°ECS-1ä¸»æœºï¼ˆ10.0.1.121ï¼‰ä¸Šã€‚</p></blockquote></li><li><p>åœ¨ECS-2ä¸»æœºä¸Šå¯åŠ¨Service(Nginx) + Pod(Nginx)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">dnsPolicy:</span> <span class="hljs-string">ClusterFirst</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>        <span class="hljs-attr">kubernetes.io/hostname:</span> <span class="hljs-string">cn-shanghai.10.0.2.121</span><br>      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">300</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:latest</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app.kubernetes.io/name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">app.kubernetes.io/instance:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-string">http</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡nodeSelectorç»‘å®šåˆ°ECS-2ä¸»æœºï¼ˆ10.0.2.121ï¼‰ä¸Šã€‚</p></blockquote></li></ul><h2 id="æ£€æŸ¥ç³»ç»Ÿç»„ä»¶CoreDNS"><a href="#æ£€æŸ¥ç³»ç»Ÿç»„ä»¶CoreDNS" class="headerlink" title="æ£€æŸ¥ç³»ç»Ÿç»„ä»¶CoreDNS"></a>æ£€æŸ¥ç³»ç»Ÿç»„ä»¶CoreDNS</h2><blockquote><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/">Debugging DNS Resolution</a></p></blockquote><h3 id="æ£€æŸ¥CoreDNS-Podæ˜¯å¦æ­£åœ¨è¿è¡Œ"><a href="#æ£€æŸ¥CoreDNS-Podæ˜¯å¦æ­£åœ¨è¿è¡Œ" class="headerlink" title="æ£€æŸ¥CoreDNS Podæ˜¯å¦æ­£åœ¨è¿è¡Œ"></a>æ£€æŸ¥CoreDNS Podæ˜¯å¦æ­£åœ¨è¿è¡Œ</h3><p>æ‰§è¡Œå‘½ä»¤<code>kubectl get pods</code>éªŒè¯CoreDNS Podæ­£åœ¨è¿è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get pods -l k8s-app=kube-dns -n kube-system<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">NAME                           READY   STATUS    RESTARTS   AGE<br>pod/coredns-849698df86-j9474   1/1     Running   0          9d<br>pod/coredns-849698df86-xl5g9   1/1     Running   0          9d<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰çœ‹åˆ°CoreDNS Podæ­£åœ¨è¿è¡Œï¼Œå¯èƒ½åœ¨ä½ å½“å‰çš„ç¯å¢ƒé‡Œç¼ºçœæ²¡æœ‰å®‰è£…CoreDNSæ’ä»¶ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…å®ƒã€‚å¦‚æœçœ‹åˆ°CoreDNS Podå¤±è´¥ï¼Œæ‰§è¡Œå‘½ä»¤<code>kubectl describe pod</code>æ£€æŸ¥CoreDNS Podçš„äº‹ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl describe pod -l k8s-app=kube-dns -n kube-system<br></code></pre></td></tr></table></figure><h3 id="æ£€æŸ¥CoreDNS-Podæ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯"><a href="#æ£€æŸ¥CoreDNS-Podæ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯" class="headerlink" title="æ£€æŸ¥CoreDNS Podæ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯"></a>æ£€æŸ¥CoreDNS Podæ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯</h3><p>è¿è¡ŒçŠ¶æ€æ­£å¸¸çš„Podå¹¶ä¸ä»£è¡¨æ²¡æœ‰é”™è¯¯ï¼Œæœ‰æ—¶ç¨‹åºä¼šå¤„ç†å¼‚å¸¸ä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚æ‰€ä»¥éœ€è¦æ‰§è¡Œå‘½ä»¤<code>kubectl logs</code>æ£€æŸ¥Podçš„æ—¥å¿—æ˜¯å¦æœ‰ä»»ä½•å¯ç–‘æˆ–å¼‚å¸¸çš„æ¶ˆæ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl logs -l k8s-app=kube-dns -n=kube-system<br></code></pre></td></tr></table></figure><p>æ­£å¸¸çš„CoreDNSæ—¥å¿—å®ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">.:53<br>[INFO] plugin/reload: Running configuration MD5 = 3be31de8f5d9c8e0b5a82d2b6bd5251b<br>CoreDNS-1.6.7<br>linux/amd64, go1.13.6, da7f65b<br><br>.:53<br>[INFO] plugin/reload: Running configuration MD5 = 3be31de8f5d9c8e0b5a82d2b6bd5251b<br>CoreDNS-1.6.7<br>linux/amd64, go1.13.6, da7f65b<br></code></pre></td></tr></table></figure><h3 id="æ£€æŸ¥CoreDNSæœåŠ¡"><a href="#æ£€æŸ¥CoreDNSæœåŠ¡" class="headerlink" title="æ£€æŸ¥CoreDNSæœåŠ¡"></a>æ£€æŸ¥CoreDNSæœåŠ¡</h3><p>æ‰§è¡Œå‘½ä»¤<code>kubect get svc -l k8s-app=kube-dns -n=kube-system</code>æ£€æŸ¥CoreDNSæœåŠ¡æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œå‚è€ƒ<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/">è°ƒè¯•æœåŠ¡</a>è¿›è¡Œæ’æŸ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">NAME               TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                  AGE<br>service/kube-dns   ClusterIP   172.21.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   450d<br></code></pre></td></tr></table></figure><h3 id="æ£€æŸ¥CoreDNS-endpointså¯¹è±¡æ˜¯å¦å­˜åœ¨"><a href="#æ£€æŸ¥CoreDNS-endpointså¯¹è±¡æ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æŸ¥CoreDNS endpointså¯¹è±¡æ˜¯å¦å­˜åœ¨"></a>æ£€æŸ¥CoreDNS endpointså¯¹è±¡æ˜¯å¦å­˜åœ¨</h3><p>æ‰§è¡Œå‘½ä»¤<code>kubectl get endpoints</code>æ£€æŸ¥CoreDNS endpointsæ˜¯å¦å­˜åœ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">NAME       ENDPOINTS                                                       AGE<br>kube-dns   172.20.0.146:53,172.20.0.205:53,172.20.0.146:9153 + 3 more...   458d<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ£€æŸ¥åˆ°endpointsï¼Œå‚è€ƒ<a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-service/">è°ƒè¯•æœåŠ¡</a>æ–‡æ¡£ä¸­çš„endpointsæ®µè½ã€‚</p><h3 id="æ£€æŸ¥DNSæŸ¥è¯¢æ˜¯å¦è¢«CoreDNSå¤„ç†"><a href="#æ£€æŸ¥DNSæŸ¥è¯¢æ˜¯å¦è¢«CoreDNSå¤„ç†" class="headerlink" title="æ£€æŸ¥DNSæŸ¥è¯¢æ˜¯å¦è¢«CoreDNSå¤„ç†"></a>æ£€æŸ¥DNSæŸ¥è¯¢æ˜¯å¦è¢«CoreDNSå¤„ç†</h3><p>é¦–å…ˆï¼Œä¿®æ”¹CoreDNSçš„é…ç½®æ·»åŠ æ—¥å¿—æ’ä»¶ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰“å¼€CoreDNSçš„é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl edit cm coredns -n kube-system<br></code></pre></td></tr></table></figure><p>åœ¨Corefileæ®µè½æ·»åŠ <code>log</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ConfigMap<br>data:<br>  Corefile: |-<br>    .:53 &#123;<br>      <span class="hljs-built_in">log</span><br>      autopath @kubernetes<br>      cache 30<br>      errors<br>      forward . /etc/resolv.conf<br>      health<br>      kubernetes cluster.local in-addr.arpa ip6.arpa &#123;<br>        pods verified<br>        fallthrough in-addr.arpa ip6.arpa<br>      &#125;<br>      loadbalance<br>      loop<br>      prometheus :9153<br>      ready<br>      reload<br>    &#125;<br></code></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰“å¼€CoreDNS Podsæ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl logs --tail 20 -f -l k8s-app=kube-dns -n kube-system | grep -E <span class="hljs-string">&quot;\&quot;A IN nginx.default.svc.cluster.local&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡grepå‘½ä»¤ä»…æå–åŸŸånginx.default.svc.cluster.localçš„DNSæŸ¥è¯¢æ—¥å¿—ï¼Œåé¢æˆ‘ä»¬å°†æŸ¥è¯¢è¿™ä¸ªåŸŸåã€‚</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›å…¥Pod(Busybox)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">exec</span> -it pod/busybox-757d9599bd-hdhhq -- sh<br></code></pre></td></tr></table></figure><p>åœ¨Pod(Busybox)ä¸­ï¼Œé‡å¤æŸ¥è¯¢åŸŸånginx.default.svc.cluster.localå¤šæ¬¡ï¼Œä¾‹å¦‚100æ¬¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq 1 100); <span class="hljs-keyword">do</span> nslookup nginx.default.svc.cluster.local; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>æ£€æŸ¥CoreDNS Podsæ—¥å¿—ï¼Œçœ‹æ˜¯å¦æœ‰åŒæ ·æ¬¡æ•°çš„åŸŸåè§£ææ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[INFO] 172.20.0.219:48418 - 4 <span class="hljs-string">&quot;A IN nginx.default.svc.cluster.local. udp 49 false 512&quot;</span> NOERROR qr,aa,rd 96 0.000179197s<br>[INFO] 172.20.0.219:59640 - 4 <span class="hljs-string">&quot;A IN nginx.default.svc.cluster.local. udp 49 false 512&quot;</span> NOERROR qr,aa,rd 96 0.000067985s<br>[INFO] 172.20.0.219:34682 - 4 <span class="hljs-string">&quot;A IN nginx.default.svc.cluster.local. udp 49 false 512&quot;</span> NOERROR qr,aa,rd 96 0.000072317s<br>[INFO] 172.20.0.219:37560 - 4 <span class="hljs-string">&quot;A IN nginx.default.svc.cluster.local. udp 49 false 512&quot;</span> NOERROR qr,aa,rd 96 0.000075455s<br>[INFO] 172.20.0.219:59156 - 4 <span class="hljs-string">&quot;A IN nginx.default.svc.cluster.local. udp 49 false 512&quot;</span> NOERROR qr,aa,rd 96 0.00006403s<br>......<br></code></pre></td></tr></table></figure><p>å¦‚æœåŸŸåè§£æçš„æ¬¡æ•°å°‘äºæŸ¥è¯¢çš„æ¬¡æ•°ï¼Œè¯´æ˜æœ‰äº›è§£æè¯·æ±‚æ²¡æœ‰è¢«CoreDNSè·å–ï¼Œå®¢æˆ·ç«¯<code>nslookup</code>å‘½ä»¤å°±ä¼šå‡ºç°æœ‰æ—¶è§£ææˆåŠŸï¼Œæœ‰æ—¶è§£æå¤±è´¥çš„æƒ…å†µã€‚è¿™ä¹Ÿè¯æ˜äº†å‰é¢æè¿°çš„åŸŸåè§£æä¸ç¨³å®šçš„é—®é¢˜ã€‚</p><h3 id="ç›´æ¥è°ƒç”¨CoreDNSçš„Pod-IPè§£æåŸŸå"><a href="#ç›´æ¥è°ƒç”¨CoreDNSçš„Pod-IPè§£æåŸŸå" class="headerlink" title="ç›´æ¥è°ƒç”¨CoreDNSçš„Pod IPè§£æåŸŸå"></a>ç›´æ¥è°ƒç”¨CoreDNSçš„Pod IPè§£æåŸŸå</h3><p>ç›´æ¥ä½¿ç”¨CoreDNS Pod IPå¯ä»¥é¿å…CoreDNSæœåŠ¡åˆ°CoreDNS Podçš„ä»£ç†è§£æã€‚å¦‚æœæ£€æŸ¥ä¸‹æ¥é—®é¢˜ä»æ—§å­˜åœ¨ï¼Œè¯´æ˜ä»CoreDNSæœåŠ¡åˆ°CoreDNS Podçš„ä»£ç†è§£ææ²¡æœ‰é—®é¢˜ï¼Œå¦åˆ™éœ€è¦è¯¦ç»†æ£€æŸ¥kube-proxyçš„çŠ¶æ€ã€‚</p><p>Pod(Busybox)ç¼ºçœä½¿ç”¨CoreDNSæœåŠ¡IPè°ƒç”¨CoreDNSè§£æåŸŸåã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹Pod(Busybox)ä¸­çš„DNSé…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">exec</span> -it pod/busybox-757d9599bd-hdhhq -- cat /etc/resolv.conf<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">nameserver 172.21.0.10<br>search default.svc.cluster.local svc.cluster.local cluster.local<br>options ndots:5<br></code></pre></td></tr></table></figure><p>172.21.0.10æ˜¯CoreDNSçš„æœåŠ¡IPã€‚</p><p>ç¼–è¾‘Pod(Busybox)ä¸­çš„<code>/etc/resolv.conf</code>å°†nameserveræ¢æˆåŒä¸€èŠ‚ç‚¹ä¸Šçš„CoreDNS Pod IPï¼ˆ172.20.0.205ï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥NginxæœåŠ¡åŸŸåçš„è§£ææƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq 1 100); <span class="hljs-keyword">do</span> nslookup nginx.default.svc.cluster.local; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä¸‹æ¥å‘ç°ä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„CoreDNS Podè§£æåŸŸåæ­£å¸¸ä¸”ç¨³å®šã€‚</p><p>å°†Pod(Busybox)çš„nameserveræ¢æˆå¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„CoreDNS Pod IPï¼ˆ172.20.0.146ï¼‰ï¼Œå†æ‰§è¡Œä¸Šé¢åŒæ ·çš„æµ‹è¯•å‘ç°åŸŸåè§£æéƒ½å¤±è´¥äº†ã€‚ è¿™ä¸ªæµ‹è¯•è¯´æ˜Pod(Busybox)å¯ä»¥è®¿é—®åŒä¸€èŠ‚ç‚¹ä¸Šçš„CoreDNS Podï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„CoreDNS Podï¼Œä¹Ÿå°±æ˜¯è·¨èŠ‚ç‚¹çš„Podä¹‹é—´æ— æ³•è®¿é—®ã€‚æ¥ä¸‹æ¥å°±éœ€è¦æ£€æŸ¥è·¨èŠ‚ç‚¹Podä¹‹é—´çš„è·¯ç”±ä¿¡æ¯æ˜¯å¦æ­£ç¡®äº†ã€‚</p><h2 id="æ£€æŸ¥ä»Pod-Busybox-åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šçš„CoreDNS-Podï¼ˆ172-20-0-146ï¼‰çš„è·¯ç”±ä¿¡æ¯"><a href="#æ£€æŸ¥ä»Pod-Busybox-åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šçš„CoreDNS-Podï¼ˆ172-20-0-146ï¼‰çš„è·¯ç”±ä¿¡æ¯" class="headerlink" title="æ£€æŸ¥ä»Pod(Busybox)åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šçš„CoreDNS Podï¼ˆ172.20.0.146ï¼‰çš„è·¯ç”±ä¿¡æ¯"></a>æ£€æŸ¥ä»Pod(Busybox)åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šçš„CoreDNS Podï¼ˆ172.20.0.146ï¼‰çš„è·¯ç”±ä¿¡æ¯</h2><ul><li><p>Pod(Busybox)é‡Œçš„è·¯ç”±ä¿¡æ¯<br><img src="/2021/09/06/aliyun-coredns-issue-tracking/3.png"><br>ä»Pod(Busybox)å‡ºæ¥çš„æµé‡ä¼šé€šè¿‡çº¢è‰²çš„è·¯ç”±è§„åˆ™è¿›å…¥åˆ°èŠ‚ç‚¹ECS-1ã€‚</p></li><li><p>VPCé‡Œè·¨èŠ‚ç‚¹ä¹‹é—´çš„è·¯ç”±ä¿¡æ¯<br><img src="/2021/09/06/aliyun-coredns-issue-tracking/4.png"><br>çº¢æ¡†ä¸­çš„ç³»ç»Ÿè·¯ç”±è§„åˆ™ä½¿ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è·¯ç”±å¯è¾¾ã€‚</p><p><img src="/2021/09/06/aliyun-coredns-issue-tracking/5.png"><br>è“æ¡†ä¸­çš„è·¯ç”±è§„åˆ™ä½¿æµé‡ä»ECS-1è·¯ç”±åˆ°ECS-2ä¸­ã€‚</p></li><li><p>ECS-2çš„è·¯ç”±ä¿¡æ¯<br><img src="/2021/09/06/aliyun-coredns-issue-tracking/6.png"><br>çº¢è‰²è·¯ç”±è§„åˆ™ä½¿å¾—æµé‡ä»ECS-2è·¯ç”±åˆ°ç½‘æ¡¥æ¥å£cni0ï¼Œæœ€ç»ˆç”±cni0æ ¹æ®ç›®çš„Pod IPåœ°å€è¿›å…¥CoreDNS Podï¼ˆ172.20.0.146ï¼‰ã€‚</p></li></ul><p>ä»è·¯ç”±åˆ†æä¸‹æ¥çœ‹ï¼Œè·¨èŠ‚ç‚¹Podä¹‹å‰ç›¸äº’è®¿é—®æ²¡æœ‰é—®é¢˜ã€‚æ¥ä¸‹æ¥å°±éœ€è¦æ£€æŸ¥æ–½åŠ åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šçš„å®‰å…¨ç»„è§„åˆ™ï¼Œçœ‹æµé‡æ˜¯å¦è¢«ç¦æ­¢äº†ã€‚</p><h2 id="æ£€æŸ¥å®‰å…¨ç»„"><a href="#æ£€æŸ¥å®‰å…¨ç»„" class="headerlink" title="æ£€æŸ¥å®‰å…¨ç»„"></a>æ£€æŸ¥å®‰å…¨ç»„</h2><p>é€šè¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œæœ€ç»ˆå‘ç°å·¥ä½œèŠ‚ç‚¹ä¸Šçš„å®‰å…¨ç»„å¹¶ä¸æ˜¯å½“å‰é›†ç¾¤å¯¹åº”çš„å®‰å…¨ç»„ï¼Œä»è€Œå¯¼è‡´æ‰€æœ‰è·¨èŠ‚ç‚¹ä¹‹å‰çš„Podè®¿é—®æµé‡è¢«ç¦æ­¢äº†ã€‚å®‰å…¨ç»„ç”¨é”™çš„åŸå› æ˜¯åœ¨æ–°å»ºACKé›†ç¾¤æ—¶å¹¶æ²¡æœ‰åˆ›å»ºæ–°çš„èŠ‚ç‚¹è€Œæ˜¯é€‰æ‹©äº†å·²ç»å­˜åœ¨çš„èŠ‚ç‚¹ã€‚</p><h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>æ‰¾åˆ°é—®é¢˜åï¼Œè§£å†³æ–¹æ¡ˆå°±ç®€å•äº†ï¼Œä¹Ÿå°±æ˜¯å°†æ‰€æœ‰çš„å·¥ä½œèŠ‚ç‚¹çš„å®‰å…¨ç»„å…¨éƒ¨æ¢æˆå½“å‰é›†ç¾¤çš„å®‰å…¨ç»„ã€‚</p><h1 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h1><p>å¯¹äºè¿™æ¬¡çš„é—®é¢˜å®šä½å’Œè§£å†³èŠ±è´¹äº†ä¸€å®šçš„ç²¾åŠ›ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜æœªæ¥ä¹Ÿå¯èƒ½å†æ¬¡å‡ºç°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¨èŠ‚ç‚¹Podä¹‹é—´çš„ç½‘ç»œè¿é€šæ€§çº³å…¥åˆ°ç›‘æ§ç³»ç»Ÿä¸­ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸‹æ¬¡åŒæ ·çš„é—®é¢˜å‡ºç°æ—¶ï¼Œèƒ½å¤Ÿé€šè¿‡ç›‘æ§ç³»ç»Ÿå¿«é€Ÿçš„å‘ç°å’Œå®šä½é—®é¢˜ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>AliCloud</tag>
      
      <tag>Aliyun</tag>
      
      <tag>ACK</tag>
      
      <tag>Kubernetes</tag>
      
      <tag>K8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…æSonarQubeæ’ä»¶çš„è¿è¡ŒåŸç†</title>
    <link href="/2021/01/17/sonar-plugin-principle/"/>
    <url>/2021/01/17/sonar-plugin-principle/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å…¬å¸çš„æŸä¸ªJavaé¡¹ç›®çš„<a href="https://www.sonarqube.org/">SonarQube</a>é™æ€ä»£ç æ‰«æå‡ºäº†é—®é¢˜ï¼Œè™½ç„¶æœ€ç»ˆè§£å†³äº†ï¼Œä½†æ˜¯åœ¨æ’æŸ¥é—®é¢˜çš„è¿‡ç¨‹ä¸­èµ°äº†ä¸€äº›å¼¯è·¯ï¼Œå¤šèŠ±äº†ç‚¹æ—¶é—´ã€‚åˆ†æä¸‹æ¥ï¼Œä¸»è¦åŸå› è¿˜æ˜¯å¯¹SonarQubeæ’ä»¶çš„è¿è¡Œæœºåˆ¶ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚æœ¬æ–‡ä»åˆ†æSonarQubeæ‰«æçš„é—®é¢˜å‡ºå‘ç®€å•åœ°ä»‹ç»ä¸‹SonarQubeæ’ä»¶çš„è¿è¡ŒåŸç†ã€‚</p><span id="more"></span><h1 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h1><p>é¡¹ç›®æ˜¯ç”¨Mavenæ„å»ºçš„ï¼ŒMavençš„<a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner-for-maven/">SonarScanneræ’ä»¶</a>ç”¨æ¥åšé™æ€ä»£ç æ‰«æã€‚æœ€è¿‘é¡¹ç›®çš„Javaç‰ˆæœ¬å‡çº§åˆ°14ï¼ŒSonarQubeæ‰«æå°±é‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs txt">[ERROR] Failed to execute goal org.sonarsource.scanner.maven:sonar-maven-plugin:3.7.0.1746:sonar<br>(default-cli) on project aid-range-ocean: Unsupported Java version for PMD: 14 -&gt; [Help 1]<br>[ERROR]<br>[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.<br>[ERROR] Re-run Maven using the -X switch to enable full debug logging.<br>[ERROR]<br>[ERROR] For more information about the errors and possible solutions, please read the following articles:<br>[ERROR] [Help 1]<br></code></pre></td></tr></table></figure><p>ä»é”™è¯¯æ—¥å¿—çœ‹ï¼ŒPMDä¸æ”¯æŒJava14ã€‚å†ä»ä¸‹é¢çš„Sonaræ‰«æçš„æ—¥å¿—çœ‹ï¼Œå½“å‰ä½¿ç”¨çš„PMDç‰ˆæœ¬ä¸º6.10.0ç‰ˆæœ¬ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs txt">[INFO] Load metrics repository<br>[INFO] Load metrics repository (done) | time=268ms<br>[INFO] Sensor JavaSquidSensor [java]<br>[INFO] Sensor JavaSquidSensor [java] (done) | time=2289ms<br>[INFO] Sensor PmdSensor [pmd]<br>[INFO] Execute PMD 6.10.0<br>[INFO] Execute PMD 6.10.0 (done) | time=15ms<br></code></pre></td></tr></table></figure><p>åœ¨<a href="https://github.com/pmd/pmd/releases/tag/pmd_releases%2F6.22.0#java-14-support">PMDçš„GitHubç½‘ç«™</a>çœ‹åˆ°PMDä»6.22.0ç‰ˆæœ¬æ‰å¼€å§‹æ”¯æŒJava14ã€‚åˆšå¼€å§‹ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯å¦‚ä½•è®©Mavençš„SonarScanneræ’ä»¶ä½¿ç”¨æ–°ç‰ˆæœ¬çš„PMDï¼Œæ‰€ä»¥å¼•å…¥äº†<a href="https://maven.apache.org/plugins/maven-pmd-plugin/">Maven PMDæ’ä»¶</a>å¹¶è®¾ç½®PMDçš„ç‰ˆæœ¬ä¸º6.29.0ï¼Œä»¥ä¸‹æ˜¯Mavençš„POMæ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pmd.plugin.version</span>&gt;</span>3.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">pmd.plugin.version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pmd.version</span>&gt;</span>6.29.0<span class="hljs-tag">&lt;/<span class="hljs-name">pmd.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-pmd-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;pmd.plugin.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.pmd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pmd-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;pmd.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.pmd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pmd-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;pmd.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.pmd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pmd-javascript<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;pmd.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.pmd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pmd-jsp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;pmd.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-pmd-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- failOnViolation is actually true by default, but can be disabled --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">failOnViolation</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">failOnViolation</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- printFailingErrors is pretty useful --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">printFailingErrors</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">printFailingErrors</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">targetJdk</span>&gt;</span>14<span class="hljs-tag">&lt;/<span class="hljs-name">targetJdk</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿è¡Œä¸‹æ¥å‘ç°é—®é¢˜å¹¶æ²¡æœ‰è§£å†³ï¼Œè€Œä¸”åˆå¤šäº†æ¬¡PMDæ‰«æã€‚è¿™ä¸ªæ‰«ææ¥è‡ªäºMaven PMDæ’ä»¶ï¼Œç”¨çš„ç‰ˆæœ¬ç¡®å®æ˜¯æˆ‘ä»¬è®¾ç½®çš„6.29.0ç‰ˆæœ¬ï¼Œä¹Ÿç¡®å®èƒ½å¤Ÿæ”¯æŒJava14ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs txt">[INFO] --- maven-pmd-plugin:3.14.0:check (default) @ xxxx ---<br>[INFO] PMD version: 6.29.0<br>[INFO] You have 41 PMD violations. For more details see: xxxx/target/pmd.xml<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼ŒMaven PMDæ’ä»¶å’ŒSonaræ‰«ææ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œå³ä½¿æ²¡æœ‰SonarQubeï¼ŒMaven PMDæ’ä»¶ä¹Ÿèƒ½å¤Ÿå•ç‹¬æ‰«æJavaä»£ç ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æŠŠæ€è·¯è½¬åˆ°SonarQubeçš„æ’ä»¶ä¸Šäº†ï¼Œè€Œä¸”å‘ç°SonarQubeçš„æœåŠ¡ç«¯ç¡®å®å®‰è£…äº†ä¸€ä¸ª<a href="https://github.com/jensgerdes/sonar-pmd">SonarQubeçš„PMDæ’ä»¶</a>ï¼Œä¸”ç‰ˆæœ¬ä¸º3.2.1ã€‚ä»SonarQube PMDæ’ä»¶çš„GitHubé¡µé¢çœ‹ï¼Œç‰ˆæœ¬3.2.1æ”¯æŒçš„PMDç‰ˆæœ¬ä¸º6.9.0ï¼Œç¡®å®ä¸æ”¯æŒJava14, è€ŒSonarQubeçš„PMDæ’ä»¶ä»3.3.xç‰ˆæœ¬æ‰å¼€å§‹æ”¯æŒPMD 6.30.0ç‰ˆæœ¬ï¼Œä¹Ÿå°±èƒ½å¤Ÿæ”¯æŒJava14ã€‚å½“æŠŠSonarQubeçš„PMDæ’ä»¶å‡çº§ä¸º3.3.0åï¼Œé—®é¢˜è§£å†³äº†ã€‚å†ä»”ç»†åˆ†æå®¢æˆ·ç«¯SonarQubeæ‰«ææ—¥å¿—å‘ç°Maven SonarScanneræ’ä»¶ä¼šå°†SonarQubeçš„PMDæ’ä»¶ä¸‹è½½åˆ°æœ¬åœ°ç¼“å­˜ç›®å½•ä¸­ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯Maven SonarScanneræ’ä»¶è°ƒç”¨SonarQube PMDæ’ä»¶åšPMDæ‰«æã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs txt">[INFO] --- sonar-maven-plugin:3.7.0.1746:sonar (default-cli) @ xxxx ---<br>[INFO] User cache: /xxxx/.sonar/cache<br>[INFO] SonarQube version: 7.9.4<br>[INFO] Default locale: &quot;en_CN&quot;, source code encoding: &quot;UTF-8&quot;<br>[INFO] Load global settings<br>[INFO] Load global settings (done) | time=1676ms<br>[INFO] Server id: 9C01C42E-1505da3410fc976<br>[INFO] User cache: /xxxx/.sonar/cache<br>[INFO] Load/download plugins<br>[INFO] Load plugins index<br>[INFO] Load plugins index (done) | time=295ms<br>[INFO] Load/download plugins (done) | time=501ms<br></code></pre></td></tr></table></figure><p>æœç´¢äº†ä¸‹SonarQubeæœ¬åœ°ç¼“å­˜ç›®å½•ï¼Œç¡®å®å‘ç°äº†SonarQube PMDæ’ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">/xxxx/.sonar/cache/5528f475b7c3651f5a42841b092164fa<br><br>Jan 18:58 sonar-pmd-plugin.jar<br>Jan 18:58 sonar-pmd-plugin.jar_unzip<br></code></pre></td></tr></table></figure><p>çœ‹äº†ä¸‹SonarQube PMDæ’ä»¶çš„è§£å‹ç›®å½•ï¼Œå®ƒå¼•ç”¨äº†PMD 6.30.0ç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">/xxxx/.sonar/cache/5528f475b7c3651f5a42841b092164fa/sonar-pmd-plugin.jar_unzip/META-INF/lib<br><br>-rw-r--r--  1 mizha53  619956085  1241504 13 Jan 18:58 pmd-core-6.30.0.jar<br>-rw-r--r--  1 mizha53  619956085  1141858 13 Jan 18:58 pmd-java-6.30.0.jar<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨ææ¸…æ¥šSonarQube PMDæ‰«æçš„è°ƒç”¨é¡ºåºï¼šMaven SonarScanneræ’ä»¶ä¸‹è½½SonarQube PMDæ’ä»¶åˆ°æœ¬åœ°ç¼“å­˜ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨çš„è¯ï¼‰, Maven SonarScanneræ’ä»¶è°ƒç”¨SonarQube PMDæ’ä»¶ï¼ŒSonarQube PMDæ’ä»¶æœ€ç»ˆè°ƒç”¨PMDå®Œæˆæ‰«æã€‚ä½†æ˜¯SonarQubeçš„æ’ä»¶ä»…ä»…æ˜¯è¿è¡Œåœ¨å®¢æˆ·ç«¯å—ï¼Œæ‰«æåçš„ç»“æœä¸Šä¼ åˆ°æœåŠ¡ç«¯åå¦‚ä½•å¤„ç†ï¼Œç”±è°æ¥å¤„ç†ï¼Ÿç­”æ¡ˆè¿˜æ˜¯SonarQubeæ’ä»¶ï¼ŒSonarQubeæ’ä»¶æ˜¯å¯¹SonarQubeçš„æ‰©å±•ï¼Œæ—¢å¯ä»¥è¿è¡Œåœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±äº†è§£ä¸‹SonarQubeæ’ä»¶çš„åŸç†ã€‚</p><h1 id="SonarQubeæ’ä»¶åŸç†"><a href="#SonarQubeæ’ä»¶åŸç†" class="headerlink" title="SonarQubeæ’ä»¶åŸç†"></a>SonarQubeæ’ä»¶åŸç†</h1><h2 id="SonarQubeæ¶æ„"><a href="#SonarQubeæ¶æ„" class="headerlink" title="SonarQubeæ¶æ„"></a>SonarQubeæ¶æ„</h2><p><img src="/2021/01/17/sonar-plugin-principle/1.png" alt="SonarQubeæ¶æ„"></p><ul><li><p>SonarQubeæœåŠ¡åŒ…å«äº†ä¸‰ä¸ªè¿›ç¨‹ï¼š</p><ul><li>WebæœåŠ¡ç»™å¼€å‘äººå‘˜æˆ–è€…ç»ç†æµè§ˆä»£ç è´¨é‡å¿«ç…§å¹¶é…ç½®SonarQubeå®ä¾‹</li><li>åŸºäºElasticSearchçš„æœç´¢æœåŠ¡æ”¯æŒä»UIç•Œé¢æœç´¢ä¿¡æ¯</li><li>è®¡ç®—å¼•æ“æœåŠ¡è´Ÿè´£å¤„ç†ä»£ç åˆ†ææŠ¥å‘Šå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨SonarQubeæ•°æ®åº“ä¸­</li></ul></li><li><p>SonarQubeæ•°æ®åº“ç”¨æ¥å­˜å‚¨ï¼š</p><ul><li>SonarQubeå®ä¾‹çš„é…ç½®ï¼ˆå®‰å…¨ï¼Œæ’ä»¶é…ç½®ç­‰ï¼‰</li><li>é¡¹ç›®æˆ–è§†å›¾çš„è´¨é‡å¿«ç…§</li></ul></li><li><p>å®‰è£…åœ¨æœåŠ¡ç«¯çš„å¤šä¸ªSonarQubeæ’ä»¶ï¼ŒåŒ…æ‹¬è¯­è¨€ï¼ŒSCMï¼Œé›†æˆï¼Œè®¤è¯å’Œç®¡ç†æ’ä»¶</p></li><li><p>è¿è¡Œåœ¨æ„å»ºæˆ–æŒç»­é›†æˆæœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªå¤šä¸ªSonarScannerç”¨æ¥åˆ†æé¡¹ç›®</p></li><li><p>é›†æˆåœ¨ä¸åŒIDEä¸­çš„SonarLintæ’ä»¶ï¼Œåœ¨å¼€å‘äººå‘˜çš„IDEä¸­å®æ—¶åˆ†æä»£ç è´¨é‡</p></li></ul><h2 id="SonarQubeæ’ä»¶"><a href="#SonarQubeæ’ä»¶" class="headerlink" title="SonarQubeæ’ä»¶"></a>SonarQubeæ’ä»¶</h2><p>SonarQubeåœ¨ä»¥ä¸‹çš„å››ä¸ªæŠ€æœ¯æ ˆä¸­æä¾›äº†æ‰©å±•ç‚¹ï¼š</p><ul><li>æ‰«æå™¨(Scanner)ï¼Œæ‰§è¡Œæºä»£ç åˆ†æ</li><li>è®¡ç®—å¼•æ“ï¼Œæ•´åˆæ‰«æå™¨çš„ç»“æœ</li><li>Webåº”ç”¨</li><li>SonarLint</li></ul><p>ä¸€ä¸ªSonarQubeæ’ä»¶å¯ä»¥å¯¹ä¸€ä¸ªï¼Œå¤šä¸ªæˆ–æ‰€æœ‰çš„æŠ€æœ¯æ ˆå®ç°æ‰©å±•ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„SonarQube PMDæ’ä»¶å®ç°äº†æ‰€æœ‰æŠ€æœ¯æ ˆçš„æ‰©å±•ï¼š<br><img src="/2021/01/17/sonar-plugin-principle/2.png" alt="SonarQube PMDæ’ä»¶æ‰©å±•SonarQube"></p><p>æ¯ä¸€ä¸ªæ‰©å±•ç‚¹éƒ½æ˜¯ä¸€ä¸ªJavaç±»ï¼Œè€Œä¸€ä¸ªæ‰©å±•ç‚¹å¯ä»¥åŒæ—¶å®ç°å¤šä¸ªæŠ€æœ¯æ ˆã€‚ä¾‹å¦‚ï¼ŒPmdSensorå³æ‰©å±•äº†SonarLintï¼Œåˆæ‰©å±•äº†SonarQube Scannerï¼Œä¹Ÿå°±æ˜¯Javaç±»PmdSensorå³è¿è¡Œåœ¨SonarLintä¸­ï¼Œä¹Ÿè¿è¡Œåœ¨SonarScannerä¸­ã€‚â€SonarLintSideâ€ï¼Œâ€œScannerSideâ€ï¼Œâ€œServerSideâ€å’Œâ€œComputeEngineSideâ€æ˜¯Javaä¸­ç”¨æ¥æ ‡æ³¨æ‰©å±•ç‚¹çš„Javaç±»ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ScannerSide</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PmdConfiguration</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PROPERTY_GENERATE_XML = <span class="hljs-string">&quot;sonar.pmd.generateXml&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PMD_RESULT_XML = <span class="hljs-string">&quot;pmd-result.xml&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = Loggers.get(PmdConfiguration.class);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileSystem fileSystem;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Configuration settings;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PmdConfiguration</span><span class="hljs-params">(FileSystem fileSystem, Configuration settings)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.fileSystem = fileSystem;<br>        <span class="hljs-keyword">this</span>.settings = settings;<br>    &#125;<br>...<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œç”±ä¸Šé¢SonarQubeæ’ä»¶çš„åˆ†ææ¥çœ‹ï¼ŒSonarQubeçš„æ’ä»¶å…·ä½“è¿è¡Œåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œå°±çœ‹å®ƒæ‰©å±•äº†å“ªäº›æŠ€æœ¯æ ˆã€‚å¦‚æœå®ƒæ‰©å±•äº†æ‰«æå™¨(Scanner)ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„æ‰«æå™¨(Scanner)åœ¨æ‰§è¡Œä»£ç æ‰«æçš„æ—¶å€™å°±ä¼šä¸‹è½½è¿™ä¸ªæ’ä»¶åˆ°æœ¬åœ°ç¼“å­˜ç›®å½•å¹¶æ‰§è¡Œé‡Œé¢çš„Javaç±»ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SonarQube</tag>
      
      <tag>Code Quality</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜¿é‡Œäº‘é€šè¿‡RAMè§’è‰²ç®¡ç†å¤šäº‘è´¦å·ä¸‹çš„èµ„æº</title>
    <link href="/2021/01/05/aliyun-ram-role-multi-accounts/"/>
    <url>/2021/01/05/aliyun-ram-role-multi-accounts/</url>
    
    <content type="html"><![CDATA[<p>äº‘è®¡ç®—ç»è¿‡åå‡ å¹´çš„å‘å±•å·²ç»å˜å¾—å¾ˆæˆç†Ÿï¼Œæ— è®ºæ˜¯ä¼ ç»Ÿä¼ä¸šè¿˜æ˜¯åˆåˆ›ä¼ä¸šéƒ½å°†äº‘è®¡ç®—å¹³å°ä½œä¸ºå…¶æ•°å­—åŒ–ç­–ç•¥çš„æ”¯æ’‘å¹³å°ã€‚åœ¨å›½å†…ï¼Œé˜¿é‡Œäº‘æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„å…¬æœ‰äº‘å¹³å°ï¼Œå¾ˆå¤šæœ¬åœŸä¼ä¸šå’Œå¤–èµ„ä¼ä¸šåœ¨åçš„åˆ†æ”¯æœºæ„éƒ½æ˜¯é¦–é€‰é˜¿é‡Œäº‘æ¥æ„å»ºå’Œè¿è¡Œä»–ä»¬çš„æ•°å­—åŒ–æ–¹æ¡ˆã€‚ä¸ºäº†èƒ½å¤Ÿé«˜æ•ˆåœ°ä½¿ç”¨é˜¿é‡Œäº‘ï¼ŒåŒæ—¶åˆèƒ½å¯¹æ¥é˜¿é‡Œäº‘äº§å“æœåŠ¡å›¢é˜Ÿï¼Œåœ¨è¿™äº›å…¬å¸é‡Œé€æ¸åœ°å‡ºç°äº†ä¸€ä¸ªæ–°çš„è§’è‰²æˆ–å›¢é˜Ÿæ¥ç»Ÿä¸€è§„åˆ’ã€ç®¡ç†é˜¿é‡Œäº‘å¹³å°ï¼Œæˆ‘ä»¬å°±æš‚ä¸”ç§°è¿™ä¸ªå›¢é˜Ÿä¸ºäº‘å›¢é˜Ÿã€‚å¤§éƒ¨åˆ†å…¬å¸äº‘å›¢é˜Ÿå¾€å¾€éœ€è¦ç®¡ç†å¤šä¸ªé˜¿é‡Œäº‘è´¦å·ï¼Œè€Œåœ¨ä¸åŒçš„è´¦å·é‡Œçš„ç”¨æˆ·åˆ›å»ºã€ç™»å½•ã€ç™»å‡ºçš„æ“ä½œå¾€å¾€ä¼šå˜çš„å¾ˆéº»çƒ¦ã€‚æœ¬æ–‡ä»‹ç»é€šè¿‡åˆ‡æ¢èº«ä»½çš„æ–¹å¼æ‰®æ¼”<a href="https://help.aliyun.com/document_detail/93689.html?spm=a2c4g.11186623.6.581.77ae30b7l5Hupx">RAMè§’è‰²</a>æ¥ç®¡ç†å¤šäº‘è´¦å·ä¸‹çš„èµ„æºã€‚</p><span id="more"></span><h1 id="å¤šäº‘è´¦å·"><a href="#å¤šäº‘è´¦å·" class="headerlink" title="å¤šäº‘è´¦å·"></a>å¤šäº‘è´¦å·</h1><p>å…¬å¸åœ¨ä½¿ç”¨é˜¿é‡Œäº‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºäºä¸åŒçš„ç›®çš„æˆ–è€…å—ç»„ç»‡æ¶æ„çš„çº¦æŸï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šåˆ›å»ºå¤šä¸ªäº‘è´¦å·ã€‚ä¼ ç»Ÿçš„å…¬å¸æˆ–è€…ç»å¤§éƒ¨åˆ†å¤–èµ„å…¬å¸åœ¨è´¢åŠ¡ä¸Šéƒ½ä¼šä¸ºä¸åŒçš„éƒ¨é—¨æˆ–å›¢é˜Ÿåˆ›å»ºä¸åŒçš„æˆæœ¬ä¸­å¿ƒ(cost center)å¹¶åˆ†é…å¯¹åº”çš„é¢„ç®—ï¼Œéƒ¨é—¨æˆ–å›¢é˜Ÿçš„å¼€æ”¯éƒ½æ˜¯èµ°è‡ªå·±çš„æˆæœ¬ä¸­å¿ƒã€‚è¿™å°±å†³å®šäº†å½“æŸä¸ªéƒ¨é—¨æˆ–å›¢é˜Ÿåœ¨ä½¿ç”¨é˜¿é‡Œäº‘çš„æ—¶å€™ï¼Œå¿…å®šä¼šåˆ›å»ºè‡ªå·±çš„äº‘è´¦å·ï¼Œè€Œä¸ä¼šå»ä½¿ç”¨åˆ«çš„æˆæœ¬ä¸­å¿ƒä¸‹çš„é˜¿é‡Œäº‘è´¦å·ã€‚ä¸€äº›ä¸­å°å‹çš„äº’è”ç½‘å…¬å¸æˆ–è€…åˆ›ä¸šå…¬å¸çš„è´¢åŠ¡ä¸ä¼šé‚£ä¹ˆå¤æ‚ï¼Œç ”å‘å¯èƒ½å°±ä¸€ä¸ªæˆæœ¬ä¸­å¿ƒï¼Œä½†æ˜¯å¾€å¾€éœ€è¦å¤šä¸ªé˜¿é‡Œäº‘è´¦å·æ¥éš”ç¦»ä¸åŒçš„ç¯å¢ƒï¼Œä¾‹å¦‚å¼€å‘ï¼Œæµ‹è¯•ï¼Œé¢„ç”Ÿäº§å’Œå’Œç”Ÿäº§ç¯å¢ƒã€‚</p><p>ä½¿ç”¨å¤šä¸ªé˜¿é‡Œäº‘è´¦å·æœ‰ä»¥ä¸‹ä¸€äº›ä¼˜ç‚¹ï¼š</p><ul><li>ä¸åŒè´¦å·çš„äº‘èµ„æºæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œç›¸äº’ä¹‹é—´ä¸å—å½±å“ã€‚</li><li>å¯ä»¥å•ç‹¬å‡ºè´¦å•ï¼Œåšåˆ°æŒ‰ä¸åŒæˆæœ¬ä¸­å¿ƒæ ¸ç®—ã€‚</li><li>å¦‚æœæ„å»ºçš„å¾®æœåŠ¡ç³»ç»Ÿæ¶‰åŠåˆ°å¤šä¸ªä¸šåŠ¡éƒ¨é—¨æˆ–å›¢é˜Ÿï¼Œå„ä¸ªä¸šåŠ¡éƒ¨é—¨æˆ–å›¢é˜Ÿåœ¨è‡ªå·±çš„é˜¿é‡Œäº‘è´¦å·é‡Œåªç»´æŠ¤æˆ–è¿è¡Œè‡ªå·±è´Ÿè´£çš„å¾®æœåŠ¡ï¼Œè¿™æ ·å¯ä»¥é™ä½å•ä¸ªé˜¿é‡Œäº‘è´¦å·ä¸‹æ¶æ„çš„å¤æ‚æ€§ã€‚</li></ul><p>ä½†æ˜¯äº‘å›¢é˜Ÿåœ¨ç®¡ç†å¤šä¸ªé˜¿é‡Œäº‘è´¦å·æ—¶ä¹Ÿä¼šé‡åˆ°å¾ˆå¤šéº»çƒ¦ï¼š</p><ul><li>éœ€è¦é‡å¤åœ°ç™»å½•ï¼Œç™»å‡ºå’ŒåŒå› ç´ è®¤è¯æ¥åˆ‡æ¢ä¸åŒçš„è´¦å·ã€‚</li><li>é˜¿é‡Œäº‘æ”¯æŒå•ç‚¹ç™»å½•(SSO)ï¼Œè¿™æ ·å¯ä»¥çœæ‰åŒå› ç´ è®¤è¯çš„æ­¥éª¤ï¼Œä½†å½“å‡ºç°é—®é¢˜æ—¶ï¼Œæ— æ³•åˆ›å»ºä¸€ä¸ªéSSOè´¦å·ç»™é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒç”¨æ¥ä¸´æ—¶ç™»å½•è¿›è´¦å·è°ƒè¯•é—®é¢˜ã€‚</li><li>å›¢é˜Ÿæˆå‘˜å…¥èŒï¼Œç¦»èŒæ—¶éƒ½éœ€è¦é€šçŸ¥äº§å“æ‹¥æœ‰è€…åœ¨é˜¿é‡Œäº‘è´¦å·é‡Œåˆ›å»ºå’Œåˆ é™¤RAMç”¨æˆ·ã€‚</li><li>æ¯ä¸ªäº‘å›¢é˜Ÿæˆå‘˜éƒ½éœ€è¦éœ€è¦è®°ä½å¾ˆå¤šäº‘è´¦å·ã€‚</li></ul><h1 id="é€šè¿‡RAMè§’è‰²ç®¡ç†å¤šäº‘è´¦å·"><a href="#é€šè¿‡RAMè§’è‰²ç®¡ç†å¤šäº‘è´¦å·" class="headerlink" title="é€šè¿‡RAMè§’è‰²ç®¡ç†å¤šäº‘è´¦å·"></a>é€šè¿‡RAMè§’è‰²ç®¡ç†å¤šäº‘è´¦å·</h1><p>ä¸ºäº†è§£å†³å¤šäº‘è´¦å·ç®¡ç†çš„ç—›ç‚¹ï¼Œå¯ä»¥é€šè¿‡RAMç”¨æˆ·æ‰®æ¼”RAMè§’è‰²çš„æ–¹å¼æ¥ç™»å½•é˜¿é‡Œäº‘å…¶å®ƒè´¦å·ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯RAMè§’è‰²"><a href="#ä»€ä¹ˆæ˜¯RAMè§’è‰²" class="headerlink" title="ä»€ä¹ˆæ˜¯RAMè§’è‰²"></a>ä»€ä¹ˆæ˜¯RAMè§’è‰²</h2><p>RAMè§’è‰²ï¼ˆRAM roleï¼‰ä¸RAMç”¨æˆ·ä¸€æ ·ï¼Œéƒ½æ˜¯RAMèº«ä»½ç±»å‹çš„ä¸€ç§ã€‚RAMè§’è‰²æ˜¯ä¸€ç§è™šæ‹Ÿç”¨æˆ·ï¼Œæ²¡æœ‰ç¡®å®šçš„èº«ä»½è®¤è¯å¯†é’¥ï¼Œéœ€è¦è¢«ä¸€ä¸ªå—ä¿¡çš„å®ä½“ç”¨æˆ·æ‰®æ¼”æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><p>RAMè§’è‰²æ˜¯ä¸€ç§è™šæ‹Ÿç”¨æˆ·ï¼Œä¸å®ä½“ç”¨æˆ·ï¼ˆäº‘è´¦å·ã€RAMç”¨æˆ·å’Œäº‘æœåŠ¡ï¼‰å’Œæ•™ç§‘ä¹¦å¼è§’è‰²ï¼ˆTextbook roleï¼‰ä¸åŒã€‚</p><ul><li>å®ä½“ç”¨æˆ·ï¼šæ‹¥æœ‰ç¡®å®šçš„ç™»å½•å¯†ç æˆ–è®¿é—®å¯†é’¥ã€‚</li><li>æ•™ç§‘ä¹¦å¼è§’è‰²ï¼šæ•™ç§‘ä¹¦å¼è§’è‰²æˆ–ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è§’è‰²æ˜¯æŒ‡ä¸€ç»„æƒé™é›†åˆï¼Œç±»ä¼¼äºRAMé‡Œçš„æƒé™ç­–ç•¥ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·è¢«èµ‹äºˆäº†è¿™ç§è§’è‰²ï¼Œä¹Ÿå°±æ„å‘³ç€è¯¥ç”¨æˆ·è¢«èµ‹äºˆäº†ä¸€ç»„æƒé™ï¼Œå¯ä»¥è®¿é—®è¢«æˆæƒçš„èµ„æºã€‚</li><li>RAMè§’è‰²ï¼šRAMè§’è‰²æœ‰ç¡®å®šçš„èº«ä»½ï¼Œå¯ä»¥è¢«èµ‹äºˆä¸€ç»„æƒé™ç­–ç•¥ï¼Œä½†æ²¡æœ‰ç¡®å®šçš„ç™»å½•å¯†ç æˆ–è®¿é—®å¯†é’¥ã€‚RAMè§’è‰²éœ€è¦è¢«ä¸€ä¸ªå—ä¿¡çš„å®ä½“ç”¨æˆ·æ‰®æ¼”ï¼Œæ‰®æ¼”æˆåŠŸåå®ä½“ç”¨æˆ·å°†è·å¾—RAMè§’è‰²çš„å®‰å…¨ä»¤ç‰Œï¼Œä½¿ç”¨è¿™ä¸ªå®‰å…¨ä»¤ç‰Œå°±èƒ½ä»¥è§’è‰²èº«ä»½è®¿é—®è¢«æˆæƒçš„èµ„æºã€‚</li></ul><h2 id="RAMè§’è‰²ä½¿ç”¨æ–¹æ³•"><a href="#RAMè§’è‰²ä½¿ç”¨æ–¹æ³•" class="headerlink" title="RAMè§’è‰²ä½¿ç”¨æ–¹æ³•"></a>RAMè§’è‰²ä½¿ç”¨æ–¹æ³•</h2><ul><li><p>RAMè§’è‰²æŒ‡å®šå¯ä¿¡å®ä½“ï¼Œå³æŒ‡å®šå¯ä»¥æ‰®æ¼”è§’è‰²çš„å®ä½“ç”¨æˆ·èº«ä»½ã€‚</p></li><li><p>å¯ä¿¡å®ä½“é€šè¿‡æ§åˆ¶å°æˆ–è°ƒç”¨APIæ‰®æ¼”è§’è‰²å¹¶è·å–è§’è‰²ä»¤ç‰Œã€‚<br><img src="/2021/01/05/aliyun-ram-role-multi-accounts/6.png"></p></li><li><p>ä¸ºRAMè§’è‰²ç»‘å®šæƒé™ç­–ç•¥ã€‚</p></li><li><p>å—ä¿¡å®ä½“é€šè¿‡æ‰®æ¼”è§’è‰²ï¼Œä½¿ç”¨è§’è‰²ä»¤ç‰Œè®¿é—®é˜¿é‡Œäº‘èµ„æºã€‚</p></li></ul><h2 id="RAMè§’è‰²ç±»å‹"><a href="#RAMè§’è‰²ç±»å‹" class="headerlink" title="RAMè§’è‰²ç±»å‹"></a>RAMè§’è‰²ç±»å‹</h2><p>æ ¹æ®RAMå¯ä¿¡å®ä½“çš„ä¸åŒï¼ŒRAMæ”¯æŒä»¥ä¸‹ä¸‰ç§ç±»å‹çš„è§’è‰²ï¼š</p><ul><li><p>é˜¿é‡Œäº‘è´¦å·ï¼šå…è®¸RAMç”¨æˆ·æ‰€æ‰®æ¼”çš„è§’è‰²ã€‚æ‰®æ¼”è§’è‰²çš„RAMç”¨æˆ·å¯ä»¥å±äºè‡ªå·±çš„äº‘è´¦å·ï¼Œä¹Ÿå¯ä»¥å±äºå…¶ä»–äº‘è´¦å·ã€‚æ­¤ç±»è§’è‰²ä¸»è¦ç”¨æ¥è§£å†³è·¨è´¦å·è®¿é—®å’Œä¸´æ—¶æˆæƒé—®é¢˜ã€‚</p></li><li><p>é˜¿é‡Œäº‘æœåŠ¡ï¼šå…è®¸äº‘æœåŠ¡æ‰€æ‰®æ¼”çš„è§’è‰²ã€‚æ­¤ç±»è§’è‰²ä¸»è¦ç”¨äºæˆæƒäº‘æœåŠ¡ä»£ç†æ‚¨è¿›è¡Œèµ„æºæ“ä½œã€‚</p></li><li><p>èº«ä»½æä¾›å•†ï¼šå…è®¸å—ä¿¡èº«ä»½æä¾›å•†ä¸‹çš„ç”¨æˆ·æ‰€æ‰®æ¼”çš„è§’è‰²ã€‚æ­¤ç±»è§’è‰²ä¸»è¦ç”¨äºå®ç°ä¸é˜¿é‡Œäº‘çš„SSOã€‚</p></li></ul><h2 id="RAMè§’è‰²åˆ‡æ¢çš„æ–¹å¼ç®¡ç†å¤šäº‘è´¦å·çš„å®ç°"><a href="#RAMè§’è‰²åˆ‡æ¢çš„æ–¹å¼ç®¡ç†å¤šäº‘è´¦å·çš„å®ç°" class="headerlink" title="RAMè§’è‰²åˆ‡æ¢çš„æ–¹å¼ç®¡ç†å¤šäº‘è´¦å·çš„å®ç°"></a>RAMè§’è‰²åˆ‡æ¢çš„æ–¹å¼ç®¡ç†å¤šäº‘è´¦å·çš„å®ç°</h2><p>å®ç°å¤šäº‘è´¦å·ç®¡ç†éœ€è¦æ»¡è¶³ä»¥ä¸‹çš„å‰ææ¡ä»¶ï¼š</p><ul><li><p>äº‘å›¢é˜Ÿæ‹¥æœ‰è‡ªå·±çš„äº‘è´¦å·ï¼Œå‡è®¾è´¦å·IDä¸º123456789012****ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰å¯¹åº”çš„RAMç”¨æˆ·ã€‚</p></li><li><p>å‡è®¾æŸä¸ªä¸šåŠ¡éƒ¨é—¨çš„äº‘è´¦å·ä¸º128888789012****ã€‚</p></li></ul><h3 id="å®ç°æ¶æ„"><a href="#å®ç°æ¶æ„" class="headerlink" title="å®ç°æ¶æ„"></a>å®ç°æ¶æ„</h3><p><img src="/2021/01/05/aliyun-ram-role-multi-accounts/7.png" alt="RAMç”¨æˆ·é€šè¿‡æ‰®æ¼”ä¸åŒäº‘è´¦å·é‡Œçš„RAMè§’è‰²æ¥ç®¡ç†è´¦å·é‡Œçš„èµ„æº"></p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><ul><li><p>äº§å“æ‹¥æœ‰è€…å‚è€ƒâ€œ<a href="https://help.aliyun.com/document_detail/93691.html?spm=a2c4g.11186623.6.584.312068f9HVtYvh">åˆ›å»ºå¯ä¿¡å®ä½“ä¸ºé˜¿é‡Œäº‘è´¦å·çš„RAMè§’è‰²</a>â€ï¼Œåœ¨è‡ªå·±çš„äº‘è´¦å·ä¸‹ä¸ºäº‘å›¢é˜Ÿçš„è´¦å·123456789012****åˆ›å»ºRAMè§’è‰²â€CloudAdminâ€ï¼Œå¹¶ç»™è§’è‰²åˆ†é…â€AdministratorAccessâ€æƒé™<br><img src="/2021/01/05/aliyun-ram-role-multi-accounts/1.png" alt="é€‰æ‹©æˆä¿¡å®ä½“ä¸ºé˜¿é‡Œäº‘è´¦å·"><br><img src="/2021/01/05/aliyun-ram-role-multi-accounts/2.png" alt="é€‰æ‹©å…¶å®ƒäº‘è´¦å·ï¼Œå¹¶è¾“å…¥äº‘å›¢é˜Ÿçš„è´¦å·"><br><img src="/2021/01/05/aliyun-ram-role-multi-accounts/3.png" alt="ç»™è¿™ä¸ªRAMè§’è‰²æˆäºˆç®¡ç†å‘˜æƒé™"></p></li><li><p>è®¾ç½®ä»¥ä¸‹æˆä¿¡ç­–ç•¥ã€‚æˆä¿¡å®ä½“ä¸ºäº‘å›¢é˜Ÿçš„è´¦å·â€œ123456789012****â€ï¼Œå¹¶å¼€æ”¾ç»™æœ‰â€œAliyunSTSAssumeRoleAccessâ€æƒé™çš„RAMç”¨æˆ·</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;Action&quot;</span>: <span class="hljs-string">&quot;sts:AssumeRole&quot;</span>,<br>            <span class="hljs-attr">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-attr">&quot;Principal&quot;</span>: &#123;<br>                <span class="hljs-attr">&quot;RAM&quot;</span>: [<br>                    <span class="hljs-string">&quot;acs<span class="github-emoji" alias="ram" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f40f.png?v8">&#x1f40f;</span>:123456789012****:root&quot;</span><br>                ]<br>            &#125;<br>        &#125;<br>    ],<br>    <span class="hljs-attr">&quot;Version&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥å°†æŸä¸ªæˆä¿¡å®ä½“é™åˆ¶ä¸ºè´¦å·ä¸‹çš„æŸä¸ªRAMç”¨æˆ·ï¼Œæ¯”å¦‚mikejianzhang</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;Action&quot;</span>: <span class="hljs-string">&quot;sts:AssumeRole&quot;</span>,<br>            <span class="hljs-attr">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-attr">&quot;Principal&quot;</span>: &#123;<br>                <span class="hljs-attr">&quot;RAM&quot;</span>: [<br>                    <span class="hljs-string">&quot;acs<span class="github-emoji" alias="ram" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f40f.png?v8">&#x1f40f;</span>:123456789012****:user/mikejianzhang&quot;</span><br>                ]<br>            &#125;<br>        &#125;<br>    ],<br>    <span class="hljs-attr">&quot;Version&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></blockquote></li><li><p>äº‘å›¢é˜Ÿåœ¨è‡ªå·±çš„äº‘è´¦å·é‡Œä¸ºRAMç”¨æˆ·æˆäºˆè§’è‰²æ‰®æ¼”æƒé™â€AliyunSTSAssumeRoleAccessâ€ã€‚</p></li><li><p>äº‘å›¢é˜Ÿçš„æŸä¸ªRAMç”¨æˆ·é¦–å…ˆç™»å½•äº‘å›¢é˜Ÿçš„è´¦å·ï¼Œç„¶åé€šè¿‡åˆ‡æ¢è§’è‰²å¹¶è¾“å…¥ä¸šåŠ¡éƒ¨é—¨äº‘è´¦å·æˆ–è€…åˆ«åï¼Œä»¥åŠå¯¹åº”çš„è§’è‰²â€CloudAdminâ€å°±èƒ½åˆ‡æ¢è¿›ä¸šåŠ¡éƒ¨é—¨äº‘è´¦å·é‡Œã€‚</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/4.png"></div><div class="group-image-wrap"><img src="/5.png" alt="è¾“å…¥ä¸šåŠ¡éƒ¨é—¨äº‘è´¦å·IDæˆ–åˆ«å"></div></div><div class="group-image-row"></div></div></li><li><p>å®Œæˆç®¡ç†ä»»åŠ¡åç‚¹å‡»â€œè¿”å›ç™»å½•èº«ä»½â€é€€å›åˆ°è‡ªå·±çš„è´¦å·ã€‚<br><img src="/2021/01/05/aliyun-ram-role-multi-accounts/8.png"></p></li><li><p>å½“æœ‰äº‘å›¢é˜Ÿæˆå‘˜å…¥èŒæˆ–ç¦»èŒæ—¶ï¼Œåªéœ€è¦åœ¨äº‘å›¢é˜Ÿçš„é˜¿é‡Œäº‘è´¦å·é‡Œæ·»åŠ å’Œåˆ é™¤å¯¹åº”çš„RAMç”¨æˆ·å³å¯ã€‚</p></li></ul><p>è¿™æ ·ï¼Œé€šè¿‡RAMè§’è‰²åˆ‡æ¢çš„æ–¹æ³•ï¼Œäº‘å›¢é˜Ÿå°±å¯ä»¥ç®¡ç†å¤šä¸ªä¸šåŠ¡éƒ¨é—¨çš„äº‘è´¦å·ã€‚å¦å¤–ï¼ŒRAMè§’è‰²åˆ‡æ¢çš„æ–¹æ³•è¿˜æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>é€šè¿‡RAMè§’è‰²ä¸´æ—¶æˆæƒç»™é˜¿é‡Œäº‘çš„æŠ€æœ¯æ”¯æŒå¸®åŠ©è°ƒè¯•é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨äº‘è´¦å·å¼€å¯äº†å•ç‚¹ç™»å½•(SSO)çš„æƒ…å†µä¸‹ï¼Œåªæœ‰é€šè¿‡è¿™ç§æ–¹æ³•æ‰èƒ½è®©é˜¿é‡Œäº‘çš„æŠ€æœ¯æ”¯æŒç™»å½•è¿›æ¥ã€‚</li><li>å½“ä¸€ä¸ªä¼ä¸šå¸Œæœ›å°†éƒ¨åˆ†ä¸šåŠ¡æˆæƒç»™å¦ä¸€ä¸ªä¼ä¸šæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡RAMè§’è‰²è¿›è¡Œè·¨é˜¿é‡Œäº‘è´¦å·æˆæƒæ¥ç®¡ç†èµ„æºçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œä¼ä¸šAè´­ä¹°äº†å¤šç§é˜¿é‡Œäº‘èµ„æºï¼ˆECSå®ä¾‹ã€RDSå®ä¾‹ã€SLBå®ä¾‹ç­‰ï¼‰ï¼Œä½†æ˜¯ä¼ä¸šAå¸Œæœ›èƒ½ä¸“æ³¨äºä¸šåŠ¡ï¼Œä»…ä½œä¸ºèµ„æºæ‹¥æœ‰è€…ã€‚ä¼ä¸šAå¸Œæœ›å¯ä»¥æˆæƒä¼ä¸šBè´¦å·æ¥å¯¹äº‘èµ„æºè¿›è¡Œè¿ç»´ï¼Œç›‘æ§å’Œç®¡ç†ï¼Œä¼ä¸šAä¹Ÿå¸Œæœ›ä¼ä¸šBçš„å‘˜å·¥å…¥èŒå’Œç¦»èŒæ—¶ï¼Œæ— éœ€åšä»»ä½•æƒé™å˜æ›´ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›åˆåŒç»ˆæ­¢æ—¶ï¼Œå¯ä»¥éšæ—¶æ’¤é”€å¯¹ä¼ä¸šBçš„æˆæƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¼ä¸šAå¯ä»¥åˆ›å»ºä¸€å®šæƒé™çš„è§’è‰²å¹¶æˆæƒç»™ä¼ä¸šBçš„é˜¿é‡Œäº‘è´¦å·ï¼Œä¼ä¸šBçš„RAMç”¨æˆ·å¯ä»¥é€šè¿‡è§’è‰²åˆ‡æ¢çš„æ–¹æ³•ç™»å½•è¿›ä¼ä¸šAçš„è´¦å·å¯¹èµ„æºè¿›è¡Œè¿ç»´ç®¡ç†ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>AliCloud</tag>
      
      <tag>Aliyun</tag>
      
      <tag>RAM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitå®‰è£…ä¸é…ç½®</title>
    <link href="/2020/12/31/git-install-configure/"/>
    <url>/2020/12/31/git-install-configure/</url>
    
    <content type="html"><![CDATA[<p><a href="https://git-scm.com/">Git</a>æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„åˆ†å¸ƒå¼ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿã€‚ç›¸å¯¹äºé›†ä¸­å¼ä»£ç ç®¡ç†ç³»ç»Ÿï¼Œä¾‹å¦‚Subversion, Perforceç­‰ï¼Œæ¥è¯´ï¼Œå®ƒæœ‰ç€æ— æ³•æ¯”æ‹Ÿçš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚è½»é‡çº§çš„åˆ†æ”¯ç®¡ç†ï¼Œé€‚åˆä¸åŒåœºæ™¯çš„åˆ†æ”¯åˆå¹¶ç­–ç•¥ï¼Œç¦»çº¿çŠ¶æ€ä¸‹çš„ç‰ˆæœ¬ç®¡ç†å’Œå˜æ›´å†å²æŸ¥è¯¢ç­‰ï¼Œè€Œè¿™äº›ä¼˜åŠ¿ä¹Ÿæ­£å¥½ç¬¦åˆäº†å½“å‰æ•æ·å’Œç²¾ç›Šçš„è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨Linuxï¼ŒMacå’ŒWindowsç³»ç»Ÿä¸­å®‰è£…å¹¶é…ç½®Gitã€‚</p><span id="more"></span><h1 id="å®‰è£…Git"><a href="#å®‰è£…Git" class="headerlink" title="å®‰è£…Git"></a>å®‰è£…Git</h1><p>æœ¬æ–‡åªä»‹ç»Gitå‘½ä»¤è¡Œçš„å®‰è£…ï¼Œå› ä¸ºä½¿ç”¨å‘½ä»¤è¡Œæ›´èƒ½æŒæ¡Gitçš„æœ¬è´¨ï¼Œä¸”å¯¹äºDevOpsæˆ–ç³»ç»Ÿç»´æŠ¤äººå‘˜æ¥è¯´ï¼Œä½¿ç”¨å‘½ä»¤è¡Œä¹Ÿæ˜¯æ—¥å¸¸çš„åŸºæœ¬åŠŸã€‚å½“æŒæ¡äº†Gitå‘½ä»¤è¡Œçš„ä½¿ç”¨åï¼Œå†å»ä½¿ç”¨å›¾å½¢åŒ–å®¢æˆ·ç«¯ï¼Œä¹Ÿä¼šå˜å¾—æ›´å®¹æ˜“ã€‚</p><h2 id="åœ¨Macä¸­çš„å®‰è£…"><a href="#åœ¨Macä¸­çš„å®‰è£…" class="headerlink" title="åœ¨Macä¸­çš„å®‰è£…"></a>åœ¨Macä¸­çš„å®‰è£…</h2><p>Mac Xcodeè‡ªå¸¦äº†Gitã€‚å¦‚æœä½ çš„Macç”µè„‘ä¸Šå·²ç»å®‰è£…äº†Xcodeï¼Œå°±å·²ç»æœ‰Gitå¯ä»¥ä½¿ç”¨äº†ï¼ŒGitå‘½ä»¤çš„å®‰è£…è·¯å¾„ä¸º/usr/bin/gitã€‚ä½†æ˜¯è¿™ä¸ªGitä¸ä¸€å®šæ˜¯æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡Homebrewæˆ–ç¬¬ä¸‰æ–¹æä¾›çš„DMGå®‰è£…åŒ…ï¼Œé‡æ–°å®‰è£…ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ã€‚</p><ul><li><p>é€šè¿‡Homebrewå®‰è£…</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">brew install git<br></code></pre></td></tr></table></figure><p>  Homebrewå°†Gitå®‰è£…åœ¨/usr/local/Cellar/git/2.29.2/è·¯å¾„ä¸‹ï¼ŒåŒæ—¶ä¼šå»ºç«‹ä¸€ä¸ªç¬¦å·é“¾æ¥/usr/local/bin/gitæŒ‡å‘Gitå‘½ä»¤/usr/local/Cellar/git/2.29.2/bin/gitã€‚2.29.2æ˜¯å½“å‰Homebrewæ”¯æŒçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><blockquote><p>åœ¨PATHç¯å¢ƒå˜é‡ä¸­ç¡®ä¿è·¯å¾„/usr/local/binåœ¨/usr/binä¹‹å‰ï¼Œè¿™æ ·Homebrewå®‰è£…çš„Gitå‘½ä»¤ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ã€‚</p></blockquote></li><li><p>é€šè¿‡DMGå®‰è£…åŒ…å®‰è£…</p><p>  å¯ä»¥ä»<a href="https://sourceforge.net/projects/git-osx-installer/">https://sourceforge.net/projects/git-osx-installer/</a> ä¸‹è½½è¾ƒæ–°çš„ç‰ˆæœ¬å»å®‰è£…ã€‚é€šè¿‡DMGå®‰è£…çš„Gitè¢«å®‰è£…åœ¨/usr/local/gitä¸‹, å¹¶ä¸”ä¼šåœ¨/usr/local/binå’Œ/usr/share/man/ä¸­å»ºç«‹ç¬¦å·é“¾æ¥ã€‚</p><p>  å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¸è½½Git.</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo /usr/<span class="hljs-built_in">local</span>/git/uninstall.sh<br></code></pre></td></tr></table></figure></li></ul><div class="note note-info">            <p>æ¨èç”¨Homebrewçš„æ–¹å¼å®‰è£…Gitï¼Œä¸ä½†èƒ½è·å¾—è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œè€Œä¸”ä»¥åå‡çº§ä¹Ÿæ–¹ä¾¿ã€‚</p>          </div><h2 id="åœ¨Linuxä¸­çš„å®‰è£…"><a href="#åœ¨Linuxä¸­çš„å®‰è£…" class="headerlink" title="åœ¨Linuxä¸­çš„å®‰è£…"></a>åœ¨Linuxä¸­çš„å®‰è£…</h2><p>Linuxç³»ç»Ÿä¹Ÿç¼ºçœè‡ªå¸¦äº†Gitï¼Œä¸è¿‡ä¸€èˆ¬ä¸æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä½†ä¸å½±å“ä½¿ç”¨ã€‚å¦‚æœæƒ³å®‰è£…æœ€æ–°ç‰ˆæœ¬æˆ–ç›¸å¯¹è¾ƒæ–°çš„ç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥å‚ç…§ä¸‹é¢æ–¹æ³•å®‰è£…ã€‚</p><h3 id="åœ¨Ubuntuä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git"><a href="#åœ¨Ubuntuä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git" class="headerlink" title="åœ¨Ubuntuä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git"></a>åœ¨Ubuntuä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git</h3><p>Ubuntuè‡ªå¸¦çš„Gitæ˜¯å®‰è£…åœ¨è·¯å¾„/usr/bin/gitä¸‹ã€‚åœ¨Ubuntuä¸­ï¼Œå¯ä»¥é€šè¿‡<a href="https://launchpad.net/ubuntu/+ppas">PPAï¼ˆPersonal Package Archiveï¼‰</a>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Gitï¼Œå®‰è£…å®Œåä¼šè¦†ç›–æ—§çš„ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯å®‰è£…æ­¥éª¤ï¼š</p><ul><li><p>æ·»åŠ Gitçš„PPAåº“</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo add-apt-repository ppa:git-core/ppa<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°APTç¼“å­˜</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt update<br></code></pre></td></tr></table></figure></li><li><p>æœç´¢æœ€æ–°ç‰ˆæœ¬çš„Git</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-cache madison git<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…Git</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt install git<br></code></pre></td></tr></table></figure></li></ul><div class="note note-info">            <p>è¿™é‡Œé€‰æ‹©çš„æ˜¯Ubuntu18ã€‚</p>          </div><h3 id="åœ¨CentOSä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git"><a href="#åœ¨CentOSä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git" class="headerlink" title="åœ¨CentOSä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git"></a>åœ¨CentOSä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Git</h3><p>CentOS 7è‡ªå¸¦çš„Gitéå¸¸æ—§ï¼Œè¿˜æ˜¯1.xçš„ç‰ˆæœ¬ï¼Œæ‰§è¡Œ<code>rpm -qa | grep git</code>å¯ä»¥çœ‹åˆ°GitåŒ…ä¸ºâ€git-1.8.3.1-23.el7_8.x86_64â€œï¼Œå®‰è£…è·¯å¾„ä¸º/usr/bin/gitã€‚åœ¨CentOSä¸­ï¼Œå¯ä»¥é€šè¿‡Endpointä»“åº“å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Gitã€‚ä»¥ä¸‹æ˜¯å®‰è£…æ­¥éª¤ï¼š</p><ul><li><p>åˆ é™¤æ—§çš„Git</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum remove git*<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ CentOS 7 Endpointä»“åº“</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°Yumç¼“å­˜</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum update<br></code></pre></td></tr></table></figure></li><li><p>æœç´¢æœ€æ–°ç‰ˆæœ¬çš„Git</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum list git<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…Git</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install git<br></code></pre></td></tr></table></figure></li></ul><div class="note note-info">            <p>è¿™é‡Œé€‰æ‹©çš„æ˜¯CentOS 7ã€‚</p>          </div><h2 id="åœ¨Windowsä¸­çš„å®‰è£…"><a href="#åœ¨Windowsä¸­çš„å®‰è£…" class="headerlink" title="åœ¨Windowsä¸­çš„å®‰è£…"></a>åœ¨Windowsä¸­çš„å®‰è£…</h2><p>ä»<a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a> ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Windowså®‰è£…åŒ…ï¼Œå¹¶å®‰è£…ã€‚</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/1.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/2.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/3.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/4.png" class=""></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/5.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/6.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/7.png" class=""></div><div class="group-image-wrap"><img src="/2020/12/31/git-install-configure/8.png" class=""></div></div></div><div class="note note-info">            <p>å°½é‡é€‰æ‹©çº¢è‰²æ¡†é‡Œçš„é€‰é¡¹ï¼Œè¿™æ ·èƒ½æœ€å¤§é™åº¦åœ°ç”¨Linuxçš„æ–¹å¼ä½¿ç”¨Gitå‘½ä»¤ã€‚</p>          </div><h1 id="é…ç½®Git"><a href="#é…ç½®Git" class="headerlink" title="é…ç½®Git"></a>é…ç½®Git</h1><p>ä¸ºäº†æ›´å¥½åœ°ä½¿ç”¨Gitå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œéœ€è¦åšä¸€äº›å¿…è¦çš„è®¾ç½®ï¼Œæœ‰äº›è®¾ç½®æ˜¯ä¸åŒå¹³å°å…±äº«çš„ï¼Œæœ‰äº›è®¾ç½®æ˜¯å¹³å°ç‹¬æœ‰çš„ã€‚</p><h2 id="å…±äº«é…ç½®"><a href="#å…±äº«é…ç½®" class="headerlink" title="å…±äº«é…ç½®"></a>å…±äº«é…ç½®</h2><ul><li><p>è®¾ç½®ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global user.name mikejianzhang<br>git config --global user.email mikejianzhang@163.com<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®å¼•ç”¨è·¯å¾„ä¸ºfalse</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.quotepath <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>å¦‚æœæ–‡ä»¶åæˆ–è·¯å¾„ä¸­å«æœ‰éè‹±æ–‡å­—ç¬¦æˆ–è€…å…è®¸çš„æ§åˆ¶å­—ç¬¦ï¼Œä¾‹å¦‚ä¸­æ–‡å­—ç¬¦ï¼Œåæ–œæ ï¼ŒåŒå¼•å·ç­‰ï¼Œå½“ä¸è®¾ç½®â€core.quotepathâ€æˆ–è€…è®¾ç½®å®ƒçš„å€¼ä¸ºtrueæ—¶ï¼ŒGitå‘½ä»¤åœ¨æ˜¾ç¤ºè¿™äº›æ–‡ä»¶åæˆ–è·¯å¾„æ—¶ä¼šç”¨åŒå¼•å·å¼•ç”¨è¿™äº›æ–‡ä»¶åæˆ–è·¯å¾„ï¼Œå¹¶å¯¹è¿™äº›å­—ç¬¦è¿›è¡Œè½¬ä¹‰æ˜¾ç¤ºï¼Œå³å¯¹éè‹±æ–‡å­—ç¬¦ç”¨å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºUTF-8ç¼–ç ï¼Œè€Œå¯¹æ§åˆ¶å­—ç¬¦åˆ™é€šè¿‡åæ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œå½“è®¾ç½®â€core.quotepathâ€ä¸ºfalseæ—¶ï¼Œåˆ™å¯¹éè‹±æ–‡å­—ç¬¦ä¼šæ˜¾ç¤ºåŸæ¥çš„æ–‡æœ¬ï¼Œä½†æ˜¯å¯¹æ§åˆ¶å­—ç¬¦ä»ç„¶ä¼šè½¬ä¹‰æ˜¾ç¤ºã€‚  </p><p>ä¸‹é¢çš„ä¸¤ä¸ªæ–‡ä»¶åä¸­æ—¢åŒ…å«äº†ä¸­æ–‡å­—ç¬¦åˆåŒ…å«äº†æ§åˆ¶å­—ç¬¦ï¼Œåæ–œæ å’ŒåŒå¼•å·ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">mikepro:git-test mike$ ls -l<br>total 16<br>-rw-r--r--  1 mike  staff  12 Jan  1 19:33 ä½ å¥½\ä¸Šæµ· <span class="hljs-string">&quot;å¤§å®¶ä»¬&quot;</span>.txt<br>-rw-r--r--  1 mike  staff  13 Jan  1 19:28 ä½ å¥½ç¥–å›½.txt<br></code></pre></td></tr></table></figure><p>å½“ä¸è®¾ç½®â€core.quotepathâ€æˆ–è€…è®¾ç½®å®ƒçš„å€¼ä¸ºtrueæ—¶ï¼Œ<code>git status</code>æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs txt">mikepro:git-test mike$ git status<br>On branch master<br><br>No commits yet<br><br>Untracked files:<br>(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)<br>    &quot;\344\275\240\345\245\275\\\344\270\212\346\265\267 \&quot;\345\244\247\345\256\266\344\273\254\&quot;.txt&quot;<br>    &quot;\344\275\240\345\245\275\347\245\226\345\233\275.txt&quot;<br></code></pre></td></tr></table></figure><p>å½“è®¾ç½®â€core.quotepathâ€ä¸ºfalseæ—¶ï¼Œ<code>git status</code>æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs txt">mikepro:git-test mike$ git status<br>On branch master<br><br>No commits yet<br><br>Untracked files:<br>(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)<br>    &quot;ä½ å¥½\\ä¸Šæµ· \&quot;å¤§å®¶ä»¬\&quot;.txt&quot;<br>    ä½ å¥½ç¥–å›½.txt<br></code></pre></td></tr></table></figure>          </div></li><li><p>è®¾ç½®æ°¸ä¹…ç¼“å­˜Gitè´¦å·</p><p>  å½“é€šè¿‡httpåè®®è®¿é—®Gitä»“åº“æ—¶ï¼Œéœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œä¸ºäº†é¿å…æ¯æ¬¡éƒ½è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¹…ç¼“å­˜Gitè´¦å·ã€‚</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global credential.helper store<br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>åœ¨Macç³»ç»Ÿä¸­ï¼Œè´¦å·ä¼šè¢«ç¼“å­˜åˆ°Keychainé‡Œï¼Œè€Œåœ¨Linux/Windowsä¸­ï¼Œè´¦å·ä¼šè¢«ç¼“å­˜åˆ°æ–‡ä»¶~/.git-credentialsä¸­ã€‚</p>          </div></li><li><p>è®¾ç½®å®‰å…¨çš„æ¢è¡Œç¬¦</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.safecrlf <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>ä¸¥æ ¼æ£€æŸ¥æ–‡æœ¬æˆ–ä»£ç æ–‡ä»¶çš„æ¢è¡Œç¬¦æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚åœ¨Linux/Mac/Unixå¹³å°ä¸Šï¼Œåº”è¯¥éƒ½æ˜¯LFæ ¼å¼ï¼Œåœ¨Windowså¹³å°ä¸Šï¼Œåº”è¯¥æ˜¯CRLFæ ¼å¼ï¼Œæˆ–è€…æ˜¯åœ¨.gitattributeä¸­ï¼Œé€šè¿‡é€‰é¡¹â€eolâ€œæ˜¾å¼æŒ‡å®šçš„æ¢è¡Œç¬¦ï¼Œå¦‚æœä¸æ­£ç¡®åˆ™é˜»æ­¢æäº¤ã€‚</p>          </div></li><li><p>è®¾ç½®å¿½ç•¥sslè¯ä¹¦éªŒè¯</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global http.sslverify <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>å¦‚æœGité€šè¿‡httpåè®®è®¿é—®ä»£ç ä»“åº“ï¼Œå¯ä»¥è®¾ç½®å¿½ç•¥sslè¯ä¹¦éªŒè¯ï¼Œå°¤å…¶æ˜¯GitæœåŠ¡å™¨ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ã€‚</p>          </div></li><li><p>è®¾ç½®ç©ºæ ¼å¤„ç†</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.whitespace cr-at-eol,-trailing-space<br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>åœ¨æ‰§è¡Œ<code>git diff</code>å’Œ<code>git apply</code>å‘½ä»¤æ—¶ï¼Œå¦‚ä½•å¤„ç†ç©ºæ ¼æˆ–æ¢è¡Œå¾ˆé‡è¦ï¼Œå¦åˆ™åœ¨å›¢é˜ŸååŒå¼€å‘çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¾ˆå¤§çš„å¹²æ‰°ã€‚</p><p>cr-at-eol: å¦‚æœè¡Œå°¾ä¸ºCRå­—ç¬¦ï¼Œå½“åšæ¢è¡Œç¬¦å¤„ç†ï¼Œä¸æ˜¾ç¤º^M<br>-trailing-space: æ‰§è¡Œ<code>git apply</code>æ—¶ï¼Œå¯¹äºè¡Œæœ«æˆ–æ–‡æœ«çš„ç©ºæ ¼ä¸æç¤ºé”™è¯¯</p>          </div></li></ul><h2 id="Linx-Macä¸­çš„é…ç½®"><a href="#Linx-Macä¸­çš„é…ç½®" class="headerlink" title="Linx/Macä¸­çš„é…ç½®"></a>Linx/Macä¸­çš„é…ç½®</h2><ul><li><p>è®¾ç½®æ–‡ä»¶æ£€å‡ºæ—¶çš„æ¢è¡Œç¬¦</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.autocrlf input<br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>åœ¨Linx/Macç³»ç»Ÿä¸­ï¼Œä»ä»£ç ä»“åº“æ£€å‡ºæ–‡ä»¶æ—¶ï¼Œä¿æŒæœåŠ¡ç«¯çš„æ–‡ä»¶æ¢è¡Œç¬¦ï¼Œå› ä¸ºGitæœåŠ¡ç«¯æ˜¯æŒ‰ç…§Linuxæ ¼å¼çš„æ¢è¡Œç¬¦å­˜å‚¨æ–‡æœ¬æˆ–ä»£ç æ–‡ä»¶çš„ã€‚</p>          </div></li></ul><h2 id="Windowsä¸­çš„é…ç½®"><a href="#Windowsä¸­çš„é…ç½®" class="headerlink" title="Windowsä¸­çš„é…ç½®"></a>Windowsä¸­çš„é…ç½®</h2><ul><li><p>è®¾ç½®æ–‡ä»¶æ£€å‡ºæ—¶çš„æ¢è¡Œç¬¦</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.autocrlf <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>åœ¨Windowsç³»ç»Ÿä¸­ï¼Œä»ä»£ç ä»“åº“æ£€å‡ºæ–‡ä»¶æ—¶ï¼Œå°†æ–‡æœ¬æˆ–ä»£ç æ–‡ä»¶çš„æ¢è¡Œç¬¦è‡ªåŠ¨è½¬æ¢æˆWindowsæ ¼å¼çš„æ¢è¡Œç¬¦CRLFï¼Œé™¤éåœ¨.gitattributeä¸­æ˜¾å¼æŒ‡å®šæŸäº›æ–‡ä»¶çš„æ¢è¡Œç¬¦ä¸ºLinuxæ ¼å¼çš„æ¢è¡Œç¬¦LFã€‚</p>          </div></li><li><p>è®¾ç½®å…è®¸é•¿è·¯å¾„æ–‡ä»¶</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">git config --global core.longpaths <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>  <div class="note note-info">            <p>è®¾ç½®Windowsä¸­çš„Gitå‘½ä»¤æ”¯æŒé•¿è·¯å¾„ï¼ˆå¤§äº260å­—èŠ‚ï¼‰ã€‚</p>          </div></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GitåŠ å¯†å­˜å‚¨æ–‡ä»¶</title>
    <link href="/2020/12/16/git-encrypt-file-in-repository/"/>
    <url>/2020/12/16/git-encrypt-file-in-repository/</url>
    
    <content type="html"><![CDATA[<p>ä¸è¦å°†åŒ…å«ç”¨æˆ·åã€å¯†ç ã€APIä»¤ç‰Œ(Token)ç­‰å„ç±»æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­å·²ç»æˆä¸ºäº†å¤§å®¶çš„å…±è¯†ï¼Œå°¤å…¶æ˜¯ä»£ç ä»“åº“æ‰˜ç®¡åœ¨GitHubã€GitLabã€Bitbucketç­‰æä¾›å…¬å…±ä»£ç ä»“åº“æœåŠ¡çš„å¹³å°ä¸Šæ—¶ï¼Œæ›´éœ€è¦ä¸”å€¼å¾—ä»»ä½•çš„ä»£ä»·å»å°½é‡é¿å…è¿™ç§äº‹æƒ…çš„å‘ç”Ÿã€‚æœ¬æ–‡ä»‹ç»å¹¶ä½¿ç”¨<a href="https://git-secret.io/">git-secret</a>å°†æ–‡ä»¶åŠ å¯†åå­˜å‚¨åœ¨Gitä»£ç ä»“åº“ä¸­ï¼Œä»¥åŠåŸºäºgit-secretçš„å¤šäººååŒå·¥ä½œçš„æµç¨‹ã€‚</p><span id="more"></span><h1 id="ç§æœ‰ä»“åº“æ˜¯å¦å®‰å…¨"><a href="#ç§æœ‰ä»“åº“æ˜¯å¦å®‰å…¨" class="headerlink" title="ç§æœ‰ä»“åº“æ˜¯å¦å®‰å…¨"></a>ç§æœ‰ä»“åº“æ˜¯å¦å®‰å…¨</h1><p>ä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼šâ€æˆ‘æŠŠä»£ç ä»“åº“è®¾æˆç§æœ‰çš„ä¸å°±å®‰å…¨äº†ï¼Ÿâ€œï¼Œç„¶è€Œæƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå› ä¸ºå³ä½¿æ˜¯ç§æœ‰ä»“åº“ï¼Œä¹ŸåŒæ ·é¢ä¸´ç€ä¸åŒç±»å‹çš„é£é™©ã€‚å½“ä½ é›†æˆæŸä¸ªç¬¬ä¸‰æ–¹æœåŠ¡åˆ°ä½ çš„ç§æœ‰ä»“åº“ï¼ˆæ¯”å¦‚é›†æˆç¬¬ä¸‰æ–¹çš„æŒç»­é›†æˆæœåŠ¡ï¼‰æ—¶ï¼Œä½ çš„ç§æœ‰ä»“åº“å°±å¼€æ”¾ç»™äº†ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹æœåŠ¡å°±æœ‰å¯èƒ½è¯»å–ä½ å­˜å‚¨åœ¨ä»£ç ä»“åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚å¦‚æœç¬¬ä¸‰æ–¹æœåŠ¡é­å—äº†é»‘å®¢æ”»å‡»ï¼Œé‚£ä¹ˆé»‘å®¢å°±å¯ä»¥é€šè¿‡è¿™ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡è·å–ä½ çš„Gitä»“åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¿˜è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­"><a href="#ä¸ºä»€ä¹ˆè¿˜è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­" class="headerlink" title="ä¸ºä»€ä¹ˆè¿˜è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­"></a>ä¸ºä»€ä¹ˆè¿˜è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­</h1><p>æ­£å¦‚æ–‡åˆè°ˆåˆ°çš„â€ä¸è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­å·²æ˜¯å…±è¯†â€œï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ç”¨è°ˆå°†æ•æ„Ÿä¿¡æ¯æ”¾åœ¨Gitä»£ç ä»“åº“ä¸­ï¼Ÿæ­£æ‰€è°“æ— é£ä¸èµ·æµªï¼Œå­˜åœ¨å³åˆç†ã€‚æŠ›å¼€æ•æ„Ÿä¿¡æ¯è¿™ä¸ªç‰¹å¾ä¸è°ˆï¼ŒåŒ…å«è¿™äº›ä¿¡æ¯çš„æ–‡ä»¶å…¶å®å’Œæˆ‘ä»¬çš„ä»£ç æ–‡ä»¶æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚æœä¸æ”¾åœ¨Gitä»“åº“ä¸­ï¼Œå°±ä¸èƒ½å¯¹å®ƒä»¬åšç‰ˆæœ¬ç®¡ç†ï¼Œæ¯”å¦‚å¯¹æ–‡ä»¶åå’Œè·¯å¾„çš„å˜æ›´ï¼Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯çš„å˜æ›´ï¼Œæ–°ä¿¡æ¯çš„æ·»åŠ ç­‰éƒ½æ²¡æ³•è¿½è¸ªå®ƒä»¬çš„å˜æ›´è®°å½•ï¼Œå°¤å…¶åœ¨æ„å»ºä¸€ä¸ªè‡ªåŠ¨éƒ¨ç½²ç³»ç»Ÿæ—¶ï¼Œä½ å°±ä¸å¾—ä¸ç»´æŠ¤ä¸€ä¸ªé¢å¤–çš„å®‰å…¨æœåŠ¡æ¥åŠ å¯†å­˜å‚¨è¿™äº›åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œè€Œè‡ªåŠ¨éƒ¨ç½²ç³»ç»Ÿä¹Ÿéœ€è¦è®¾è®¡é¢å¤–çš„æ–¹æ³•å’Œæ­¥éª¤æ¥è¯»å–è¿™äº›é…ç½®æ–‡ä»¶ï¼Œæ›´ä¸ºéº»çƒ¦çš„æ˜¯è‡ªåŠ¨éƒ¨ç½²ç³»ç»Ÿæ— æ³•é€šè¿‡Gitå˜æ›´è®°å½•æ¥æŒ‡å®šä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ã€‚</p><h1 id="git-secretçš„åŸç†"><a href="#git-secretçš„åŸç†" class="headerlink" title="git-secretçš„åŸç†"></a>git-secretçš„åŸç†</h1><p>æ—¢è¦å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨Gitä»£ç ä»“åº“ä¸­ï¼ˆèƒ½å¸¦æ¥å¾ˆå¤šä¾¿åˆ©ï¼‰ï¼Œåˆè¦ä¿è¯å®‰å…¨ï¼Œé‚£ä¹ˆæœ€ç›´æ¥çš„åšæ³•å°±æ˜¯å°†è¿™äº›æ–‡ä»¶åŠ å¯†åå†ä¿å­˜åˆ°Gitä»“åº“ä¸­ï¼Œè€Œgit-secretåˆ™æ»¡è¶³äº†è¿™ä¸€éœ€æ±‚ï¼ŒåŒæ—¶git-secretä¹Ÿèƒ½ä¿è¯å¤šäººååŒå·¥ä½œã€‚ä»¥ä¸‹æ˜¯git-secretæä¾›çš„ä¸€äº›åŠŸèƒ½ï¼š</p><ul><li><p>åˆ©ç”¨<a href="http://www.gnupg.org/">GnuPG</a>çš„å¤šå¯†é’¥åŠ å¯†åŠŸèƒ½ï¼šå¤šä¸ªå…¬é’¥åŠ å¯†æ–‡ä»¶ï¼Œä¸åŒçš„ç§é’¥è§£å¯†æ–‡ä»¶ã€‚è¿™æ ·ï¼Œå·¥ä½œåœ¨Gitä»“åº“ä¸­çš„å¼€å‘äººå‘˜åªéœ€è¦å°†è‡ªå·±çš„å…¬é’¥ä¿å­˜åœ¨ä»£ç ä»“åº“ä¸­ç”¨æ¥åŠ å¯†æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨è‡ªå·±çš„å·¥ä½œæœºå™¨ä¸Šä¿å­˜è‡ªå·±çš„ç§é’¥æ¥è§£å¯†æ–‡ä»¶ã€‚</p></li><li><p>é€šè¿‡git-secretå°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶æ”¾å…¥.gitignoreæ–‡ä»¶ä¸­é¿å…è¯¯æäº¤ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„åŠ å¯†æ–‡ä»¶ï¼ˆåœ¨åŸæœ‰æ–‡ä»¶åä¸Šæ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„åç¼€.secretï¼‰å¹¶ä¿å­˜åœ¨Gitä»“åº“ä¸­ã€‚</p></li><li><p>å½“æŠŠä»£ç ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼ˆåªåŒ…å«å¸¦æœ‰åç¼€.secretçš„åŠ å¯†æ–‡ä»¶ï¼‰åï¼Œå¯ä»¥é€šè¿‡git-secretè§£å¯†åç”Ÿæˆè§£å¯†æ–‡ä»¶ï¼ˆä¸åŒ…å«.secretåç¼€ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨åŒ…å«è¿™äº›æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶äº†ã€‚</p></li></ul><h1 id="git-secretçš„å®‰è£…å’Œä½¿ç”¨"><a href="#git-secretçš„å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="git-secretçš„å®‰è£…å’Œä½¿ç”¨"></a>git-secretçš„å®‰è£…å’Œä½¿ç”¨</h1><p>git-secretçš„ä½¿ç”¨ä¾èµ–äºgitå’Œ<a href="http://www.gnupg.org/">GnuPG</a>ã€‚Gitçš„å®‰è£…å¯ä»¥å‚è€ƒç›¸å…³æ–‡æ¡£ï¼Œä¸åœ¨è¿™é‡Œèµ˜è¿°ã€‚git-secretä½¿ç”¨çš„å¯†é’¥ä»¥åŠåŠ è§£å¯†çš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡GnuPGæ¥å®Œæˆçš„ã€‚</p><h2 id="å®‰è£…GnuPG"><a href="#å®‰è£…GnuPG" class="headerlink" title="å®‰è£…GnuPG"></a>å®‰è£…GnuPG</h2><p>GnuPGï¼Œä¹Ÿç§°ä¸ºGPGï¼Œæ˜¯OpenPGPæ ‡å‡†RFC4880ï¼ˆä¹Ÿç§°ä¸ºPGPï¼‰çš„å…è´¹å®ç°ã€‚GnuPGå…è®¸ä½ å¯¹æ•°æ®å’Œé€šä¿¡è¿›è¡ŒåŠ å¯†å’Œç­¾åï¼Œå®ƒå…·æœ‰é€šç”¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼Œä»¥åŠç”¨äºå„ç§å…¬é’¥ç›®å½•çš„è®¿é—®æ¨¡å—ã€‚GnuPGæ˜¯ä¸€ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œå…·æœ‰æ˜“äºä¸å…¶ä»–åº”ç”¨ç¨‹åºé›†æˆçš„åŠŸèƒ½ã€‚GnuPGä¹Ÿæä¾›äº†å¤§é‡çš„å‰ç«¯åº”ç”¨ç¨‹åºå’Œåº“ï¼ŒGnuPGè¿˜æä¾›å¯¹S/MIMEå’ŒSecure Shellï¼ˆsshï¼‰çš„æ”¯æŒã€‚</p><ul><li><p>Mac OSXä¸­çš„å®‰è£…</p><p>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„GnuPGæ˜¯2.2.25ã€‚å¯ä»¥ä»<a href="https://sourceforge.net/p/gpgosx/docu/Download/">https://sourceforge.net/p/gpgosx/docu/Download/</a> ä¸‹è½½dmgæ–‡ä»¶å¹¶å®‰è£…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„brewå‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install gpg2<br></code></pre></td></tr></table></figure><p>æ¨èä½¿ç”¨brewçš„å®‰è£…æ–¹å¼ï¼Œä»¥åå¯ä»¥æ–¹ä¾¿å‡çº§ã€‚</p></li><li><p>Windowsä¸­çš„å®‰è£…</p><p>Gpg4winæ˜¯Windowsç‰ˆæœ¬çš„GnuPGå®Œæ•´å®ç°ã€‚å¯ä»¥ä»<a href="https://gpg4win.org/download.html">https://gpg4win.org/download.html</a> ä¸‹è½½å®‰è£…æ–‡ä»¶å¹¶å®‰è£…ã€‚</p></li><li><p>Linuxä¸­çš„å®‰è£… </p><p>å¤§éƒ¨åˆ†Linuxç³»ç»Ÿå·²ç»è‡ªå¸¦GnuPGäº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…ï¼Œåªæ˜¯æœ‰å¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯ä¸å½±å“ä½¿ç”¨ã€‚å¦‚æœGnuPGä¸å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹çš„å‘½ä»¤æ¥å®‰è£…ï¼š</p><p>Debianæˆ–Ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install gnupg<br></code></pre></td></tr></table></figure><p>RedHatæˆ–CentOS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install gnupg<br></code></pre></td></tr></table></figure></li></ul><h2 id="å®‰è£…git-secret"><a href="#å®‰è£…git-secret" class="headerlink" title="å®‰è£…git-secret"></a>å®‰è£…git-secret</h2><p>åœ¨Max OSXå’ŒLinuxä¸­çš„å®‰è£…å¯ä»¥å‚è€ƒgit-secretçš„<a href="https://git-secret.io/installation">å®‰è£…æ–‡æ¡£</a>ã€‚</p><ul><li><p>Mac OSXä¸­çš„å®‰è£…</p><p>é€šè¿‡brewå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install git-secret<br></code></pre></td></tr></table></figure></li><li><p>Linuxä¸­çš„å®‰è£…</p><p>Ubuntuæˆ–è€…Debian</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb https://dl.bintray.com/sobolevn/deb git-secret main&quot;</span> | sudo tee -a /etc/apt/sources.list<br>wget -qO - https://api.bintray.com/users/sobolevn/keys/gpg/public.key | sudo apt-key add -<br>sudo apt-get update &amp;&amp; sudo apt-get install git-secret<br></code></pre></td></tr></table></figure><p>RedHatæˆ–è€…CentOS:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://bintray.com/sobolevn/rpm/rpm -O bintray-sobolevn-rpm.repo<br>sudo mv bintray-sobolevn-rpm.repo /etc/yum.repos.d/<br>sudo yum install git-secret<br></code></pre></td></tr></table></figure></li><li><p>Windowsä¸­çš„å®‰è£…</p><p>git-secretå®˜æ–¹å¹¶æ²¡æœ‰å®£ç§°æ”¯æŒWindowsç³»ç»Ÿï¼Œä½†æ˜¯ä»æºä»£ç æ¥çœ‹å·²ç»æ”¯æŒCYGWINæˆ–MINGWç¯å¢ƒäº†ã€‚ç»è¿‡è¯•éªŒï¼Œä»¥ä¸‹æ–¹æ³•å¯ç”¨ï¼š</p><p>(1) é¦–å…ˆï¼Œåœ¨Windowsç³»ç»Ÿä¸­å›½å®‰è£…Gitæ—¶ï¼Œé€‰æ‹©â€åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ä½¿ç”¨Gitå’Œå¯é€‰çš„Unixå·¥å…·â€œï¼Œè¿™æ ·å¯ä»¥å®‰è£…å’Œä½¿ç”¨å¾ˆå¤šå¯ç”¨çš„Linuxå‘½ä»¤</p><p><img src="/2020/12/16/git-encrypt-file-in-repository/1.png"></p><p>(2) å°†Mac OSXä¸‹é€šè¿‡brewå®‰è£…çš„git secretæ‰“åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zip -r -9 git-secret.zip /usr/<span class="hljs-built_in">local</span>/Cellar/git-secret/<br></code></pre></td></tr></table></figure><p>(3) å°†git-secret.zipæ‹·è´åˆ°Windowsç³»ç»ŸæŸä¸ªç›®å½•ä¸‹å¹¶è§£å‹ï¼Œä¾‹å¦‚è§£å‹åçš„è·¯å¾„å¦‚ä¸‹ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>\<span class="hljs-title">Documents</span>\<span class="hljs-title">Tools</span>\<span class="hljs-title">git</span>-<span class="hljs-title">secret</span>\0.3.3</span><br></code></pre></td></tr></table></figure><blockquote><p>0.3.3æ˜¯git-secretçš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚</p></blockquote><p>(4) å°†git-secretç›®å½•ä¸‹çš„binç›®å½•åŠ åˆ°Windowsçš„Pathç¯å¢ƒå˜é‡ä¸­</p><p><img src="/2020/12/16/git-encrypt-file-in-repository/2.png"></p><p>(5) é‡æ–°å¯åŠ¨ä¸€ä¸ªå‘½ä»¤è¡Œæ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥git secretå‘½ä»¤å¯ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret --version<br></code></pre></td></tr></table></figure></li></ul><h2 id="ä½¿ç”¨git-secret"><a href="#ä½¿ç”¨git-secret" class="headerlink" title="ä½¿ç”¨git-secret"></a>ä½¿ç”¨git-secret</h2><h3 id="åˆæ¬¡æ·»åŠ å¯¹git-secretæ”¯æŒ"><a href="#åˆæ¬¡æ·»åŠ å¯¹git-secretæ”¯æŒ" class="headerlink" title="åˆæ¬¡æ·»åŠ å¯¹git-secretæ”¯æŒ"></a>åˆæ¬¡æ·»åŠ å¯¹git-secretæ”¯æŒ</h3><ul><li><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºGPGå…¬é’¥å’Œç§é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gpg --full-generate-key<br></code></pre></td></tr></table></figure><blockquote><p>é€‰æ‹©ç¼ºçœçš„åŠ å¯†ç®—æ³•â€œ(1) RSA and RSA (default)â€ã€‚<br>è¾“å…¥uidå’Œemailï¼Œä¾‹å¦‚åˆ†åˆ«ä¸ºmikejianzhangå’Œ<a href="mailto:&#x6d;&#105;&#x6b;&#x65;&#106;&#105;&#97;&#110;&#x7a;&#104;&#x61;&#110;&#x67;&#64;&#49;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;">&#x6d;&#105;&#x6b;&#x65;&#106;&#105;&#97;&#110;&#x7a;&#104;&#x61;&#110;&#x67;&#64;&#49;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;</a>ã€‚</p></blockquote></li><li><p>å¯¼å‡ºGPGå…¬é’¥å’Œç§é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gpg --armor --<span class="hljs-built_in">export</span> mikejianzhang@163.com &gt; mikejianzhang.public-key.gpg<br>gpg --armor --export-secret-key  mikejianzhang@163.com &gt; mikejianzhang.private-key.gpg<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœè¿˜æœ‰ç¬¬äºŒä¸ªå¼€å‘ç”µè„‘ï¼Œåˆ™éœ€è¦åœ¨ç”µè„‘é‡Œå®‰è£…Gitå’ŒGnuPGï¼Œå¹¶æ‰§è¡Œä¸‹é¢å‘½ä»¤å¯¼å…¥è‡ªå·±çš„ç§é’¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gpg --import mikejianzhang.private-key.gpg<br></code></pre></td></tr></table></figure></blockquote></li><li><p>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Gitä»“åº“æˆ–è€…å…‹éš†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ä»£ç ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir test-git-secret<br><span class="hljs-built_in">cd</span> test-git-secret<br>git init<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mikejianzhang/test-git-secret.git<br></code></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–Gitä»“åº“æ”¯æŒgit-secret</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> test-git-secret<br>git secret init<br></code></pre></td></tr></table></figure><blockquote><p>ç±»ä¼¼äº.gitç›®å½•ï¼Œgit secret initå‘½ä»¤ä¼šåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª.gitsecretç›®å½•ç”¨æ¥å­˜å‚¨GPGå…¬é’¥ã€‚</p></blockquote></li><li><p>å°†è‡ªå·±çš„å…¬é’¥å¯¼å…¥è¿›git secretçš„å¯†é’¥ä¸²ä¸­ï¼ˆä¿å­˜åœ¨.gitsecretç›®å½•ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret tell mikejianzhang@163.com<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤æ·»åŠ éœ€è¦åŠ å¯†çš„æ–‡ä»¶</p><p>æ‰§è¡Œå‘½ä»¤ä¹‹å‰ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶ï¼Œè€Œä¸”è¿˜æ²¡æœ‰æäº¤åˆ°Gitä»“åº“ä¸­ï¼Œä¾‹å¦‚testã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret add <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><blockquote><p>æ–‡ä»¶â€œtestâ€ä¼šè¢«åŠ å…¥åˆ°.gitignoreæ–‡ä»¶ä¸­ï¼Œè¿™æ ·Gitå‘½ä»¤å°±ä¼šå¿½ç•¥è¿™ä¸ªæ–‡ä»¶</p></blockquote></li><li><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤åŠ å¯†æ‰€æœ‰é€šè¿‡git secret addæ·»åŠ çš„å¾…åŠ å¯†æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret hide <br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªå‘½ä»¤ä¼šäº§ç”Ÿä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼Œä¾‹å¦‚â€test.secretâ€ã€‚</p></blockquote></li><li><p>å°†æ‰€æœ‰æœ¬åœ°æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æäº¤åˆ°Gitä»“åº“ä¸­</p></li></ul><h3 id="ç¼–è¾‘å·²åŠ å¯†åçš„æ–‡ä»¶"><a href="#ç¼–è¾‘å·²åŠ å¯†åçš„æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘å·²åŠ å¯†åçš„æ–‡ä»¶"></a>ç¼–è¾‘å·²åŠ å¯†åçš„æ–‡ä»¶</h3><ul><li><p>å…‹éš†Gitä»£ç ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/mikejianzhang/test-git-secret.git<br></code></pre></td></tr></table></figure></li><li><p>è§£å¯†æ‰€æœ‰çš„åŠ å¯†æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret reveal -f<br></code></pre></td></tr></table></figure><blockquote><p>â€œ-fâ€é€‰é¡¹å°†è§£å¯†åçš„æ–‡ä»¶å¼ºåˆ¶è¦†ç›–æœ¬åœ°çš„æ˜æ–‡æ–‡ä»¶ã€‚</p></blockquote></li><li><p>ç¼–è¾‘æœ¬åœ°çš„æ˜æ–‡æ–‡ä»¶å¹¶æ‰§è¡Œä¸‹é¢å‘½ä»¤é‡æ–°åŠ å¯†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret hide<br></code></pre></td></tr></table></figure></li><li><p>å°†æ‰€æœ‰çš„æœ¬åœ°æ”¹åŠ¨æäº¤çš„Gitä»“åº“ä¸­</p><blockquote><p>å½“æ¯æ¬¡æœ‰æ”¹åŠ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æ£€æŸ¥æ˜¯å¦æœ‰åŠ å¯†æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œä»¥å†³å®šæ˜¯å¦éœ€è¦æ‰§è¡Œgit secret hideå‘½ä»¤å»é‡æ–°åŠ å¯†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret changes<br></code></pre></td></tr></table></figure></blockquote></li></ul><h3 id="æ·»åŠ ç¬¬äºŒä¸ªç”¨æˆ·"><a href="#æ·»åŠ ç¬¬äºŒä¸ªç”¨æˆ·" class="headerlink" title="æ·»åŠ ç¬¬äºŒä¸ªç”¨æˆ·"></a>æ·»åŠ ç¬¬äºŒä¸ªç”¨æˆ·</h3><ul><li><p>æ‹¿åˆ°ç¬¬äºŒä¸ªç”¨æˆ·çš„å…¬é’¥æ–‡ä»¶ï¼Œä¾‹å¦‚user2.public-key.gpg, å¹¶æ‰§è¡Œä»¥ä¸‹çš„æ“ä½œå°†ç¬¬äºŒä¸ªç”¨æˆ·çš„å…¬é’¥å¯¼å…¥gitä»“åº“çš„å¯†é’¥ä¸²ä¸­<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å…ˆå°†ç”¨æˆ·çš„å…¬é’¥å¯¼å…¥gpgçš„å¯†é’¥ä¸²ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gpg --import user2.public-key.gpg<br></code></pre></td></tr></table></figure><p>åœ¨å½“å‰ä»£ç ä»“åº“ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†ç”¨æˆ·çš„å…¬é’¥ä»gpgçš„å¯†é’¥ä¸²ä¸­å¯¼å…¥gitä»“åº“çš„å¯†é’¥ä¸²ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git tell &lt;user2&gt;@xxx.com<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤è§£å¯†å‡ºæ‰€æœ‰æœ€æ–°çš„åŠ å¯†æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret reveal -f<br></code></pre></td></tr></table></figure></li><li><p>ç”¨ç›®å‰å¯†é’¥ä¸²ä¸­çš„æ‰€æœ‰å…¬é’¥ï¼ˆåŒ…å«ç¬¬äºŒä¸ªç”¨æˆ·çš„å…¬é’¥ï¼‰é‡æ–°åŠ å¯†æ‰€æœ‰çš„æ–‡ä»¶å¹¶æäº¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git secret hide<br></code></pre></td></tr></table></figure></li></ul><p>å½“åšå®Œä»¥ä¸Šæ‰€æœ‰çš„æ“ä½œåï¼Œç¬¬äºŒä¸ªç”¨æˆ·å°±å¯ä»¥æ‰§è¡Œgit secretå‘½ä»¤è¿›è¡Œæ­£å¸¸çš„åŠ è§£å¯†æ“ä½œäº†ã€‚</p><h1 id="git-secretå¯¹CI-CDæµç¨‹çš„æ”¯æŒ"><a href="#git-secretå¯¹CI-CDæµç¨‹çš„æ”¯æŒ" class="headerlink" title="git-secretå¯¹CI/CDæµç¨‹çš„æ”¯æŒ"></a>git-secretå¯¹CI/CDæµç¨‹çš„æ”¯æŒ</h1><p>ç”³è¯·ä¸€ä¸ªæœåŠ¡è´¦å·ï¼ˆä¸€èˆ¬ä¼ä¸šéƒ½ä¼šæ”¯æŒè¿™æ ·çš„æ“ä½œï¼‰åŒ…å«é‚®ç®±åœ°å€ï¼Œåˆ©ç”¨è¿™ä¸ªé‚®ç®±åœ°å€åˆ›å»ºä¸€ä¸ªGnuPGçš„å…¬é’¥å’Œç§é’¥ï¼Œå°†å…¬é’¥å¯¼å…¥Gitä»“åº“çš„å¯†é’¥ç¯ä¸­ï¼Œå°†ç§é’¥å¯¼å…¥æ‰€æœ‰çš„æ„å»ºæœºå™¨ä¸­ï¼Œæœ€ååœ¨CI/CDè„šæœ¬æ‰§è¡Œæ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²å‰ç”¨git secretå‘½ä»¤æ¥è§£å¯†æ‰€æœ‰çš„åŠ å¯†çš„æ–‡ä»¶ã€‚</p><h1 id="git-secretçš„ç¼ºç‚¹"><a href="#git-secretçš„ç¼ºç‚¹" class="headerlink" title="git-secretçš„ç¼ºç‚¹"></a>git-secretçš„ç¼ºç‚¹</h1><ul><li><p>æ— æ³•åœ¨Webç•Œé¢ä¸Šæµè§ˆåŠ å¯†æ–‡ä»¶å†…å®¹æˆ–åšå·®å¼‚åŒ–æ¯”è¾ƒï¼Œåªæœ‰æŠŠä»£ç ä»“åº“å…‹éš†åˆ°æœ¬åœ°è§£å¯†åæ‰èƒ½æµè§ˆæ–‡ä»¶å†…å®¹æˆ–åšå·®å¼‚åŒ–æ¯”è¾ƒã€‚å¦‚æœgit-secretèƒ½å¤Ÿæä¾›åŠ å¯†éƒ¨åˆ†æ–‡ä»¶å†…å®¹çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒå®Œç¾äº†ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–Globè¯­æ³•æ¥å®šä¹‰éœ€è¦åŠ å¯†çš„æ–‡æœ¬ï¼Œgit-secretçš„hideå‘½ä»¤å¯ä»¥è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶å»åŠ å¯†æ–‡ä»¶å†…å®¹è€Œéæ•´ä¸ªæ–‡ä»¶ã€‚</p></li><li><p>æ“ä½œå˜å¾—å¤æ‚äº†ã€‚ä¸ªäººè§‰å¾—è¿™ä¹Ÿä¸èƒ½ç®—ä»€ä¹ˆç¼ºç‚¹ï¼Œæœ‰å¾—å¿…æœ‰å¤±ï¼Œè·å¾—äº†é«˜å®‰å…¨æ€§ï¼Œè€Œåœ¨æ“ä½œä¸Šå°±å¿…å®šè¦èŠ±è´¹ä¸€äº›ä»£ä»·ï¼Œä½†è¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ„¿æ„èŠ±è´¹ä»£ä»·å»åšè¿™ä»¶äº‹çš„ã€‚</p></li><li><p>ç”¨æˆ·è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå®‰å…¨çš„å·¥å…·æ¥å¦¥å–„ä¿å­˜è‡ªå·±çš„ç§é’¥ï¼Œå¼€æºå’Œå•†ä¸šé¢†åŸŸéƒ½æœ‰ç›¸å…³çš„å·¥å…·é€‰æ‹©ï¼Œæ‰€ä»¥é—®é¢˜ä¹Ÿä¸æ˜¯å¾ˆå¤§ã€‚</p></li></ul><h1 id="å…¶å®ƒçš„åŒç±»å·¥å…·"><a href="#å…¶å®ƒçš„åŒç±»å·¥å…·" class="headerlink" title="å…¶å®ƒçš„åŒç±»å·¥å…·"></a>å…¶å®ƒçš„åŒç±»å·¥å…·</h1><p>é™¤äº†git-secret, è¿˜æœ‰å¾ˆå¤šå…¶å®ƒç±»ä¼¼çš„å·¥å…·å¯ä¾›é€‰æ‹©ï¼Œå®ƒä»¬çš„åŸç†åŸºæœ¬ä¸Šéƒ½æ˜¯ç›¸ä¼¼çš„ã€‚ä¸‹é¢åˆ—å‡ºä¸€äº›ä»…ä¾›å‚è€ƒã€‚</p><ul><li><p><a href="https://www.agwa.name/projects/git-crypt/">git-crypt</a><br>å¦ä¸€ä¸ªå’Œgit-secretç›¸ä¼¼çš„æ–¹æ¡ˆæ˜¯git-cryptï¼Œä½†æ˜¯git-cryptæ˜¯äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è€Œä¸æ˜¯shellè„šæœ¬ã€‚</p></li><li><p><a href="https://github.com/StackExchange/blackbox">BlackBox</a><br>BlackBoxæ—¢æ”¯æŒGitä¹Ÿæ”¯æŒå…¶å®ƒçš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œä¾‹å¦‚Mercurialå’ŒSubversionã€‚BlackBoxæ”¯æŒåŠ å¯†æŸä¸ªæ–‡æœ¬ä¸²è€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ï¼Œè¿™æ­£å¥½å¯ä»¥å¼¥è¡¥git-secretåªèƒ½åŠ å¯†æ•´ä¸ªæ–‡ä»¶çš„ç¼ºç‚¹ã€‚å¯ä»¥æŠ½ç©ºåšä¸ªæ·±å…¥ç ”ç©¶çœ‹BlackBoxæ˜¯å¦æ”¯æŒgit-secretå…¶å®ƒçš„ä¸€äº›æ“ä½œã€‚</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»Gitä»“åº“ä¸­æ°¸ä¹…æ¸…ç†è„æ•°æ®</title>
    <link href="/2020/09/26/git-clean-bad-data-from-history/"/>
    <url>/2020/09/26/git-clean-bad-data-from-history/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä»£ç å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šå°†ä¸è¯¥æäº¤çš„æ–‡ä»¶è¯¯æäº¤åˆ°Gitä»“åº“ä¸­ï¼Œæ¯”å¦‚ç¼–è¯‘äº§ç”Ÿçš„ä¸´æ—¶äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¿˜äº†æ·»åŠ .gitignoreï¼‰ï¼Œæˆ–è€…åŒ…å«è´¦å·ï¼Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶ã€‚ä¸´æ—¶çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨Gitä»“åº“ä¸­æ²¡æœ‰æ„ä¹‰ï¼Œè€Œä¸”å¦‚æœé¢‘ç¹æ”¹åŠ¨çš„è¯ï¼Œä¹Ÿä¼šå¯¼è‡´Gitä»“åº“é€æ¸å˜å¤§ï¼Œè€Œæ•æ„Ÿä¿¡æ¯ä¼šå¯¼è‡´ä¿¡æ¯æ³„éœ²ä¸”ä¸ç¬¦åˆä¿¡æ¯å®‰å…¨æ ‡å‡†ã€‚è¿™äº›ä¸è¯¥æäº¤çš„æ–‡ä»¶æˆ–å†…å®¹è¢«ç§°ä¸ºGitä»“åº“çš„è„æ•°æ®ï¼Œéœ€è¦è¢«æ¸…ç†æ‰ã€‚é‡æ–°æäº¤ä¸€ä¸ªæ–°çš„å˜æ›´æ¥æ¸…ç†è¿™äº›è„æ•°æ®æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå› ä¸ºä»å†å²ç‰ˆæœ¬ä¸­ä»ç„¶èƒ½å¤Ÿæ‰¾åˆ°å®ƒä»¬ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å¼€æºå·¥å…·<a href="https://rtyley.github.io/bfg-repo-cleaner">BFG Repo-Cleaner</a>ä»Gitä»“åº“çš„å˜æ›´å†å²ä¸­æ°¸ä¹…æ¸…é™¤è¿™äº›è„æ•°æ®ã€‚</p><span id="more"></span><p>å¦‚æœä¸å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œè¦å®ç°ä»Gitä»“åº“ä¸­æ°¸ä¹…æ¸…ç†è„æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨Gitçš„é«˜çº§å‘½ä»¤<a href="https://git-scm.com/docs/git-filter-branch">â€œgit-filter-branchâ€</a>é‡å†™å†å²è®°å½•ã€‚â€git-filter-branchâ€åŠŸèƒ½å¼ºå¤§ï¼Œä½†ä¹Ÿç›¸å¯¹è¾ƒå¤æ‚ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ç¬¬ä¸‰æ–¹çš„å¼€æºå·¥å…·å°è£…â€git-filter-branchâ€å¹¶æä¾›ç®€å•æ˜“ç”¨çš„æ¥å£ï¼Œ<a href="https://rtyley.github.io/bfg-repo-cleaner">BFG Repo-Cleaner</a>å°±æ˜¯å…¶ä¸­æ¯”è¾ƒå‡ºè‰²çš„ä¸€ä¸ªã€‚ä»…ç®¡<a href="https://rtyley.github.io/bfg-repo-cleaner">BFG Repo-Cleaner</a>æ²¡æœ‰â€git-filter-branchâ€çš„åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯å®ƒç›¸å¯¹ç®€æ´ã€é«˜æ•ˆï¼Œå¹¶ä¸”åŸºæœ¬ä¸Šèƒ½æ»¡è¶³æ—¥å¸¸å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚</p><h1 id="å®‰è£…BFG-Repo-Cleaner"><a href="#å®‰è£…BFG-Repo-Cleaner" class="headerlink" title="å®‰è£…BFG Repo-Cleaner"></a>å®‰è£…BFG Repo-Cleaner</h1><ul><li><p>ä»<a href="https://rtyley.github.io/bfg-repo-cleaner">å®˜ç½‘</a>ä¸­ä¸‹è½½BFG Repo-Cleaner(jar file)åˆ°æŸä¸ªè·¯å¾„ä¸‹ï¼Œå¹¶å‘½åä¸ºbfg.jar</p></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºBFG Repo-Cleanerå‘½ä»¤çš„åˆ«åï¼Œæˆ–è€…å°†ä¸‹é¢çš„å‘½ä»¤æ·»åŠ åˆ°shellçš„åˆå§‹åŒ–æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿è‡ªåŠ¨æ·»åŠ è¿™ä¸ªå‘½ä»¤çš„åˆ«å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> bfg=<span class="hljs-string">&#x27;java -jar /xxxx/bfg.jar&#x27;</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="ä½¿ç”¨BFG-Repo-Cleaner"><a href="#ä½¿ç”¨BFG-Repo-Cleaner" class="headerlink" title="ä½¿ç”¨BFG Repo-Cleaner"></a>ä½¿ç”¨BFG Repo-Cleaner</h1><p>BFG Repo-Cleanerä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„åº”ç”¨ï¼š</p><ul><li>æ›¿æ¢æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯</li><li>åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</li></ul><p>å¯ä»¥æ‰§è¡Œå‘½ä»¤è·å–BFG Repo-Cleanerçš„å¸®åŠ©ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg --<span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><p>BFG Repo-Cleanerç¼ºçœä¸ä¼šæ¸…ç†æœ€æ–°ç‰ˆæœ¬ä»£ç é‡Œçš„è„æ•°æ®ï¼Œå› ä¸ºä½ çš„æœ€æ–°ä»£ç å¯èƒ½å·²ç»éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œè€Œä¸”å¯èƒ½ä¼šä¾èµ–äºè¿™äº›å·²ç»å­˜åœ¨çš„æ•æ„Ÿä¿¡æ¯æˆ–æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ éœ€è¦æ‰‹åŠ¨åœ°æ¸…ç†è¿™äº›æ•æ„Ÿä¿¡æ¯æˆ–æ–‡ä»¶å¹¶ä¿®å¤ä»£ç è¿è¡Œæ—¶å¯èƒ½å­˜åœ¨çš„é”™è¯¯ã€‚å¦‚æœä½ ç¡®è®¤æ¸…ç†æœ€æ–°ç‰ˆæœ¬ä»£ç é‡Œçš„è„æ•°æ®å¯¹ä»£ç è¿è¡Œä¸ä¼šäº§ç”Ÿå½±å“ï¼Œåˆ™å¯ä»¥åœ¨å‘½ä»¤ä¸­æ˜¾å¼åœ°åŠ ä¸Šå‚æ•°â€œâ€“no-blob-protectionâ€ã€‚</p><h2 id="æ›¿æ¢æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯"><a href="#æ›¿æ¢æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯" class="headerlink" title="æ›¿æ¢æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯"></a>æ›¿æ¢æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯</h2><p>è¿™ä¸ªæ“ä½œä¸»è¦æ˜¯æŠŠæ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯ç”¨æŒ‡å®šçš„æ–‡æœ¬æ›¿æ¢æ‰ã€‚æ¯”å¦‚æ–‡ä»¶ä¸­åŒ…å«password=123456ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æ–‡æœ¬â€***hidden***â€œå»æ›¿æ¢â€123456â€ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><ul><li><p>é€šè¿‡mirrorçš„æ–¹å¼å…‹éš†ä»£ç ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> --mirror https://github.com/xxxx/test-history-clean.git<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ–‡æœ¬æ›¿æ¢æ–‡ä»¶ï¼ˆä¾‹å¦‚replace-text.txtï¼‰<br>å¦‚æœä½¿ç”¨BFGç¼ºçœçš„æ›¿æ¢æ–‡æœ¬â€***REMOVED***â€œï¼Œæ–‡æœ¬æ›¿æ¢æ–‡ä»¶ä¸­åªéœ€è¦åˆ—å‡ºéœ€è¦æ›¿æ¢çš„æ•æ„Ÿä¿¡æ¯çš„æ–‡æœ¬ï¼Œä¸€è¡Œä¸€ä¸ªï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">123456<br>89fsafaaf<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ›¿æ¢æ–‡æœ¬ï¼Œæ–‡æœ¬æ›¿æ¢æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">regex:xxxx==&gt;yyyy<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">glob:xxxx==&gt;yyyy<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">regex:123.*==&gt;***hidden***<br>regex:test123==&gt;***hidden***<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">glob:123*==&gt;***hidden***<br></code></pre></td></tr></table></figure><blockquote><p>Regexå’ŒGlobçš„åŒºåˆ«å¯ä»¥å‚è€ƒ<a href="https://www.linuxjournal.com/content/globbing-and-regex-so-similar-so-different">https://www.linuxjournal.com/content/globbing-and-regex-so-similar-so-different</a></p></blockquote></li></ul><h3 id="å¸¸ç”¨çš„æ•æ„Ÿä¿¡æ¯æ›¿æ¢æ“ä½œ"><a href="#å¸¸ç”¨çš„æ•æ„Ÿä¿¡æ¯æ›¿æ¢æ“ä½œ" class="headerlink" title="å¸¸ç”¨çš„æ•æ„Ÿä¿¡æ¯æ›¿æ¢æ“ä½œ"></a>å¸¸ç”¨çš„æ•æ„Ÿä¿¡æ¯æ›¿æ¢æ“ä½œ</h3><div class="note note-warning">            <p>åœ¨æ‰§è¡Œbfgå‘½ä»¤å‰ï¼Œè¯·å…ˆç¡®ä¿æœ€æ–°ä»£ç é‡Œçš„æ•æ„Ÿä¿¡æ¯å·²ç»è¢«æ›¿æ¢ï¼ˆæ‰‹å·¥æäº¤ä¸€ä¸ªæ–°çš„Gitæäº¤ï¼‰ï¼Œå¦åˆ™åœ¨æ‰§è¡Œbfgå‘½ä»¤æ—¶éœ€è¦æ˜¾å¼åœ°åŠ ä¸Šå‚æ•°â€œâ€“no-blob-protectionâ€ä»¥ç¡®ä¿æœ€æ–°ä»£ç é‡Œçš„æ•æ„Ÿä¿¡æ¯ä¹Ÿä¼šè¢«æ›¿æ¢ã€‚</p>          </div><ul><li><p>æ›¿æ¢æ‰€æœ‰æ–‡ä»¶ä¸­çš„æŒ‡å®šçš„æ•æ„Ÿä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -rt replace-text.txt test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ‰“å¼€å¼ºåˆ¶æ¨é€åˆ°Gitä»“åº“çš„åŠŸèƒ½</p></blockquote></li><li><p>æ›¿æ¢æŒ‡å®šæ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -rt replace-text.txt -<span class="hljs-keyword">fi</span> test3.txt test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><blockquote><p>bfgä¸èƒ½æŒ‡å®šå…·ä½“æ–‡ä»¶çš„è·¯å¾„<br>-fiå‚æ•°å¯ä»¥é€šè¿‡è¿‡globè¯­æ³•æŒ‡å®šæŸä¸€ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚*.{txt,properties}</p></blockquote></li><li><p>æ›¿æ¢é™¤äº†æŒ‡å®šçš„æ–‡ä»¶å¤–çš„æ‰€æœ‰æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -rt replace-text.txt -fe test3.txt test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><blockquote><p>bfgä¸èƒ½æŒ‡å®šå…·ä½“æ–‡ä»¶çš„è·¯å¾„<br>-feå‚æ•°å¯ä»¥é€šè¿‡è¿‡globè¯­æ³•æŒ‡å®šæŸä¸€ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚*.{txt,properties}</p></blockquote></li></ul><h2 id="åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹"><a href="#åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹" class="headerlink" title="åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹"></a>åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</h2><p>å¦‚æœGitä»“åº“ä¸­ä¸å°å¿ƒæäº¤äº†æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œæˆ–è€…æ•´ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ“ä½œä»å˜æ›´å†å²ä¸­æŠŠä»–ä»¬æ¸…ç†æ‰ã€‚</p><div class="note note-warning">            <p>åœ¨æ‰§è¡Œbfgå‘½ä»¤å‰ï¼Œè¯·å…ˆç¡®ä¿æœ€æ–°ä»£ç é‡Œçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å·²ç»è¢«åˆ é™¤ï¼ˆæ‰‹å·¥æäº¤ä¸€ä¸ªæ–°çš„Gitæäº¤ï¼‰ï¼Œå¦åˆ™åœ¨æ‰§è¡Œbfgå‘½ä»¤æ—¶éœ€è¦æ˜¾å¼åœ°åŠ ä¸Šå‚æ•°â€œâ€“no-blob-protectionâ€ä»¥ç¡®ä¿æœ€æ–°ä»£ç é‡Œçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p>          </div><h3 id="åˆ é™¤æ–‡ä»¶åä¸ºâ€œtest3-tar-gzâ€çš„æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶åä¸ºâ€œtest3-tar-gzâ€çš„æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶åä¸ºâ€œtest3.tar.gzâ€çš„æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶åä¸ºâ€œtest3.tar.gzâ€çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -D test3.tar.gz test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤æŸä¸€ç±»æ–‡ä»¶"><a href="#åˆ é™¤æŸä¸€ç±»æ–‡ä»¶" class="headerlink" title="åˆ é™¤æŸä¸€ç±»æ–‡ä»¶"></a>åˆ é™¤æŸä¸€ç±»æ–‡ä»¶</h3><p>BFG Repo-Cleanerçš„-Då‚æ•°å¯ä»¥é€šè¿‡globæ ¼å¼æŒ‡å®šæŸä¸€ç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚åˆ é™¤åç¼€ä¸ºdllæˆ–binçš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -D *&#123;dll,bin&#125; test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><h3 id="ä»å˜æ›´å†å²ä¸­ç²¾ç¡®åœ°åˆ é™¤æŸä¸ªæ–‡ä»¶"><a href="#ä»å˜æ›´å†å²ä¸­ç²¾ç¡®åœ°åˆ é™¤æŸä¸ªæ–‡ä»¶" class="headerlink" title="ä»å˜æ›´å†å²ä¸­ç²¾ç¡®åœ°åˆ é™¤æŸä¸ªæ–‡ä»¶"></a>ä»å˜æ›´å†å²ä¸­ç²¾ç¡®åœ°åˆ é™¤æŸä¸ªæ–‡ä»¶</h3><p>BFG Repo-Cleanerå¯ä»¥åˆ é™¤æŸä¸ªblobï¼ˆgitä»“åº“çš„å˜æ›´å†å²ä¸­å­˜å‚¨çš„æ–‡ä»¶ç§°ä¸ºblobï¼‰ï¼Œè€Œå‚æ•°-bi(â€“strip-blobs-with-ids)å¯ä»¥ç”¨æ¥æŒ‡å®šå¾…åˆ é™¤çš„blob idå·ã€‚</p><ul><li>è·å–æŒ‡å®šæ–‡ä»¶åœ¨æ‰€æœ‰å˜æ›´å†å²ä¸­å¯¹åº”çš„blob idå·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> --all --pretty=format:%H -- a/b/c/test1.txt  | xargs -n 1 -I &#123;&#125; sh -c <span class="hljs-string">&quot;git ls-tree  &#123;&#125; a/b/c/test1.txt&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span> &gt; blob-ids.txt<br></code></pre></td></tr></table></figure><ul><li>ä»å˜æ›´å†å²ä¸­åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶(Blob)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -bi blob-ids.txt test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤è¶…è¿‡æŸä¸ªå¤§å°çš„æ–‡ä»¶"><a href="#åˆ é™¤è¶…è¿‡æŸä¸ªå¤§å°çš„æ–‡ä»¶" class="headerlink" title="åˆ é™¤è¶…è¿‡æŸä¸ªå¤§å°çš„æ–‡ä»¶"></a>åˆ é™¤è¶…è¿‡æŸä¸ªå¤§å°çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -b 500M test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤å‰å‡ ä¸ªæœ€å¤§çš„æ–‡ä»¶"><a href="#åˆ é™¤å‰å‡ ä¸ªæœ€å¤§çš„æ–‡ä»¶" class="headerlink" title="åˆ é™¤å‰å‡ ä¸ªæœ€å¤§çš„æ–‡ä»¶"></a>åˆ é™¤å‰å‡ ä¸ªæœ€å¤§çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg -B 5 test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤æŸä¸ªæ–‡ä»¶å¤¹"><a href="#åˆ é™¤æŸä¸ªæ–‡ä»¶å¤¹" class="headerlink" title="åˆ é™¤æŸä¸ªæ–‡ä»¶å¤¹"></a>åˆ é™¤æŸä¸ªæ–‡ä»¶å¤¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bfg --delete-folders .svn test-history-clean.git<br><span class="hljs-built_in">cd</span> test-history-clean.git<br>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive<br>git push --force<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥é€šè¿‡globæ ¼å¼æŒ‡å®šä¸€ç±»æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚*-tmpã€‚</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsæ„å»ºGitLabåˆå¹¶è¯·æ±‚(Merge Request)</title>
    <link href="/2020/03/09/jenkins-gitlab-pullrequest/"/>
    <url>/2020/03/09/jenkins-gitlab-pullrequest/</url>
    
    <content type="html"><![CDATA[<p>å†™äº†ä¸¤ç¯‡è¿™æ ·çš„æ–‡ç« ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºJenkinsæ„å»ºåˆå¹¶è¯·æ±‚(Merge Request)çš„åŸç†ï¼šé¦–å…ˆï¼Œéœ€è¦åœ¨Jenkinsä¸Šå®‰è£…ä¸€ä¸ªæ’ä»¶ä»¥ä¾¿æä¾›ä¸€ä¸ªWebhookæ¥å£ï¼Œé…ç½®æ’ä»¶è¿é€šå¯¹åº”çš„ä»£ç åä½œå¹³å°ä»¥ä¾¿å°†æ„å»ºçŠ¶æ€å†™å›ä»£ç åä½œå¹³å°(å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ’ä»¶éƒ½æä¾›è¿™ä¸ªåŠŸèƒ½)ï¼›å…¶æ¬¡ï¼Œåœ¨å¯¹åº”çš„Gitä»“åº“ä¸­è®¾ç½®Webhookç›‘å¬Gitäº‹ä»¶ï¼Œæ¯”å¦‚åˆå¹¶è¯·æ±‚(Merge Request)çš„åˆ›å»ºã€ç¼–è¾‘ç­‰ã€‚å½“æœ‰ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒWebhookè§¦å‘Jenkinsçš„Webhookæ¥å£ï¼ŒWebhookæ¥å£è§£æè¯·æ±‚æ•°æ®ï¼Œåˆ›å»ºä¸€äº›æœ‰ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åˆå¹¶è¯·æ±‚(Merge Request)IDï¼Œåˆå¹¶è¯·æ±‚(Merge Request)çš„åŸåˆ†æ”¯å’Œç›®æ ‡åˆ†æ”¯ç­‰ï¼Œå¹¶è§¦å‘å¯¹åº”çš„Jenkins pipelineï¼›æœ€åï¼Œåˆ›å»ºä¸€ä¸ªJenkins pipeline(ç›®å‰ä¸»è¦æ˜¯Pipeline2.0çš„Jenkinsfile)ï¼Œè®¾ç½®è¢«è§¦å‘çš„æ¡ä»¶å’Œå¦‚ä½•å…‹éš†å¯¹åº”çš„ä»£ç ï¼Œä»¥åŠå®é™…çš„æ„å»ºé€»è¾‘ã€‚æ¥å‰é¢çš„ç³»åˆ—ï¼Œæœ¬æ–‡å°†ç»§ç»­ä»‹ç»å¦‚ä½•é…ç½®Jenkinså’ŒGitLabæ¥æ„å»ºGitLabåˆå¹¶è¯·æ±‚(Merge Request)ã€‚</p><span id="more"></span><p>GitLab<a href="https://docs.gitlab.com/ee/integration/jenkins.html">å®˜æ–¹æ–‡æ¡£</a>æœ‰å†™åˆ°ç”¨Jenkinså»æ„å»ºGitLabä¸­çš„ä»£ç ï¼Œä½†æ˜¯ç”¨åˆ°äº†â€Jenkins CIâ€è¿™ä¸ªé¡¹ç›®æœåŠ¡ï¼Œè€Œè¿™ä¸ªæœåŠ¡åœ¨GitLabå…è´¹ç‰ˆæœ¬(ç¤¾åŒºç‰ˆ)ä¸­å¹¶æ²¡æœ‰æä¾›ï¼Œæ‰€ä»¥ä¸å»è¿‡å¤šçš„è®¨è®ºæ­¤æ–¹æ³•ã€‚ä¸‹é¢å°†åˆ©ç”¨Jenkinsçš„<a href="https://plugins.jenkins.io/git/">Gitæ’ä»¶</a>å’Œ<a href="https://plugins.jenkins.io/gitlab-plugin/">GitLabæ’ä»¶</a>å»å®ç°Jenkinsæ„å»ºGitLabçš„åˆå¹¶è¯·æ±‚(Merge Request)ã€‚</p><h1 id="é…ç½®Jenkins"><a href="#é…ç½®Jenkins" class="headerlink" title="é…ç½®Jenkins"></a>é…ç½®Jenkins</h1><h2 id="å®‰è£…GitLabæ’ä»¶-å¦‚æœGitæ’ä»¶ä¸å­˜åœ¨ï¼Œä¼šä½œä¸ºGitLabæ’ä»¶çš„ä¾èµ–è¢«å®‰è£…"><a href="#å®‰è£…GitLabæ’ä»¶-å¦‚æœGitæ’ä»¶ä¸å­˜åœ¨ï¼Œä¼šä½œä¸ºGitLabæ’ä»¶çš„ä¾èµ–è¢«å®‰è£…" class="headerlink" title="å®‰è£…GitLabæ’ä»¶(å¦‚æœGitæ’ä»¶ä¸å­˜åœ¨ï¼Œä¼šä½œä¸ºGitLabæ’ä»¶çš„ä¾èµ–è¢«å®‰è£…)"></a>å®‰è£…GitLabæ’ä»¶(å¦‚æœGitæ’ä»¶ä¸å­˜åœ¨ï¼Œä¼šä½œä¸ºGitLabæ’ä»¶çš„ä¾èµ–è¢«å®‰è£…)</h2><ol><li><p>ç‚¹å‡»Jenkins -&gt; Manage Jenkins -&gt; Manage Pluginsæ‰“å¼€Plugin Manageré¡µé¢</p></li><li><p>æ‰“å¼€Availableé¡µé¢ï¼Œé€‰æ‹©GitLabæ’ä»¶ï¼Œç‚¹å‡»Install without restartæŒ‰é’®</p><p><img src="/2020/03/09/jenkins-gitlab-pullrequest/1.png"></p></li><li><p>å¿…è¦æ—¶é‡å¯Jenkinsè®©æ’ä»¶ç”Ÿæ•ˆ</p></li></ol><p>å®‰è£…å®Œæ’ä»¶åï¼Œç”Ÿæˆçš„Web hook urlåœ°å€ä¸º<code>https://JENKINS_URL/project/YOUR_JOB</code>ã€‚</p><h2 id="åˆ›å»ºGitlab-Personal-Access-Token"><a href="#åˆ›å»ºGitlab-Personal-Access-Token" class="headerlink" title="åˆ›å»ºGitlab Personal Access Token"></a>åˆ›å»ºGitlab Personal Access Token</h2><ol><li><p>ç‚¹å‡»Settingsæ‰“å¼€ç”¨æˆ·è®¾ç½®é¡µé¢ï¼Œå¹¶ç‚¹å‡»Access Tokensæ‰“å¼€åˆ›å»ºPersonal Access Tokené¡µé¢</p><p><img src="/2020/03/09/jenkins-gitlab-pullrequest/3.png"></p></li><li><p>åœ¨Nameå­—æ®µå¡«ä¸ŠTokençš„åå­—ï¼Œåœ¨Scopeå­—æ®µé€‰ä¸Šéœ€è¦çš„æƒé™ï¼Œapiçš„æƒé™åº”è¯¥è¶³å¤Ÿäº†ã€‚å¦‚æœéœ€è¦è®¾ç½®æœ‰æ•ˆæœŸé™ï¼Œå¯ä»¥è®¾ç½®Expires atå­—æ®µï¼Œå¦åˆ™Tokenæ°¸ä¸è¿‡æœŸ</p></li><li><p>ç‚¹å‡»Create personal access tokenæŒ‰é’®åˆ›å»ºTokenã€‚æ³¨æ„ï¼Œéœ€è¦ç«‹å³å¤åˆ¶è¿™ä¸ªTokenå€¼ï¼Œå¦åˆ™é¡µé¢åˆ·æ–°åå°±ä¼šè¢«éšè—æ‰</p></li></ol><h2 id="é…ç½®Jenkins-Gitlabæ’ä»¶"><a href="#é…ç½®Jenkins-Gitlabæ’ä»¶" class="headerlink" title="é…ç½®Jenkins Gitlabæ’ä»¶"></a>é…ç½®Jenkins Gitlabæ’ä»¶</h2><ol><li><p>ç‚¹å‡»Jenkins -&gt; Manage Jenkins -&gt; Config Systemæ‰“å¼€ç³»ç»Ÿé…ç½®é¡µé¢</p></li><li><p>å®šä½åˆ°â€GitLabâ€œæ®µè½ï¼Œç‚¹å‡»Addèœå•æ‰“å¼€åˆ›å»ºJenkinsè®¤è¯ä¿¡æ¯å¯¹è¯æ¡†<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/2.png"></p></li><li><p>é€‰æ‹©â€GitLab API Tokenâ€ç±»å‹çš„å‡­è¯ï¼Œåœ¨API tokenå­—æ®µé‡Œè¾“å…¥å‰é¢åˆ›å»ºçš„Gitlab Personal Access Tokenï¼Œè®¾ç½®Tokençš„IDå’Œæè¿°<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/4.png"></p></li><li><p>è®¾ç½®Gitlabè¯¦ç»†çš„è¿æ¥ä¿¡æ¯<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/5.png"></p><p>è®¾ç½®Connection nameï¼ŒGitlab host URLï¼Œé€‰æ‹©åˆšåˆšåˆ›å»ºçš„GitLab API Tokenï¼Œè¿æ¥å’Œè¯»å–è¶…æ—¶å¯ä»¥ç¨å¾®è®¾å¤§ä¸€ç‚¹ã€‚å¯ä»¥ç‚¹å‡»Test Connectionæµ‹è¯•æ˜¯å¦èƒ½è¿é€šã€‚</p></li><li><p>ç‚¹å‡»â€Saveâ€æŒ‰é’®ä¿å­˜é…ç½®</p></li></ol><h1 id="åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-Merge-Request"><a href="#åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-Merge-Request" class="headerlink" title="åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(Merge Request)"></a>åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(Merge Request)</h1><h2 id="Jenkinsfile"><a href="#Jenkinsfile" class="headerlink" title="Jenkinsfile"></a>Jenkinsfile</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs groovy">pipeline &#123;<br>    agent &#123;<br>        label <span class="hljs-string">&#x27;common&#x27;</span><br>    &#125;<br>    triggers &#123;<br>        gitlab(<br>            <span class="hljs-symbol">triggerOnPush:</span> <span class="hljs-literal">false</span>,<br>            <span class="hljs-symbol">triggerOnMergeRequest:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">triggerOpenMergeRequestOnPush:</span> <span class="hljs-string">&quot;source&quot;</span>,<br>            <span class="hljs-symbol">triggerOnNoteRequest:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">noteRegex:</span> <span class="hljs-string">&quot;.*\\[run\\W+ci\\].*&quot;</span>,<br>            <span class="hljs-symbol">skipWorkInProgressMergeRequest:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">ciSkip:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">setBuildDescription:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">addNoteOnMergeRequest:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">addCiMessage:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">addVoteOnMergeRequest:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-symbol">acceptMergeRequestOnSuccess:</span> <span class="hljs-literal">false</span>,<br>            <span class="hljs-symbol">branchFilterType:</span> <span class="hljs-string">&quot;NameBasedFilter&quot;</span>,<br>            <span class="hljs-symbol">includeBranchesSpec:</span> <span class="hljs-string">&quot;master&quot;</span>,<br>            <span class="hljs-symbol">excludeBranchesSpec:</span> <span class="hljs-string">&quot;&quot;</span><br>        )<br>    &#125;<br>    environment &#123;<br>        GITLAB_URL = <span class="hljs-string">&quot;http://mygitlab.philips.com&quot;</span><br>        GITLAB_ORG = <span class="hljs-string">&quot;mikesay&quot;</span><br>        GITLAB_REPO = <span class="hljs-string">&quot;mikesay-test-1&quot;</span><br>    &#125;<br>    options &#123;<br>        skipDefaultCheckout()<br>        ansiColor(<span class="hljs-string">&#x27;xterm&#x27;</span>)<br>        gitLabConnection <span class="hljs-string">&#x27;mygitlab&#x27;</span><br>    &#125;<br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;Checkout&#x27;</span>) &#123;<br>            steps &#123;<br>                script&#123;<br>                    <span class="hljs-keyword">def</span> scmVars =   checkout(<br>                                        [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;origin/mr/$&#123;gitlabMergeRequestId&#125;/head&quot;</span>]], <br>                                        <span class="hljs-symbol">doGenerateSubmoduleConfigurations:</span> <span class="hljs-literal">false</span>,<br>                                        <span class="hljs-symbol">submoduleCfg:</span> [], <br>                                        <span class="hljs-symbol">extensions:</span> [<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;RelativeTargetDirectory&#x27;</span>, <span class="hljs-attr">relativeTargetDir:</span> <span class="hljs-string">&#x27;codes&#x27;</span>],<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;CleanBeforeCheckout&#x27;</span>]<br>                                        ],<br>                                        <span class="hljs-symbol">userRemoteConfigs:</span> [<br>                                                [<br>                                                    <span class="hljs-symbol">credentialsId:</span> <span class="hljs-string">&#x27;gitlab_account&#x27;</span>, <br>                                                    <span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;origin&#x27;</span>, <br>                                                    <span class="hljs-symbol">refspec:</span> <span class="hljs-string">&#x27;+refs/heads/*:refs/remotes/origin/* +refs/merge-requests/*:refs/remotes/origin/mr/*&#x27;</span>, <br>                                                    <span class="hljs-symbol">url:</span> <span class="hljs-string">&quot;$&#123;GITLAB_URL&#125;/$&#123;GITLAB_ORG&#125;/$&#123;GITLAB_REPO&#125;.git&quot;</span><br>                                                ]<br>                                            ]<br>                                        ]<br>                                    )<br>                    env.GIT_BRANCH = <span class="hljs-string">&quot;$&#123;scmVars.GIT_BRANCH&#125;&quot;</span><br>                    env.GIT_COMMIT = <span class="hljs-string">&quot;$&#123;scmVars.GIT_COMMIT&#125;&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;Build&#x27;</span>) &#123;<br>            steps &#123;<br>                dir(<span class="hljs-string">&#x27;codes&#x27;</span>) &#123;<br>                    sh <span class="hljs-string">&#x27;&#x27;&#x27;#!/bin/bash -l</span><br><span class="hljs-string">                        echo &quot;Start building!&quot;</span><br><span class="hljs-string">                    &#x27;&#x27;&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    post &#123;<br>      failure &#123;<br>        updateGitlabCommitStatus <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;build&#x27;</span>, <span class="hljs-attr">state:</span> <span class="hljs-string">&#x27;failed&#x27;</span><br>      &#125;<br>      success &#123;<br>        updateGitlabCommitStatus <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;build&#x27;</span>, <span class="hljs-attr">state:</span> <span class="hljs-string">&#x27;success&#x27;</span><br>      &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p>6è¡Œ-22è¡Œè®¾ç½®GitLabè§¦å‘å™¨ï¼Œä¸»è¦è®¾ç½®å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å˜é‡</th><th>äº‹ä¾‹å€¼</th></tr></thead><tbody><tr><td>triggerOnPush</td><td>ä»»ä½•æ¨é€äº‹ä»¶éƒ½ä¼šè§¦å‘æ„å»ºã€‚å› ä¸ºæ˜¯ç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(Merge Request)ï¼Œåªéœ€è¦ç›‘å¬åˆå¹¶è¯·æ±‚(Merge Request)äº‹ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰“å¼€ã€‚</td></tr><tr><td>triggerOnMergeRequest</td><td>è®¾ç½®åˆå¹¶è¯·æ±‚(Merge Request)äº‹ä»¶è§¦å‘æ„å»ºï¼Œéœ€è¦æ‰“å¼€ã€‚</td></tr><tr><td>triggerOpenMergeRequestOnPush</td><td>å½“åˆå¹¶è¯·æ±‚(Merge Request)çš„åŸåˆ†æ”¯æœ‰æ–°çš„æ¨é€è§¦å‘æ„å»ºï¼Œéœ€è¦æ‰“å¼€ã€‚</td></tr><tr><td>triggerOnNoteRequest</td><td>åˆå¹¶è¯·æ±‚(Merge Request)çš„è¯„è®ºæœ‰æ›´æ–°æ—¶è§¦å‘æ„å»ºï¼Œéœ€è¦æ‰“å¼€ï¼Œå¹¶ä¸”é…åˆnoteRegexè®¾ç½®å…·ä½“çš„è§¦å‘æ„å»ºçš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td>ciSkip</td><td>å½“åˆå¹¶è¯·æ±‚(Merge Request)çš„è¯„è®ºåŒ…æ‹¬å­—ç¬¦ä¸²â€[ci-skip]â€æ—¶ï¼Œä¸ä¼šæ„å»ºè¿™ä¸ªåˆå¹¶è¯·æ±‚(Merge Request)ã€‚</td></tr><tr><td>branchFilterType, includeBranchesSpec, excludeBranchesSpec</td><td>è®¾ç½®å“ªäº›åˆ†æ”¯ä¸Šçš„åˆå¹¶è¯·æ±‚(Merge Request)ä¼šè§¦å‘æ„å»ºã€‚</td></tr></tbody></table></li><li><p>50è¡Œ: æ·»åŠ refspecè·å–åˆå¹¶è¯·æ±‚(merge request)çš„åˆ†æ”¯ä¿¡æ¯</p> <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-attr">refspec:</span> <span class="hljs-string">&#x27;+refs/merge-requests/*:refs/remotes/origin/mr/*&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>39è¡Œ: branchesé€‰æ‹©â€origin/mr/${gitlabMergeRequestId}/headâ€, æ˜¯åˆå¹¶åçš„åˆ†æ”¯ã€‚ç¯å¢ƒå˜é‡â€gitlabMergeRequestIdâ€æ˜¯åˆå¹¶è¯·æ±‚(merge request)çš„IDå·</p> <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">[<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;origin/mr/$&#123;gitlabMergeRequestId&#125;/head&quot;</span>]]<br></code></pre></td></tr></table></figure></li></ol><p>é™¤äº†â€gitlabMergeRequestIdâ€å¤–ï¼ŒGitlabæ’ä»¶è¿˜å¾€å½“å‰æ„å»ºä¸­æ³¨å…¥äº†è®¸å¤šå˜é‡ä¾›æ„å»ºJobä½¿ç”¨ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs groovy">gitlabBranch<br>gitlabSourceBranch<br>gitlabActionType<br>gitlabUserName<br>gitlabUserUsername<br>gitlabUserEmail<br>gitlabSourceRepoHomepage<br>gitlabSourceRepoName<br>gitlabSourceNamespace<br>gitlabSourceRepoURL<br>gitlabSourceRepoSshUrl<br>gitlabSourceRepoHttpUrl<br>gitlabMergeRequestTitle<br>gitlabMergeRequestDescription<br>gitlabMergeRequestId<br>gitlabMergeRequestIid<br>gitlabMergeRequestState<br>gitlabMergedByUser<br>gitlabMergeRequestAssignee<br>gitlabMergeRequestLastCommit<br>gitlabMergeRequestTargetProjectId<br>gitlabTargetBranch<br>gitlabTargetRepoName<br>gitlabTargetNamespace<br>gitlabTargetRepoSshUrl<br>gitlabTargetRepoHttpUrl<br>gitlabBefore<br>gitlabAfter<br>gitlabTriggerPhrase<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile"><a href="#åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile" class="headerlink" title="åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile"></a>åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile</h2><ol><li><p>ç‚¹å‡»â€New Itemâ€</p></li><li><p>é€‰æ‹©Jobç±»å‹ä¸ºâ€Pipelineâ€ï¼Œè¾“å…¥Jobçš„åå­—ï¼Œæ¯”å¦‚â€gitlab-preflightâ€ï¼Œç‚¹å‡»â€Okâ€æŒ‰é’®<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/6.png"></p></li><li><p>åœ¨â€Pipelineâ€æ®µï¼Œå¼•ç”¨Jenkinsfile(Jenkinsfileæ˜¯å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„Gitä»“åº“ä¸­çš„)<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/7.png"></p></li><li><p>ç‚¹å‡»â€Saveâ€æŒ‰é’®ä¿å­˜Jenkins Job</p></li><li><p>æ‰‹åŠ¨è§¦å‘Jobä¸€æ¬¡è®©Jenkinsfileä¸­è®¾ç½®çš„è§¦å‘è§„åˆ™é…ç½®åˆ°jobä¸­ã€‚<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/8.png"></p></li></ol><h1 id="é…ç½®Gitlab"><a href="#é…ç½®Gitlab" class="headerlink" title="é…ç½®Gitlab"></a>é…ç½®Gitlab</h1><h2 id="åˆ›å»ºJenkins-API-token"><a href="#åˆ›å»ºJenkins-API-token" class="headerlink" title="åˆ›å»ºJenkins API token"></a>åˆ›å»ºJenkins API token</h2><ol><li><p>è¿›å…¥Jenkinsç”¨æˆ·è®¾ç½®é¡µé¢<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/11.png"></p></li><li><p>ç‚¹å‡»Add new Tokenï¼Œå¹¶ç‚¹å‡»GenerateæŒ‰é’®äº§ç”Ÿå½“å‰ç”¨æˆ·çš„API Tokenï¼Œæ³¨æ„ç«‹å³å¤åˆ¶ä¿å­˜ï¼Œå› ä¸ºé¡µé¢åˆ·æ–°åï¼Œå°†è¢«éšè—<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/12.png"></p></li><li><p>ç‚¹å‡»SaveæŒ‰é’®ä¿å­˜</p></li></ol><h2 id="åˆ›å»ºGitlab-Web-hook"><a href="#åˆ›å»ºGitlab-Web-hook" class="headerlink" title="åˆ›å»ºGitlab Web hook"></a>åˆ›å»ºGitlab Web hook</h2><ol><li><p>è¿›å…¥å…·ä½“çš„é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»Settings -&gt; Integrationsæ‰“å¼€åˆ›å»ºWeb hookçš„é¡µé¢<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/13.png"></p></li><li><p>è®¾ç½®Web hookè¯¦ç»†ä¿¡æ¯<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/14.png"></p></li></ol><p>åœ¨URLåœ°å€é‡Œè¾“å…¥Jenkins Gitlabæ’ä»¶ç”Ÿæˆçš„Web hookåœ°å€ï¼ŒåŒ…æ‹¬Jenkinsçš„è®¤è¯ä¿¡æ¯ï¼Œæ¯”å¦‚<code>https://&lt;jenkins user&gt;:&lt;user&#39;s api token&gt;@mykube.com/jenkins/project/gitlab-preflight</code>ï¼Œé€‰æ‹©â€Commentsâ€å’Œâ€Merge request eventsâ€ç”¨æ¥ç›‘å¬åˆå¹¶è¯·æ±‚(merge request)äº‹ä»¶ï¼ŒåŒ…æ‹¬è¯„è®ºæ›´æ–°äº‹ä»¶ã€‚</p><ol start="3"><li>ç‚¹å‡»Add webhookæŒ‰é’®æ·»åŠ Web hook</li></ol><h1 id="åˆ›å»ºåˆå¹¶è¯·æ±‚-merge-request-è§¦å‘æ„å»º"><a href="#åˆ›å»ºåˆå¹¶è¯·æ±‚-merge-request-è§¦å‘æ„å»º" class="headerlink" title="åˆ›å»ºåˆå¹¶è¯·æ±‚(merge request)è§¦å‘æ„å»º"></a>åˆ›å»ºåˆå¹¶è¯·æ±‚(merge request)è§¦å‘æ„å»º</h1><ol><li><p>Gitlabçš„åˆå¹¶è¯·æ±‚(merge request)<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/9.png"></p></li><li><p>è§¦å‘çš„æ„å»º<br><img src="/2020/03/09/jenkins-gitlab-pullrequest/10.png"></p></li></ol><p>ä»æ„å»ºçš„æè¿°æ¥çœ‹ï¼ŒJenkins Gitlabæ’ä»¶æä¾›äº†æ¯”è¾ƒå…¨é¢çš„åŠŸèƒ½ï¼Œæ˜¾ç¤ºäº†åˆå¹¶è¯·æ±‚(merge request)çš„ä¿¡æ¯ï¼ŒåŒæ—¶åœ¨Gitlabçš„åˆå¹¶è¯·æ±‚(merge request)é¡µé¢ä¹Ÿæ˜¾ç¤ºäº†æ„å»ºçš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Git</tag>
      
      <tag>Jenkins</tag>
      
      <tag>GitLab</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsæ„å»ºBitbucketåˆå¹¶è¯·æ±‚(Pull Request)</title>
    <link href="/2020/02/23/jenkins-bibucket-pullrequest/"/>
    <url>/2020/02/23/jenkins-bibucket-pullrequest/</url>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="http://www.mikesay.com/2020/01/30/jenkins-github-pullrequest/">â€œJenkinséšç¬”(3)  Jenkinsæ„å»ºGithubåˆå¹¶è¯·æ±‚(Pull Request)â€</a>ä¸­ä»‹ç»äº†ç”¨Jenkinsæ„å»ºGithubåˆå¹¶è¯·æ±‚(Pull Request)çš„æ–¹æ³•ä»¥åŠpreflightæµæ°´çº¿çš„æ„ä¹‰ã€‚æœ¬æ–‡å°†ç»§ç»­ä»‹ç»å¦‚ä½•é…ç½®Jenkinså’ŒBitbucketæ¥æ„å»ºBitbucketåˆå¹¶è¯·æ±‚(Pull Request)ã€‚</p><span id="more"></span><p>Bitbucketå®˜ç½‘æä¾›äº†ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ¥é…ç½®Jenkinsæ„å»ºBitbucketåˆå¹¶è¯·æ±‚(Pull Request):</p><ol><li>Jenkins <a href="https://plugins.jenkins.io/git/">Gitæ’ä»¶</a>ç»“åˆBitbucketæ’ä»¶<a href="https://marketplace.atlassian.com/apps/1211284/webhook-to-jenkins-for-bitbucket/version-history">Webhook to Jenkins for Bitbucket</a></li><li>Jenkins <a href="https://plugins.jenkins.io/cloudbees-bitbucket-branch-source/">Bitbucket Branch Source</a>æ’ä»¶</li></ol><p>æ–¹æ³•1ä¸­çš„Bitbucketæ’ä»¶Webhook to Jenkins for Bitbucketæ˜¯å•†ä¸šç‰ˆçš„ï¼Œéœ€è¦æ”¶è´¹ï¼Œä¸ªäººè§‰å¾—ä¸å€¼å¾—ï¼Œä¹Ÿæ²¡æœ‰å°è¯•ã€‚æ–¹æ³•2ä¸­çš„Jenkins Bitbucket Branch Sourceæ’ä»¶é€‚åˆäºJenkinså¤šåˆ†æ”¯æµæ°´çº¿ï¼Œ ä¹Ÿä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„èŒƒå›´ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJenkinsè¿˜æœ‰è¿™ä¸‰ä¸ªæ’ä»¶å¯ç”¨ï¼š</p><ul><li>Jenkins <a href="https://plugins.jenkins.io/bitbucket-pullrequest-builder/">Bitbucket Pullrequest Builder</a>æ’ä»¶</li><li>Jenkins <a href="https://plugins.jenkins.io/bitbucket/">Bitbucket</a>æ’ä»¶</li><li>Jenkins <a href="https://plugins.jenkins.io/bitbucket-push-and-pull-request/">Bitbucket Push and Pull Request</a>æ’ä»¶</li></ul><p>Bitbucket Pullrequest Builderæ’ä»¶æœ‰ä¸€äº›ä¸¥é‡çš„é—®é¢˜<a href="https://plugins.jenkins.io/bitbucket-pullrequest-builder/">(https://plugins.jenkins.io/bitbucket-pullrequest-builder/)</a>ï¼Œæ‰€ä»¥ä¸èƒ½é‡‡ç”¨ã€‚Bitbucketæ’ä»¶æ˜¯ç›®å‰ç½‘ä¸Šå¤§éƒ¨åˆ†æ–‡ç« è®¨è®ºç”¨åˆ°çš„æ’ä»¶ï¼Œä½†æ˜¯æµ‹è¯•ä¸‹æ¥å‘ç°ä¸ªé—®é¢˜ï¼Œå³æäº¤ä»£ç åˆ°ç°æœ‰çš„åˆå¹¶è¯·æ±‚(Pull Request)ä¸ä¼šè§¦å‘æ–°çš„åˆå¹¶è¯·æ±‚(Pull Request)çš„æ„å»ºï¼Œè¿™ä¸ªé—®é¢˜é¦–å…ˆæ˜¯Bitbucket Webhookå¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªè¿™æ ·çš„äº‹ä»¶(<a href="https://community.atlassian.com/t5/Bitbucket-questions/How-to-trigger-a-webhook-when-a-commit-is-pushed-to-an-open-pull/qaq-p/1029556">ç½‘ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„è®¨è®º</a>)ï¼Œå…¶æ¬¡Bitbucketæ’ä»¶ä¹Ÿæ²¡æœ‰æä¾›è¶³å¤Ÿçš„çµæ´»æ€§æ–¹ä¾¿è§£å†³å®ƒã€‚æœ€ç»ˆæµ‹è¯•ä¸‹æ¥è§‰å¾—Bitbucket Push and Pull Requestæ’ä»¶å¯ä»¥ä½¿ç”¨ï¼Œé¦–å…ˆå®ƒæ˜¯ä»Bitbucketæ’ä»¶ç»§æ‰¿è¿‡æ¥çš„ï¼ŒåŒ…å«äº†Bitbucketæ’ä»¶çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå…¶æ¬¡é€šè¿‡ä½¿ç”¨Bitbucket Push and Pull Requestæ’ä»¶ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªä¸´æ—¶çš„æ–¹æ³•è§£å†³æˆ‘ä»¬å‘ç°çš„Bitbucketæ’ä»¶å’ŒBitbucket Webhookçš„é—®é¢˜ã€‚ä¸‹é¢å°†è¯¦ç»†ä»‹ç»åˆ©ç”¨Jenkins Bitbucket Push and Pull Requestæ’ä»¶æ¥æ„å»ºBitbucketåˆå¹¶è¯·æ±‚(Pull Request)ã€‚</p><h1 id="é…ç½®Jenkins"><a href="#é…ç½®Jenkins" class="headerlink" title="é…ç½®Jenkins"></a>é…ç½®Jenkins</h1><h2 id="å®‰è£…Bitbucket-Push-and-Pull-Requestæ’ä»¶"><a href="#å®‰è£…Bitbucket-Push-and-Pull-Requestæ’ä»¶" class="headerlink" title="å®‰è£…Bitbucket Push and Pull Requestæ’ä»¶"></a>å®‰è£…Bitbucket Push and Pull Requestæ’ä»¶</h2><ol><li><p>ç‚¹å‡»Jenkins -&gt; Manage Jenkins -&gt; Manage Pluginsæ‰“å¼€Plugin Manageré¡µé¢</p></li><li><p>æ‰“å¼€Availableé¡µé¢ï¼Œé€‰æ‹©Github Pull Request Builderï¼Œç‚¹å‡»Install without restartæŒ‰é’®<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/1.png"></p></li><li><p>å¿…è¦æ—¶é‡å¯Jenkinsè®©æ’ä»¶ç”Ÿæ•ˆ</p></li></ol><p>å®‰è£…å®Œæ’ä»¶åï¼Œç”Ÿæˆçš„Web hook urlåœ°å€ä¸º<code>http://&lt;jenkins url&gt;/bitbucket-hook/</code>ã€‚</p><h1 id="é…ç½®Bitbucketä»£ç ä»“åº“"><a href="#é…ç½®Bitbucketä»£ç ä»“åº“" class="headerlink" title="é…ç½®Bitbucketä»£ç ä»“åº“"></a>é…ç½®Bitbucketä»£ç ä»“åº“</h1><ol><li><p>ç‚¹å‡»â€Repository settingsâ€ -&gt; â€œWebhooksâ€æ‰“å¼€Webhooksåˆ›å»ºé¡µé¢<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/2.png"></p></li><li><p>ç‚¹å‡»â€Create webhookâ€æŒ‰é’®æ‰“å¼€æ·»åŠ Webhooké¡µé¢<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/3.png"></p></li></ol><p>æ·»åŠ ä»¥ä¸‹çš„ä¿¡æ¯åç‚¹å‡»ä¿å­˜æŒ‰é’®åˆ›å»ºæ–°çš„Webhook:</p><ul><li>URL: è®¾ç½®ä¸ºBitbucket Push and Pull Requestæ’ä»¶ç”Ÿæˆçš„Web hook urlåœ°å€ï¼š<code>http://&lt;jenkins url&gt;/bitbucket-hook/</code></li><li>Pull requestäº‹ä»¶: é€‰æ‹©â€Openedâ€å’Œâ€Modifiedâ€</li><li>Repositoryäº‹ä»¶: é€‰æ‹©â€Pushâ€<blockquote><p>è¿™é‡Œé€‰æ‹©Pushäº‹ä»¶æ˜¯ä¸ºäº†è§£å†³æ–‡ç« å¼€å¤´æåˆ°çš„Bitbucketæ’ä»¶å’ŒBitbucket Webhookçš„é—®é¢˜ï¼Œå³æäº¤ä»£ç åˆ°å·²æœ‰çš„åˆå¹¶è¯·æ±‚(Pull Request)ä¸ä¼šè§¦å‘æ–°çš„åˆå¹¶è¯·æ±‚(Pull Request)çš„æ„å»ºã€‚</p></blockquote></li></ul><h1 id="åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-pull-merge-request"><a href="#åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-pull-merge-request" class="headerlink" title="åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(pull/merge request)"></a>åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(pull/merge request)</h1><h2 id="Jenkinsfile"><a href="#Jenkinsfile" class="headerlink" title="Jenkinsfile"></a>Jenkinsfile</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs groovy">pipeline &#123;<br>    agent &#123;<br>        label <span class="hljs-string">&#x27;common&#x27;</span><br>    &#125;<br>    triggers &#123;<br>        bitBucketTrigger(<br>            [<br>                [<br>                    <span class="hljs-symbol">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRPullRequestServerTriggerFilter&#x27;</span>,<br>                    <span class="hljs-symbol">actionFilter:</span> [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRPullRequestServerCreatedActionFilter&#x27;</span>, <span class="hljs-attr">allowedBranches:</span> <span class="hljs-string">&#x27;&#x27;</span>]<br>                ], <br>                [<br>                    <span class="hljs-symbol">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRPullRequestServerTriggerFilter&#x27;</span>, <br>                    <span class="hljs-symbol">actionFilter:</span> [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRPullRequestServerUpdatedActionFilter&#x27;</span>, <span class="hljs-attr">allowedBranches:</span> <span class="hljs-string">&#x27;&#x27;</span>]<br>                ],<br>                [<br>                    <span class="hljs-symbol">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRRepositoryTriggerFilter&#x27;</span>, <br>                    <span class="hljs-symbol">actionFilter:</span> [<br>                                    <span class="hljs-symbol">$class:</span> <span class="hljs-string">&#x27;BitBucketPPRServerRepositoryPushActionFilter&#x27;</span>, <br>                                    <span class="hljs-symbol">allowedBranches:</span> <span class="hljs-string">&#x27;&#x27;</span>, <br>                                    <span class="hljs-symbol">triggerAlsoIfNothingChanged:</span> <span class="hljs-literal">true</span>, <br>                                    <span class="hljs-symbol">triggerAlsoIfTagPush:</span> <span class="hljs-literal">false</span><br>                                ]<br>                ]<br>            ]<br>        )<br>    &#125;<br>    environment &#123;<br>        BITBUCKET_URL = <span class="hljs-string">&quot;http://130.147.249.221:7990&quot;</span><br>        BITBUCKET_ORG = <span class="hljs-string">&quot;miks&quot;</span><br>        BITBUCKET_REPO = <span class="hljs-string">&quot;mikesay-test-1&quot;</span><br>    &#125;<br>    options &#123;<br>        skipDefaultCheckout()<br>        ansiColor(<span class="hljs-string">&#x27;xterm&#x27;</span>)<br>    &#125;<br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;Checkout&#x27;</span>) &#123;<br>            steps &#123;<br>                script&#123;<br>                    <span class="hljs-keyword">def</span> scmVars =   checkout(<br>                                        [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;origin/pr/*/merge&quot;</span>]], <br>                                        <span class="hljs-symbol">doGenerateSubmoduleConfigurations:</span> <span class="hljs-literal">false</span>,<br>                                        <span class="hljs-symbol">submoduleCfg:</span> [], <br>                                        <span class="hljs-symbol">extensions:</span> [<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;RelativeTargetDirectory&#x27;</span>, <span class="hljs-attr">relativeTargetDir:</span> <span class="hljs-string">&#x27;codes&#x27;</span>],<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;CleanBeforeCheckout&#x27;</span>]<br>                                        ],<br>                                        <span class="hljs-symbol">userRemoteConfigs:</span> [<br>                                                [<br>                                                    <span class="hljs-symbol">credentialsId:</span> <span class="hljs-string">&#x27;ghe_account&#x27;</span>, <br>                                                    <span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;origin&#x27;</span>, <br>                                                    <span class="hljs-symbol">refspec:</span> <span class="hljs-string">&#x27;+refs/pull-requests/*:refs/remotes/origin/pr/*&#x27;</span>, <br>                                                    <span class="hljs-symbol">url:</span> <span class="hljs-string">&quot;$&#123;BITBUCKET_URL&#125;/scm/$&#123;BITBUCKET_ORG&#125;/$&#123;BITBUCKET_REPO&#125;.git&quot;</span><br>                                                ]<br>                                            ]<br>                                        ]<br>                                    )<br>                    env.GIT_BRANCH = <span class="hljs-string">&quot;$&#123;scmVars.GIT_BRANCH&#125;&quot;</span><br>                    env.GIT_COMMIT = <span class="hljs-string">&quot;$&#123;scmVars.GIT_COMMIT&#125;&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;Build&#x27;</span>) &#123;<br>            steps &#123;<br>                dir(<span class="hljs-string">&#x27;codes&#x27;</span>) &#123;<br>                    sh <span class="hljs-string">&#x27;&#x27;&#x27;#!/bin/bash -l</span><br><span class="hljs-string">                        echo &quot;Start building!&quot;</span><br><span class="hljs-string">                    &#x27;&#x27;&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>8è¡Œ-24è¡Œ: é…ç½®Jobè§¦å‘äº‹ä»¶ï¼Œåˆ†åˆ«æ˜¯åˆå¹¶è¯·æ±‚(Pull Request)çš„åˆ›å»º(Create)ï¼Œæ›´æ–°(Update)äº‹ä»¶ï¼Œä»¥åŠGitä»“åº“çš„æ¨é€(Push)äº‹ä»¶ï¼ŒåŒæ—¶è®¾ç½®â€triggerAlsoIfNothingChangedâ€çš„å€¼ä¸ºtrueã€‚å‹¾é€‰Gitä»“åº“çš„æ¨é€(Push)äº‹ä»¶å’Œè®¾ç½®â€triggerAlsoIfNothingChangedâ€çš„å€¼ä¸ºtrueæ˜¯ä¸ºäº†è¿‡æ»¤å‰é¢Webhookä¸­è®¾ç½®çš„Gitä»“åº“çš„æ¨é€(Push)äº‹ä»¶ï¼Œè¿™æ ·å½“æœ‰æ–°çš„æäº¤æ¨é€åˆ°åˆå¹¶è¯·æ±‚(Pull Request)åï¼ŒJobä¹Ÿèƒ½è¢«è§¦å‘ã€‚</p><p>53è¡Œï¼šè®¾ç½®æ‹‰å–åˆå¹¶è¯·æ±‚(Pull Request)çš„é…ç½®ã€‚å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« <a href="http://www.mikesay.com/2020/01/29/pullrequest-essential/">â€œGitéšç¬”(1) Gitåˆå¹¶è¯·æ±‚(pull/merge request)çš„æœ¬è´¨â€</a>ã€‚</p><p>42è¡Œï¼šæ„å»ºåˆ†æ”¯è®¾ç½®ä¸º<code>origin/pr/*/merge</code>ï¼Œè¿™æ ·å¯ä»¥æ„å»ºæ‰€æœ‰åˆå¹¶è¯·æ±‚(Pull Request)å¯¹åº”çš„åˆ†æ”¯ã€‚Bitbucket Push and Pull Requestæ’ä»¶åœ¨è§¦å‘æ„å»ºæ—¶ä¼šä¼ é€’ä¸€ä¸ªç¯å¢ƒå˜é‡â€BITBUCKET_PULL_REQUEST_IDâ€åˆ°æ„å»ºJobä¸­ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼å°±æ˜¯åˆå¹¶è¯·æ±‚(Pull Request)çš„IDå·ã€‚åˆ©ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥å°†æ„å»ºåˆ†æ”¯è®¾ç½®çš„æ›´ç²¾ç¡®ä¸€ç‚¹ï¼Œæ¯”å¦‚<code>origin/pr/$&#123;BITBUCKET_PULL_REQUEST_ID&#125;/merge</code>ï¼Œä½†åªæœ‰åˆå¹¶è¯·æ±‚(Pull Request)çš„åˆ›å»ºï¼Œå…³é—­å’Œé‡æ–°æ‰“å¼€çš„äº‹ä»¶è§¦å‘çš„æ„å»ºJobæ‰ä¼šä¼ é€’è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ä¸æ€ä¹ˆé€šç”¨ã€‚</p><blockquote><p>å°†æ„å»ºåˆ†æ”¯è®¾ç½®ä¸ºé€šç”¨çš„åˆå¹¶è¯·æ±‚(Pull Request)åˆ†æ”¯ä¹Ÿå¸¦æ¥äº†ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å½“æ„å»ºJobåˆ›å»ºå¥½åï¼Œå¿…é¡»æ‰‹åŠ¨è§¦å‘å¤šæ¬¡ä»¥è·å–æ‰€æœ‰æœªå®Œæˆçš„åˆå¹¶è¯·æ±‚(Pull Request)åˆ†æ”¯çš„ä¿¡æ¯ä»¥ä¾¿åç»­åˆå¹¶è¯·æ±‚(Pull Request)æœ‰æ›´æ–°æ—¶ï¼Œèƒ½å¤Ÿè§¦å‘æ­£ç¡®çš„æ„å»ºã€‚</p></blockquote><h2 id="åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile"><a href="#åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile" class="headerlink" title="åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile"></a>åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile</h2><ol><li><p>ç‚¹å‡»â€New Itemâ€</p></li><li><p>é€‰æ‹©Jobç±»å‹ä¸ºâ€Pipelineâ€ï¼Œè¾“å…¥Jobçš„åå­—ï¼Œæ¯”å¦‚â€bitbucket-preflightâ€ï¼Œç‚¹å‡»â€Okâ€æŒ‰é’®<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/4.png"></p></li><li><p>åœ¨â€Pipelineâ€æ®µï¼Œå¼•ç”¨Jenkinsfile(Jenkinsfileæ˜¯å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„Gitä»“åº“ä¸­çš„)<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/5.png"></p></li><li><p>ç‚¹å‡»â€Saveâ€æŒ‰é’®ä¿å­˜Jenkins Job</p></li><li><p>æ‰‹åŠ¨è§¦å‘Jenkins Jobå¤šæ¬¡ä»¥è·å–æ‰€æœ‰æœªå®Œæˆçš„åˆå¹¶è¯·æ±‚(Pull Request)åˆ†æ”¯çš„ä¿¡æ¯ã€‚å¦‚æœç›®å‰æ²¡æœ‰æœªå®Œæˆçš„åˆå¹¶è¯·æ±‚(Pull Request)ï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨è§¦å‘Jobä¸€æ¬¡è®©Jenkinsfileä¸­è®¾ç½®çš„è§¦å‘è§„åˆ™é…ç½®åˆ°jobä¸­ã€‚<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/6.png"></p></li></ol><h1 id="åˆ›å»ºåˆå¹¶è¯·æ±‚-pull-merge-request-è§¦å‘æ„å»º"><a href="#åˆ›å»ºåˆå¹¶è¯·æ±‚-pull-merge-request-è§¦å‘æ„å»º" class="headerlink" title="åˆ›å»ºåˆå¹¶è¯·æ±‚(pull/merge request)è§¦å‘æ„å»º"></a>åˆ›å»ºåˆå¹¶è¯·æ±‚(pull/merge request)è§¦å‘æ„å»º</h1><ol><li><p>Bitbucketçš„åˆå¹¶è¯·æ±‚(pull/merge request)<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/7.png"></p></li><li><p>è§¦å‘çš„æ„å»º<br><img src="/2020/02/23/jenkins-bibucket-pullrequest/8.png"></p></li></ol><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½å‘ç°ï¼Œå’ŒGithubåˆå¹¶è¯·æ±‚(Pull Request)çš„æ„å»ºç›¸æ¯”å°‘äº†å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ„å»ºæè¿°ä¸­æ²¡æœ‰æ˜¾ç¤ºåˆå¹¶è¯·æ±‚(Pull Request)å·ï¼Œä¸å¤ªå®¹æ˜“çŸ¥é“å½“å‰çš„æ„å»ºæ˜¯ç”±å“ªä¸ªåˆå¹¶è¯·æ±‚(Pull Request)è§¦å‘çš„ï¼Œè€Œåœ¨åˆå¹¶è¯·æ±‚(Pull Request)çš„é¡µé¢ä¸­ä¹Ÿçœ‹ä¸åˆ°å½“å‰æ„å»ºçš„çŠ¶æ€ã€‚è¿™äº›éƒ½æ˜¯ç”±Jenkinsæ’ä»¶æä¾›çš„åŠŸèƒ½å¤šå°‘å†³å®šçš„ï¼Œå¯¹äºBitbucketåˆå¹¶è¯·æ±‚(Pull Request)çš„æ„å»ºï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„è‡ªå®šä¹‰å·¥ä½œä»¥æä¾›è¶³å¤Ÿå¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä»å½“å‰æ„å»ºä¸­è·å–åˆå¹¶è¯·æ±‚(Pull Request)åˆ†æ”¯ï¼Œæå–å‡ºåˆå¹¶è¯·æ±‚(Pull Request)å·å¹¶ä¸”è®¾ç½®åˆ°æ„å»ºæè¿°ä¸­ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Git</tag>
      
      <tag>Jenkins</tag>
      
      <tag>Bitbucket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘½ä»¤æ–¹å¼è®¾ç½®Windows Serverç½‘ç»œä»£ç†</title>
    <link href="/2020/02/03/windows-core-proxy/"/>
    <url>/2020/02/03/windows-core-proxy/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å…¬å¸é‡Œçš„æœåŠ¡å™¨å¾€å¾€éœ€è¦é…ç½®ç½‘ç»œä»£ç†æ‰èƒ½è®¿é—®å¤–ç½‘ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿè®¾ç½®ä»£ç†çš„æ–¹å¼ä¹Ÿä¸åŒï¼ŒåŒä¸€ä¸ªæ“ä½œç³»ç»Ÿåœ¨å›¾å½¢åŒ–å’Œéå›¾å½¢åŒ–ä¸‹çš„è®¾ç½®æ–¹å¼ä¹Ÿä¸åŒã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ç”¨å‘½ä»¤çš„æ–¹å¼æ¥è®¾ç½®Windows Serverçš„ç½‘ç»œä»£ç†ï¼Œè¿™ç§æ–¹å¼éå¸¸é€‚åˆäºéå›¾å½¢åŒ–çš„Windows Server Coreçš„ç½‘ç»œä»£ç†çš„è®¾ç½®ï¼Œå¯¹å›¾å½¢åŒ–çš„Windows Serverä¹ŸåŒæ ·é€‚ç”¨ã€‚</p><span id="more"></span><h1 id="Windows-Serverç½‘ç»œä»£ç†è¯´æ˜"><a href="#Windows-Serverç½‘ç»œä»£ç†è¯´æ˜" class="headerlink" title="Windows Serverç½‘ç»œä»£ç†è¯´æ˜"></a>Windows Serverç½‘ç»œä»£ç†è¯´æ˜</h1><p>åœ¨å›¾å½¢åŒ–çš„Windows Serverä¸­è®¾ç½®ç½‘ç»œä»£ç†ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸åœ¨IEæµè§ˆå™¨çš„â€Internet Optionsâ€é‡Œé¢è®¾ç½®å³å¯ï¼š<br><img src="/2020/02/03/windows-core-proxy/1.png"></p><p>ä½†æ˜¯è¿™ä¸ªç½‘ç»œä»£ç†åªå¯¹ä¸€éƒ¨åˆ†åº”ç”¨èµ·ä½œç”¨ï¼Œæ¯”å¦‚IEæµè§ˆå™¨ç­‰ã€‚ä»æ—§æœ‰äº›åº”ç”¨ä¸æ˜¯ä½¿ç”¨è¿™ä¸ªç½‘ç»œä»£ç†ã€‚åœ¨Windows Serverç¯å¢ƒä¸­ï¼Œæœ‰ä»¥ä¸‹å››ç±»ç½‘ç»œä½¿ç”¨æ–¹å¼ï¼š</p><ul><li><p>ä½¿ç”¨WinINETåº“<br>WinINTEæ˜¯IEæµè§ˆå™¨çš„æ ¸å¿ƒï¼ŒåŒæ—¶ä¹Ÿèƒ½è¢«åˆ«çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚ä½¿ç”¨WinINETçš„åº”ç”¨åŒæ ·ä¼šä½¿ç”¨IEæµè§ˆå™¨çš„ç½‘ç»œä»£ç†è®¾ç½®ã€‚</p></li><li><p>ä½¿ç”¨WinHTTPåº“<br>WinHTTPä¸»è¦æ˜¯è¢«Windowsä¸­éäº¤äº’å¼çš„åº”ç”¨æ‰€ä½¿ç”¨ï¼Œæ¯”å¦‚éœ€è¦è®¿é—®ç½‘ç»œçš„WindowsæœåŠ¡æˆ–åå°ä»»åŠ¡ç­‰ã€‚WinHTTPç¼ºçœä¸ä½¿ç”¨WinINETçš„ç½‘ç»œä»£ç†è®¾ç½®ã€‚</p></li><li><p>Linuxé£æ ¼çš„ç½‘ç»œä»£ç†<br>è®¸å¤šLinuxç”¨æˆ·åœ¨ä½¿ç”¨Windowsæ—¶ä»ç„¶å¸Œæœ›ä½¿ç”¨Linuxç›¸å…³çš„å‘½ä»¤ï¼Œä»–ä»¬å¾€å¾€é€šè¿‡å®‰è£…<a href="https://www.cygwin.com/">Cygwin</a>ï¼Œæˆ–è€…<a href="http://getgnuwin32.sourceforge.net/">GunWin32</a>æ¥å¼•å…¥Linuxå‘½ä»¤ï¼Œè€Œæ¶‰åŠåˆ°ç½‘ç»œæ“ä½œçš„å‘½ä»¤åˆ™æ˜¯é€šè¿‡Linuxé£æ ¼çš„ç½‘ç»œä»£ç†æ¥è®¿é—®ç½‘ç»œã€‚Linuxç³»ç»Ÿä¸€èˆ¬æ˜¯ä»¥éå›¾å½¢åŒ–çš„æ–¹å¼ä½œä¸ºæœåŠ¡å™¨ï¼Œæ‰€ä»¥å…¶ç½‘ç»œä»£ç†è®¾ç½®é€šå¸¸åªéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼šhttps_proxy, http_proxyå’Œno_proxyï¼Œè€Œæ¡Œé¢ç‰ˆçš„Linuxæ˜¯å¸¦æœ‰å›¾å½¢åŒ–çš„ï¼Œå…¶ç½‘ç»œè®¾ç½®é™¤äº†ä¸‰ä¸ªç¯å¢ƒå˜é‡å¤–ï¼Œè¿˜éœ€è¦å…¶å®ƒåœ°æ–¹çš„è®¾ç½®ï¼Œå¦åˆ™é‚£äº›å›¾å½¢åŒ–çš„åº”ç”¨å°†æ— æ³•è®¿é—®ç½‘ç»œã€‚æœ¬æ–‡å°†åªä»‹ç»éå›¾å½¢åŒ–çš„Linuxç½‘ç»œä»£ç†è®¾ç½®ã€‚</p></li><li><p>åº”ç”¨çº§åˆ«çš„ç½‘ç»œä»£ç†è®¾ç½®<br>æœ‰äº›åº”ç”¨æœ¬èº«æ”¯æŒè®¾ç½®è‡ªå·±çš„ç½‘ç»œä»£ç†ï¼Œè€Œä¸ä¾èµ–äºç³»ç»Ÿè®¾ç½®çš„ä»£ç†ã€‚è¿™äº›åº”ç”¨æœ¬èº«ä¼šå®ç°å¾ˆå¤šåº•å±‚çš„æ“ä½œï¼Œæ¯”å¦‚ç›´æ¥ä½¿ç”¨Winsockå»ºç«‹ç½‘ç»œè¿æ¥ã€‚</p></li></ul><p>æ¥ä¸‹æ¥å°†è¯¦ç»†ä»‹ç»WinINETï¼ŒWinHTTPå’ŒLinuxé£æ ¼çš„ç½‘ç»œä»£ç†è®¾ç½®ã€‚</p><h1 id="è®¾ç½®WinINETç±»å‹çš„ç½‘ç»œä»£ç†"><a href="#è®¾ç½®WinINETç±»å‹çš„ç½‘ç»œä»£ç†" class="headerlink" title="è®¾ç½®WinINETç±»å‹çš„ç½‘ç»œä»£ç†"></a>è®¾ç½®WinINETç±»å‹çš„ç½‘ç»œä»£ç†</h1><h2 id="è®¾ç½®è‡ªåŠ¨ä»£ç†è„šæœ¬"><a href="#è®¾ç½®è‡ªåŠ¨ä»£ç†è„šæœ¬" class="headerlink" title="è®¾ç½®è‡ªåŠ¨ä»£ç†è„šæœ¬"></a>è®¾ç½®è‡ªåŠ¨ä»£ç†è„šæœ¬</h2><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ps"><span class="hljs-variable">$proxyScript</span> = <span class="hljs-string">&quot;http://&lt;your url&gt;/proxy.pac&quot;</span><br><span class="hljs-variable">$regs</span> = <span class="hljs-string">&quot;HKLM:\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span>,<span class="hljs-string">&quot;HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$reg</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$regs</span>)&#123;<br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> AutoConfigURL <span class="hljs-literal">-Value</span> <span class="hljs-variable">$proxyScript</span><br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyEnable <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®æ‰‹åŠ¨ä»£ç†"><a href="#è®¾ç½®æ‰‹åŠ¨ä»£ç†" class="headerlink" title="è®¾ç½®æ‰‹åŠ¨ä»£ç†"></a>è®¾ç½®æ‰‹åŠ¨ä»£ç†</h2><p>å‚è€ƒ:<br><a href="https://config9.com/windows/powershell/using-powershell-to-programmatically-configure-internet-explorer-proxy-settings-to-work-before-it-has-been-opened/">https://config9.com/windows/powershell/using-powershell-to-programmatically-configure-internet-explorer-proxy-settings-to-work-before-it-has-been-opened/</a></p><h3 id="ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®"><a href="#ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®" class="headerlink" title="ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®"></a>ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®</h3><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs ps"><span class="hljs-variable">$proxy</span>=<span class="hljs-string">&quot;http=&lt;server&gt;:&lt;port&gt;;https=&lt;server&gt;:&lt;port&gt;;ftp=&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-variable">$bypassList</span>=<span class="hljs-string">&quot;&lt;local&gt;;*.xxxx.com;xxxx.com;192.168.56.*;10.0.0.*&quot;</span><br><br><span class="hljs-variable">$proxyString</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$proxy</span>)).length); <span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$i</span> % <span class="hljs-number">2</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$byte</span> = (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$proxy</span>))[<span class="hljs-variable">$i</span>])<br>        <span class="hljs-variable">$convertedByte</span>=%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$byte</span>,<span class="hljs-number">16</span>)&#125;<br>        <span class="hljs-variable">$proxyString</span> = <span class="hljs-variable">$proxystring</span> + <span class="hljs-variable">$convertedByte</span>  + <span class="hljs-string">&quot;,&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-variable">$bypassString</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$bypassList</span>)).length); <span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$i</span> % <span class="hljs-number">2</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$byte</span> = (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$bypassList</span>))[<span class="hljs-variable">$i</span>])<br>        <span class="hljs-variable">$convertedByte</span>=%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$byte</span>,<span class="hljs-number">16</span>)&#125;<br>        <span class="hljs-variable">$bypassString</span> = <span class="hljs-variable">$bypassString</span> + <span class="hljs-variable">$convertedByte</span>  + <span class="hljs-string">&quot;,&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-variable">$regString</span>=<span class="hljs-string">&quot;46,00,00,00,00,00,00,00,0b,00,00,00,&quot;</span>+(%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$proxy</span>.length,<span class="hljs-number">16</span>)&#125;)+<span class="hljs-string">&quot;,00,00,00,&quot;</span> + <span class="hljs-variable">$proxystring</span> + (%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$bypassList</span>.length,<span class="hljs-number">16</span>)&#125;) + <span class="hljs-string">&quot;,00,00,00,&quot;</span> + <span class="hljs-variable">$bypassString</span> +  <span class="hljs-string">&quot;00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00&quot;</span><br><span class="hljs-variable">$regstringAsArray</span> = (<span class="hljs-string">&quot;0x&quot;</span>+<span class="hljs-variable">$regString</span>.replace(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;,0x&quot;</span>)).Split(<span class="hljs-string">&quot;,&quot;</span>)<br><br><span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxySettingsPerUser <span class="hljs-literal">-Value</span> <span class="hljs-number">0</span><br><br><span class="hljs-variable">$regs</span> = <span class="hljs-string">&quot;HKLM:\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span>,<span class="hljs-string">&quot;HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$reg</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$regs</span>)&#123;<br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyServer <span class="hljs-literal">-Value</span> <span class="hljs-variable">$proxy</span><br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyEnable <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span><br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyOverride <span class="hljs-literal">-Value</span> <span class="hljs-variable">$bypassList</span><br>&#125;<br><br><span class="hljs-variable">$regs</span> = <span class="hljs-string">&quot;HKLM:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections&quot;</span>,<span class="hljs-string">&quot;HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Internet Settings\Connections&quot;</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$reg</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$regs</span>)&#123;<br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> DefaultConnectionSettings <span class="hljs-literal">-Type</span> Binary <span class="hljs-literal">-Value</span> <span class="hljs-variable">$regstringAsArray</span><br>    <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> SavedLegacySettings <span class="hljs-literal">-Type</span> Binary <span class="hljs-literal">-Value</span> <span class="hljs-variable">$regstringAsArray</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç”¨æˆ·çº§åˆ«çš„è®¾ç½®"><a href="#ç”¨æˆ·çº§åˆ«çš„è®¾ç½®" class="headerlink" title="ç”¨æˆ·çº§åˆ«çš„è®¾ç½®"></a>ç”¨æˆ·çº§åˆ«çš„è®¾ç½®</h3><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs ps"><span class="hljs-variable">$proxy</span>=<span class="hljs-string">&quot;http=&lt;server&gt;:&lt;port&gt;;https=&lt;server&gt;:&lt;port&gt;;ftp=&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-variable">$bypassList</span>=<span class="hljs-string">&quot;&lt;local&gt;;*.xxxx.com;xxxx.com;192.168.56.*;10.0.0.*&quot;</span><br><br><span class="hljs-variable">$proxyString</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$proxy</span>)).length); <span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$i</span> % <span class="hljs-number">2</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$byte</span> = (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$proxy</span>))[<span class="hljs-variable">$i</span>])<br>        <span class="hljs-variable">$convertedByte</span>=%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$byte</span>,<span class="hljs-number">16</span>)&#125;<br>        <span class="hljs-variable">$proxyString</span> = <span class="hljs-variable">$proxystring</span> + <span class="hljs-variable">$convertedByte</span>  + <span class="hljs-string">&quot;,&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-variable">$bypassString</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$bypassList</span>)).length); <span class="hljs-variable">$i</span>++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$i</span> % <span class="hljs-number">2</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$byte</span> = (([<span class="hljs-type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="hljs-variable">$bypassList</span>))[<span class="hljs-variable">$i</span>])<br>        <span class="hljs-variable">$convertedByte</span>=%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$byte</span>,<span class="hljs-number">16</span>)&#125;<br>        <span class="hljs-variable">$bypassString</span> = <span class="hljs-variable">$bypassString</span> + <span class="hljs-variable">$convertedByte</span>  + <span class="hljs-string">&quot;,&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-variable">$regString</span>=<span class="hljs-string">&quot;46,00,00,00,00,00,00,00,0b,00,00,00,&quot;</span>+(%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$proxy</span>.length,<span class="hljs-number">16</span>)&#125;)+<span class="hljs-string">&quot;,00,00,00,&quot;</span> + <span class="hljs-variable">$proxystring</span> + (%&#123;[<span class="hljs-type">System.Convert</span>]::ToString(<span class="hljs-variable">$bypassList</span>.length,<span class="hljs-number">16</span>)&#125;) + <span class="hljs-string">&quot;,00,00,00,&quot;</span> + <span class="hljs-variable">$bypassString</span> +  <span class="hljs-string">&quot;00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00&quot;</span><br><span class="hljs-variable">$regstringAsArray</span> = (<span class="hljs-string">&quot;0x&quot;</span>+<span class="hljs-variable">$regString</span>.replace(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;,0x&quot;</span>)).Split(<span class="hljs-string">&quot;,&quot;</span>)<br><br><span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxySettingsPerUser <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span><br><br><span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;HKLM:\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyServer <span class="hljs-literal">-Value</span> <span class="hljs-variable">$proxy</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyEnable <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> ProxyOverride <span class="hljs-literal">-Value</span> <span class="hljs-variable">$bypassList</span><br><br><span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;HKLM:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections&quot;</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> DefaultConnectionSettings <span class="hljs-literal">-Type</span> Binary <span class="hljs-literal">-Value</span> <span class="hljs-variable">$regstringAsArray</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> SavedLegacySettings <span class="hljs-literal">-Type</span> Binary <span class="hljs-literal">-Value</span> <span class="hljs-variable">$regstringAsArray</span><br></code></pre></td></tr></table></figure><blockquote><p>Windowsä»£ç†çš„å¿½ç•¥åˆ—è¡¨æ”¯æŒé€šé…ç¬¦*</p></blockquote><h1 id="è®¾ç½®WinHTTPç±»å‹çš„ç½‘ç»œä»£ç†"><a href="#è®¾ç½®WinHTTPç±»å‹çš„ç½‘ç»œä»£ç†" class="headerlink" title="è®¾ç½®WinHTTPç±»å‹çš„ç½‘ç»œä»£ç†"></a>è®¾ç½®WinHTTPç±»å‹çš„ç½‘ç»œä»£ç†</h1><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ps">netsh winhttp <span class="hljs-built_in">set</span> proxy proxy<span class="hljs-literal">-server</span>=<span class="hljs-string">&quot;http=&lt;server&gt;:&lt;port&gt;;https=&lt;server&gt;:&lt;port&gt;;ftp=&lt;server&gt;:&lt;port&gt;&quot;</span> bypass<span class="hljs-literal">-list</span>=<span class="hljs-string">&quot;&lt;local&gt;;*.xxxx.com;xxxx.com;192.168.56.*;10.0.0.*&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœWinINETè®¾ç½®çš„æ˜¯æ‰‹åŠ¨ç½‘ç»œä»£ç†ï¼Œä¹Ÿå¯ä»¥å¯¼å…¥WinINETçš„ç½‘ç»œä»£ç†ï¼š</p><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ps">netsh winhttp import proxy ie<br></code></pre></td></tr></table></figure><h1 id="è®¾ç½®Linuxé£æ ¼çš„ç½‘ç»œä»£ç†"><a href="#è®¾ç½®Linuxé£æ ¼çš„ç½‘ç»œä»£ç†" class="headerlink" title="è®¾ç½®Linuxé£æ ¼çš„ç½‘ç»œä»£ç†"></a>è®¾ç½®Linuxé£æ ¼çš„ç½‘ç»œä»£ç†</h1><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ps"><span class="hljs-variable">$httpProxy</span> = <span class="hljs-string">&quot;http://&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-variable">$httpsProxy</span> = <span class="hljs-string">&quot;http://&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-variable">$noProxy</span> = <span class="hljs-string">&quot;localhost,127.0.0.1,.xxxx.com,xxxx.com,192.168.0.5&quot;</span><br><br><span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;HKLM:\SYSTEM\ControlSet001\Control\Session Manager\Environment&quot;</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> https_proxy <span class="hljs-literal">-Value</span> <span class="hljs-variable">$httpProxy</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> http_proxy <span class="hljs-literal">-Value</span> <span class="hljs-variable">$httpsProxy</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> no_proxy <span class="hljs-literal">-Value</span> <span class="hljs-variable">$noProxy</span><br><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> HTTPS_PROXY <span class="hljs-literal">-Value</span> <span class="hljs-variable">$httpProxy</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> HTTP_PROXY <span class="hljs-literal">-Value</span> <span class="hljs-variable">$httpsProxy</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$reg</span> <span class="hljs-literal">-Name</span> NO_PROXY <span class="hljs-literal">-Value</span> <span class="hljs-variable">$noProxy</span><br></code></pre></td></tr></table></figure><blockquote><p>Linuxä»£ç†çš„å¿½ç•¥åˆ—è¡¨ä¸æ”¯æŒé€šé…ç¬¦ï¼Œæ¯”å¦‚*ï¼Œä½†å¯ä»¥åªå¢åŠ åŸŸååç¼€æ¥åŒ¹é…ä¸€ç³»åˆ—åŸŸå<br>å¤§å°å†™çš„ç¯å¢ƒå˜é‡éƒ½è®¾ç½®äº†ä¸€éï¼Œå› ä¸ºåœ¨å®é™…å·¥ä½œä¸­å‘ç°å­˜åœ¨ç€ä¸€äº›åº”ç”¨æˆ–å‘½ä»¤åªè¯†åˆ«å¤§å†™æˆ–å°å†™</p></blockquote><h1 id="Ansibleè„šæœ¬è®¾ç½®ç½‘ç»œä»£ç†"><a href="#Ansibleè„šæœ¬è®¾ç½®ç½‘ç»œä»£ç†" class="headerlink" title="Ansibleè„šæœ¬è®¾ç½®ç½‘ç»œä»£ç†"></a>Ansibleè„šæœ¬è®¾ç½®ç½‘ç»œä»£ç†</h1><p>ä»¥ä¸Šè®¾ç½®ç½‘ç»œä»£ç†çš„æ–¹å¼å…¶å®å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ad-hocè„šæœ¬çš„æ–¹å¼ï¼Œä½†æ˜¯ad-hocè„šæœ¬åœ¨ä¸åŒçš„Windowsç³»ç»Ÿä¸­ç§»æ¤æ€§æ¯”è¾ƒå·®ï¼Œå¾€å¾€éœ€è¦ä¸€äº›æ”¹åŠ¨æ‰èƒ½è¿è¡Œã€‚ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·æ¯”å¦‚Ansibleæ¥è®¾ç½®ç½‘ç»œä»£ç†å¾€å¾€ä¼šå¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å¯ç§»æ¤æ€§</li><li>æ›´å°‘çš„ä»£ç </li></ul><p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œç°æˆçš„å·¥å…·ä¼˜å…ˆäºä¸“é—¨è„šæœ¬(tool over ad-hoc)â€è¿™ä¸€æœ€ä½³å®è·µã€‚</p><p>ä»¥ä¸‹æ˜¯Ansibleè„šæœ¬æ ·æœ¬ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">IE</span> <span class="hljs-string">proxy</span> <span class="hljs-string">settings</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">all</span> <span class="hljs-string">users</span><br>  <span class="hljs-attr">win_regedit:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet</span> <span class="hljs-string">Settings</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ProxySettingsPerUser</span><br>    <span class="hljs-attr">data:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">dword</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">IE</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">proxy</span> <span class="hljs-string">per</span> <span class="hljs-string">protocol</span> <span class="hljs-string">using</span> <span class="hljs-string">a</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">win_inet_proxy:</span><br>    <span class="hljs-attr">proxy:</span> <span class="hljs-string">http=&#123;&#123;win_init_http_proxy&#125;&#125;;https=&#123;&#123;win_init_https_proxy&#125;&#125;;ftp=&#123;&#123;win_init_ftp_proxy&#125;&#125;</span><br>    <span class="hljs-attr">bypass:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;win_init_no_proxy&#125;&#125;</span>&quot;</span><br><br><span class="hljs-comment"># This should be done after setting the IE proxy with win_inet_proxy</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Import</span> <span class="hljs-string">IE</span> <span class="hljs-string">proxy</span> <span class="hljs-string">configuration</span> <span class="hljs-string">to</span> <span class="hljs-string">WinHTTP</span><br>  <span class="hljs-attr">win_http_proxy:</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">ie</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-string">http</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">http_proxy</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_http_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-string">https</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">https_proxy</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_https_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-literal">no</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">no_proxy</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_no_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">HTTP_PROXY</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_http_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-string">HTTPS</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">HTTPS_PROXY</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_https_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">Linux</span> <span class="hljs-string">style</span> <span class="hljs-literal">NO</span> <span class="hljs-string">proxy</span><br>  <span class="hljs-attr">win_environment:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">NO_PROXY</span><br>    <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;<span class="hljs-template-variable">&#123;&#123;linux_style_init_no_proxy&#125;&#125;</span>&#x27;</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-string">machine</span><br>    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span><br></code></pre></td></tr></table></figure><p>å˜é‡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">win_init_http_proxy:</span> <span class="hljs-string">&quot;&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-attr">win_init_https_proxy:</span> <span class="hljs-string">&quot;&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-attr">win_init_ftp_proxy:</span> <span class="hljs-string">&quot;&lt;server&gt;:&lt;port&gt;&quot;</span><br><span class="hljs-attr">win_init_no_proxy:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;local&gt;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;*.xxxx.com&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;192.168.56.*&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;10.0.0.*&quot;</span><br><br><span class="hljs-attr">linux_style_init_http_proxy:</span> <span class="hljs-string">http://&lt;server&gt;:&lt;port&gt;</span><br><span class="hljs-attr">linux_style_init_https_proxy:</span> <span class="hljs-string">http://&lt;server&gt;:&lt;port&gt;</span><br><span class="hljs-attr">linux_style_init_ftp_proxy:</span> <span class="hljs-string">http://&lt;server&gt;:&lt;port&gt;</span><br><span class="hljs-attr">linux_style_init_no_proxy:</span> <span class="hljs-string">&quot;localhost,127.0.0.1,.xxxx.com,xxxx.com,192.168.0.5&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…Pythonå¹¶æ­å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ</title>
    <link href="/2020/01/31/install-python/"/>
    <url>/2020/01/31/install-python/</url>
    
    <content type="html"><![CDATA[<p>è™½ç„¶Pythonçš„å®‰è£…ä¹‹äºå¼€å‘æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œä½†å¼„æ¸…æ¥šPythonåŠå…¶ç›¸å…³å·¥å…·åœ¨å„ä¸ªå¹³å°ä¸Šçš„å®‰è£…å¯¹äºä¹‹åçš„å¼€å‘ï¼Œæ‰“åŒ…éƒ½æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œæ­£æ‰€è°“å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨Macï¼ŒWindowsï¼ŒUbuntuå’ŒCentOSä¸­åŒæ—¶å®‰è£…å’Œè®¾ç½®Python2å’ŒPython3ï¼Œä»¥åŠåˆ©ç”¨virtualenvå‘½ä»¤åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒã€‚ä¸ºä»€ä¹ˆè¦Python2å’ŒPython3å…±å­˜ï¼Ÿå°½ç®¡å®˜æ–¹å·²ç»ä¸æ”¯æŒPython2äº†ï¼Œä½†è¿˜æ˜¯æœ‰å¾ˆå¤šPython2çš„ç¨‹åºå­˜åœ¨ï¼Œæœ‰å¾ˆå¤šPython2çš„åº“æ²¡æœ‰è¿ç§»åˆ°Python3ï¼Œæ‰€ä»¥åœ¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é‡Œæ˜¯éœ€è¦Python2å’ŒPython3çš„å¼€å‘å’Œè¿è¡Œç¯å¢ƒå…±å­˜ã€‚</p><span id="more"></span><h1 id="åœ¨Macä¸­å®‰è£…Python2å’ŒPython3"><a href="#åœ¨Macä¸­å®‰è£…Python2å’ŒPython3" class="headerlink" title="åœ¨Macä¸­å®‰è£…Python2å’ŒPython3"></a>åœ¨Macä¸­å®‰è£…Python2å’ŒPython3</h1><p>ä»Pythonçš„å®˜ç½‘ä¸­ä¸‹è½½Pythonçš„Macå®‰è£…åŒ…ï¼ŒæŒ‰ç…§å‘å¯¼ç¼ºçœå®‰è£…å³å¯ã€‚<br><img src="/2020/01/31/install-python/7.png"></p><p><img src="/2020/01/31/install-python/8.png"></p><h2 id="è®¾ç½®Python3ä¸ºç¼ºçœçš„Python"><a href="#è®¾ç½®Python3ä¸ºç¼ºçœçš„Python" class="headerlink" title="è®¾ç½®Python3ä¸ºç¼ºçœçš„Python"></a>è®¾ç½®Python3ä¸ºç¼ºçœçš„Python</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo rm /Library/Frameworks/Python.framework/Versions/Current<br>sudo ln -s /Library/Frameworks/Python.framework/Versions/3.8 /Library/Frameworks/Python.framework/Versions/Current<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin/<br>sudo python<br>sudo ln -s ../../../Library/Frameworks/Python.framework/Versions/3.8/bin/python3 python<br>sudo rm pip<br>sudo ln -s ../../../Library/Frameworks/Python.framework/Versions/3.8/bin/pip3 pip<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨Macä¸­ç¼ºçœçš„æ˜¯Python3ï¼Œå‘½ä»¤è¡Œç›´æ¥è°ƒç”¨pythonæˆ–pipå³å¯ã€‚å¦‚æœéœ€è¦ä½¿ç”¨Python2ï¼Œå‘½ä»¤è¡Œè°ƒç”¨python2æˆ–pip2ã€‚</p><p>åœ¨æ–‡ä»¶â€œ~/.bash_profileâ€ä¸­æ³¨é‡Šæ‰æˆ–è€…åˆ é™¤Pythonå®‰è£…ç¨‹åºæ·»åŠ çš„PATHç¯å¢ƒå˜é‡ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç³»ç»Ÿè·¯å¾„/usr/local/binä¸‹å»ºç«‹äº†Pythonç›¸å…³å‘½ä»¤çš„è½¯é“¾æ¥ï¼Œè€Œä¸”è®¸å¤šå·¥å…·ç¼ºçœä¹Ÿæ˜¯ä»è¿™ä¸ªè·¯å¾„ä¸‹æœç´¢Pythonçš„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># Setting PATH for Python 3.8</span><br><span class="hljs-comment"># The original version is saved in .bash_profile.pysave</span><br><span class="hljs-comment">#PATH=&quot;/Library/Frameworks/Python.framework/Versions/3.8/bin:$&#123;PATH&#125;&quot;</span><br><span class="hljs-comment">#export PATH</span><br><br><span class="hljs-comment"># Setting PATH for Python 2.7</span><br><span class="hljs-comment"># The original version is saved in .bash_profile.pysave</span><br><span class="hljs-comment">#PATH=&quot;/Library/Frameworks/Python.framework/Versions/2.7/bin:$&#123;PATH&#125;&quot;</span><br><span class="hljs-comment">#export PATH</span><br></code></pre></td></tr></table></figure><h2 id="å‡çº§pipå·¥å…·"><a href="#å‡çº§pipå·¥å…·" class="headerlink" title="å‡çº§pipå·¥å…·"></a>å‡çº§pipå·¥å…·</h2><p>Pythonå®‰è£…åŒ…é‡ŒåŒ…å«çš„pipå·¥å…·å¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦å‡çº§ä¸€ä¸‹ã€‚</p><h3 id="ç¼ºçœpython3"><a href="#ç¼ºçœpython3" class="headerlink" title="ç¼ºçœpython3"></a>ç¼ºçœpython3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl https://bootstrap.pypa.io/get-pip.py | sudo -E -H /usr/loca/bin/python<br></code></pre></td></tr></table></figure><h3 id="python2"><a href="#python2" class="headerlink" title="python2"></a>python2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl https://bootstrap.pypa.io/get-pip.py | sudo -E -H /usr/<span class="hljs-built_in">local</span>/bin/  python2<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…virtualenvå·¥å…·"><a href="#å®‰è£…virtualenvå·¥å…·" class="headerlink" title="å®‰è£…virtualenvå·¥å…·"></a>å®‰è£…virtualenvå·¥å…·</h2><h3 id="ç¼ºçœPython3"><a href="#ç¼ºçœPython3" class="headerlink" title="ç¼ºçœPython3"></a>ç¼ºçœPython3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip install virtualenv<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin/<br>sudo ln -s ../../../Library/Frameworks/Python.framework/Versions/3.8/bin/virtualenv virtualenv<br></code></pre></td></tr></table></figure><h3 id="Python2"><a href="#Python2" class="headerlink" title="Python2"></a>Python2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">pip2 install virtualenv<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin/<br>sudo ln -s ../../../Library/Frameworks/Python.framework/Versions/2.7/bin/virtualenv virtualenv2<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ"><a href="#åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ" class="headerlink" title="åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ"></a>åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ</h2><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3"></a>Python3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">virtualenv --always-copy pyenv3<br></code></pre></td></tr></table></figure><h3 id="Python2-1"><a href="#Python2-1" class="headerlink" title="Python2"></a>Python2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">virtualenv --always-copy -p python2 pyenv2<br></code></pre></td></tr></table></figure><h1 id="åœ¨CentOSä¸­å®‰è£…Python2å’ŒPython3"><a href="#åœ¨CentOSä¸­å®‰è£…Python2å’ŒPython3" class="headerlink" title="åœ¨CentOSä¸­å®‰è£…Python2å’ŒPython3"></a>åœ¨CentOSä¸­å®‰è£…Python2å’ŒPython3</h1><p>Pythonçš„å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æä¾›Linuxçš„äºŒè¿›åˆ¶å®‰è£…åŒ…æˆ–è€…æä¾›yumçš„å®‰è£…æ–¹æ³•ï¼Œå› ä¸ºå¤§éƒ¨åˆ†Linuxéƒ½åŒ…å«äº†Pythonã€‚ä½†æ˜¯Linuxç¼ºçœè‡ªå¸¦çš„Pythonéƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ¯”å¦‚CentOS 7ç¼ºçœè‡ªå¸¦Python2.7.5ï¼Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡æºä»£ç æ„å»ºå¹¶å®‰è£…æœ€æ–°ç‰ˆçš„Pythonã€‚</p><h2 id="å®‰è£…æ„å»ºPython2å’ŒPython3çš„ä¾èµ–"><a href="#å®‰è£…æ„å»ºPython2å’ŒPython3çš„ä¾èµ–" class="headerlink" title="å®‰è£…æ„å»ºPython2å’ŒPython3çš„ä¾èµ–"></a>å®‰è£…æ„å»ºPython2å’ŒPython3çš„ä¾èµ–</h2><p><a href="https://devguide.python.org/setup/#linux">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a>ï¼Œæ‰§è¡Œä»¥ä¸‹shellå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo yum install yum-utils<br>sudo yum-builddep python3<br></code></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥æ˜¾å¼å®‰è£…æ‰€æœ‰çš„ä¾èµ–ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é¦–å…ˆç¡®ä¿ä½ çš„ç³»ç»Ÿæ˜¯æœ€æ–°çš„:</span><br>yum update<br><span class="hljs-comment"># å®‰è£…ç¼–è¯‘å™¨å’Œç›¸å…³çš„å·¥å…·:</span><br>yum groupinstall -y <span class="hljs-string">&quot;development tools&quot;</span><br><span class="hljs-comment"># å®‰è£…ç¼–è¯‘å…¨åŠŸèƒ½Pythonæ‰€éœ€çš„ä¾èµ–åº“:</span><br>yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libffi-devel libpcap-devel xz-devel expat-devel<br><span class="hljs-comment"># å¦‚æœä½ çš„CentOSæ˜¯â€æœ€å°åŒ–â€œå®‰è£…ï¼Œä½ éœ€è¦å®‰è£…wgetå·¥å…·ï¼š</span><br>yum install -y wget<br></code></pre></td></tr></table></figure></blockquote><h2 id="æºç å®‰è£…Python2å’ŒPython3"><a href="#æºç å®‰è£…Python2å’ŒPython3" class="headerlink" title="æºç å®‰è£…Python2å’ŒPython3"></a>æºç å®‰è£…Python2å’ŒPython3</h2><ol><li><p>ä¸‹è½½æœ€æ–°Python2çš„æºä»£ç å¹¶è§£å‹<br><a href="https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz">https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz</a></p></li><li><p>ä¸‹è½½æœ€æ–°Python3çš„æºä»£ç å¹¶è§£å‹<br><a href="https://www.python.org/ftp/python/3.8.3/Python-3.8.3.tgz">https://www.python.org/ftp/python/3.8.3/Python-3.8.3.tgz</a></p></li><li><p>åˆ†åˆ«åœ¨Python2å’ŒPython3çš„æºç æ ¹ç›®å½•ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤é…ç½®ï¼Œæ„å»ºå¹¶å®‰è£…Python2å’ŒPython3</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">./configure --prefix=/usr/<span class="hljs-built_in">local</span> --enable-shared LDFLAGS=<span class="hljs-string">&quot;-Wl,-rpath /usr/local/lib&quot;</span><br>make &amp;&amp; make altinstall<br></code></pre></td></tr></table></figure><blockquote><p>ä¸ºäº†åŒºåˆ«CentOSä¸­ç¼ºçœçš„è‡ªå¸¦Pythonï¼Œç”¨altinstallå°†Pythonå®‰è£…åˆ°ä¸åŒçš„è·¯å¾„ä¸‹ã€‚<br>ä¸‹é¢æ˜¯Python2çš„å®‰è£…ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">/usr/<span class="hljs-built_in">local</span>/bin/<br>/usr/<span class="hljs-built_in">local</span>/lib/<br>/usr/<span class="hljs-built_in">local</span>/lib/python3.8/<br>/usr/<span class="hljs-built_in">local</span>/lib/python2.7/<br></code></pre></td></tr></table></figure></blockquote></li><li><p>è®¾ç½®Python3ä¸ºç¼ºçœçš„Python</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin<br>sudo ln -s python3.8 python3<br>sudo ln -s python3 python<br>sudo ln -s python2.7 python2<br></code></pre></td></tr></table></figure></li></ol><h2 id="å®‰è£…æˆ–å‡çº§pipå·¥å…·"><a href="#å®‰è£…æˆ–å‡çº§pipå·¥å…·" class="headerlink" title="å®‰è£…æˆ–å‡çº§pipå·¥å…·"></a>å®‰è£…æˆ–å‡çº§pipå·¥å…·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl https://bootstrap.pypa.io/get-pip.py | sudo -E -H /usr/<span class="hljs-built_in">local</span>/bin/python<br>curl https://bootstrap.pypa.io/get-pip.py | sudo -E -H /usr/<span class="hljs-built_in">local</span>/bin/python2<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/bin<br>sudo rm pip<br>sudo ln -s pip3 pip<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…virtualenvå·¥å…·-1"><a href="#å®‰è£…virtualenvå·¥å…·-1" class="headerlink" title="å®‰è£…virtualenvå·¥å…·"></a>å®‰è£…virtualenvå·¥å…·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo -E -H /usr/<span class="hljs-built_in">local</span>/bin/pip2 install virtualenv<br>sudo mv virtualenv virtualenv2<br>sudo -E -H /usr/<span class="hljs-built_in">local</span>/bin/pip install virtualenv<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ-1"><a href="#åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ-1" class="headerlink" title="åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ"></a>åˆ›å»ºPythonçš„è™šæ‹Ÿå¼€å‘ç¯å¢ƒ</h2><h3 id="Python3-1"><a href="#Python3-1" class="headerlink" title="Python3"></a>Python3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">virtualenv --always-copy pyenv3<br></code></pre></td></tr></table></figure><h3 id="Python2-2"><a href="#Python2-2" class="headerlink" title="Python2"></a>Python2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">virtualenv --always-copy -p python2 pyenv2<br></code></pre></td></tr></table></figure><h1 id="åœ¨Ubuntuä¸­å®‰è£…Python2å’ŒPython3"><a href="#åœ¨Ubuntuä¸­å®‰è£…Python2å’ŒPython3" class="headerlink" title="åœ¨Ubuntuä¸­å®‰è£…Python2å’ŒPython3"></a>åœ¨Ubuntuä¸­å®‰è£…Python2å’ŒPython3</h1><p>ä¸CentOSç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æºä»£ç æ„å»ºå¹¶å®‰è£…æœ€æ–°ç‰ˆçš„Pythonã€‚</p><h2 id="å®‰è£…æ„å»ºPython3å’ŒPython2çš„ä¾èµ–"><a href="#å®‰è£…æ„å»ºPython3å’ŒPython2çš„ä¾èµ–" class="headerlink" title="å®‰è£…æ„å»ºPython3å’ŒPython2çš„ä¾èµ–"></a>å®‰è£…æ„å»ºPython3å’ŒPython2çš„ä¾èµ–</h2><p><a href="https://devguide.python.org/setup/#linux">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a>ï¼Œç¼–è¾‘/etc/apt/sources.listï¼Œä¸ºUbuntu 18æ·»åŠ â€œdeb-src <a href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a> bionic mainâ€ï¼Œæˆ–ä¸ºUbuntu 16æ·»åŠ â€œdeb-src <a href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a> xenial mainâ€ã€‚æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…ç¼–è¯‘Python2æˆ–Python3çš„ä¾èµ–ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get update<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get build-dep python3.6<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¾èµ–åŒ…çš„ç‰ˆæœ¬æ‰¾ä¸åˆ°ï¼Œè¯•ç€é™ä½å°ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚python3.5ã€‚</p></blockquote><h2 id="æºç å®‰è£…Python2å’ŒPython3-1"><a href="#æºç å®‰è£…Python2å’ŒPython3-1" class="headerlink" title="æºç å®‰è£…Python2å’ŒPython3"></a>æºç å®‰è£…Python2å’ŒPython3</h2><p>ä¸CentOSçš„è¿‡ç¨‹ä¸€æ ·ï¼Œå¯ä»¥å‚ç…§CentOSç« èŠ‚ã€‚</p><h2 id="PPA-Personal-Package-Archive-å®‰è£…Python"><a href="#PPA-Personal-Package-Archive-å®‰è£…Python" class="headerlink" title="PPA(Personal Package Archive)å®‰è£…Python"></a>PPA(Personal Package Archive)å®‰è£…Python</h2><p><a href="https://launchpad.net/~deadsnakes/+archive/ubuntu/ppa">PPA</a>åº“åŒ…å«äº†ä¸ºUbuntuæ‰“åŒ…çš„æœ€æ–°çš„Pythonç‰ˆæœ¬ï¼Œä½†ä¸ä¸€å®šåŒ…å«æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸æ˜¯å¤ªæ¨èè¿™ä¸ªæ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡PPAå®‰è£…Python3.8çš„æ­¥éª¤ï¼š</p><h3 id="ä¸ºaptæ·»åŠ PPAåº“"><a href="#ä¸ºaptæ·»åŠ PPAåº“" class="headerlink" title="ä¸ºaptæ·»åŠ PPAåº“"></a>ä¸ºaptæ·»åŠ PPAåº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get update<br>sudo apt install -y software-properties-common<br>sudo -E -H add-apt-repository -y ppa:deadsnakes/ppa<br>sudo apt-get update<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…Python3-8"><a href="#å®‰è£…Python3-8" class="headerlink" title="å®‰è£…Python3.8"></a>å®‰è£…Python3.8</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get -y -f --allow-unauthenticated install python3.8-dev<br></code></pre></td></tr></table></figure><h1 id="åœ¨Windowsä¸­å®‰è£…Python2å’ŒPython3"><a href="#åœ¨Windowsä¸­å®‰è£…Python2å’ŒPython3" class="headerlink" title="åœ¨Windowsä¸­å®‰è£…Python2å’ŒPython3"></a>åœ¨Windowsä¸­å®‰è£…Python2å’ŒPython3</h1><p>åœ¨Windowsä¸­åŒæ—¶å®‰è£…Python2å’ŒPython3ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“ï¼Œä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…ï¼ŒæŒ‰å‘å¯¼å®‰è£…åˆ°ç¼ºçœç›®å½•ä¸‹å³å¯ã€‚<br><img src="/2020/01/31/install-python/1.png"></p><p>åœ¨å®‰è£…Python2å‘å¯¼ä¸­ï¼Œé€‰æ‹©åŒæ—¶å®‰è£…å·¥å…·pipä»¥åŠå°†python.exeåŠ å…¥Pathç¯å¢ƒå˜é‡ä¸­ï¼š<br><img src="/2020/01/31/install-python/2.png"></p><p>åœ¨å®‰è£…Python3å‘å¯¼ä¸­ï¼Œé€‰æ‹©è‡ªå®šä¹‰å®‰è£…ï¼š<br><img src="/2020/01/31/install-python/3.png"></p><p>å¹¶é€‰æ‹©å®‰è£…å·¥å…·pipï¼š<br><img src="/2020/01/31/install-python/4.png"></p><p>å°†å®‰è£…ç›®å½•è®¾ç½®åˆ°å’ŒPython2ç›¸åŒçš„åœ°æ–¹C:\Python37ï¼š<br><img src="/2020/01/31/install-python/5.png"></p><p>å¦‚æœè¦è®¾ç½®Python2ä¸ºç¼ºçœçš„Pythonï¼Œå¯ä»¥å°†C:\Python27;C:\Python27\Scriptsæ”¾åˆ°Python3çš„é…ç½®å‰é¢ï¼š<br><img src="/2020/01/31/install-python/6.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsæ„å»ºGitHubåˆå¹¶è¯·æ±‚(Pull Request)</title>
    <link href="/2020/01/30/jenkins-github-pullrequest/"/>
    <url>/2020/01/30/jenkins-github-pullrequest/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æˆ‘çš„æ–‡ç« <a href="http://www.mikesay.com/2020/01/29/pullrequest-essential/">â€œGitåˆå¹¶è¯·æ±‚(pull/merge request)çš„æœ¬è´¨â€</a>ä¸­å·²ç»è¯´æ˜äº†åˆå¹¶è¯·æ±‚(pull/merge request)åœ¨ä»£ç å±‚é¢ä¸Šå®é™…æ˜¯Gitä»“åº“ä¸­çš„ä¸€ä¸ªç‰¹æ®Šåˆ†æ”¯ï¼Œå®ƒæŒ‡å‘äº†ç§æœ‰åˆ†æ”¯å’Œä¸»åˆ†æ”¯ä¸´æ—¶åˆå¹¶åäº§ç”Ÿçš„åˆå¹¶æäº¤(merge commit)ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿™ä¸ªåˆå¹¶è¯·æ±‚(pull/merge request)è¢«çœŸæ­£åˆå¹¶è¿›ä¸»åˆ†æ”¯ä¹‹å‰å¯¹å®ƒåšä¸€æ¬¡æ„å»ºï¼Œå°±èƒ½å°½æ—©å‘ç°ç§æœ‰åˆ†æ”¯ä¸Šçš„ä»£ç æ˜¯å¦æœ‰é—®é¢˜ï¼Œä»è€Œå°†é—®é¢˜æ‹¦æˆªåœ¨ä¸»åˆ†æ”¯ä¹‹å¤–ï¼Œå‡å°‘ä¸»åˆ†æ”¯ä¸ŠæŒç»­äº¤ä»˜æµæ°´çº¿çš„å¤±è´¥ç‡ã€‚å¯¹åˆå¹¶è¯·æ±‚(pull/merge request)çš„æ„å»ºé™¤äº†ç¼–è¯‘ä»£ç (å¿…è¦æ—¶å¯å¢é‡ç¼–è¯‘)å’Œå•å…ƒæµ‹è¯•å¤–ï¼Œè¿˜å¯ä»¥å¢åŠ æ›´å¤šé¢å¤–çš„æ£€æŸ¥ï¼Œæ¯”å¦‚ä»£ç çš„é™æ€æ‰«æã€‚ä¸šç•ŒæŠŠè¿™ä¸ªæ”¾åœ¨æŒç»­äº¤ä»˜æµæ°´çº¿ä¹‹å‰çš„æ£€æŸ¥ç§°ä¸ºpreflightæµæ°´çº¿(å¯å‚è€ƒã€ŠContinuous Deliveryã€‹è¿™æœ¬ä¹¦ç¬¬ä¸‰ç« 67é¡µå¯¹preflightæ„å»ºçš„è¯¦ç»†ä»‹ç»)ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é…ç½®Jenkinså’ŒGithubæ¥æ„å»ºGithubåˆå¹¶è¯·æ±‚(Pull Request)ã€‚</p><span id="more"></span><h1 id="é…ç½®Jenkins"><a href="#é…ç½®Jenkins" class="headerlink" title="é…ç½®Jenkins"></a>é…ç½®Jenkins</h1><h2 id="å®‰è£…Github-Pull-Request-Builderæ’ä»¶"><a href="#å®‰è£…Github-Pull-Request-Builderæ’ä»¶" class="headerlink" title="å®‰è£…Github Pull Request Builderæ’ä»¶"></a>å®‰è£…Github Pull Request Builderæ’ä»¶</h2><ol><li><p>ç‚¹å‡»Jenkins -&gt; Manage Jenkins -&gt; Manage Pluginsæ‰“å¼€Plugin Manageré¡µé¢</p></li><li><p>æ‰“å¼€Availableé¡µé¢ï¼Œé€‰æ‹©Github Pull Request Builderï¼Œç‚¹å‡»Install without restartæŒ‰é’®<br><img src="/2020/01/30/jenkins-github-pullrequest/1.png"></p></li><li><p>å¿…è¦æ—¶é‡å¯Jenkinsè®©æ’ä»¶ç”Ÿæ•ˆ</p></li></ol><h2 id="é…ç½®Github-Pull-Request-Builderæ’ä»¶"><a href="#é…ç½®Github-Pull-Request-Builderæ’ä»¶" class="headerlink" title="é…ç½®Github Pull Request Builderæ’ä»¶"></a>é…ç½®Github Pull Request Builderæ’ä»¶</h2><ol><li><p>ç‚¹å‡»Jenkins -&gt; Manage Jenkins -&gt; Config Systemæ‰“å¼€ç³»ç»Ÿé…ç½®é¡µé¢</p></li><li><p>å®šä½åˆ°â€Github Pull Request Builderâ€œæ’ä»¶ï¼Œç‚¹å‡»Addèœå•æ‰“å¼€åˆ›å»ºJenkinsè®¤è¯ä¿¡æ¯å¯¹è¯æ¡†<br><img src="/2020/01/30/jenkins-github-pullrequest/2.png"></p></li><li><p>åˆ›å»ºâ€Username with passwordâ€ç±»å‹çš„å‡­è¯ï¼Œç”¨æˆ·åå’Œå¯†ç æ˜¯æœ‰è¶³å¤Ÿæƒé™çš„Githubè´¦å·å’Œå¯†ç <br><img src="/2020/01/30/jenkins-github-pullrequest/3.png"></p></li><li><p>é…ç½®GitHub Server API URLï¼Œé€‰æ‹©æ­¥éª¤3åˆ›å»ºçš„å‡­è¯ï¼Œå¯ä»¥ç‚¹å‡»â€Connect to APIâ€æŒ‰é’®æµ‹è¯•åŸºæœ¬è¿æ¥<br><img src="/2020/01/30/jenkins-github-pullrequest/4.png"></p><p>å¯¹äºGitHub Server API URLçš„å€¼ï¼ŒGitHubå’ŒGitHub Enterpriseæ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><table><thead><tr><th>GitHub Server</th><th>API Endpoint</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>GitHub Enterprise</td><td>http(s)://[hostname]/api/v3</td><td></td></tr><tr><td>GitHub</td><td><a href="https://api.github.com/">https://api.github.com</a></td><td>Receive the v3 version of the REST API.</td></tr></tbody></table></li><li><p>ç‚¹å‡»â€Saveâ€æŒ‰é’®ä¿å­˜é…ç½®</p></li></ol><h1 id="é…ç½®Githubä»£ç ä»“åº“"><a href="#é…ç½®Githubä»£ç ä»“åº“" class="headerlink" title="é…ç½®Githubä»£ç ä»“åº“"></a>é…ç½®Githubä»£ç ä»“åº“</h1><ol><li><p>æ‰“å¼€Gitä»“åº“è®¾ç½®é¡µé¢ï¼Œç‚¹å‡»Hooks -&gt; Add webhook<br><img src="/2020/01/30/jenkins-github-pullrequest/5.png"></p></li><li><p>è¾“å…¥Palyload URL(<code>http://jenkins-url/github-webhook/</code>)ï¼Œé€‰æ‹©Content Typeä¸ºapplication/json<br><img src="/2020/01/30/jenkins-github-pullrequest/6.png"></p></li><li><p>é€‰æ‹©â€Let me select individual enventsâ€è‡ªå®šä¹‰webhookè§¦å‘äº‹ä»¶<br><img src="/2020/01/30/jenkins-github-pullrequest/7.png"></p></li><li><p>åªé€‰æ‹©â€Pull requestsâ€äº‹ä»¶ï¼Œå¹¶ç‚¹å‡»â€Add webhookâ€ä¿å­˜Webhook<br><img src="/2020/01/30/jenkins-github-pullrequest/8.png"></p></li></ol><h1 id="åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-pull-merge-request"><a href="#åˆ›å»ºJenkins-pipeline-jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚-pull-merge-request" class="headerlink" title="åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(pull/merge request)"></a>åˆ›å»ºJenkins pipeline jobç”¨æ¥æ„å»ºåˆå¹¶è¯·æ±‚(pull/merge request)</h1><h2 id="Jenkinsfile"><a href="#Jenkinsfile" class="headerlink" title="Jenkinsfile"></a>Jenkinsfile</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs groovy">pipeline &#123;<br>    agent &#123;<br>        label <span class="hljs-string">&#x27;common&#x27;</span><br>    &#125;<br>    environment &#123;<br>        GITHUB_URL = <span class="hljs-string">&quot;http://xxx.github.xxxx.com&quot;</span><br>        GITHUB_ORG = <span class="hljs-string">&quot;MikeSay&quot;</span><br>        GITHUB_REPO = <span class="hljs-string">&quot;mikesay-test-1&quot;</span><br>    &#125;<br>    options &#123;<br>        skipDefaultCheckout()<br>        ansiColor(<span class="hljs-string">&#x27;xterm&#x27;</span>)<br>    &#125;<br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;Checkout&#x27;</span>) &#123;<br>            steps &#123;<br>                script&#123;<br>                    <span class="hljs-keyword">def</span> scmVars =   checkout(<br>                                        [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;$&#123;ghprbActualCommit&#125;&quot;</span>]], <br>                                        <span class="hljs-symbol">doGenerateSubmoduleConfigurations:</span> <span class="hljs-literal">false</span>,<br>                                        <span class="hljs-symbol">submoduleCfg:</span> [], <br>                                        <span class="hljs-symbol">extensions:</span> [<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;RelativeTargetDirectory&#x27;</span>, <span class="hljs-attr">relativeTargetDir:</span> <span class="hljs-string">&#x27;codes&#x27;</span>],<br>                                            [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;CleanBeforeCheckout&#x27;</span>]<br>                                        ],<br>                                        <span class="hljs-symbol">userRemoteConfigs:</span> [<br>                                                [<br>                                                    <span class="hljs-symbol">credentialsId:</span> <span class="hljs-string">&#x27;ghe_account&#x27;</span>, <br>                                                    <span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;origin&#x27;</span>, <br>                                                    <span class="hljs-symbol">refspec:</span> <span class="hljs-string">&#x27;+refs/pull/*:refs/remotes/origin/pr/*&#x27;</span>, <br>                                                    <span class="hljs-symbol">url:</span> <span class="hljs-string">&quot;$&#123;GITHUB_URL&#125;/$&#123;GITHUB_ORG&#125;/$&#123;GITHUB_REPO&#125;.git&quot;</span><br>                                                ]<br>                                            ]<br>                                        ]<br>                                    )<br>                    env.GIT_BRANCH = <span class="hljs-string">&quot;$&#123;scmVars.GIT_BRANCH&#125;&quot;</span><br>                    env.GIT_COMMIT = <span class="hljs-string">&quot;$&#123;scmVars.GIT_COMMIT&#125;&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        stage(<span class="hljs-string">&#x27;Build&#x27;</span>) &#123;<br>            steps &#123;<br>                dir(<span class="hljs-string">&#x27;codes&#x27;</span>) &#123;<br>                    sh <span class="hljs-string">&#x27;&#x27;&#x27;#!/bin/bash -l</span><br><span class="hljs-string">                        echo &quot;Start building!&quot;</span><br><span class="hljs-string">                        cat README.md</span><br><span class="hljs-string">                    &#x27;&#x27;&#x27;</span><br>                &#125;<br>            &#125;<br>        &#125;<br><br><br>    &#125;<br>    post &#123;<br>        always &#123;<br>            junit <span class="hljs-attr">allowEmptyResults:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">testResults:</span> <span class="hljs-string">&#x27;codes/build/test-results/test/**/*.xml&#x27;</span><br>            <span class="hljs-comment">// send to email</span><br>            emailext(<br>                <span class="hljs-symbol">subject:</span> <span class="hljs-string">&#x27;$DEFAULT_SUBJECT&#x27;</span>,<br>                <span class="hljs-symbol">body:</span> <span class="hljs-string">&#x27;$DEFAULT_CONTENT&#x27;</span>,<br>                <span class="hljs-symbol">recipientProviders:</span> [<br>                [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;CulpritsRecipientProvider&#x27;</span>],<br>                [<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;RequesterRecipientProvider&#x27;</span>],<br>                [<span class="hljs-attr">$class :</span> <span class="hljs-string">&#x27;DevelopersRecipientProvider&#x27;</span>]<br>                ],<br>                <span class="hljs-symbol">replyTo:</span> <span class="hljs-string">&#x27;$DEFAULT_REPLYTO&#x27;</span>,<br>                <span class="hljs-symbol">to:</span> <span class="hljs-string">&#x27;$DEFAULT_RECIPIENTS&#x27;</span><br>            )<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>30è¡Œ: æ·»åŠ refspecè·å–åˆå¹¶è¯·æ±‚(pull/merge request)çš„åˆ†æ”¯ä¿¡æ¯</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-attr">refspec:</span> <span class="hljs-string">&#x27;+refs/pull/*:refs/remotes/origin/pr/*&#x27;</span><br></code></pre></td></tr></table></figure><p>19è¡Œ: branchesé€‰æ‹©ç¯å¢ƒå˜é‡â€ghprbActualCommitâ€ï¼Œå®ƒæ˜¯åˆå¹¶è¯·æ±‚(pull/merge request)åˆ†æ”¯å¯¹åº”çš„æäº¤å·</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">[<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;$&#123;ghprbActualCommit&#125;&quot;</span>]]<br></code></pre></td></tr></table></figure><p>é™¤äº†â€ghprbActualCommitâ€å¤–ï¼Œgithub pull request builderæ’ä»¶è¿˜å¾€å½“å‰æ„å»ºä¸­æ³¨å…¥äº†è®¸å¤šå˜é‡ä¾›æ„å»ºJobä½¿ç”¨ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>å˜é‡</th><th>äº‹ä¾‹å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sha1</td><td>origin/pr/6/merge</td><td>åˆå¹¶è¯·æ±‚(pull/merge request)åˆ†æ”¯ã€‚åœ¨æ„å»ºJobä¸­ä¹Ÿå¯ä»¥ç”¨${sha1}æ¥ä»£æ›¿${ghprbActualCommit}</td></tr><tr><td>ghprbAuthorRepoGitUrl</td><td><a href="http://xxxx.github.xxxx.com/MikeSay/mikesay-test-1.git">http://xxxx.github.xxxx.com/MikeSay/mikesay-test-1.git</a></td><td>åˆå¹¶è¯·æ±‚(pull/merge request)æ‰€åœ¨ä»“åº“çš„httpåœ°å€</td></tr><tr><td>ghprbPullId</td><td>6</td><td>åˆå¹¶è¯·æ±‚(pull/merge request)çš„IDå·</td></tr><tr><td>ghprbTargetBranch</td><td>master</td><td>åˆå¹¶è¯·æ±‚(pull/merge request)çš„ä¸»åˆ†æ”¯</td></tr><tr><td>ghprbSourceBranch</td><td>test9</td><td>åˆå¹¶è¯·æ±‚(pull/merge request)çš„ç§æœ‰åˆ†æ”¯</td></tr><tr><td>ghprbPullTitle</td><td>Test9.</td><td>åˆå¹¶è¯·æ±‚(pull/merge request)çš„æ ‡é¢˜</td></tr><tr><td>ghprbPullLink</td><td><a href="http://xxxx.github.xxxx.com/MikeSay/mikesay-test-1/pull/6">http://xxxx.github.xxxx.com/MikeSay/mikesay-test-1/pull/6</a></td><td>åˆå¹¶è¯·æ±‚(pull/merge request)çš„httpåœ°å€</td></tr></tbody></table><p>å¯ä»¥ä»å½“å‰åˆå¹¶è¯·æ±‚(pull/merge request)çš„æ„å»ºå‚æ•°ä¸­è·å¾—æ‰€æœ‰å˜é‡åå’Œå½“å‰å€¼ï¼š<br><img src="/2020/01/30/jenkins-github-pullrequest/16.png"></p><h2 id="åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile"><a href="#åˆ›å»ºJenkins-jobå¼•ç”¨Jenkinsfile" class="headerlink" title="åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile"></a>åˆ›å»ºJenkins jobå¼•ç”¨Jenkinsfile</h2><ol><li><p>ç‚¹å‡»â€New Itemâ€</p></li><li><p>é€‰æ‹©Jobç±»å‹ä¸ºâ€Pipelineâ€ï¼Œè¾“å…¥Jobçš„åå­—â€github-preflightâ€ï¼Œç‚¹å‡»â€Okâ€æŒ‰é’®<br><img src="/2020/01/30/jenkins-github-pullrequest/9.png"></p></li><li><p>åœ¨â€GitHub Projectâ€æ®µï¼Œè¾“å…¥â€Project urlâ€ã€‚æ³¨ï¼Œâ€Project urlâ€æ˜¯Gitä»“åº“çš„httpåœ°å€å»é™¤â€.gitâ€åç¼€<br><img src="/2020/01/30/jenkins-github-pullrequest/10.png"></p></li><li><p>åœ¨â€Build Triggersâ€æ®µï¼Œé€‰æ‹©â€GitHub Pull Request Builderâ€<br><img src="/2020/01/30/jenkins-github-pullrequest/11.png"></p><ul><li>GitHub API credentials: ä¹‹å‰é…ç½®çš„GitHub API</li><li>Trigger phrase: åœ¨åˆå¹¶è¯·æ±‚(pull/merge request)çš„æ³¨é‡Šæˆ–æ ‡é¢˜é‡ŒåŠ å…¥trigger phraseå†…å®¹ä¼šè‡ªåŠ¨è§¦å‘æ–°çš„æ„å»º</li><li>Skip build phrase: åœ¨åˆå¹¶è¯·æ±‚(pull/merge request)çš„æ³¨é‡Šæˆ–æ ‡é¢˜é‡ŒåŠ å…¥skip build phraseå†…å®¹åˆ™ä¸ä¼šè§¦å‘æ„å»º</li></ul></li><li><p>å¦‚æœéœ€è¦æ„å»ºæ¯ä¸ªåˆå¹¶è¯·æ±‚(pull/merge request)ï¼Œå‹¾é€‰â€Build every pull request automatically without asking (Dangerous)â€ï¼Œåœ¨â€Whitelist Target Branchesâ€è¾“å…¥ä¸»åˆ†æ”¯â€masterâ€<br><img src="/2020/01/30/jenkins-github-pullrequest/12.png"></p></li><li><p>åœ¨â€Pipelineâ€æ®µï¼Œå¼•ç”¨Jenkinsfile<br><img src="/2020/01/30/jenkins-github-pullrequest/13.png"></p></li></ol><h1 id="åˆ›å»ºåˆå¹¶è¯·æ±‚-pull-merge-request-è§¦å‘æ„å»º"><a href="#åˆ›å»ºåˆå¹¶è¯·æ±‚-pull-merge-request-è§¦å‘æ„å»º" class="headerlink" title="åˆ›å»ºåˆå¹¶è¯·æ±‚(pull/merge request)è§¦å‘æ„å»º"></a>åˆ›å»ºåˆå¹¶è¯·æ±‚(pull/merge request)è§¦å‘æ„å»º</h1><ol><li><p>Githubçš„åˆå¹¶è¯·æ±‚(pull/merge request)<br><img src="/2020/01/30/jenkins-github-pullrequest/14.png"></p></li><li><p>è§¦å‘çš„æ„å»º<br><img src="/2020/01/30/jenkins-github-pullrequest/15.png"></p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Git</tag>
      
      <tag>Jenkins</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitåˆå¹¶è¯·æ±‚(Pull/Merge request)çš„æœ¬è´¨</title>
    <link href="/2020/01/29/pullrequest-essential/"/>
    <url>/2020/01/29/pullrequest-essential/</url>
    
    <content type="html"><![CDATA[<p>Gitä»¥åŠåŸºäºGitçš„å„ä»£ç å¼€å‘åä½œå¹³å°ï¼Œæ¯”å¦‚Github, Gitlab, Bitbucket, TFS Gitç­‰æ­£é€æ¸æˆä¸ºé¦–é€‰çš„ä»£ç ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œè€ŒåŸºäºGitçš„åŸºæœ¬å¼€å‘æµç¨‹åˆ™æ˜¯å¼€å‘è€…åˆ›å»ºä¸ªäººçš„ç§æœ‰åˆ†æ”¯å¹¶åœ¨ä¸ªäººçš„ç§æœ‰åˆ†æ”¯ä¸Šæäº¤ä»£ç ï¼Œä»£ç å®Œæˆååˆ›å»ºåˆå¹¶è¯·æ±‚(pull/merge request)åˆ°ä¸»åˆ†æ”¯è®©ç›¸å…³äººå‘˜åšä»£ç è¯„å®¡ï¼Œè¯„å®¡é€šè¿‡åå°†åˆå¹¶è¯·æ±‚(pull/merge request)åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚åˆå¹¶è¯·æ±‚(pull/merge request)ä¸æ˜¯Gitæœ¬èº«çš„ç‰¹æ€§ï¼Œè€Œæ˜¯å„ä»£ç åä½œå¹³å°æä¾›çš„ç‰¹æ€§ï¼Œå®ƒæä¾›çš„ä»£ç è¯„å®¡åŠŸèƒ½å‡ ä¹å–ä»£äº†ç‹¬ç«‹çš„ä»£ç è¯„å®¡å·¥å…·ï¼ŒåŒæ—¶å®ƒä¹Ÿæ–¹ä¾¿äº†åˆ†å¸ƒäºä¸–ç•Œå„åœ°çš„å¼€æºä»£ç è´¡çŒ®è€…åˆå¹¶è‡ªå·±çš„ä»£ç ã€‚é‚£ä¹ˆåˆå¹¶è¯·æ±‚(pull/merge request)åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿå®ƒçœ‹çš„è§æ‘¸å¾—ç€å—ï¼Ÿæœ¬æ–‡å°†é€šè¿‡ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä»£ç å¼€å‘åä½œå¹³å°(Github, Gitlab, Bitbucket, TFS Git)å¯¹åˆå¹¶è¯·æ±‚(pull/merget request)çš„å®ç°æ¥é˜æ˜åˆå¹¶è¯·æ±‚(pull/merge request)çš„æœ¬è´¨ã€‚<span id="more"></span></p><p>å®é™…ä¸Šï¼Œåˆå¹¶è¯·æ±‚(pull/merge request)åœ¨ä»£ç å±‚é¢ä¸Šæ˜¯Gitä»“åº“ä¸­çš„ä¸€ä¸ªç‰¹æ®Šåˆ†æ”¯ã€‚å½“å¼€å‘åœ¨ä»£ç åä½œå¹³å°ä¸Šåˆ›å»ºå¹¶æäº¤åˆå¹¶è¯·æ±‚(pull/merge request)åï¼Œä»£ç åä½œå¹³å°åœ¨æœåŠ¡å™¨ç«¯å°†ç§æœ‰åˆ†æ”¯å’Œä¸»åˆ†æ”¯ä¸´æ—¶åˆå¹¶äº§ç”Ÿä¸€ä¸ªåˆå¹¶æäº¤(merge commit)ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªç‰¹æ®Šåˆ†æ”¯æŒ‡å‘è¿™ä¸ªåˆå¹¶æäº¤(merge commit)ã€‚å¦‚æœä¸´æ—¶åˆå¹¶å‡ºç°å†²çªï¼Œåˆ™åœ¨Webå±‚é¢æ˜¾ç¤ºæœ‰å†²çªï¼Œéœ€è¦å¼€å‘æäº¤æ–°çš„ä»£ç åˆ°ä¸ªäººåˆ†æ”¯ä»¥æ¶ˆé™¤å†²çªã€‚</p><p>è¦çœŸæ­£çš„ç†è§£åˆå¹¶è¯·æ±‚(pull/merge request)è¿™ä¸€ç‰¹æ®Šåˆ†æ”¯ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸‹Gitçš„åˆ†æ”¯ã€‚</p><h1 id="Gitåˆ†æ”¯"><a href="#Gitåˆ†æ”¯" class="headerlink" title="Gitåˆ†æ”¯"></a>Gitåˆ†æ”¯</h1><p>ç›¸å¯¹äºä¼ ç»Ÿçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·åˆ›å»ºåˆ†æ”¯çš„æ“ä½œï¼ŒGitçš„åˆ†æ”¯æ–¹å¼åŠå…¶è½»å·§ï¼Œåˆ†æ”¯æ“ä½œå‡ ä¹æ˜¯å®æ—¶çš„ï¼Œå¹¶ä¸”åœ¨åˆ†æ”¯ä¹‹å‰åˆ‡æ¢ä¹Ÿéå¸¸å¿«ã€‚è®¸å¤šäººè®¤ä¸ºGitè¿™ä¸€åˆ†æ”¯æ¨¡å¼ç®—å¾—ä¸Šæ˜¯ä¸€ä¸ªâ€œæ€æ‰‹çº§â€åŠŸèƒ½ã€‚ä¸‹å›¾æè¿°äº†ä¸€ä¸ªå«æœ‰ä¸‰ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œä¸”åªæœ‰ä¸€ä¸ªæäº¤çš„Gitä»“åº“ï¼š</p><p><img src="/2020/01/29/pullrequest-essential/1.png"></p><p>åœ¨Gitä¸­ï¼Œæ•°æ®æ˜¯ä»¥æ ‘å½¢ç»“æ„å­˜å‚¨ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ç€ä¸€ä¸ªblobå¯¹è±¡ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ç€ä¸€ä¸ªtreeå¯¹è±¡ã€‚æ¯ä¸€æ¬¡Gitæäº¤(commit)ï¼Œéƒ½ä¼šæ ¹æ®æ–‡ä»¶æˆ–è·¯å¾„çš„å˜åŒ–åˆ›å»ºä¸€ç³»åˆ—æ–°çš„blogå¯¹è±¡æˆ–treeå¯¹è±¡ï¼Œchecksumä¸å˜çš„å¯¹è±¡ä¼šè¢«é‡å¤å¼•ç”¨ï¼Œå…¶ä¸­æœ€é¡¶å±‚çš„treeå¯¹è±¡ç”±äºæ¯æ¬¡éƒ½éœ€è¦å˜åŒ–ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„é¡¶å±‚treeå¯¹è±¡ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªcommitå¯¹è±¡æŒ‡å‘æ–°çš„é¡¶å±‚treeå¯¹è±¡ï¼Œæ•´ä¸ªè¿‡ç¨‹çŠ¹å¦‚ç»™æ•°æ®åšäº†ä¸ªå¿«ç…§ï¼Œè€Œå½“å‰çš„commitå¯¹è±¡åˆ™æ˜¯è¿™ä¸ªå¿«ç…§çš„æ ‡ç­¾ã€‚å¦‚æœè¦è·å–è¿™ä¸ªå¿«ç…§å¯¹åº”çš„ä»£ç ï¼Œåªè¦git checkoutåˆ°è¿™ä¸ªcommitå¯¹è±¡å³å¯ã€‚</p><p>å½“å†æ¬¡æäº¤æ—¶ï¼Œæ–°åˆ›å»ºçš„commitå¯¹è±¡ä¼šä¿å­˜ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å‰é¢çš„ä¸€ä¸ªcommitå¯¹è±¡å½¢æˆä¸€ä¸ªæäº¤é“¾(å¿«ç…§é“¾)ã€‚ä¸‹å›¾å°±æ˜¯Gitä»“åº“ä¸­çš„ä¸€ä¸ªæäº¤é“¾ï¼š</p><p><img src="/2020/01/29/pullrequest-essential/2.png"></p><p>è€ŒGitä¸­çš„åˆ†æ”¯åˆ™æ˜¯ä¸€ä¸ªè½»é‡çš„å¯ç§»åŠ¨çš„æŒ‡é’ˆæŒ‡å‘å…¶ä¸­ä¸€ä¸ªcommitå¯¹è±¡ã€‚ç¼ºçœçš„åˆ†æ”¯åå­—å«masterï¼Œæ¯ä¸€æ¬¡æ–°çš„æäº¤masteråˆ†æ”¯éƒ½ä¼šç§»åŠ¨å¹¶æŒ‡å‘åˆ°æœ€æ–°çš„commitå¯¹è±¡ã€‚ä¸‹å›¾æ˜¯Gitä¸­çš„åˆ†æ”¯å’Œæäº¤å†å²ï¼š</p><p><img src="/2020/01/29/pullrequest-essential/3.png"></p><p>HEADå¯¹è±¡æ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚åˆ‡æ¢åˆ†æ”¯æ—¶ï¼Œåªè¦å°†HEADæŒ‡å‘æ–°çš„åˆ†æ”¯å³å¯ï¼Œæ‰€ä»¥è¯´Gitåˆ‡æ¢åˆ†æ”¯çš„æ“ä½œæ˜¯ç›¸å½“è½»é‡çš„ã€‚</p><p>æ‰€ä»¥æ­£å¦‚å‰æ–‡æ‰€è¯´ï¼Œåˆå¹¶è¯·æ±‚(pull/merge request)ä¹Ÿæ˜¯ä¸ªåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆï¼Œå®ƒæ˜¯æŒ‡å‘ç§æœ‰åˆ†æ”¯å’Œä¸»åˆ†æ”¯ä¸´æ—¶åˆå¹¶åäº§ç”Ÿçš„åˆå¹¶æäº¤(commit)å¯¹è±¡ã€‚ä¸‹å›¾æ˜¯Gitä¸­çš„åˆå¹¶è¯·æ±‚(pull/merge request)åˆ†æ”¯ï¼š</p><p><img src="/2020/01/29/pullrequest-essential/4.png"></p><p>å¦‚å›¾â€defect235â€åˆ†æ”¯æ˜¯ä¸ºäº†ä¿®å¤defect235è€Œåˆ›å»ºçš„ç§æœ‰åˆ†æ”¯ï¼Œcommitâ€f40acâ€æ˜¯ä»£ç åä½œå¹³å°ä¸´æ—¶åˆå¹¶åˆ†æ”¯â€defect235â€å’Œâ€masterâ€è€Œåˆ›å»ºçš„åˆå¹¶æäº¤å¯¹è±¡ï¼Œåˆ†æ”¯â€refs/pull/1/mergeâ€åˆ™æ˜¯é‚£ä¸ªç‰¹æ®Šçš„åˆ†æ”¯ï¼ŒæŒ‡å‘åˆå¹¶æäº¤å¯¹è±¡â€f40acâ€ã€‚ä¸è¿‡,å¸¸è§„çš„Gitå…‹éš†æˆ–è€…æ‹‰å–æ˜¯æ— æ³•è·å–è¿™ä¸ªåˆ†æ”¯ä¿¡æ¯çš„ï¼Œå› ä¸ºå¸¸è§„Gitåªä¼šè®¤ä¸ºåœ¨ç¼ºçœè·¯å¾„â€œrefs/heads/â€œä¸‹çš„åˆ†æ”¯æ˜¯Gitåˆ†æ”¯ã€‚å½“å¼€å‘åœ¨Webç•Œé¢ä¸­åˆå¹¶åˆå¹¶è¯·æ±‚(pull/merge request)åï¼Œç§æœ‰åˆ†æ”¯â€defect235â€å’Œç‰¹æ®Šçš„åˆ†æ”¯ä¹Ÿä¼šè¢«åˆ é™¤æ‰(é€šå¸¸ä»£ç åä½œå¹³å°ä¼šæä¾›ä¸€äº›è®¾ç½®æ¥æ§åˆ¶æ˜¯å¦è¦åˆ é™¤ç§æœ‰åˆ†æ”¯å’Œåˆå¹¶è¯·æ±‚åˆ†æ”¯)ã€‚ä¸‹å›¾æ˜¯Gitä¸­åˆå¹¶è¯·æ±‚è¢«åˆå¹¶åçš„åˆ†æ”¯æƒ…å†µï¼š</p><p><img src="/2020/01/29/pullrequest-essential/5.png"></p><p>ä¸åŒçš„ä»£ç åä½œå¹³å°åœ¨å®ç°åˆå¹¶è¯·æ±‚(pull/merget request)çš„åŸç†ä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚</p><h1 id="GitHubåˆå¹¶è¯·æ±‚-Pull-Request"><a href="#GitHubåˆå¹¶è¯·æ±‚-Pull-Request" class="headerlink" title="GitHubåˆå¹¶è¯·æ±‚(Pull Request)"></a>GitHubåˆå¹¶è¯·æ±‚(Pull Request)</h1><ul><li><p>é…ç½®æœ¬åœ°Gitä»“åº“ä½¿å¾—æ¯æ¬¡æ‰§è¡ŒGitæ‹‰å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°åˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">  git config --add remote.origin.fetch +refs/pull/*:refs/remotes/origin/pr/*<br>  git pull --rebase<br>  git branch -a<br><br>  add_test<br>* master<br>  remotes/origin/HEAD -&gt; origin/master<br>  remotes/origin/add_test<br>  remotes/origin/master<br>  remotes/origin/pr/1/head<br>  remotes/origin/pr/1/merge<br><br>  git checkout  -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure><p>origin/pr/1/head: æŒ‡å‘å½“å‰åˆå¹¶è¯·æ±‚(pull request)ä¸­çš„ç§æœ‰åˆ†æ”¯<br>origin/pr/1/merge: æŒ‡å‘ä¸´æ—¶åˆå¹¶çš„æäº¤å¯¹è±¡</p></li><li><p>ä»…æ‹‰å–æŸä¸ªåˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git fetch origin +refs/pull/1/*:refs/remotes/origin/pr/1/*<br>git checkout  -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure></li></ul><h1 id="GitLabåˆå¹¶è¯·æ±‚-Merge-Request"><a href="#GitLabåˆå¹¶è¯·æ±‚-Merge-Request" class="headerlink" title="GitLabåˆå¹¶è¯·æ±‚(Merge Request)"></a>GitLabåˆå¹¶è¯·æ±‚(Merge Request)</h1><ul><li><p>é…ç½®æœ¬åœ°Gitä»“åº“ä½¿å¾—æ¯æ¬¡æ‰§è¡ŒGitæ‹‰å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°åˆå¹¶è¯·æ±‚(merge request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">  git config --add remote.origin.fetch +refs/merge-requests/*:refs/remotes/origin/mr/*<br>  git pull --rebase<br>  git branch -a<br><br>  change2<br>  change_readme<br>* master<br>  remotes/origin/HEAD -&gt; origin/master<br>  remotes/origin/change2<br>  remotes/origin/change_readme<br>  remotes/origin/master<br>  remotes/origin/mr/1/head<br>  remotes/origin/mr/2/head<br><br>  git checkout -b mr/2 origin/mr/2/head<br></code></pre></td></tr></table></figure><p>origin/mr/1/head: æŒ‡å‘ä¸´æ—¶åˆå¹¶çš„æäº¤å¯¹è±¡</p></li><li><p>ä»…æ‹‰å–æŸä¸ªåˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git fetch origin +refs/merge-requests/2/*:refs/remotes/origin/mr/2/*<br>git checkout -b mr/2 origin/mr/2/head<br></code></pre></td></tr></table></figure></li></ul><h1 id="Bitbucktåˆå¹¶è¯·æ±‚-pull-Request"><a href="#Bitbucktåˆå¹¶è¯·æ±‚-pull-Request" class="headerlink" title="Bitbucktåˆå¹¶è¯·æ±‚(pull Request)"></a>Bitbucktåˆå¹¶è¯·æ±‚(pull Request)</h1><ul><li><p>é…ç½®æœ¬åœ°Gitä»“åº“ä½¿å¾—æ¯æ¬¡æ‰§è¡ŒGitæ‹‰å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°åˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">  git config --add remote.origin.fetch +refs/pull-requests/*:refs/remotes/origin/pr/*<br>  git pull --rebase<br>  git branch -a<br><br>  fix_defect1<br>* master<br>  remotes/origin/fix_defect1<br>  remotes/origin/master<br>  remotes/origin/pr/1/from<br>  remotes/origin/pr/1/merge<br><br>  git checkout -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure><p>origin/pr/1/from: æŒ‡å‘å½“å‰åˆå¹¶è¯·æ±‚(pull request)ä¸­çš„ç§æœ‰åˆ†æ”¯<br>origin/pr/1/merge: æŒ‡å‘ä¸´æ—¶åˆå¹¶çš„æäº¤å¯¹è±¡</p></li><li><p>ä»…æ‹‰å–æŸä¸ªåˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git fetch origin +refs/pull-requests/1/*:refs/remotes/origin/pr/1/*<br>git checkout -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure></li></ul><h1 id="TFS-Gitåˆå¹¶è¯·æ±‚-pull-Request"><a href="#TFS-Gitåˆå¹¶è¯·æ±‚-pull-Request" class="headerlink" title="TFS Gitåˆå¹¶è¯·æ±‚(pull Request)"></a>TFS Gitåˆå¹¶è¯·æ±‚(pull Request)</h1><ul><li>é…ç½®æœ¬åœ°Gitä»“åº“ä½¿å¾—æ¯æ¬¡æ‰§è¡ŒGitæ‹‰å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°åˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">  git config --add remote.origin.fetch +refs/pull/*:refs/remotes/origin/pr/*<br>  git pull --rebase<br>  git branch -a<br><br>  fix_defect1<br>* master<br>  remotes/origin/fix_defect1<br>  remotes/origin/master<br>  remotes/origin/pr/1/merge<br><br>  git checkout -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure></li></ul><p>  origin/pr/1/merge: æŒ‡å‘ä¸´æ—¶åˆå¹¶çš„æäº¤å¯¹è±¡</p><ul><li>ä»…æ‹‰å–æŸä¸ªåˆå¹¶è¯·æ±‚(pull request)çš„ä¿¡æ¯<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git fetch origin +refs/pull/1/*:refs/remotes/origin/pr/1/*<br>git checkout -b pr/1 origin/pr/1/merge<br></code></pre></td></tr></table></figure></li></ul><p>å½“ç„¶ï¼Œé™¤äº†ä¸Šé¢å››ä¸ªåŸºäºGitçš„ä»£ç åä½œå¹³å°å¤–ï¼Œè¿˜æœ‰è®¸å¤šä¼˜ç§€çš„å¹³å°ï¼Œæ¯”å¦‚å›½å†…çš„ç äº‘<a href="https://gitee.com/">https://gitee.com/</a>ï¼Œå„å¤§å…¬æœ‰äº‘å¹³å°ä¹Ÿéƒ½æä¾›äº†è‡ªå·±çš„ä»£ç åä½œå¹³å°ã€‚è¯»è€…å¯ä»¥æ ¹æ®æœ¬æ–‡çš„è¯´æ˜è‡ªè¡Œç ”ç©¶åˆå¹¶è¯·æ±‚(pull/merge request)ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>Git</tag>
      
      <tag>Bitbucket</tag>
      
      <tag>Github</tag>
      
      <tag>Gitlab</tag>
      
      <tag>TFS Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºå®¹å™¨åŒ–çš„Azure DevOps Agent</title>
    <link href="/2019/12/30/docker-agent-for-azure-devops/"/>
    <url>/2019/12/30/docker-agent-for-azure-devops/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šå®‰è£…ï¼Œé…ç½®æˆ–åˆ é™¤Azure DevOps Agentæ˜¯éœ€è¦èŠ±è´¹ä¸€äº›æ­¥éª¤å’Œç²¾åŠ›çš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ–‡æ¡£<a href="https://docs.microsoft.com/en-us/vsts/build-release/actions/agents/v2-linux?view=vsts">https://docs.microsoft.com/en-us/vsts/build-release/actions/agents/v2-linux?view=vsts</a>ã€‚å¥½æ¶ˆæ¯æ˜¯Azure DevOpså·²ç»æ”¯æŒå®¹å™¨åŒ–çš„æ–¹å¼è¿è¡ŒAgentã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ›å»ºå’Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨åŒ–çš„Agentã€‚</p><span id="more"></span><h1 id="è·å–Azure-DevOps-Agentçš„Dockeré•œåƒ"><a href="#è·å–Azure-DevOps-Agentçš„Dockeré•œåƒ" class="headerlink" title="è·å–Azure DevOps Agentçš„Dockeré•œåƒ"></a>è·å–Azure DevOps Agentçš„Dockeré•œåƒ</h1><h2 id="ç›´æ¥ä»Docker-Hubä¸Šä¸‹è½½"><a href="#ç›´æ¥ä»Docker-Hubä¸Šä¸‹è½½" class="headerlink" title="ç›´æ¥ä»Docker Hubä¸Šä¸‹è½½"></a>ç›´æ¥ä»Docker Hubä¸Šä¸‹è½½</h2><p>åœ¨æˆ‘çš„Docker Hubç©ºé—´å·²ç»æœ‰å¼€ç®±å³ç”¨çš„Dockeré•œåƒäº†ã€‚ æ‰“å¼€é¡µé¢<a href="https://hub.docker.com/r/mikejianzhang/azure-agent">https://hub.docker.com/r/mikejianzhang/azure-agent</a>æŸ¥çœ‹è¯¦ç»†çš„ä¸‹è½½è¯´æ˜ã€‚</p><h2 id="è‡ªå·±æ„å»º"><a href="#è‡ªå·±æ„å»º" class="headerlink" title="è‡ªå·±æ„å»º"></a>è‡ªå·±æ„å»º</h2><p>ç¼ºçœçš„å¼€ç®±å³ç”¨çš„Dockeré•œåƒå¹¶æ²¡æœ‰åŒ…å«è¿‡å¤šçš„æ„å»ºå·¥å…·ã€‚å¦‚æœè¿™ä¸æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥forkä»£ç ä»“åº“<a href="https://github.com/mikejianzhang/azure-agent">https://github.com/mikejianzhang/azure-agent</a>åˆ°è‡ªå·±çš„ç©ºé—´ï¼Œä¿®æ”¹Dockerfileæ·»åŠ æ›´å¤šçš„å·¥å…·ï¼Œå†é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ„å»ºæ–°çš„Dockeré•œåƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">./build.sh azure-agent:&lt;tag&gt;<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ åœ¨å…¬å¸å†…éƒ¨æ„å»ºé•œåƒï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ä»£ç†æ‰èƒ½è®¿é—®äº’è”ç½‘ï¼Œåœ¨æ„å»ºä¹‹å‰ä½ éœ€è¦è®¾ç½®httpä»£ç†ã€‚æ„å»ºè„šæœ¬â€œbuild.shâ€æ”¯æŒâ€œhttp_proxyâ€, â€œhttps_proxyâ€ and â€œno_proxyâ€ã€‚</p></blockquote><h1 id="è¿è¡ŒAzure-DevOps-Agentçš„Dockeré•œåƒ"><a href="#è¿è¡ŒAzure-DevOps-Agentçš„Dockeré•œåƒ" class="headerlink" title="è¿è¡ŒAzure DevOps Agentçš„Dockeré•œåƒ"></a>è¿è¡ŒAzure DevOps Agentçš„Dockeré•œåƒ</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol><li><p>åœ¨Azure DevOpsä¸Šåˆ›å»ºAgent Pool<br><img src="/2019/12/30/docker-agent-for-azure-devops/1.png"></p></li><li><p>ç”ŸæˆPersonal Access Token<br><img src="/2019/12/30/docker-agent-for-azure-devops/2.png"></p></li></ol><h2 id="è¿è¡ŒDockeré•œåƒ"><a href="#è¿è¡ŒDockeré•œåƒ" class="headerlink" title="è¿è¡ŒDockeré•œåƒ"></a>è¿è¡ŒDockeré•œåƒ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ docker run -it -d --name some-agent \<br>        -e AZP_URL=your-azure-devops-url \<br>        -e AZP_TOKEN=your-azure-devops-pat \<br>        -e AZP_AGENT_NAME=some-agent \<br>        -e AZP_POOL=your-azure-devops-agent-pool \<br>        -e AZP_AGENTPACKAGE_URL=the-zure-devops-agent-package \<br>        azure-agent:&lt;tag&gt;<br></code></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡è¯´æ˜ï¼š</p><table><thead><tr><th>å˜é‡å</th><th>å¿…éœ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>AZP_URL</td><td>æ˜¯</td><td>ä½ çš„ Azure DevOps server url. i.e. https://<host>/tfs</td></tr><tr><td>AZP_TOKEN</td><td>æ˜¯</td><td>å‰é¢ç”³è¯·çš„æœ‰è¶³å¤Ÿæƒé™çš„Personal Access Token</td></tr><tr><td>AZP_AGENT_NAME</td><td>æ˜¯</td><td>æ˜¾ç¤ºåœ¨Agent Poolä¸­çš„Agentåå­—</td></tr><tr><td>AZP_POOL</td><td>æ˜¯</td><td>Agent poolçš„åå­—</td></tr><tr><td>AZP_AGENTPACKAGE_URL</td><td>å¦</td><td>æ˜¾å¼æŒ‡å®šAzure AgentåŒ…çš„ä¸‹è½½åœ°å€</td></tr></tbody></table><p>å˜é‡â€œAZP_AGENTPACKAGE_URLâ€çš„é¢å¤–è¯´æ˜ï¼š<br>ä»å®¹å™¨çš„å¯åŠ¨è„šæœ¬â€œstart.shâ€ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®¹å™¨åœ¨å¯åŠ¨æ—¶ä¼šå»æŸä¸ªç½‘å€ä¸Šä¸‹è½½Azure AgentåŒ…ã€‚å¦‚æœå‘ç°ä¸‹è½½æ¯”è¾ƒæ…¢æˆ–è€…æ ¹æœ¬æ²¡æ³•ä¸‹è½½å¯¼è‡´å®¹å™¨å¯åŠ¨æ…¢æˆ–è€…å¤±è´¥ï¼Œå¯ä»¥æå‰è¿™ä¸ªåŒ…ä¸‹è½½ä¸‹æ¥å¹¶æ”¾åœ¨å†…éƒ¨çš„æŸä¸ªhttpæœåŠ¡å™¨ä¸Šï¼Œç„¶åé€šè¿‡å˜é‡â€œAZP_AGENTPACKAGE_URLâ€æŠŠè¿™ä¸ªhttpé“¾æ¥åœ°å€ä¼ è¿›å»ã€‚</p><p>é€šè¿‡æ‰§è¡Œâ€œstart.shâ€ä¸­çš„shellå‘½ä»¤å¯ä»¥è·å¾—Azure AgentåŒ…çš„åœ°å€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -LsS \<br>  -u user:&lt;your-azure-devops-pat&gt; \<br>  -H <span class="hljs-string">&#x27;Accept:application/json;api-version=3.0-preview&#x27;</span> \<br>  <span class="hljs-string">&quot;&lt;your-azure-devops-url&gt;/_apis/distributedtask/packages/agent?platform=linux-x64&quot;</span><br></code></pre></td></tr></table></figure><h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><p>åˆ©ç”¨Azure DevOps agentå»æ‰§è¡ŒJenkins Jobæ—¶ç»å¸¸ä¼šé‡åˆ°ä¸‹é¢çš„é—®é¢˜ï¼š</p><p>getaddrinfo ENOTFOUND â€¦</p><p>è§£å†³åŠæ³•æ˜¯åœ¨å¯åŠ¨å®¹å™¨æ—¶é€šè¿‡å‚æ•°â€œâ€“add-hostâ€å°†Jenkins Serverçš„åŸŸåå’ŒIPæ˜ å°„å…³ç³»åŠ åˆ°/etc/hostsä¸­ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ docker run -it -d --name some-agent \<br>        --add-host &lt;your jenkins server domain name&gt;:&lt;you jenkins server ip address&gt;<br>        -e AZP_URL=your-azure-devops-url \<br>        -e AZP_TOKEN=your-azure-devops-pat \<br>        -e AZP_AGENT_NAME=some-agent \<br>        -e AZP_POOL=your-azure-devops-agent-pool \<br>        -e AZP_AGENTPACKAGE_URL=the-zure-devops-agent-package \<br>        azure-agent:&lt;tag&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Azure DevOps</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯GitOps?</title>
    <link href="/2019/07/21/gitops/"/>
    <url>/2019/07/21/gitops/</url>
    
    <content type="html"><![CDATA[<p>[åŸæ–‡] <a href="https://www.weave.works/technologies/gitops/">https://www.weave.works/technologies/gitops/</a></p><p>æ‚¨æ˜¯å¦å¬è¯´è¿‡GitOpså¹¶ä¸”ä¹Ÿæƒ³çŸ¥é“å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†ä»‹ç»GitOpså·¥ä½œæµçš„åŸç†å’Œæ¨¡å¼ï¼Œä»¥åŠå¦‚ä½•å®ç°å®ƒä»¬ä»¥ä¾¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è§„æ¨¡åŒ–è¿è¡ŒKubernetesã€‚ æˆ‘ä»¬è¿˜å°†æè¿°GitOpsä¸åŸºç¡€æ¶æ„ä»£ç ï¼ˆIAC)ï¼Œé…ç½®ç®¡ç†å·¥å…·ä¹‹é—´çš„å·®å¼‚ï¼Œå½“ç„¶è¿˜å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†GitOpsæœ€ä½³å®è·µä½œä¸ºæ‚¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ã€‚</p><span id="more"></span><h1 id="GitOpsæ˜¯ä»€ä¹ˆ"><a href="#GitOpsæ˜¯ä»€ä¹ˆ" class="headerlink" title="GitOpsæ˜¯ä»€ä¹ˆ?"></a>GitOpsæ˜¯ä»€ä¹ˆ?</h1><p><img src="/2019/07/21/gitops/1.png"></p><p><strong>GitOps</strong> Kubernetesé›†ç¾¤ç®¡ç†å’Œåº”ç”¨ç¨‹åºäº¤ä»˜çš„ä¸€ç§æ–¹æ³•ã€‚å®ƒæ˜¯ç”¨Gitä½œä¸ºå£°æ˜å¼åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºçš„å•ä¸€äº‹å®æ¥æºã€‚é€šè¿‡å°†Gitä½œä¸ºäº¤ä»˜ç®¡é“çš„ä¸­å¿ƒï¼Œå¼€å‘å¯ä»¥é€šè¿‡æ‹‰å–è¯·æ±‚(Pull Request)æ¥åŠ é€Ÿå’Œç®€åŒ–Kubernetesåº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œè¿ç»´ä»»åŠ¡ã€‚</p><p><strong>ä¸€ç§æ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„æ“ä½œæ¨¡å¼</strong></p><p>GitOpså¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸¤ç‚¹:</p><ol><li>Kuberneteså’Œå…¶å®ƒäº‘åŸç”ŸæŠ€æœ¯çš„ä¸€ç§æ“ä½œæ¨¡å¼ï¼Œæä¾›ä¸€ç»„ç»Ÿä¸€éƒ¨ç½²ï¼Œç®¡ç†å’Œç›‘æ§å®¹å™¨åŒ–é›†ç¾¤å’Œåº”ç”¨ç¨‹åºçš„æœ€ä½³å®è·µã€‚</li><li>é¢å‘å¼€å‘è€…çš„ç®¡ç†åº”ç”¨ç¨‹åºçš„ç»éªŒï¼Œå°†ç«¯åˆ°ç«¯çš„CI/CDç®¡é“å’ŒGitå·¥ä½œæµåº”ç”¨äºè¿ç»´å’Œå¼€å‘ã€‚</li></ol><h1 id="GitOpsçš„ä¸»è¦ä¼˜ç‚¹"><a href="#GitOpsçš„ä¸»è¦ä¼˜ç‚¹" class="headerlink" title="GitOpsçš„ä¸»è¦ä¼˜ç‚¹"></a>GitOpsçš„ä¸»è¦ä¼˜ç‚¹</h1><p>å½“Gitä¸­æœ‰å˜æ›´å‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨åŒ–äº¤ä»˜ç®¡é“ä¼šè‡ªåŠ¨å˜æ›´ä½ çš„åŸºç¡€æ¶æ„ã€‚ç„¶è€ŒGitOpsæ¦‚å¿µè¿œä¸æ­¢äºæ­¤ - å®ƒä½¿ç”¨å·¥å…·å°†æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å®é™…ç”Ÿäº§çŠ¶æ€ä¸æºç ç®¡ç†å·¥å…·ä¸­çš„ä»£ç è¿›è¡Œæ¯”è¾ƒï¼Œå½“ä½ çš„é›†ç¾¤ä¸å®é™…çŠ¶æ€ä¸ç¬¦æ—¶ï¼Œç»™å‡ºæé†’ã€‚</p><p>é€šè¿‡åº”ç”¨GitOpsæœ€ä½³å®è·µï¼Œä½ çš„åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºä¼šæœ‰ä¸€ä¸ªâ€œäº‹å®æ¥æºâ€ï¼Œè¿™å°†æé«˜å¼€å‘å›¢é˜Ÿçš„é€Ÿåº¦å¹¶æé«˜ç³»ç»Ÿå¯é æ€§ã€‚</p><p>é‡‡ç”¨GitOpsæœ€ä½³å®è·µçš„å¥½å¤„æ˜¯æ·±è¿œçš„ï¼Œå¹¶æä¾›ï¼š</p><ol><li><p><strong>æé«˜ç”Ÿäº§åŠ›</strong><br>è‡ªåŠ¨åŒ–çš„æŒç»­éƒ¨ç½²åŠ ä¸Šé›†æˆçš„åé¦ˆæ§åˆ¶å›è·¯æå‡äº†å¹³å‡éƒ¨ç½²æ—¶é—´ã€‚ä½ çš„å›¢é˜Ÿæ¯å¤©èƒ½å¤Ÿæäº¤30åˆ°100å€çš„æ›´å¤šå˜æ›´ï¼Œå°†æ€»ä½“å¼€å‘è¾“å‡ºæé«˜2åˆ°3å€ã€‚</p></li><li><p><strong>å¢å¼ºå¼€å‘ä½“éªŒ</strong><br>æ¨é€ä»£ç è€Œä¸æ˜¯å®¹å™¨ã€‚å¼€å‘ä¸éœ€è¦æ·±å…¥äº†è§£Kuberneteså°±å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„å·¥å…·(æ¯”å¦‚Git)å¿«é€Ÿåœ°æ›´æ–°Kubernetesåº”ç”¨å’Œæ·»åŠ æ–°çš„åŠŸèƒ½ã€‚æ–°å…¥èŒçš„å¼€å‘èƒ½å¤Ÿåœ¨å‡ å¤©å†…è€Œä¸æ˜¯å‡ ä¸ªæœˆå†…å¿«é€Ÿåœ°æå‡å¼€å‘æ•ˆç‡ã€‚</p></li><li><p><strong>æé«˜ç¨³å®šæ€§</strong><br>å½“ä½ ä½¿ç”¨Gitå·¥ä½œæµç®¡ç†ä½ çš„é›†ç¾¤æ—¶ï¼Œä½ ä¸éœ€è¦é€šè¿‡Kuberneteså°±èƒ½å¤Ÿè‡ªåŠ¨è·å–ä¾¿äºå®¡æ ¸çš„é›†ç¾¤çš„æ‰€æœ‰å˜æ›´æ—¥å¿—ã€‚é€šè¿‡å®¡æ ¸è·Ÿè¸ªè°åœ¨ä½•æ—¶å˜æ›´äº†ä½ çš„é›†ç¾¤èƒ½å¤Ÿæ»¡è¶³SOC 2åˆè§„æ€§å¹¶èƒ½ç¡®ä¿ç¨³å®šæ€§ã€‚ </p></li><li><p><strong>é«˜å¯ç”¨æ€§</strong><br>å€ŸåŠ©Gitæ¢å¤/å›æ»šå’Œåˆ†å‰åŠŸèƒ½ï¼Œä½ å°†è·å¾—ç¨³å®šå¹¶å¯é‡å¤çš„å›æ»šåŠŸèƒ½ã€‚å› ä¸ºä½ é€šè¿‡Gitæè¿°äº†æ•´ä¸ªç³»ç»Ÿï¼Œä½ å°†æœ‰ä¸€ä¸ªå•ä¸€çš„äº‹å®æ¥æºç”¨æ¥ä»å´©æºƒä¸­æ¢å¤ï¼Œä»è€Œå°†ä½ çš„æ¢å¤æ—¶é—´(MTTR)ä»å‡ å°æ—¶é™åˆ°å‡ åˆ†é’Ÿã€‚</p></li><li><p><strong>ä¸€è‡´æ€§å’Œæ ‡å‡†åŒ–</strong><br>ç”±äºGitOpsæä¾›äº†ç»Ÿä¸€çš„æ¨¡å‹ç”¨æ¥å˜æ›´åŸºç¡€æ¶æ„ï¼Œåº”ç”¨ä»¥åŠKubernetes add-onï¼Œä½ å¯ä»¥åœ¨æ•´ä¸ªç»„ç»‡ä¸­å®ç°ä¸€è‡´çš„ç«¯åˆ°ç«¯çš„å·¥ä½œæµã€‚ä¸ä»…ä½ çš„æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ç®¡é“é€šè¿‡æ‹‰å–è¯·æ±‚(Pull Request)é©±åŠ¨ï¼Œä½ çš„æ“ä½œä»»åŠ¡é€šè¿‡Gitä¹Ÿå®Œå…¨å¯ä»¥é‡ç°ã€‚</p></li><li><p><strong>æ›´å¥å£®çš„å®‰å…¨ä¿è¯</strong><br>Gitçš„å¼ºæ­£ç¡®æ€§ä»¥åŠå®‰å…¨ä¿è¯(èƒŒåæ˜¯å¥å£®çš„ç”¨äºè¿½è¸ªå’Œç®¡ç†å˜æ›´çš„åŠ å¯†æŠ€æœ¯)ï¼Œä»¥åŠç­¾åå˜æ›´ä»¥è¯æ˜ä½œè€…èº«ä»½å’Œæ¥æºçš„èƒ½åŠ›æ˜¯å®‰å…¨å®šä¹‰é›†ç¾¤ç›®æ ‡çŠ¶æ€çš„å…³é”®ã€‚</p></li></ol><h1 id="GitOpsæ˜¯æ»¡è¶³äº‘åŸç”Ÿçš„æŒç»­äº¤ä»˜"><a href="#GitOpsæ˜¯æ»¡è¶³äº‘åŸç”Ÿçš„æŒç»­äº¤ä»˜" class="headerlink" title="GitOpsæ˜¯æ»¡è¶³äº‘åŸç”Ÿçš„æŒç»­äº¤ä»˜"></a>GitOpsæ˜¯æ»¡è¶³äº‘åŸç”Ÿçš„æŒç»­äº¤ä»˜</h1><p>GitOpsæ˜¯ä»DevOpsSite Reliability Engineering(ç«™ç‚¹å¯é æ€§å·¥ç¨‹)çš„æƒ³æ³•ä¸­é€æ¸æ¼”å˜å‡ºæ¥çš„ï¼Œè¿™äº›æƒ³æ³•å§‹äº<a href="https://martinfowler.com/articles/continuousIntegration.html">2016å¿µMartin Fowlerå¯¹æŒç»­é›†æˆçš„å…¨é¢æ¦‚è¿°</a></p><h2 id="è‡ªç”±é€‰æ‹©æ‰€éœ€çš„å·¥å…·"><a href="#è‡ªç”±é€‰æ‹©æ‰€éœ€çš„å·¥å…·" class="headerlink" title="è‡ªç”±é€‰æ‹©æ‰€éœ€çš„å·¥å…·"></a>è‡ªç”±é€‰æ‹©æ‰€éœ€çš„å·¥å…·</h2><p>ä½œä¸ºCI/CDç®¡é“çš„ä¸€ä¸ªå·¥ä½œæµï¼ŒGitOpsè¢«<a href="https://martinfowler.com/articles/continuousIntegration.html">æè¿°ä¸ºå¼€å‘è¿‡ç¨‹çš„åœ£æ¯</a>ã€‚ç”±äºæ²¡æœ‰å•ä¸€çš„å·¥å…·èƒ½å¤Ÿå®ŒæˆCI/CDç®¡é“ä¸­æ‰€æœ‰çš„å·¥ä½œï¼ŒGitOpså¯ä»¥è®©ä½ ä¸ºæ¯ä¸ªéƒ¨åˆ†é€‰æ‹©æœ€ä½³çš„å·¥å…·ã€‚ä½ å¯ä»¥ä»å¼€æºç”Ÿæ€ç³»ç»Ÿé€‰æ‹©ä¸€ç»„å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä»é—­æºä¸­é€‰æ‹©ä¸€ç»„å·¥å…·ï¼Œä½ ç”šè‡³å¯ä»¥æ ¹æ®ä½ çš„å…·ä½“æƒ…å†µï¼Œç»„åˆä½¿ç”¨å®ƒä»¬ã€‚åˆ›å»ºCI/CDç®¡é“æœ€å›°éš¾çš„éƒ¨åˆ†æ˜¯å°†æ‰€æœ‰çš„å·¥å…·ç»„åˆåœ¨ä¸€èµ·ã€‚</p><p>æ— è®ºä½ é€‰æ‹©ä»€ä¹ˆå·¥å…·æ¥æ„å»ºäº¤ä»˜ç®¡é“ï¼Œé€šè¿‡Git(æˆ–ä»»ä½•ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ)åº”ç”¨GitOpsçš„æœ€ä½³å®è·µéƒ½åº”è¯¥æ˜¯ä½ æµç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨åˆ†ã€‚è¿™æ ·åšå¯ä»¥è½»æ¾åœ°è¿‡æ¸¡åˆ°æŒç»­äº¤ä»˜ã€‚ä¸è®ºæ˜¯ä»æŠ€æœ¯è§’åº¦è¿˜æ˜¯ä»æ–‡åŒ–è§’åº¦éƒ½åº”è¯¥å¦‚æ­¤ã€‚</p><h1 id="GitOpsçš„åŸåˆ™"><a href="#GitOpsçš„åŸåˆ™" class="headerlink" title="GitOpsçš„åŸåˆ™"></a>GitOpsçš„åŸåˆ™</h1><p>å¼€å§‹ä½¿ç”¨GitOpså·¥ä½œæµç®¡ç†ä½ çš„é›†ç¾¤ï¼Œå¿…é¡»å…·å¤‡ä»¥ä¸‹æ¡ä»¶ï¼š</p><p><strong>1. æ•´ä¸ªç³»ç»Ÿä»¥å£°æ˜æ–¹å¼æè¿°</strong><br>Kubernetesåªæ˜¯ä¼—å¤šç°ä»£äº‘åŸç”Ÿå·¥å…·çš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒä»¬æ˜¯å¯â€œå£°æ˜çš„â€ï¼Œå¯ä»¥è¢«è§†ä¸ºä»£ç ã€‚å¯å£°æ˜æ„å‘³ç€é…ç½®æ˜¯ç”±ä¸€ç»„äº‹å®è€Œä¸æ˜¯ä¸€ç»„æŒ‡ä»¤æ¥ä¿è¯çš„ã€‚å°†ä½ çš„åº”ç”¨çš„å£°æ˜ç‰ˆæœ¬ç®¡ç†åˆ°Gitï¼Œä½ åªæœ‰ä¸€ä¸ªäº‹å®æ¥æºã€‚ä½ å¯ä»¥è½»æ¾åœ°éƒ¨ç½²å’Œå›æ»šKubernetesçš„åº”ç”¨ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå½“ç¾éš¾å‘ç”Ÿæ—¶ï¼Œä½ å¯ä»¥å¿«é€Ÿå¯é åœ°é‡ç°é›†ç¾¤çš„åŸºç¡€æ¶æ„ã€‚</p><p><strong>2. åœ¨Gitä¸­ç®¡ç†è§„èŒƒçš„ç›®æ ‡ç³»ç»ŸçŠ¶æ€ç‰ˆæœ¬</strong><br>é€šè¿‡å°†ä½ ç³»ç»Ÿçš„å£°æ˜å­˜å‚¨åœ¨ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¹¶ä½œä¸ºä½ çš„è§„èŒƒæ€§äº‹å®æ¥æºï¼Œä½ å¯ä»¥ä»ä¸€ä¸ªåœ°æ–¹è·å–å’Œé©±åŠ¨æ‰€æœ‰çš„å†…å®¹ã€‚è¿™ç®€åŒ–äº†å›æ»šæ“ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨â€œGit Revertâ€æ¥å›æ»šåˆ°ä¹‹å‰çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚å€ŸåŠ©Gitå‡ºè‰²çš„å®‰å…¨ä¿éšœï¼Œä½ å¯ä»¥ä½¿ç”¨SSHå¯†é’¥å¯¹æäº¤è¿›è¡Œç­¾åï¼Œä»è€Œå¯¹ä»£ç çš„ä½œè€…å’Œæ¥æºå®æ–½å¼ºæœ‰åŠ›çš„å®‰å…¨ä¿éšœã€‚ </p><p><strong>3. æ‰¹å‡†çš„æ›´æ”¹å¯ä»¥è‡ªåŠ¨åº”ç”¨äºç³»ç»Ÿ</strong><br>ä¸€æ—¦å°†å£°æ˜çš„çŠ¶æ€ä¿å­˜åœ¨Gitä¸­ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å…è®¸å¯¹è¯¥çŠ¶æ€çš„ä»»ä½•æ›´æ”¹éƒ½èƒ½å¤Ÿè¢«è‡ªåŠ¨åº”ç”¨äºä½ çš„ç³»ç»Ÿã€‚æœ‰æ„ä¹‰çš„æ˜¯ï¼Œä½ ä¸éœ€è¦é›†ç¾¤çš„è´¦å·æ¥æ›´æ”¹ä½ çš„ç³»ç»Ÿã€‚å€ŸåŠ©äºGitOpsï¼ŒçŠ¶æ€å®šä¹‰å­˜åœ¨äºè¿™ä¸ªéš”ç¦»ç¯å¢ƒä¹‹å¤–ã€‚è¿™ä½¿ä½ å¯ä»¥è§£è€¦åšä»€ä¹ˆä¸å¦‚ä½•åšã€‚</p><p><strong>4. è½¯ä»¶ä»£ç†ç¡®ä¿å·®å¼‚çš„æ­£ç¡®æ€§å¹¶æŠ¥è­¦</strong><br>ä¸€æ—¦ä½ çš„ç³»ç»ŸçŠ¶æ€è¢«å£°æ˜å¹¶ä¿å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œæ¯å½“å®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ç¬¦ï¼Œè½¯ä»¶ä»£ç†å°±å¯ä»¥é€šçŸ¥ä½ ã€‚ä»£ç†çš„ä½¿ç”¨è¿˜å¯ä»¥ç¡®ä¿ä½ çš„æ•´ä¸ªç³»ç»Ÿæ˜¯è‡ªä¿®å¤çš„ã€‚é€šè¿‡è‡ªä¿®å¤ï¼Œä¸ä»…ä»…æ˜¯æŒ‡èŠ‚ç‚¹æˆ–podå¤±è´¥æ—¶(Kubernetesä¼šå¤„ç†è¿™ç±»å¤±è´¥)ï¼Œè€Œæ˜¯åœ¨æ›´å¹¿æ³›çš„æ„ä¹‰ä¸Šï¼Œæ¯”å¦‚äººä¸ºé”™è¯¯çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè½¯ä»¶ä»£ç†å……å½“äº†ä½ çš„æ“ä½œçš„åé¦ˆå’Œæ§åˆ¶é—­ç¯ã€‚</p><h1 id="Gitèµ‹èƒ½åŸºç¡€æ¶æ„å³ä»£ç -IAC-å·¥å…·"><a href="#Gitèµ‹èƒ½åŸºç¡€æ¶æ„å³ä»£ç -IAC-å·¥å…·" class="headerlink" title="Gitèµ‹èƒ½åŸºç¡€æ¶æ„å³ä»£ç (IAC)å·¥å…·"></a>Gitèµ‹èƒ½åŸºç¡€æ¶æ„å³ä»£ç (IAC)å·¥å…·</h1><p>Kubernetesåªæ˜¯ä¼—å¤šç°ä»£äº‘åŸç”Ÿå·¥å…·çš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒä»¬æ˜¯å¯â€œå£°æ˜çš„â€ï¼Œå¯ä»¥è¢«è§†ä¸ºä»£ç ã€‚å¯å£°æ˜æ„å‘³ç€é…ç½®æ˜¯ç”±ä¸€ç»„äº‹å®è€Œä¸æ˜¯ä¸€ç»„æŒ‡ä»¤æ¥ä¿è¯çš„ã€‚ä¾‹å¦‚ï¼Œâ€œæœ‰åä¸ªredisæœåŠ¡å™¨â€ï¼Œè€Œä¸æ˜¯â€œå¯åŠ¨åä¸ªredisæœåŠ¡å™¨â€ï¼Œå¹¶ä¸”æç¤ºæˆ‘å¯è¡Œã€‚</p><p>å€ŸåŠ©å£°æ˜å¼å·¥å…·ï¼Œä½ çš„æ•´ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥åœ¨Gitä¸­è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚é€šè¿‡ä½¿ç”¨Gitä½œä¸ºäº‹å®æ¥æºï¼Œä½ å¯ä»¥è½»æ¾åœ°éƒ¨ç½²å’Œå›æ»šKubernetesçš„åº”ç”¨ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå½“ç¾éš¾å‘ç”Ÿæ—¶ï¼Œä½ å¯ä»¥ä»Gitä¸­å¿«é€Ÿå¯é åœ°é‡ç°é›†ç¾¤çš„åŸºç¡€æ¶æ„ã€‚</p><h2 id="IACå·¥å…·-vs-GitOps"><a href="#IACå·¥å…·-vs-GitOps" class="headerlink" title="IACå·¥å…· vs. GitOps"></a>IACå·¥å…· vs. GitOps</h2><p>ä½œä¸ºèƒ½å¤ŸæŒ‰è¦æ±‚åˆ›å»ºæœåŠ¡å™¨çš„åŸºç¡€æ¶æ„å³ä»£ç å·¥å…·å·²ç»å­˜åœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´äº†ã€‚è¿™äº›å·¥å…·äº§ç”Ÿäº†ä¿æŒåŸºç¡€æ¶æ„åŠä»£ç é…ç½®ç‰ˆæœ¬åŒ–ï¼Œå¯å¤‡ä»½åŒ–ä»¥åŠå¯é‡ç°çš„æ¦‚å¿µã€‚</p><p>ä½†æ˜¯ç°åœ¨ç”±äºKuberneteså‡ ä¹å®Œå…¨æ˜¯å£°æ˜æ€§çš„ï¼Œç»“åˆä¸å¯å˜å®¹å™¨ï¼Œå¯ä»¥å°†è¿™äº›æ¦‚å¿µä¸­çš„ä¸€äº›æ‰©å±•åˆ°ç®¡ç†åº”ç”¨ç¨‹åºåŠå…¶æ“ä½œç³»ç»Ÿã€‚</p><p>èƒ½å¤Ÿç®¡ç†å’Œæ¯”è¾ƒåŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ï¼Œä»¥ä¾¿å€ŸåŠ©ä½¿ç”¨Gitå®Œæ•´çš„å®¡è®¡è·Ÿè¸ªï¼Œä½ èƒ½æµ‹è¯•ï¼Œéƒ¨ç½²ï¼Œå›æ»šå’Œå‰æ»šï¼Œè¿™æ˜¯GitOpsç†å¿µåŠå…¶æœ€ä½³å®è·µå†…å®¹ã€‚è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºKuberneteså‡ ä¹å®Œå…¨é€šè¿‡å£°æ˜æ€§é…ç½®è¿›è¡Œç®¡ç†ï¼Œä»¥åŠå®¹å™¨ä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚</p><p>åœ¨Weaveworksï¼Œæˆ‘ä»¬ä½¿ç”¨Terraformå’ŒAnsibleæ¥åˆ›å»ºæœåŠ¡å™¨ã€‚æˆ‘ä»¬å°†é‚£äº›é…ç½®æ–‡ä»¶ä¿å­˜åœ¨Gitä¸­è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚IACå·¥å…·åŠå…¶ç›¸å…³çš„é…ç½®æ–‡ä»¶æ„æˆäº†æˆ‘ä»¬GitOpså·¥ä½œæµçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå¦‚æœå‘ç”Ÿç¾éš¾ï¼Œå¯ä»¥åšåˆ°è¿‘ä¹å®æ—¶çš„é›†ç¾¤æ¢å¤ã€‚é€šè¿‡<a href="http://www.weave.works/technologies/gitops-frequently-asked-questions">GitOps FAQ</a>äº†è§£æ›´å¤šçš„åŸºç¡€æ¶æ„åŠä»£ç ä¸GitOpsçš„åŒºåˆ«ã€‚</p><h2 id="æˆ‘çš„ç³»ç»Ÿä¸äº‹å®æ¥æºå‡ºç°å·®å¼‚è¯¥å¦‚ä½•ï¼Ÿ"><a href="#æˆ‘çš„ç³»ç»Ÿä¸äº‹å®æ¥æºå‡ºç°å·®å¼‚è¯¥å¦‚ä½•ï¼Ÿ" class="headerlink" title="æˆ‘çš„ç³»ç»Ÿä¸äº‹å®æ¥æºå‡ºç°å·®å¼‚è¯¥å¦‚ä½•ï¼Ÿ"></a>æˆ‘çš„ç³»ç»Ÿä¸äº‹å®æ¥æºå‡ºç°å·®å¼‚è¯¥å¦‚ä½•ï¼Ÿ</h2><p>å£°æ˜å¼å·¥å…·å…è®¸ä½ åœ¨Gitä¸­æè¿°æœŸæœ›çš„çœŸå®çŠ¶æ€ã€‚ä½†æ˜¯åœ¨å®é™…ç³»ç»Ÿä¸­çš„çœŸå®çŠ¶æ€å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œè¿™å¯èƒ½ä¸ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä¸­æè¿°çš„çŠ¶æ€æœ‰å·®åˆ«ã€‚</p><ul><li>ä½ å¦‚ä½•çŸ¥é“å®é™…ç³»ç»Ÿè¾¾åˆ°äº†æœŸæœ›çŠ¶æ€ï¼Ÿ  </li><li>å½“æœ‰å·®å¼‚æ—¶ï¼Œä½ èƒ½å¾—åˆ°é€šçŸ¥å—ï¼Ÿ  </li><li>æœ‰ä»€ä¹ˆæœºåˆ¶ç±»ä¼¼äºâ€œç…¤çŸ¿ä¸­çš„é‡‘ä¸é›€â€åœ¨ä½ é‡åˆ°éº»çƒ¦æ—¶é€šçŸ¥ä½ ï¼Ÿ</li><li>ä½ å¦‚ä½•è§¦å‘é›†ç¾¤ä¸ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä¹‹å‰çš„åŒæ­¥ï¼Ÿ</li></ul><p>è¿™é‡Œæœ‰ç°æˆçš„æŠ€æœ¯.</p><p>IACå·¥å…·ï¼Œæ¯”å¦‚Chefï¼ŒPuppetå’ŒAnsibleæ”¯æŒâ€œå·®å¼‚è­¦å‘Šâ€åŠŸèƒ½ã€‚è¿™æœ‰åŠ©äºè¿ç»´äººå‘˜çŸ¥é“ä½•æ—¶åº”è¯¥é‡‡å–è¡ŒåŠ¨å°†å®é™…ç³»ç»Ÿæ”¶æ•›åˆ°æœŸæœ›çŠ¶æ€ï¼ˆé€šè¿‡é…ç½®è„šæœ¬å®šä¹‰çš„ï¼‰ã€‚ç”šè‡³æœ€è¿‘ï¼Œæœ€ä½³å®è·µæ˜¯éƒ¨ç½²ä¸å¯å˜é•œåƒï¼ˆæ¯”å¦‚å®¹å™¨ï¼‰ï¼Œä»¥ä¾¿å°½å¯èƒ½å‡å°‘å·®å¼‚ã€‚</p><p>åœ¨â€œGitOpsâ€æ¨¡å‹ä¸­ï¼Œåœ¨ä¸€ç»„ç”¨æ¥æ¯”è¾ƒæœŸæœ›çŠ¶æ€å’Œå®é™…çŠ¶æ€çš„â€œæ¯”è¾ƒâ€å’Œâ€œåŒæ­¥â€å·¥å…·ï¼ˆ<a href="https://github.com/weaveworks/kubediff">kubediff</a>, ä»¥åŠ terradiff å’Œansiblediffï¼‰çš„è¾…åŠ©ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨Gitè§£å†³å·®å¼‚å’Œæ”¶æ•›ã€‚</p><h2 id="GitOpsæ„å»ºåœ¨ä¸å¯å˜åŸºç¡€æ¶æ„ä¹‹ä¸Š"><a href="#GitOpsæ„å»ºåœ¨ä¸å¯å˜åŸºç¡€æ¶æ„ä¹‹ä¸Š" class="headerlink" title="GitOpsæ„å»ºåœ¨ä¸å¯å˜åŸºç¡€æ¶æ„ä¹‹ä¸Š"></a>GitOpsæ„å»ºåœ¨ä¸å¯å˜åŸºç¡€æ¶æ„ä¹‹ä¸Š</h2><p>GitOpså……åˆ†åˆ©ç”¨ä¸æ–­å‘å±•çš„ä¸å¯å˜åŸºç¡€æ¶æ„å’Œå£°æ˜å¼å®¹å™¨ç¼–æ’ã€‚åœ¨Weaveworksï¼Œæˆ‘ä»¬ä¸€å¤©éƒ¨ç½²å¤šæ¬¡ã€‚ä¸ºäº†é™ä½éƒ¨ç½²åå˜æ›´çš„é£é™©ï¼Œæ— è®ºæ˜¯æœ‰æ„çš„è¿˜æ˜¯å¶ç„¶çš„â€œé…ç½®åå·®â€ï¼Œæˆ‘ä»¬å¿…é¡»ç»´æŠ¤ä¸€ä¸ªå¯é‡ç°ä¸”å¯é çš„éƒ¨ç½²è¿‡ç¨‹ã€‚</p><p>æˆ‘ä»¬æ•´ä¸ªç³»ç»Ÿçš„æœŸæœ›çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯â€œäº‹å®æ¥æºâ€ï¼‰æ˜¯åœ¨Gitä¸­æè¿°çš„ã€‚æˆ‘ä»¬ä½¿ç”¨å®¹å™¨å®ç°ä¸å¯å˜æ€§ï¼Œä»¥åŠTerraformå’ŒAnsibleç­‰ä¸åŒçš„äº‘åŸç”Ÿå·¥å…·æ¥è‡ªåŠ¨åŒ–å’Œç®¡ç†æˆ‘ä»¬çš„é…ç½®ã€‚è¿™äº›å·¥å…·ä¸å®¹å™¨ä»¥åŠKuberneteså£°æ˜æ€§çš„æœ¬è´¨ä¸€èµ·æä¾›äº†åœ¨å‘ç”Ÿç¾éš¾æ—¶å®Œæ•´æ¢å¤æ‰€éœ€è¦çš„ä¸œè¥¿ã€‚</p><h2 id="ä¸IACå·¥å…·åä½œ"><a href="#ä¸IACå·¥å…·åä½œ" class="headerlink" title="ä¸IACå·¥å…·åä½œ"></a>ä¸IACå·¥å…·åä½œ</h2><p>å½“ä½ å°†GitOpsåŸåˆ™åº”ç”¨äºâ€œæ‰€æœ‰æ–¹é¢â€æ—¶ï¼Œé™¤äº†æŠ¥è­¦è§„åˆ™å’Œä»ªè¡¨ç›˜ä¹‹å¤–åŒ…æ‹¬æœºå™¨é…ç½®ï¼Œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œæ‰€æœ‰è¿™äº›éƒ½ä¿å­˜åœ¨ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿä¸­ã€‚</p><p>é™¤éé€šè¿‡Gitï¼Œå¦åˆ™ä¸éœ€è¦è®¿é—®æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿã€‚ä»»ä½•ä¸€ç»„æ›´æ”¹éƒ½å¯ä»¥æ˜¯åŸå­æ€§çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿåšç›¸åº”åœ°æ¯”è¾ƒã€‚Gitè®°å½•ä¹Ÿä¸ä»…ä»…æ˜¯å®¡è®¡æ—¥å¿—ï¼Œè¿˜æ˜¯å¯ç”¨äºåœ¨ä»»ä½•å¿«ç…§ä¹‹å‰æ¥å›æ»šåŠ¨çš„äº‹ç‰©æ—¥å¿—ã€‚</p><h1 id="Weave-Cloudçš„æŒç»­äº¤ä»˜å’ŒGitOpså·¥ä½œæµ"><a href="#Weave-Cloudçš„æŒç»­äº¤ä»˜å’ŒGitOpså·¥ä½œæµ" class="headerlink" title="Weave Cloudçš„æŒç»­äº¤ä»˜å’ŒGitOpså·¥ä½œæµ"></a>Weave Cloudçš„æŒç»­äº¤ä»˜å’ŒGitOpså·¥ä½œæµ</h1><p>åœ¨æˆ‘ä»¬çš„äº§å“<a href="https://cloud.weave.works/signup">Weave Cloud</a>ä¸­, GitOpsçš„æ ¸å¿ƒæœºåˆ¶å·²ç»å†…ç½®äºCI/CDçš„å·¥å…·ä¸­äº†ï¼Œå…³é”®éƒ¨åˆ†æ˜¯æŒç»­éƒ¨ç½²(CD)ï¼Œ<a href="https://github.com/weaveworks/flux/blob/master/site/introduction.md#automated-git-cluster-synchronisation">æ”¯æŒGit-clusteråŒæ­¥</a>ã€‚</p><p>Weave Cloudæ˜¯ä¸“é—¨ä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå’Œå£°æ˜å¼åº”ç”¨ç¨‹åºæ ˆè®¾è®¡çš„ã€‚å›¢é˜Ÿä¸­çš„æ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯èƒ½ç†Ÿæ‚‰Gitä¸”èƒ½å¤Ÿåˆ›å»ºæ‹‰å–è¯·æ±‚(Pull Request)ã€‚ç°åœ¨ï¼Œä»–ä»¬ä¹Ÿèƒ½å¤Ÿä½¿ç”¨GitåŠ é€Ÿå¹¶ç®€åŒ–Kubernetesåº”ç”¨çš„éƒ¨ç½²ã€‚</p><p>ä»¥ä¸‹æ˜¯ä»¥å…¸å‹çš„åˆ›å»ºå’Œæ›´æ–°ä¸€ä¸ªæ–°åŠŸèƒ½çš„å¼€å‘æµç¨‹ï¼š</p><ol><li>æ¨é€ä¸€ä¸ªæ–°åŠŸèƒ½çš„æ‹‰å–è¯·æ±‚(Pull Request)åˆ°GitHubè¿›è¡Œå®¡æ ¸ã€‚</li><li>ä»£ç è¢«åŒäº‹å®¡æ ¸å¹¶æ‰¹å‡†åï¼Œè¢«åˆå¹¶åˆ°Gitã€‚</li><li>Gitåˆå¹¶è§¦å‘CIæµæ°´çº¿ï¼Œé€šè¿‡ä¸€ç³»åˆ—æµ‹è¯•åï¼Œæ–°æ„å»ºå‡ºæ¥çš„é•œåƒè¢«å­˜å‚¨åˆ°é•œåƒä»“åº“é‡Œã€‚</li><li>Weave Cloudçš„â€œDeployment Automatorâ€ æ£€æµ‹åˆ°é•œåƒä»“åº“ä¸­æœ‰æ–°çš„é•œåƒï¼Œä»ä»“åº“ä¸­æ‹‰å–æ–°çš„é•œåƒå¹¶è·Ÿæ–°é…ç½®ä»“åº“ä¸­çš„YAMLæ–‡ä»¶ã€‚</li><li>Weave Cloudçš„â€œDeployment Synchronizerâ€ (è¿è¡Œåœ¨é›†ç¾¤ä¸­)ï¼Œæ£€æµ‹åˆ°é›†ç¾¤æœ‰æ›´æ–°ï¼Œå®ƒä»é…ç½®ä»“åº“ä¸­æ‹‰å–å˜æ›´åçš„æ¸…å•å¹¶å°†æ–°çš„åŠŸèƒ½éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</li></ol><p><strong>æ”¯æŒGitOpsçš„CI/CDç®¡é“ï¼š</strong></p><p><img src="/2019/07/21/gitops/1.png"></p><h2 id="ä½¿ç”¨Operatoræ¨¡å¼å®ç°çš„Kubernetesæ§åˆ¶å™¨"><a href="#ä½¿ç”¨Operatoræ¨¡å¼å®ç°çš„Kubernetesæ§åˆ¶å™¨" class="headerlink" title="ä½¿ç”¨Operatoræ¨¡å¼å®ç°çš„Kubernetesæ§åˆ¶å™¨"></a>ä½¿ç”¨Operatoræ¨¡å¼å®ç°çš„Kubernetesæ§åˆ¶å™¨</h2><p>Weave Cloudå®ç°äº†ä»¥è‡ªå®šä¹‰çš„æ§åˆ¶å™¨ç”¨æ¥ç›‘å¬å’ŒåŒæ­¥ä½ çš„Kubernetesé›†ç¾¤ã€‚æ§åˆ¶å™¨æ˜¯ä½¿ç”¨Operatoræ¨¡å¼å®ç°çš„ï¼Œæœ‰ä¸¤ä¸ªå±‚é¢çš„æ„ä¹‰ï¼šé¦–å…ˆï¼Œå®ƒæ›´å®‰å…¨ï¼›å…¶æ¬¡ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†å¤æ‚çš„æ˜“é”™çš„ä»»åŠ¡ï¼Œæ¯”å¦‚å¿…é¡»æ‰‹åŠ¨æ›´æ–°YAMLæ¸…å•ã€‚</p><p>é€šè¿‡ä½¿ç”¨Operatoræ¨¡å¼ï¼Œä»£ç†ä¼šä»£è¡¨é›†ç¾¤ç›‘æ§è‡ªå®šä¹‰èµ„æºå˜æ›´äº‹ä»¶ï¼Œä»¥ä¾¿éƒ¨ç½²è¿™äº›å˜æ›´ã€‚ä»£ç†è´Ÿè´£åŒæ­¥Gitä¸é›†ç¾¤ï¼Œå¹¶ä¸”ä¸ºä½ çš„å›¢é˜Ÿæä¾›äº†ä¸€ç§å®ç°æŒç»­éƒ¨ç½²çš„ç®€å•æ–¹æ³•ã€‚</p><h2 id="æ‹‰-vs-æ¨ç®¡é“"><a href="#æ‹‰-vs-æ¨ç®¡é“" class="headerlink" title="æ‹‰ vs æ¨ç®¡é“"></a>æ‹‰ vs æ¨ç®¡é“</h2><p><strong>æ¨ç®¡é“</strong><br>ç›®å‰å¤§éƒ¨åˆ†CI/CDå·¥å…·ä½¿ç”¨æ¨æ¨¡å‹ã€‚åŸºäºæ¨æ¨¡å‹çš„ç®¡é“æ„å‘³ç€ä»£ç ä»CIç³»ç»Ÿå¼€å§‹ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„è„šæœ¬æˆ–è€…æ‰‹åŠ¨ä½¿ç”¨â€œkubectlâ€å°†å˜æ›´æ¨åˆ°Kubernetesé›†ç¾¤ã€‚</p><p>ä½ ä¸å¸Œæœ›ä½¿ç”¨CIç³»ç»Ÿè§¦å‘éƒ¨ç½²æˆ–è€…é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨éƒ¨ç½²ï¼ŒåŸå› æ˜¯å¯èƒ½åœ¨é›†ç¾¤ä¹‹å¤–æ³„éœ²è´¦å·ã€‚è™½ç„¶å¯ä»¥ä¿æŠ¤ä½ çš„CI/CDè„šæœ¬å’Œå‘½ä»¤è¡Œï¼Œä½†ä½ æ˜¯åœ¨é›†ç¾¤ä¿¡ä»»åŸŸä¹‹å¤–å·¥ä½œã€‚è¿™é€šå¸¸ä¸æ˜¯å¥½çš„åšæ³•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆCIç³»ç»Ÿèƒ½è¢«ä¸ºç”Ÿäº§ç¯å¢ƒæ”»å‡»çš„è½½ä½“ã€‚</p><p>å…·æœ‰é›†ç¾¤å¤–éƒ¨è¯»/å†™æƒé™çš„æ¨å¼çš„ç®¡é“ï¼š<br><img src="/2019/07/21/gitops/2.png"></p><p>åœ¨Weave Cloudä¸­ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ä¿å­˜è´¦å·å¹¶æ‹‰å–é•œåƒï¼š<br><img src="/2019/07/21/gitops/3.png"></p><p><strong>Weave Cloudæ‹‰ç®¡é“</strong><br>Weave Cloudä½¿ç”¨ç”±ä¸¤ä¸ªå…³é”®ç»„ä»¶ç»„æˆçš„æ‹‰å–ç­–ç•¥ï¼šä¸€ä¸ªæ˜¯ç›‘æµ‹é•œåƒä»“åº“çš„â€Deployment Automatorâ€å’Œä¸€ä¸ªé›†ç¾¤ä¸­ä»¥ç»´æŒå…¶çŠ¶æ€çš„â€Deployment Synchronizerâ€ã€‚</p><p>åœ¨æˆ‘ä»¬æ‹‰å–ç®¡é“æ¨¡å¼çš„ä¸­å¿ƒæ˜¯æ¸…å•ï¼ˆæˆ–é…ç½®ä»“åº“ï¼‰çš„å•ä¸€äº‹å®æ¥æºã€‚å¼€å‘å°†ä»–ä»¬çš„æ›´æ–°ä»£ç æ¨é€åˆ°ä»£ç ä»“åº“ï¼ŒCIå·¥å…·è·å–æ›´æ”¹å¹¶æœ€ç»ˆæ„å»ºå‡ºDockeré•œåƒã€‚Weave Cloudçš„â€œDeployment Automatorâ€æ£€æµ‹åˆ°æ–°çš„é•œåƒï¼Œä»é•œåƒä»“åº“ä¸­æ‹‰å–æ–°çš„é•œåƒå¹¶æ›´æ–°é…ç½®ä»“åº“ä¸­çš„YAMLé…ç½®ã€‚â€œDeployment Synchronizerâ€æ£€æµ‹åˆ°é›†ç¾¤å·²ç»è¿‡æœŸï¼Œå¹¶ä»é…ç½®ä»“åº“ä¸­æ‹‰å–æ›´æ”¹çš„æ¸…å•ï¼Œå¹¶å°†æ–°çš„é•œåƒéƒ¨ç½²åˆ°é›†ç¾¤ã€‚</p><p><strong>å®‰è£…åœ¨é›†ç¾¤ä¸­çš„Weave Cloudéƒ¨ç½²ä»£ç†</strong><br>ä½¿ç”¨ç¾¤é›†å†…éƒ¨çš„Deployment Synchronizerï¼Œä½ çš„ç¾¤é›†è´¦å·ä¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¹‹å¤–å…¬å¼€ã€‚ ä¸€æ—¦Weave Cloudä»£ç†å®‰è£…åˆ°ä½ çš„é›†ç¾¤å¹¶ä¸”ä¸ä½ çš„Gitä»“åº“å·²è¿æ¥ï¼Œä½ çš„ç”Ÿäº§ç¯å¢ƒä¸­çš„ä»»ä½•æ›´æ”¹éƒ½å°†é€šè¿‡å…·æœ‰å®Œå…¨å›æ»šçš„Gitæ‹‰è¯·æ±‚(Pull Request)ä»¥åŠGitæä¾›çš„æ–¹ä¾¿å®¡è®¡æ—¥å¿—å®Œæˆã€‚<br><img src="/2019/07/21/gitops/4.png"></p><p><strong>å¯è§‚å¯Ÿæ€§æ˜¯éƒ¨ç½²çš„å‚¬åŒ–å‰‚</strong><br>é€šè¿‡Kubernetesï¼ŒGitOpså¯ä»¥é€šè¿‡æ‹‰å–è¯·æ±‚(Pull Request)ç®¡ç†åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºã€‚ä½†æ˜¯GitOpså·¥ä½œæµå’Œå¯è§‚å¯Ÿæ€§å¦‚ä½•ååŒå·¥ä½œï¼Ÿ</p><p>é€šè¿‡GitOpså·¥ä½œæµå’Œå®æ—¶å¯è§‚å¯Ÿæ€§ï¼Œä½ çš„å¼€å‘å›¢é˜Ÿå¯ä»¥åœ¨éƒ¨ç½²ä»»ä½•æ–°åŠŸèƒ½ä¹‹å‰åšå‡ºå…³é”®å†³ç­–ã€‚ç”±äºåœ¨å‘å¸ƒä¹‹å‰ä½ å¯ä»¥åœ¨æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­å®æ—¶è§‚å¯Ÿå³å°†å‘å¸ƒçš„æœåŠ¡ï¼Œè¿™æ„å‘³ç€ä½ èƒ½å¤Ÿè‡ªä¿¡ï¼Œå¿«é€Ÿåœ°éƒ¨ç½²å¹¶äº¤ä»˜æ›´é«˜è´¨é‡çš„åŠŸèƒ½ã€‚</p><p>å¯è§‚å¯Ÿæ€§å¯ä»¥è¢«è§†ä¸ºKubernetes<a href="https://continuousdelivery.com/">æŒç»­äº¤ä»˜</a>å‘¨æœŸçš„ä¸»è¦é©±åŠ¨å› ç´ ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒæè¿°äº†ä»»ä½•ç»™å®šæ—¶é—´çš„ç³»ç»Ÿå®é™…è¿è¡ŒçŠ¶æ€ã€‚è§‚å¯Ÿè¿è¡Œç³»ç»Ÿä»¥ä¾¿ç†è§£å’Œæ§åˆ¶å®ƒã€‚æ–°åŠŸèƒ½å’Œä¿®å¤è¢«æ¨é€åˆ°Gitå¹¶è§¦å‘éƒ¨ç½²ç®¡é“ï¼Œä½•æ—¶å‡†å¤‡å‘å¸ƒå¯ä»¥é€šè¿‡å®æ—¶è§‚å¯Ÿæ­£åœ¨è¿è¡Œçš„é›†ç¾¤ã€‚æ­¤æ—¶ï¼Œæ ¹æ®æ­¤åé¦ˆï¼Œå¼€å‘äººå‘˜å¯ä»¥è¿”å›åˆ°ç®¡é“çš„å¼€å§‹ï¼Œæˆ–è€…éƒ¨ç½²å¹¶å‘å¸ƒåˆ°äº§å“é›†ç¾¤ä¸­ã€‚</p><p>GitOpsæ˜¯é¢å‘å‘å¸ƒçš„æ“ä½œå’ŒåŠŸèƒ½æ¨¡å‹ã€‚ä½ å‘å®¢æˆ·äº¤ä»˜æ–°åŠŸèƒ½çš„é€Ÿåº¦æœ‰å¤šå¿«ï¼Œéƒ¨åˆ†å–å†³ä½ çš„å›¢é˜Ÿåœ¨æ­¤å‘¨æœŸä¸­é€šè¿‡å„é˜¶æ®µçš„é€Ÿåº¦ã€‚<br><img src="/2019/07/21/gitops/5.png"></p><p>ä½¿ç”¨GitOpså·¥ä½œæµå’Œå¯è§‚å¯Ÿæ€§çš„å¼€å‘äººå‘˜éœ€è¦å›ç­”è¿™äº›é—®é¢˜ï¼š</p><ol><li>å¦‚æœè‡ªåŠ¨å‘å¸ƒä¸€ä¸ªå˜æ›´ï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“å®ƒç¡®å®æœ‰æ•ˆï¼Ÿ</li><li>å¦‚ä½•ç¡®å®šæˆ‘ä»¬çš„å˜æ›´å®é™…æ˜¯åœ¨é©±åŠ¨æ”¹è¿›ï¼Ÿ</li><li>åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•ç†è§£ï¼Œè¯Šæ–­é—®é¢˜å¹¶å¤„ç†äº‹ä»¶ï¼Ÿ</li></ol><p>é€šè¿‡Weave Cloudï¼Œå¯è§‚å¯Ÿå·¥ä½œè´Ÿè½½ä»ªè¡¨ç›˜å·²é›†æˆåˆ°éƒ¨ç½²å’Œå‘å¸ƒæµç¨‹ä¸­ã€‚åœ¨æ‰¿è¯ºå°†éƒ¨ç½²å‘å¸ƒåˆ°å‡†å¤‡ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œä½ å¯ä»¥çœ‹åˆ°éƒ¨ç½²æ˜¯å¦æˆåŠŸã€‚è¿™ä¸ä»…å¸®åŠ©ä½ æ›´å¿«åœ°è¯†åˆ«é—®é¢˜ï¼Œè€Œä¸”ç”±äºå¯è§‚å¯Ÿæ€§å·¥ä½œè´Ÿè½½ä»ªè¡¨ç›˜æ˜¯å®æ—¶çš„å¹¶ä¸”å†…ç½®äºéƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥è‡ªä¿¡çš„ä¸€å¤©å¤šæ¬¡åœ°éƒ¨ç½²ä½ çš„æœåŠ¡å¹¶ç¡®ä¿¡éƒ¨ç½²æ²¡æœ‰é‡å¤§ç¼ºé™·ã€‚<br><img src="/2019/07/21/gitops/6.png"></p><h1 id="GitOpsçš„ä¼˜ç‚¹"><a href="#GitOpsçš„ä¼˜ç‚¹" class="headerlink" title="GitOpsçš„ä¼˜ç‚¹"></a>GitOpsçš„ä¼˜ç‚¹</h1><p><strong>æ›´å¿«çš„éƒ¨ç½²</strong><br>é€šè¿‡é‡‡ç”¨GitOpsçš„æœ€ä½³å®è·µï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„å·¥å…·æ¯”å¦‚Gitæ¥å¿«é€Ÿåœ°ç®¡ç†Kubernetesåº”ç”¨çš„æ›´æ–°å’Œæ–°åŠŸèƒ½ã€‚é€šè¿‡æŒç»­çš„æ¨é€åŠŸèƒ½æ›´æ–°ï¼Œä¼ä¸šå˜å¾—æ›´åŠ æ•æ·ï¼Œèƒ½å¤Ÿæ›´å¿«åœ°ååº”å®¢æˆ·éœ€æ±‚ï¼Œå¹¶åœ¨å¸‚åœºä¸­æ›´å…·ç«äº‰åŠ›ã€‚</p><p><strong>æ›´å¥½çš„æ“ä½œ</strong><br>ä½¿ç”¨GitOpsï¼Œä½ æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯çš„ç®¡é“ã€‚ä¸ä»…ä½ çš„æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ç®¡é“éƒ½æ˜¯ç”±æ‹‰å–è¯·æ±‚(Pull Request)é©±åŠ¨ï¼Œè€Œä¸”ä½ çš„æ“ä½œä»»åŠ¡ä¹Ÿå¯ä»¥é€šè¿‡Gitå®Œå…¨é‡ç°ã€‚</p><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨Weave Cloudï¼Œå¯ä»¥å®‰å…¨åœ°éƒ¨ç½²åˆ°æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­ï¼Œä¸ä¼šå°†æ•æ„Ÿçš„è´¦å·æ³„éœ²åœ¨é›†ç¾¤ä¹‹å¤–ã€‚</p><p><strong>æ›´å¥å£®çš„å®‰å…¨ä¿è¯</strong><br>Gitçš„å¼ºæ­£ç¡®æ€§ä»¥åŠå®‰å…¨ä¿è¯(èƒŒåæ˜¯å¥å£®çš„ç”¨äºè¿½è¸ªå’Œç®¡ç†å˜æ›´çš„åŠ å¯†æŠ€æœ¯)ï¼Œä»¥åŠå¯¹å˜æ›´çš„ç­¾åä»è€Œè¯æ˜ä½œè€…èº«ä»½å’Œæ¥æºçš„èƒ½åŠ›æ˜¯æ­£ç¡®å’Œå®‰å…¨åœ°å®šä¹‰é›†ç¾¤ç›®æ ‡çŠ¶æ€çš„å…³é”®ã€‚å¦‚æœå‘ç”Ÿå®‰å…¨æ¼æ´ï¼Œå¯ä»¥ç‹¬ç«‹äºè„†å¼±çš„ç³»ç»Ÿä½¿ç”¨ä¸å¯å˜å’Œå¯å®¡è®¡çš„äº‹å®æ¥æºé‡æ–°åˆ›å»ºæ–°çš„ç³»ç»Ÿï¼Œä»è€Œå‡å°‘åœæœºæ—¶é—´å¹¶å…è®¸æ›´å¥½çš„äº‹ä»¶å“åº”ã€‚</p><p>æ‰“åŒ…è½¯ä»¶å’Œå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„èŒè´£åˆ†ç¦»ä¹Ÿä½“ç°äº†æœ€å°ç‰¹æƒçš„å®‰å…¨åŸåˆ™ï¼Œå‡å°‘è„†å¼±å½±å“å¹¶æä¾›äº†æ›´å°çš„æ”»å‡»é¢ã€‚</p><p><strong>ä½¿å¾—åˆè§„å’Œå®¡æ ¸æ›´å®¹æ˜“</strong><br>ç”±äºä»¥å®‰å…¨çš„æ–¹å¼è¿½è¸ªå’Œå’Œè®°å½•æ›´æ”¹ï¼Œå› æ­¤åˆè§„æ€§å’Œå®¡è®¡å˜å¾—å¾®ä¸è¶³é“ã€‚ä½¿ç”¨kubediffï¼Œterradiffå’Œansiblediffå¯ä»¥å°†é›†ç¾¤çš„å¯ä¿¡ä»»çŠ¶æ€å®šä¹‰ä¸å®é™…è¿è¡Œçš„é›†ç¾¤è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œç¡®ä¿å¯è¿½è¸ªå’Œå®¡æ ¸çš„å˜æ›´ä¸å®é™…ç›¸ç¬¦ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>GitOps</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkins Jobçš„å¹¶å‘æ‰§è¡Œ</title>
    <link href="/2019/07/08/jenkins-concurrent-builds/"/>
    <url>/2019/07/08/jenkins-concurrent-builds/</url>
    
    <content type="html"><![CDATA[<p>å¹¶å‘ï¼Œå¤šçº¿ç¨‹æ˜¯ç¨‹åºè®¾è®¡é¢†åŸŸè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œå”¯ä¸€çš„ç›®çš„å°±æ˜¯æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡-å……åˆ†åˆ©ç”¨èµ„æºæ›´å¿«åœ°å¤„ç†å¤šä¸ªè®¡ç®—è¯·æ±‚ã€‚åœ¨æŒç»­é›†æˆã€äº¤ä»˜(CI/CD)é¢†åŸŸåŒæ ·å­˜åœ¨ç€å¹¶å‘æ‰§è¡Œçš„éœ€æ±‚ã€‚æœ¬æ–‡å°†ä¸»è¦ä»‹ç»Jenkins Jobçš„å¹¶å‘æ‰§è¡Œä»¥åŠç›¸å…³é—®é¢˜çš„æ¢è®¨ã€‚<span id="more"></span>å…¶å®ä¸ä»…æ˜¯Jenkinsï¼Œä»»ä½•ä¸€ä¸ªæŒç»­é›†æˆ(CI)æœåŠ¡å™¨éƒ½åº”è¯¥æ”¯æŒCI Jobçš„å¹¶å‘æ‰§è¡Œï¼Œå…¶åŸå› æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å……åˆ†åˆ©ç”¨Slaveèµ„æºã€‚å¦‚æœè®©ä¸€å°VM Slaveä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªCIè¯·æ±‚ï¼Œå¾€å¾€ä¼šæµªè´¹å¾ˆå¤šçš„èµ„æºï¼ˆCPUï¼ŒMemoryï¼ŒStorageï¼‰ã€‚</li><li>æŒç»­é›†æˆçš„æœ€ä½³å®è·µè¦æ±‚å¿«é€Ÿåœ°â€œBuild Per Change Commitâ€ï¼Œä½†æ˜¯å¯¹äºä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æŒç»­é›†æˆæµæ°´çº¿ï¼Œæ¯”å¦‚é¡¹ç›®æ¯”è¾ƒå¤§ï¼Œæˆ–è€…è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¾€å¾€æ˜¯å‰ä¸€ä¸ªé›†æˆè¿˜æ²¡ç»“æŸï¼Œæ–°çš„change commitå·²ç»åˆ°æ¥ï¼Œå¦‚æœä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œåªèƒ½é˜»å¡ç­‰å¾…ï¼Œå¯¼è‡´commitçš„æäº¤è€…ä¸èƒ½åŠæ—¶å¾—åˆ°åé¦ˆï¼Œä»è€Œä½¿æŒç»­é›†æˆæµæ°´çº¿åœ¨é¡¹ç›®ä¸­å¤±å»äº†åº”æœ‰çš„ä½œç”¨ï¼Œåœ°ä½ä¹Ÿä¼šå˜å¾—æ¯”è¾ƒå°´å°¬ã€‚æ­¤æ—¶ï¼Œå¦‚æœå†ä¸€å‘³åœ°æ¨è¿›ä¸æŒç»­é›†æˆæµæ°´çº¿é…å¥—çš„ä¸€äº›ç­–ç•¥ï¼Œå°†ä¼šå—åˆ°å¾ˆå¤§çš„é˜»åŠ›ã€‚</li></ul><h1 id="Jenkins-Jobç¼ºçœçš„å¹¶å‘è¡Œä¸º"><a href="#Jenkins-Jobç¼ºçœçš„å¹¶å‘è¡Œä¸º" class="headerlink" title="Jenkins Jobç¼ºçœçš„å¹¶å‘è¡Œä¸º"></a>Jenkins Jobç¼ºçœçš„å¹¶å‘è¡Œä¸º</h1><p>éšç€Jenkins Pipeline2.0çš„å¼•å…¥ï¼Œç›®å‰ä¸»è¦æœ‰ä¸‰ç§ç±»å‹çš„Jenkins Jobï¼šFree Style Jobï¼ŒScripted Pipeline and Declarative Pipelineã€‚Scripted Pipeline and Declarative Pipelineå±äºJenkins Pipeline2.0å¼•å…¥çš„Jobç±»å‹ï¼Œæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯Pipeline as Codeï¼Œåœ¨ä¸€ä¸ªJenkinsfileæ–‡ä»¶é‡Œå¯ä»¥ç¼–å†™æ•´ä¸ªCIæµç¨‹ï¼Œå¹¶ä¸”å¯ä»¥æäº¤åˆ°ä»£ç ä»“åº“ï¼Œæ¯”å¦‚Gitï¼Œä½œç‰ˆæœ¬ç®¡ç†ã€‚ç”±äºPipeline2.0çªå‡ºçš„ä¼˜ç‚¹ï¼Œç›®å‰è¶Šæ¥è¶Šå¤šçš„å…¬å¸å’Œç»„ç»‡å¼€å§‹ä½¿ç”¨å®ƒæ¥æ„å»ºæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜æµæ°´çº¿ï¼Œä½†æ˜¯Free Styleç±»å‹çš„Jobç›®å‰è¿˜æ˜¯ä¸»è¦æ”¯æŒçš„Jobç±»å‹ä¹‹ä¸€ï¼Œæ²¡æœ‰è¢«åºŸå¼ƒæ‰ï¼Œå…¶åŸå› å¯èƒ½æœ‰ä¸¤ä¸ªï¼š<br>1ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ’ä»¶éƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒPipeline2.0ï¼ˆä¸‹ä¸€èŠ‚çš„Throttle Concurrent Builds Pluginå°±æ˜¯ä¸ªä¾‹å­ï¼‰ï¼›<br>2ï¼Œä¸å°‘å…¬å¸æˆ–ç»„ç»‡è¿˜æœ‰å¾ˆå¤šé—ç•™çš„Free Styleç±»å‹çš„Jobï¼Œæ‰€ä»¥æœ¬æ–‡ä»ç„¶ä¼šæ¶‰åŠè¿™ä¸‰ä¸ªç±»å‹çš„Jobã€‚</p><p>ä¸ºäº†æ”¯æŒJenkins Jobå¹¶å‘æ‰§è¡Œï¼Œé¦–å…ˆéœ€è¦è®¾ç½®Jenkins Slaveçš„Build Executorsçš„æ•°é‡å¤§äº1ï¼š<br><img src="/2019/07/08/jenkins-concurrent-builds/1.png"></p><p>å½“Jenkins Jobæœ‰æ–°çš„buildè¯·æ±‚æ—¶ï¼Œåªè¦åŒ¹é…çš„SlaveèŠ‚ç‚¹æœ‰ç©ºé—²çš„Executorï¼Œå³ä½¿å·²ç»æœ‰buildåœ¨æ‰§è¡Œï¼Œæ–°çš„buildä¹Ÿä¼šç«‹åˆ»è¢«å¹¶å‘æ‰§è¡Œã€‚å¦‚æœåŒ¹é…çš„SlaveèŠ‚ç‚¹æ²¡æœ‰ç©ºé—²çš„Executorï¼Œè¿™ä¸ªæ–°çš„buildè¯·æ±‚å°†è¢«æ”¾å…¥å¾…æ‰§è¡Œé˜Ÿåˆ—é‡Œç­‰å¾…è°ƒåº¦ã€‚</p><p>Free Style Jobç¼ºçœå¹¶æ²¡æœ‰æ‰“å¼€å¹¶å‘æ‰§è¡Œçš„åŠŸèƒ½ã€‚éœ€è¦åœ¨Jobçš„é…ç½®ä¸­æ‰“å¼€é€‰é¡¹â€œExecute concurrent builds if necessaryâ€ï¼š<br><img src="/2019/07/08/jenkins-concurrent-builds/2.png"></p><p>Pipeline2.0çš„Jobç¼ºçœæ˜¯å¹¶å‘æ‰§è¡Œæ¨¡å¼ã€‚å¦‚æœè¦ç¦æ­¢å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><ul><li><p>Scripted Pipeline</p><p>åœ¨Jenkinsfileå¤´éƒ¨æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dsl">properties(<br>  [<br>      disableConcurrentBuilds()<br>  ]<br>)<br></code></pre></td></tr></table></figure></li><li><p>Declarative Pipeline</p><p>åœ¨pipelineå—ä¸­æ·»åŠ ä»¥ä¸‹é€‰é¡¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dsl">pipeline &#123;<br>    options &#123;<br>        disableConcurrentBuilds()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h1 id="Jenkins-Jobå¹¶å‘æ‰§è¡Œéœ€è¦è§£å†³çš„é—®é¢˜"><a href="#Jenkins-Jobå¹¶å‘æ‰§è¡Œéœ€è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="Jenkins Jobå¹¶å‘æ‰§è¡Œéœ€è¦è§£å†³çš„é—®é¢˜"></a>Jenkins Jobå¹¶å‘æ‰§è¡Œéœ€è¦è§£å†³çš„é—®é¢˜</h1><p>Jenkins Jobçš„å¹¶å‘æ‰§è¡Œæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œç”¨å¾—å¥½ï¼Œæ‰€å‘æŠ«é¡ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ—¢æœ‰èµ„æºæœåŠ¡æ›´å¤šçš„æŒç»­é›†æˆè¯·æ±‚ï¼Œç”¨å¾—ä¸å¥½ï¼Œä¼šå‡ºç°å¾ˆå¤šé¢„æ–™ä¸åˆ°çš„é—®é¢˜ï¼Œè€Œä¸”æœ‰äº›é—®é¢˜å¹¶ä¸èƒ½é‡å¤å‡ºç°ï¼Œç»™è°ƒè¯•å¸¦æ¥äº†å¾ˆå¤§çš„è´Ÿæ‹…ã€‚Jenkins Jobçš„å¹¶å‘æ‰§è¡Œä¸»è¦é¢ä¸´çš„é—®é¢˜æ˜¯èµ„æºä½¿ç”¨çš„å†²çªã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå¸¸è§çš„åŸºäºPipeline2.0å®ç°çš„ä¸€ä¸ªJenkins CI Job(yunzai-ci)ï¼š<br><img src="/2019/07/08/jenkins-concurrent-builds/3.png">æŒ‰ç…§æµç¨‹é¡ºåºï¼Œé€ä¸€åˆ†æå¦‚ä¸‹ï¼š</p><ul><li><p>åœ¨â€œCheckout Codeâ€é˜¶æ®µï¼ŒåŒä¸€ä¸ªJenkins Jobå¹¶å‘æ‰§è¡Œçš„buildåœ¨åŒä¸€ä¸ªSlaveä¸Šçš„Workspaceä¼šå­˜åœ¨ç€å†²çªã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå…¶å®Jenkinså·²ç»æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œç»†å¿ƒçš„ä½ ä¸€å®šä¼šå‘ç°åœ¨Slaveæœºå­ä¸ŠåŒä¸€ä¸ªJobä¼šå­˜åœ¨ç€å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚â€œyunzai-ciâ€ï¼Œâ€œyunzai-ci@1â€ï¼Œâ€œyunzai-ci@2â€â€¦ï¼Œè¿™å°±æ˜¯åŒä¸€ä¸ªJobå¹¶å‘æ‰§è¡Œçš„buildå¯¹åº”çš„ä¸åŒçš„Workspaceã€‚Jenkinsç¼ºçœæ˜¯åœ¨Jobçš„åå­—åé¢åŠ ä¸Šç¬¦å·@å’Œæ•°å­—æ¥å‘½åä¸åŒçš„Workspaceçš„ï¼Œå½“å¹¶å‘æ‰§è¡Œçš„buildæ•°é‡å¤§äºWorkspaceçš„æ•°é‡ï¼ŒJenkinsä¼šæ ¹æ®å‘½åè§„åˆ™è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Workspaceï¼Œå½“å¹¶å‘æ‰§è¡Œçš„buildæ•°é‡å°äºWorkspaceæ•°é‡ï¼ŒJenkinsä¼šæŒ‰é¡ºåºé‡ç”¨å·²æœ‰çš„Workspaceã€‚</p><blockquote><p>Workspaceçš„åˆ†éš”ç¬¦@å¯ä»¥åœ¨å¯åŠ¨Jenkins masteræ—¶è®¾ç½®Javaç³»ç»Ÿå±æ€§â€œhudson.slaves.WorkspaceListâ€æ¥æ”¹å˜ã€‚æ¯”å¦‚ï¼Œâ€œhudson.slaves.WorkspaceList=-â€å°†Workspaceçš„åˆ†éš”ç¬¦æ”¹ä¸ºä¸­åˆ’çº¿ã€‚</p></blockquote><p>Workspaceçš„å†²çªè§£å†³äº†ï¼Œä½†æ˜¯åˆå¼•å…¥äº†ä¸€ä¸ªæ½œåœ¨çš„æ•ˆç‡é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœé¡¹ç›®çš„ä»£ç åº“æ¯”è¾ƒå¤§(å‡ ç™¾å…†ï¼Œæˆ–è€…å‡ ä¸ªG)ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Workspaceæ—¶ï¼Œä¼šé‡æ–°ä»è¿œå¤„çš„ä»£ç ä»“åº“å…‹éš†ä»£ç ï¼Œè¿™å°†å¯¼è‡´å½“å‰Jenkins jobæ‰§è¡Œçš„æ—¶é—´è¢«æ‹‰é•¿ã€‚å¯ä»¥ä¼˜åŒ–Jenkins Jobï¼Œé€šè¿‡æ‹·è´æœ¬åœ°å·²æœ‰Workspaceçš„ä»£ç æ¥æå‡é€Ÿåº¦(Linuxä¸Šå¯ä»¥ä½¿ç”¨Rsyncï¼ŒWindowä¸Šå¯ä»¥ä½¿ç”¨Robocopy)ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»è¿œç¨‹ä»£ç ä»“åº“å»å…‹éš†ä»£ç ã€‚</p></li><li><p>åœ¨â€œBuild/UTâ€é˜¶æ®µï¼Œä¼šä½¿ç”¨ä¸åŒçš„è‡ªåŠ¨æ„å»ºå·¥å…·å’ŒåŒ…ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚Maven, Gradle, Npm, Bowerç­‰ç­‰ï¼Œæ„å»ºå‡ºæ¥çš„åˆ¶å“ä¼šä¸Šä¼ åˆ°åˆ¶å“ä»“åº“(Artifactoryæˆ–Nexus)ã€‚è¿™é‡Œï¼Œè‡ªåŠ¨æ„å»ºå·¥å…·çš„æœ¬åœ°ç¼“å­˜ï¼Œä»¥åŠæ„å»ºåˆ¶å“ä¸Šä¼ åˆ°åˆ¶å“ä»“åº“éƒ½å¯èƒ½å­˜åœ¨å†²çªã€‚æ¯”å¦‚Maven, ç¼ºçœçš„æœ¬åœ°ç¼“å­˜æ˜¯åœ¨å½“å‰ç”¨æˆ·çš„.m2ç›®å½•ä¸‹ï¼ŒMavenæ‰§è¡Œæ—¶ä¼šæ›´æ–°æˆ–è€…ä¸‹è½½é¡¹ç›®çš„ä¾èµ–åˆ°æœ¬åœ°ç¼“å­˜ï¼Œæˆ–è€…å®‰è£…å½“å‰æ„å»ºçš„åˆ¶å“åˆ°æœ¬åœ°ç¼“å­˜ï¼Œå½“åŒä¸€ä¸ªJenkins Jobå¹¶å‘æ‰§è¡Œçš„buildè¿è¡Œåœ¨åŒä¸€ä¸ªJenkins Slaveä¸Šæ—¶ï¼Œä¼šå¯åŠ¨å¤šä¸ªMavenè¿›ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå®ƒä»¬ä¼šä¸‹è½½åŒä¸€ä¸ªä¾èµ–åŒ…æˆ–è€…å®‰è£…ç›¸åŒç‰ˆæœ¬(Mavençš„snapshotç‰ˆæœ¬æˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´ä¸¤ä¸ªbuildç‰ˆæœ¬ç›¸åŒ)çš„æ„å»ºåˆ¶å“åˆ°åˆ°åŒä¸€ä¸ªç¼“å­˜ç›®å½•ï¼Œè¿™æ—¶å°±ä¼šç»å¸¸å‡ºç°å†™ç£ç›˜æ–‡ä»¶å†²çªçš„é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜ä¸æ˜¯æ¯æ¬¡éƒ½å‘ç”Ÿã€‚å½“å¤šä¸ªMavenè¿›ç¨‹åŒæ—¶ä¸Šä¼ ç›¸åŒç‰ˆæœ¬çš„åˆ¶å“åˆ°åˆ¶å“ä»“åº“æ—¶ï¼Œä¹Ÿä¼šå­˜åœ¨ç€å†²çªã€‚<br>è¦è§£å†³è¿™ç±»å‹çš„å†²çªï¼Œéœ€è¦å…·ä½“æƒ…å†µï¼Œå…·ä½“å¯¹å¾…ã€‚å¯¹äºMavenæ¥è¯´ï¼Œå¯ä»¥é€šè¿‡å±æ€§â€maven.repo.localâ€æ¥ä¸ºæ¯ä¸ªMavenè¿›ç¨‹æŒ‡å®šä¸åŒçš„æœ¬åœ°ç¼“å­˜ç›®å½•ï¼Œä¸”ä¿è¯æ¯ä¸ªBuildçš„ç‰ˆæœ¬éƒ½æ˜¯å”¯ä¸€çš„ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆåŒæ ·å­˜åœ¨ç€æ•ˆç‡é—®é¢˜ï¼Œæ¯å¼€ä¸€ä¸ªæ–°çš„Mavenæœ¬åœ°ç¼“å­˜ç›®å½•éƒ½ä¼šå¢åŠ buildçš„æ‰§è¡Œæ—¶é—´ï¼Œå› ä¸ºMavenè¦é‡æ–°å»ä¸‹è½½é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥é€šè¿‡æ‹·è´æœ¬åœ°å·²æœ‰çš„ç¼“å­˜ç›®å½•æ¥æå‡é€Ÿåº¦ã€‚</p></li><li><p>åœ¨â€œCode Static Checkâ€é˜¶æ®µï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯SonarQubeï¼Œåˆ™ä¸ä¼šäº§ç”Ÿå†²çªï¼Œå› ä¸ºæ¯ä¸€ä¸ªå¹¶å‘æ‰§è¡Œçš„buildéƒ½ä¼šåœ¨SonarQubeæœåŠ¡ç«¯äº§ç”Ÿä¸€ä¸ªç‹¬ç«‹çš„åˆ†æï¼Œæ‰€ä»¥ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ä½†å¦‚æœæ˜¯å…¶å®ƒçš„é™æ€ä»£ç åˆ†ææœåŠ¡å™¨ï¼Œå¯èƒ½å°±éœ€è¦å…·ä½“æƒ…å†µï¼Œå…·ä½“å¯¹å¾…ã€‚</p></li><li><p>åœ¨â€œè‡ªåŠ¨åŒ–æµ‹è¯•â€é˜¶æ®µï¼Œç”±äºèµ„æºæœ‰é™(è‡ªåŠ¨åŒ–æµ‹è¯•æœºå™¨æœ‰é™ï¼Œè€Œä¸”æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ä¹Ÿéœ€è¦ä¸€å®šçš„æ—¶é—´)ï¼Œæ‰€ä»¥ä¸ä¸€å®šèƒ½å¤ŸæœåŠ¡äºå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªbuildã€‚è¿™æ—¶å¯ä»¥å¢åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æœºå™¨(è™šæ‹Ÿæœº)ï¼ŒåŒæ—¶è¿›è¡Œæµ‹è¯•åˆ†çº§ï¼ŒæŠ½å–å‡ºéƒ¨åˆ†é‡è¦çš„æµ‹è¯•ç”¨ä¾‹æ”¾åˆ°Jenkins Jobä¸­å»æ‰§è¡Œä»¥é™ä½æµ‹è¯•æ‰§è¡Œçš„æ—¶é—´ã€‚å¯ä»¥æŠŠå…¨é‡æµ‹è¯•é™çº§ä¸ºä»¥å¤©ä¸ºå•ä½ï¼Œæ¯”å¦‚æ¯æ™šå–æœ€æ–°çš„buildå»æ‰§è¡Œå…¨é‡æµ‹è¯•ï¼Œå¹¶ç»™å‡ºæµ‹è¯•æŠ¥å‘Šã€‚</p></li></ul><p>ä¸åŒå…¬å¸æˆ–ç»„ç»‡çš„æŒç»­é›†æˆæµæ°´çº¿å¯èƒ½å’Œä¸Šæ–‡æè¿°çš„ä¸ç›¸åŒï¼Œä¸ºäº†èƒ½å¤Ÿå¹¶å‘æ‰§è¡ŒJenkins Jobï¼Œéœ€è¦é€ä¸€åˆ†æå’Œè§£å†³æ¯ä¸ªé˜¶æ®µå¯èƒ½å‡ºç°çš„èµ„æºå†²çªé—®é¢˜ã€‚</p><h1 id="Jenkins-Jobå¹¶å‘æ‰§è¡Œçš„ç²¾ç¡®æ§åˆ¶-Throttle-Concurrent-Builds-Plugin"><a href="#Jenkins-Jobå¹¶å‘æ‰§è¡Œçš„ç²¾ç¡®æ§åˆ¶-Throttle-Concurrent-Builds-Plugin" class="headerlink" title="Jenkins Jobå¹¶å‘æ‰§è¡Œçš„ç²¾ç¡®æ§åˆ¶(Throttle Concurrent Builds Plugin)"></a>Jenkins Jobå¹¶å‘æ‰§è¡Œçš„ç²¾ç¡®æ§åˆ¶(Throttle Concurrent Builds Plugin)</h1><p>Jenkins Jobç¼ºçœçš„å¹¶å‘è¡Œä¸ºæ˜¯åªè¦æœ‰è¶³å¤Ÿå¯ç”¨çš„Jenkins Slaveå’ŒExecutorèµ„æºï¼Œå¯åŠ¨çš„buildæ•°é‡æ˜¯ä¸é™çš„ã€‚ä½†å®é™…æƒ…å†µæ˜¯æˆ‘ä»¬éœ€è¦ç²¾ç¡®åœ°æ§åˆ¶æŸä¸ªJenkins Jobæ€»çš„å¹¶å‘æ‰§è¡Œçš„buildæ•°é‡ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›å•ä¸ªJenkins SlaveèŠ‚ç‚¹ä¸ŠåŒä¸€ä¸ªJenkins Jobå¹¶å‘æ‰§è¡Œçš„buildæ•°é‡ï¼Œè¿™æ ·å¯ä»¥é™åˆ¶æŸä¸ªJenkins Jobçš„æ€»ä½“èµ„æºæ¶ˆè€—ï¼Œä¿è¯å…¶å®ƒJenkins Jobä¹Ÿèƒ½å‡è¡¡æ‰§è¡Œã€‚å€ŸåŠ©äºJenkinsæ’ä»¶â€œThrottle Concurrent Builds Pluginâ€å¯ä»¥è¾¾åˆ°è¿™æ ·çš„æ§åˆ¶ç›®çš„ã€‚â€œThrottle Concurrent Builds Pluginâ€æ”¯æŒç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼Œä¹Ÿæ”¯æŒJobçº§åˆ«çš„é…ç½®ï¼š</p><ul><li>ç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼š<br><img src="/2019/07/08/jenkins-concurrent-builds/4.png">ç³»ç»Ÿçº§åˆ«çš„é…ç½®å¯ä»¥è®¾ç½®ä¸€ä¸ªå¹¶å‘æ‰§è¡Œçš„ç±»åˆ«ï¼Œä¸åŒçš„Jenkins Jobå¯ä»¥å¼•ç”¨è¿™ä¸ªç±»åˆ«ã€‚<br>â€œMaximum Total Courrent Buildsâ€ç”¨æ¥è®¾ç½®Jenkins Jobæœ€å¤§çš„å¹¶å‘æ•°é‡ã€‚<br>â€œMaximum Concurrent Builds Per Nodeâ€ç”¨æ¥è®¾ç½®åŒä¸€ä¸ªJenkins Jobåœ¨åŒä¸€ä¸ªSlaveèŠ‚ç‚¹ä¸Šæœ€å¤§çš„å¹¶å‘æ•°é‡ã€‚</li><li>Free Style Jobçº§åˆ«çš„é…ç½®ï¼š<br><img src="/2019/07/08/jenkins-concurrent-builds/5.png">åœ¨Jobçº§åˆ«ï¼Œå¯ä»¥é€‰æ‹©â€œThrottle this project aloneâ€ï¼Œå¹¶ä¸”è®¾ç½®â€œMaximum Total Courrent Buildsâ€å’Œâ€œMaximum Concurrent Builds Per Nodeâ€è¿™ä¸¤ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡â€œMulti-Project Throttle Categoryâ€é€‰æ‹©ç³»ç»Ÿçº§åˆ«é…ç½®å¥½çš„å¹¶å‘æ‰§è¡Œçš„ç±»åˆ«ã€‚</li><li>Scripted Pipelineåªæ”¯æŒä½¿ç”¨ç³»ç»Ÿçº§åˆ«é…ç½®å¥½çš„å¹¶å‘æ‰§è¡Œç±»åˆ«ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dsl">throttle([&#x27;test-cocurrent&#x27;]) &#123;<br>  node(&#x27;xxxx&#x27;) &#123;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>å¯¹äºDeclarative Pipelineï¼Œç›®å‰â€œThrottle Concurrent Builds Pluginâ€è¿˜ä¸æ”¯æŒï¼Œæ‰€ä»¥åªèƒ½æ˜¯å‰é¢è®¨è®ºçš„ç¼ºçœå¹¶å‘è¡Œä¸ºã€‚<blockquote><p>å¯¹äºæ’ä»¶â€œThrottle Concurrent Builds Pluginâ€çš„è¯¦ç»†ç”¨æ³•ï¼Œ<br>å¯ä»¥å‚è€ƒæ’ä»¶çš„Wiki: <a href="https://wiki.jenkins.io/display/JENKINS/Throttle+Concurrent+Builds">https://wiki.jenkins.io/display/JENKINS/Throttle+Concurrent+Builds+Plugin</a>å’ŒGitHubåœ°å€: <a href="https://github.com/jenkinsci/throttle-concurrent-builds-plugin">https://github.com/jenkinsci/throttle-concurrent-builds-plugin</a>ã€‚</p></blockquote></li></ul><h1 id="Jenkins-Jobç›¸åŒå‚æ•°buildçš„æ‰§è¡Œæƒ…å†µ"><a href="#Jenkins-Jobç›¸åŒå‚æ•°buildçš„æ‰§è¡Œæƒ…å†µ" class="headerlink" title="Jenkins Jobç›¸åŒå‚æ•°buildçš„æ‰§è¡Œæƒ…å†µ"></a>Jenkins Jobç›¸åŒå‚æ•°buildçš„æ‰§è¡Œæƒ…å†µ</h1><p>æ‰€è°“ç›¸åŒå‚æ•°buildï¼Œå°±æ˜¯æŒ‡åŒä¸€ä¸ªJenkins Jobä»¥ç›¸åŒçš„å‚æ•°è§¦å‘å¤šä¸ªbuildã€‚ä¸è®ºæ˜¯Jenkins Jobå¹¶å‘æ‰§è¡Œï¼Œè¿˜æ˜¯éå¹¶å‘æ‰§è¡Œï¼Œåªè¦æœ‰ç¬¦åˆJenkins Jobæ‰§è¡Œçš„Slaveå’ŒExecutorèµ„æºè€Œä¸”å¹¶å‘ç­–ç•¥å…è®¸ï¼Œæ‰€æœ‰è¢«è§¦å‘çš„buildéƒ½ä¼šè¢«ç«‹åˆ»æ‰§è¡Œã€‚ä½†å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ‰§è¡Œèµ„æºï¼Œæˆ–è€…å¹¶å‘ç­–ç•¥ä¸å…è®¸ï¼Œè€Œä¸”å·²ç»æœ‰buildåœ¨å¾…æ‰§è¡Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è§¦å‘ä¸ç­‰å¾…çš„buildå‚æ•°ç›¸åŒçš„buildï¼Œè¡Œä¸ºå°±ä¼šæœ‰äº›åŒºåˆ«ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Jobç±»å‹</th><th>å¹¶å‘æ‰§è¡Œ</th><th>éå¹¶å‘æ‰§è¡Œ</th></tr></thead><tbody><tr><td>Free Style Job</td><td>ç›¸åŒå‚æ•°çš„buildåªä¼šåŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸€æ¬¡</td><td>ç›¸åŒå‚æ•°çš„buildåªä¼šåŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸€æ¬¡</td></tr><tr><td>Scripted Pipeline</td><td>ç›¸åŒå‚æ•°çš„buildä¼šé‡å¤åŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—</td><td>ç›¸åŒå‚æ•°çš„buildåªä¼šåŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸€æ¬¡</td></tr><tr><td>Declarative Pipeline</td><td>ç›¸åŒå‚æ•°çš„buildä¼šé‡å¤åŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—</td><td>ç›¸åŒå‚æ•°çš„buildåªä¼šåŠ å…¥åˆ°å¾…æ‰§è¡Œé˜Ÿåˆ—ä¸€æ¬¡</td></tr></tbody></table><p>ä»¥ä¸Šæ˜¯æ ¹æ®å®æµ‹å¾—åˆ°çš„ç»“æœï¼Œå¹¶æ²¡æœ‰ä»»ä½•å®˜æ–¹æ–‡æ¡£æä¾›è¯¦ç»†çš„è¯´æ˜ï¼Œæ‰€ä»¥éšç€Jenkinsç‰ˆæœ¬çš„å‡çº§ï¼Œå…¶è¡Œä¸ºæœ‰å¯èƒ½ä¼šå˜åŒ–ã€‚</p><h1 id="å®¹å™¨ä½œä¸ºSlaveèŠ‚ç‚¹ä¼šè®©å¹¶å‘æ‰§è¡Œå˜å¾—å®¹æ˜“å—ï¼Ÿ"><a href="#å®¹å™¨ä½œä¸ºSlaveèŠ‚ç‚¹ä¼šè®©å¹¶å‘æ‰§è¡Œå˜å¾—å®¹æ˜“å—ï¼Ÿ" class="headerlink" title="å®¹å™¨ä½œä¸ºSlaveèŠ‚ç‚¹ä¼šè®©å¹¶å‘æ‰§è¡Œå˜å¾—å®¹æ˜“å—ï¼Ÿ"></a>å®¹å™¨ä½œä¸ºSlaveèŠ‚ç‚¹ä¼šè®©å¹¶å‘æ‰§è¡Œå˜å¾—å®¹æ˜“å—ï¼Ÿ</h1><p>æœ€è¿‘å‡ å¹´å®¹å™¨æŠ€æœ¯å€ŸåŠ©äºDockeråœ¨ITé¢†åŸŸé‡Œæ€èµ·äº†å·¨å¤§çš„å˜é©ï¼Œå®¹å™¨ç¼–æ’å¹³å°Kubernetesçš„å‡ºç°æ›´æ˜¯å°†å®¹å™¨åŒ–çš„åº”ç”¨æ¨å‘é«˜æ½®ã€‚åœ¨CI/CDé¢†åŸŸä¹Ÿä¸ä¾‹å¤–ï¼Œè¶Šæ¥è¶Šå¤šçš„ç»„ç»‡å¼€å§‹å°è¯•åˆ©ç”¨Dockerå®¹å™¨ä½œä¸ºCI Jobæ‰§è¡Œçš„SlaveèŠ‚ç‚¹ï¼Œé€šè¿‡Kuberneteså¹³å°ç»Ÿä¸€ç®¡ç†è°ƒåº¦è™šæ‹Ÿæœºèµ„æºï¼Œä»¥æœŸæœ›æ›´åŠ ç»†ç²’åº¦åœ°æ§åˆ¶å’Œä½¿ç”¨è®¡ç®—èµ„æºã€‚Dockerå®¹å™¨ä½œä¸ºSlaveèŠ‚ç‚¹ç¡®å®æ˜¯å®ç°äº†æœ¬åœ°æ‰§è¡Œç¯å¢ƒçš„éš”ç¦»ï¼Œä½†æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šå¯åŠ¨å…¨æ–°çš„å®¹å™¨ï¼Œéƒ½å¾—é‡æ–°ä¸‹è½½ä»£ç å’Œæ„å»ºå·¥å…·çš„æœ¬åœ°ç¼“å­˜ï¼Œä½¿å¾—æ¯æ¬¡çš„æ„å»ºéƒ½è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦è€ƒè™‘å¦‚ä½•æå‡æ•ˆç‡ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ›å»ºè‡ªç­¾åTLS/SSLè¯ä¹¦å’Œç§é’¥</title>
    <link href="/2018/12/30/create-self-signed-ssl/"/>
    <url>/2018/12/30/create-self-signed-ssl/</url>
    
    <content type="html"><![CDATA[<p>TLS(Transport Layer Security)-ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ŒåŠå…¶å‰èº«SSL(Secure Sockets Layer)-å®‰å…¨å¥—æ¥å±‚æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œåœ¨ä¼ è¾“å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚TLSåè®®ç”±ä¸¤å±‚ç»„æˆï¼šTLS è®°å½•åè®®ï¼ˆTLS Recordï¼‰å’Œ TLS æ¡æ‰‹åè®®ï¼ˆTLS Handshakeï¼‰ã€‚è¾ƒä½çš„å±‚ä¸º TLS è®°å½•åè®®ï¼Œä½äºæŸä¸ªå¯é çš„ä¼ è¾“åè®®ï¼ˆä¾‹å¦‚ TCPï¼‰ä¸Šé¢ï¼Œä¸å…·ä½“çš„åº”ç”¨æ— å…³ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æŠŠTLSåè®®å½’ä¸ºä¼ è¾“å±‚å®‰å…¨åè®®ã€‚TLSæ¡æ‰‹åè®®ä½¿ç”¨è¯¥å±‚ä¸­çš„å…¬é’¥å’Œè¯ä¹¦æ¥å¤„ç†å¯¹ç­‰ç”¨æˆ·çš„è®¤è¯ï¼Œä»¥åŠåå•†ç®—æ³•å’ŒåŠ å¯†å®é™…æ•°æ®ä¼ è¾“çš„ç§é’¥ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨TLSè®°å½•åè®®çš„é¡¶éƒ¨æ‰§è¡Œçš„ã€‚TLSæ‰€é‡‡ç”¨çš„è¯ä¹¦ç³»ç»Ÿå¯ä»¥ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“çš„æ•°æ®æ˜¯è¢«åŠ å¯†çš„ï¼Œä¸”æœåŠ¡ç«¯æ˜¯è¢«å—ä¿¡ä»»çš„ï¼Œä½†æ˜¯å‰ææ˜¯TLSæ‰€é‡‡ç”¨çš„è¯ä¹¦æ˜¯ç”±ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„(CA)é¢å‘çš„ã€‚åŸºäºæµ‹è¯•æˆ–å†…éƒ¨ä½¿ç”¨çš„ç›®çš„ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ›å»ºè‡ªç­¾åçš„TLS/SSLè¯ä¹¦ï¼Œå¦‚ä½•é…ç½®Nginxä½¿ç”¨è¿™ä¸ªè‡ªç­¾åè¯ä¹¦å’Œç§é’¥ï¼Œä»¥åŠå¦‚ä½•åœ¨Linux, Windowså’ŒMacå®¢æˆ·ç«¯å®‰è£…è¿™ä¸ªè¯ä¹¦ã€‚éœ€è¦è¯´æ˜çš„æ˜¯è‡ªç­¾åè¯ä¹¦æ— æ³•ç¡®è®¤æœåŠ¡ç«¯æ˜¯è¢«å—ä¿¡ä»»çš„ã€‚</p><span id="more"></span><h1 id="ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥"><a href="#ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥" class="headerlink" title="ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥"></a>ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥</h1><blockquote><p>æœ¬æ–‡æ˜¯åœ¨Ubuntu 16.04ç³»ç»Ÿä¸Šè°ƒç”¨opensslå·¥å…·ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥ã€‚</p></blockquote><p>ä½¿ç”¨opensslå‘½ä»¤ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥å¯¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout selfsigned-key.key -out selfsigned-certificate.crt<br></code></pre></td></tr></table></figure><ul><li>openssl: åŸºæœ¬å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥åˆ›å»ºå’Œç®¡ç†OpenSSLè¯ä¹¦ï¼Œç§é’¥å’Œå…¶å®ƒæ–‡ä»¶ã€‚</li><li>req: å­å‘½ä»¤ï¼Œä¸»è¦æ˜¯ç”¨æ¥åˆ›å»ºå’Œå¤„ç†PKCS#10æ ¼å¼çš„è¯ä¹¦è¯·æ±‚ã€‚å®ƒä¹Ÿèƒ½åˆ›å»ºè¢«ç”¨ä½œæ ¹è¯ä¹¦çš„è‡ªç­¾åè¯ä¹¦ã€‚</li><li>-x509: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰opensslåˆ›å»ºä¸€ä¸ªè‡ªç­¾åè¯ä¹¦è€Œä¸æ˜¯ä¸€ä¸ªè¯ä¹¦è¯·æ±‚ã€‚</li><li>-nodes: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰opensslä¸è¦åŠ å¯†ç§é’¥ï¼Œå¦åˆ™å½“ä½¿ç”¨åœ¨Nginxä¸Šæ—¶ï¼Œæ¯æ¬¡Nginxå¯åŠ¨éƒ½è¦æç¤ºè¾“å…¥å¯†ç ã€‚</li><li>-days 365: è®¾ç½®è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º1å¹´ï¼ˆ365å¤©ï¼‰ã€‚</li><li>-newkey rsa:2048: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰opensslåœ¨ç”Ÿæˆè¯ä¹¦çš„åŒæ—¶ç”Ÿæˆç§é’¥ã€‚rsa:2048è¯´æ˜åˆ›å»ºä¸€ä¸ª2048æ¯”ç‰¹é•¿çš„RSAç§é’¥ã€‚</li><li>-keyout: å‘Šè¯‰opensslç”Ÿæˆçš„ç§é’¥çš„åå­—å’Œè·¯å¾„ã€‚</li><li>-out: å‘Šè¯‰opensslç”Ÿæˆçš„è‡ªç­¾åè¯ä¹¦å’Œè·¯å¾„ã€‚</li></ul><p>å‘½ä»¤ä¼šæç¤ºä»¥ä¸‹çš„ä¸€äº›è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Country Name (2 letter code) [AU]:CN<br>State or Province Name (full name) [Some-State]:Shanghai<br>Locality Name (eg, city) []:Shanghai<br>Organization Name (eg, company) [Internet Widgits Pty Ltd]:&lt;The company name&gt;<br>Organizational Unit Name (eg, section) []:&lt;The unit name of company&gt;<br>Common Name (e.g. server FQDN or YOUR name) []:&lt;Domain name or Server IP address&gt;<br>Email Address []:&lt;xxxx@xxx.xxx&gt;<br></code></pre></td></tr></table></figure><h1 id="é…ç½®Nginxä½¿ç”¨è‡ªç­¾åè¯ä¹¦å’Œç§é’¥"><a href="#é…ç½®Nginxä½¿ç”¨è‡ªç­¾åè¯ä¹¦å’Œç§é’¥" class="headerlink" title="é…ç½®Nginxä½¿ç”¨è‡ªç­¾åè¯ä¹¦å’Œç§é’¥"></a>é…ç½®Nginxä½¿ç”¨è‡ªç­¾åè¯ä¹¦å’Œç§é’¥</h1><ol><li><p>å°†è¯ä¹¦å’Œç§é’¥æ”¾åœ¨NginxæœåŠ¡å™¨ä¸ŠæŸä¸ªè·¯å¾„ä¸‹ï¼Œæ¯”å¦‚â€/etc/nginx/ssl-certsâ€ï¼›</p></li><li><p>ç¼–è¾‘â€/etc/nginx/sites-enabledâ€ä¸‹çš„é…ç½®æ–‡ä»¶â€œ*.confâ€ï¼Œåœ¨å¤´éƒ¨(serverèŠ‚ç‚¹ä¹‹å¤–)åŠ ä¸Šä»¥ä¸‹ä¸¤è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssl_certificate       /etc/nginx/ssl-certs/selfsigned-certificate.crt;<br>ssl_certificate_key   /etc/nginx/ssl-certs/selfsigned-key.key;<br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nginx -s reload<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯NginxæœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart nginx<br></code></pre></td></tr></table></figure></li></ol><h1 id="åœ¨å®¢æˆ·ç«¯å®‰è£…è‡ªç­¾åè¯ä¹¦"><a href="#åœ¨å®¢æˆ·ç«¯å®‰è£…è‡ªç­¾åè¯ä¹¦" class="headerlink" title="åœ¨å®¢æˆ·ç«¯å®‰è£…è‡ªç­¾åè¯ä¹¦"></a>åœ¨å®¢æˆ·ç«¯å®‰è£…è‡ªç­¾åè¯ä¹¦</h1><blockquote><p>å½“è‡ªç­¾åè¯ä¹¦å®‰è£…å®Œåï¼Œä¸åŒçš„å®¢æˆ·ç«¯ç¨‹åºä¸ºäº†èƒ½å¤Ÿè¯†åˆ«å’Œä½¿ç”¨è¿™ä¸ªè¯ä¹¦å¯èƒ½éœ€è¦åšä¸åŒçš„æ“ä½œï¼Œæ¯”å¦‚dockerå®¢æˆ·ç«¯éœ€è¦é‡æ–°å¯åŠ¨ã€‚</p></blockquote><h2 id="Linuxå®¢æˆ·ç«¯"><a href="#Linuxå®¢æˆ·ç«¯" class="headerlink" title="Linuxå®¢æˆ·ç«¯"></a>Linuxå®¢æˆ·ç«¯</h2><h3 id="Ubuntu-Debian"><a href="#Ubuntu-Debian" class="headerlink" title="Ubuntu, Debian"></a>Ubuntu, Debian</h3><h4 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><ol><li><p>å°†è¯ä¹¦æ‹·è´åˆ°ç›®å½•â€œ/usr/local/share/ca-certificatesâ€:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo cp selfsigned-certificate.crt /usr/<span class="hljs-built_in">local</span>/share/ca-certificates<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°CAå­˜å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo update-ca-certificates<br></code></pre></td></tr></table></figure></li></ol><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><ol><li><p>ä»ç›®å½•â€œ/usr/local/share/ca-certificatesâ€ä¸­åˆ é™¤è¯ä¹¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo rm /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/selfsigned-certificate.crt<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°CAå­˜å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo update-ca-certificates --fresh<br></code></pre></td></tr></table></figure></li></ol><h3 id="CentOS-RedHat"><a href="#CentOS-RedHat" class="headerlink" title="CentOS, RedHat"></a>CentOS, RedHat</h3><h4 id="æ·»åŠ -1"><a href="#æ·»åŠ -1" class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><ol><li><p>å°†è¯ä¹¦æ‹·è´åˆ°ç›®å½•â€œ/etc/pki/ca-trust/source/anchorsâ€:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo cp selfsigned-certificate.crt /etc/pki/ca-trust/<span class="hljs-built_in">source</span>/anchors<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°CAå­˜å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo update-ca-trust<br></code></pre></td></tr></table></figure></li></ol><h4 id="åˆ é™¤-1"><a href="#åˆ é™¤-1" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><ol><li><p>ä»ç›®å½•â€œ/etc/pki/ca-trust/source/anchorsâ€ä¸­åˆ é™¤è¯ä¹¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo rm /etc/pki/ca-trust/<span class="hljs-built_in">source</span>/anchors/selfsigned-certificate.crt<br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°CAå­˜å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo update-ca-trust<br></code></pre></td></tr></table></figure></li></ol><h2 id="Macå®¢æˆ·ç«¯"><a href="#Macå®¢æˆ·ç«¯" class="headerlink" title="Macå®¢æˆ·ç«¯"></a>Macå®¢æˆ·ç«¯</h2><h4 id="æ·»åŠ -2"><a href="#æ·»åŠ -2" class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain selfsigned-certificate.crt<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤-2"><a href="#åˆ é™¤-2" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo security delete-certificate -c <span class="hljs-string">&quot;&lt;Common Name of existing certificate&gt;&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„&lt; Common Name of existing certificate&gt;æ˜¯æŒ‡åˆ›å»ºè¯ä¹¦æ—¶æç¤ºè¾“å…¥çš„Common Name (e.g. server FQDN or YOUR name) []: &lt; Domain name or Server IP address&gt;</p></blockquote><p>æˆ–è€…é€šè¿‡è¯ä¹¦çš„SHA-1ç æ¥åˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo security delete-certificate -Z &lt;SHA-1 Hash&gt;<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡å‘½ä»¤â€security find-ceritificate -a -Z -c &lt; Common Name of existing certificate&gt;â€å¯ä»¥è·å¾—è¯ä¹¦çš„SHA-1ç ã€‚</p></blockquote><h2 id="Windowså®¢æˆ·ç«¯"><a href="#Windowså®¢æˆ·ç«¯" class="headerlink" title="Windowså®¢æˆ·ç«¯"></a>Windowså®¢æˆ·ç«¯</h2><h4 id="æ·»åŠ -3"><a href="#æ·»åŠ -3" class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs batch">certutil -addstore -f &quot;Root&quot; selfsigned-certificate.crt<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤-3"><a href="#åˆ é™¤-3" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs batch">certutil -delstore &quot;Root&quot; &lt;Cert Serial Number&gt;<br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡å‘½ä»¤â€certutil -store â€œRootâ€â€å¯ä»¥è·å¾—è¯ä¹¦çš„Serial Numberã€‚</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>System Management</tag>
      
      <tag>TLS/SSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Terraformå¦‚ä½•è°ƒç”¨Ansibleé…ç½®è™šæ‹Ÿæœºèµ„æº</title>
    <link href="/2018/11/14/terraform-call-ansible/"/>
    <url>/2018/11/14/terraform-call-ansible/</url>
    
    <content type="html"><![CDATA[<p>Terraformï¼ˆ<a href="https://www.terraform.io/">https://www.terraform.io/</a>ï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„åŸºç¡€æ¶æ„å³ä»£ç (Infrastructure As Code - IAC)å·¥å…·ï¼Œé€šè¿‡ä»£ç æ¥æ„å»ºå’Œå˜æ›´åŸºç¡€æ¶æ„ï¼Œå¹¶ä¸”èƒ½å¤Ÿç®¡ç†å˜æ›´çš„ç‰ˆæœ¬ã€‚Terraformåœ¨æ„å»ºå‡ºè™šæ‹Ÿæœºèµ„æºåï¼Œå¾€å¾€ä¼šè°ƒç”¨ä¸å…¶å…³è”çš„provisoneræ¥é…ç½®è™šæ‹Ÿæœºèµ„æºï¼Œæ¯”å¦‚å˜æ›´æŸä¸ªç³»ç»Ÿé…ç½®ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æˆ–è€…éƒ¨ç½²æŸä¸ªåº”ç”¨ï¼Œä½†æ˜¯Terraformç›®å‰å¹¶æ²¡æœ‰æä¾›å¼€ç®±å³ç”¨çš„æ”¯æŒAnsibleçš„provisionerï¼ˆä¹Ÿè®¸éšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œä¼šæä¾›ï¼‰ã€‚æœ¬æ–‡åŸºäºvSphereæ•°æ®ä¸­å¿ƒå’ŒUbuntuç³»ç»Ÿå®ç°ä¸€ç§Terraformè°ƒç”¨Ansibleé…ç½®è™šæ‹Ÿæœºèµ„æºçš„æ–¹æ³•ã€‚</p><span id="more"></span><h1 id="Terraformæ¶æ„ç®€ä»‹"><a href="#Terraformæ¶æ„ç®€ä»‹" class="headerlink" title="Terraformæ¶æ„ç®€ä»‹"></a>Terraformæ¶æ„ç®€ä»‹</h1><p>ä¸ºäº†æ–¹ä¾¿åç»­æ­¥éª¤çš„ç†è§£ï¼Œåœ¨è¿™é‡Œå¯¹TerraformåŠå…¶ç›¸å…³ç»„ä»¶åšä¸€ç®€å•ä»‹ç»ã€‚è¿™æ˜¯Terraformçš„æ¶æ„å›¾ï¼š<br><img src="/2018/11/14/terraform-call-ansible/1.jpg"></p><p>Terraformè°ƒç”¨ä¸åŒäº‘å¹³å°ï¼ˆå…¬æœ‰æˆ–ç§æœ‰ï¼‰çš„â€œProviderâ€åˆ›å»ºå’Œç¼–æ’åŸºç¡€æ¶æ„èµ„æºï¼Œè°ƒç”¨ä¸åŒçš„â€œProvisionerâ€é…ç½®æ–°ç”Ÿæˆçš„èµ„æºã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„èµ„æºéƒ½æ”¯æŒâ€œProvisionerâ€ï¼Œå¯ä»¥å‚è€ƒå¯¹åº”èµ„æºçš„å¸®åŠ©æ–‡æ¡£æ¥äº†è§£æ˜¯å¦æ”¯æŒã€‚åŸºæœ¬ä¸Šï¼Œè™šæ‹Ÿæœºèµ„æºï¼Œæ¯”å¦‚ECS, EC2ç­‰ï¼Œéƒ½æ”¯æŒè°ƒç”¨â€œProvisionerâ€å»é…ç½®ã€‚</p><h1 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h1><p>ç»„åˆåˆ©ç”¨Terraformç°æœ‰çš„Provisionerä¸ºæ–°åˆ›å»ºçš„è™šæ‹Ÿæœºç”ŸæˆåŠ¨æ€çš„Ansibleèµ„æºæ–‡ä»¶ï¼ŒåŠ å…¥åˆ°Ansibleå½“å‰èµ„æºæ–‡ä»¶å¤¹ä¸­ï¼ˆAnsibleåœ¨æ‰§è¡Œæ—¶ä¼šåˆå¹¶å½“å‰èµ„æºæ–‡ä»¶åŠ ä¸‹çš„æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼‰ï¼Œæœ€ååŸºäºåŠ¨æ€èµ„æºæ‰§è¡ŒAnsibleè„šæœ¬é…ç½®æ–°åˆ›å»ºçš„è™šæ‹Ÿæœºã€‚</p><h1 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h1><p>ä»¥è‡ªåŠ¨åˆ›å»ºä¸€å°è™šæ‹Ÿæœºèµ„æºå¹¶å®‰è£…å’Œé…ç½®Artifactoryè½¯ä»¶ä¸ºä¾‹ï¼Œä¸‹å›¾æ˜¯Terraform+Ansibleçš„ä»£ç ç»“æ„ï¼š<br>.<br>â”œâ”€â”€ ansible<br>â”‚Â Â  â”œâ”€â”€ handlers<br>â”‚Â Â  â”œâ”€â”€ inventory<br>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ devops<br>â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ group_vars<br>â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ host_vars<br>â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ hosts<br>â”‚Â Â  â”‚Â Â  â””â”€â”€ devops-disconf<br>â”‚Â Â  â”‚Â Â      â””â”€â”€ hosts<br>â”‚Â Â  â”œâ”€â”€ roles<br>â”‚Â Â  â”œâ”€â”€ templates<br>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ artifactory<br>â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ hosts.temp.j2<br>â”‚Â Â  â”œâ”€â”€ configure-ansible-node.sh<br>â”‚Â Â  â”œâ”€â”€ ansible.cfg<br>â”‚Â Â  â”œâ”€â”€ terraform-ansible-inventory.yaml<br>â”‚Â Â  â”œâ”€â”€ artifactory.yaml<br>â”œâ”€â”€ iac<br>â”‚Â Â  â””â”€â”€ cicd<br>â”‚Â Â      â”œâ”€â”€ vsphere_virtual_machine_art1.tf</p><blockquote><p>Artifactoryæ˜¯ä¸€æ¬¾ç»Ÿä¸€åˆ¶å“ç®¡ç†å·¥å…·ï¼Œæ”¯æŒå¤šç§æ ‡å‡†çš„è½¯ä»¶åŒ…æ ¼å¼ï¼šMavenï¼ˆGradleï¼‰ï¼ŒNugetï¼ŒNPMï¼ŒBowerï¼ŒCocoaPodsï¼ŒDockerï¼ŒDebianï¼ŒRPMâ€¦ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰å­˜å‚¨æ ¼å¼ã€‚Artifactoryæ˜¯æ„å»ºCI/CDæµç¨‹å¿…ä¸å¯å°‘çš„ä¸€ä¸ªå·¥å…·ã€‚</p></blockquote><h2 id="ansibleç›®å½•"><a href="#ansibleç›®å½•" class="headerlink" title="ansibleç›®å½•"></a>ansibleç›®å½•</h2><p>è¿™ä¸ªç›®å½•æ˜¯å…¸å‹çš„Ansibleå·¥ç¨‹ç›®å½•ï¼Œæœ‰handlersï¼Œinventoryï¼Œrolesï¼Œtemplatesï¼Œansible.cfgï¼Œ*.yamlï¼ˆAnsible playbookï¼‰ã€‚</p><ul><li><p>ansible.cfg</p><p>è®¾ç½®ç¼ºçœçš„èµ„æºæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">defaults</span>]<br><span class="hljs-string">inventory</span> <span class="hljs-string">=</span> <span class="hljs-string">./inventory/devops</span><br></code></pre></td></tr></table></figure><p>åœ¨èµ„æºæ–‡ä»¶å¤¹ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªç¼ºçœçš„èµ„æºæ–‡ä»¶hostsï¼Œå¦å¤–è¿˜æœ‰ç»„å˜é‡æ–‡ä»¶å’Œä¸»æœºå˜é‡æ–‡ä»¶ã€‚</p></li><li><p>configure-ansible-node.sh</p><p>Shellè„šæœ¬ï¼Œç”¨æ¥åœ¨æ–°åˆ›å»ºçš„è™šæ‹Ÿæœºä¸­ï¼ˆUbuntuï¼‰å®‰è£…Pythonï¼Œä»¥ä¾¿å°†è¿™å°è™šæ‹Ÿæœºé…ç½®æˆAnsibleçš„ç®¡ç†èŠ‚ç‚¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash -il</span><br><br>py_version=2.7.12-1~16.04<br><br><span class="hljs-keyword">if</span> [ -f /var/lib/apt/lists/lock ]<br><span class="hljs-keyword">then</span><br>  rm -f /var/lib/apt/lists/lock<br><span class="hljs-keyword">fi</span><br><br>result=$(dpkg-query -W  python | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>)<br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;result&#125;</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Installing python=<span class="hljs-variable">$&#123;py_version&#125;</span>&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;python was already installed!&quot;</span><br>  <span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">export</span> http_proxy=http://xxxx<br><span class="hljs-built_in">export</span> https_proxy=<span class="hljs-variable">$&#123;http_proxy&#125;</span><br><br>cat &gt; /etc/apt/apt.conf.d/apt-temp.conf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">Acquire::http::Proxy &quot;$&#123;http_proxy&#125;&quot;;</span><br><span class="hljs-string">Acquire::https::Proxy &quot;$&#123;http_proxy&#125;&quot;;</span><br><span class="hljs-string">Acquire::ftp::Proxy &quot;$&#123;http_proxy&#125;&quot;;</span><br><span class="hljs-string">EOF</span><br><br>apt-get update<br>apt-get -y --no-upgrade install python=<span class="hljs-variable">$&#123;py_version&#125;</span><br><br>curl https://bootstrap.pypa.io/get-pip.py | python<br>pip install -U pip<br><br>rm -f /etc/apt/apt.conf.d/apt-temp.conf<br></code></pre></td></tr></table></figure><p>å¦‚æœä»£ç æ˜¯è¿è¡Œåœ¨é˜²ç«å¢™åé¢ï¼Œæ¯”å¦‚åœ¨å…¬å¸çš„ç½‘ç»œä¸­ï¼Œéœ€è¦line 19 - line 26çš„ä»£ç é…ç½®aptä»£ç†ã€‚</p></li><li><p>terraform-ansible-inventory.yaml</p><p>Ansibleè„šæœ¬ï¼Œç”¨æ¥ç”Ÿæˆå½“å‰è™šæ‹Ÿæœºçš„åŠ¨æ€èµ„æºæ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span>  <span class="hljs-string">Create</span> <span class="hljs-string">temp</span> <span class="hljs-string">inventory</span> <span class="hljs-string">file</span><br>  <span class="hljs-attr">hosts:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; host | default(&#x27;localhost&#x27;) &#125;&#125;</span>&quot;</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">host_name:</span> <span class="hljs-string">default-temp</span><br>    <span class="hljs-attr">host_ip:</span> <span class="hljs-string">xxx.xxx.xxx.xxx</span><br>    <span class="hljs-attr">host_user:</span> <span class="hljs-string">xxx</span><br>    <span class="hljs-attr">host_password:</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">temp</span> <span class="hljs-string">inventory</span> <span class="hljs-string">file</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">src=artifactory/hosts.temp.j2</span> <span class="hljs-string">dest=inventory/devops/&#123;&#123;host_name&#125;&#125;</span> <span class="hljs-string">mode=644</span><br>      <span class="hljs-attr">delegate_to:</span> <span class="hljs-string">localhost</span><br></code></pre></td></tr></table></figure><p>æœ¬åœ°æ‰§è¡Œè¿™ä¸ªAnsibleè„šæœ¬ä»ä»¥ä¸‹æ¨¡æ¿ï¼ˆhosts.temp.j2ï¼‰å®ä¾‹åŒ–å‡ºAnsibleçš„èµ„æºæ–‡ä»¶ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;&#123;<span class="hljs-string">host_name</span>&#125;&#125; <span class="hljs-string">ansible_host=&#123;&#123;host_ip&#125;&#125;</span> <span class="hljs-string">ansible_user=&#123;&#123;host_user&#125;&#125;</span> <span class="hljs-string">ansible_password=&#123;&#123;host_password&#125;&#125;</span> <span class="hljs-string">ansible_ssh_common_args=&#x27;-o</span> <span class="hljs-string">StrictHostKeyChecking=no&#x27;</span><br><br>[<span class="hljs-string">packer_node</span>]<br>&#123;&#123;<span class="hljs-string">host_name</span>&#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å› ä¸ºåœ¨åŠ¨æ€èµ„æºæ–‡ä»¶ä¸­ä½¿ç”¨äº†ç”¨æˆ·åå’Œå¯†ç çš„æ–¹å¼è®¿é—®è™šæ‹Ÿæœºã€‚éœ€è¦åœ¨Ansibleæ§åˆ¶æœºä¸Šå®‰è£…sshpassã€‚</p></blockquote></li></ul><h2 id="iacç›®å½•"><a href="#iacç›®å½•" class="headerlink" title="iacç›®å½•"></a>iacç›®å½•</h2><p>è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾Terraformé…ç½®æ–‡ä»¶ã€‚</p><ul><li><p>vsphere_virtual_machine_art1.tf</p><p>Terraformé…ç½®æ–‡ä»¶ï¼Œåœ¨vsphereä¸­ä»æŸä¸ªè™šæ‹Ÿæœºæ¨¡æ¿å…‹éš†åˆ›å»ºä¸€å°æ–°çš„è™šæ‹Ÿæœºèµ„æºã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">provider</span> <span class="hljs-string">&quot;vsphere&quot;</span> &#123;<br>  <span class="hljs-string">vsphere_server</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;xxx.xxx.xxx.xxx&quot;</span><br>  <span class="hljs-string">user</span>           <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>  <span class="hljs-string">password</span>       <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>  <span class="hljs-string">allow_unverified_ssl</span> <span class="hljs-string">=</span> <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-string">resource</span> <span class="hljs-string">&quot;vsphere_virtual_machine&quot;</span> <span class="hljs-string">&quot;art1&quot;</span> &#123;<br>  <span class="hljs-string">...</span><br><br>  <span class="hljs-string">clone</span> &#123;<br>    <span class="hljs-string">template_uuid</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>    <span class="hljs-string">...</span><br>  &#125;<br><br>  <span class="hljs-string">provisioner</span> <span class="hljs-string">&quot;file&quot;</span> &#123;<br>    <span class="hljs-string">source</span>      <span class="hljs-string">=</span> <span class="hljs-string">&quot;../../ansible/configure-ansible-node.sh&quot;</span><br>    <span class="hljs-string">destination</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;/tmp/configure-ansible-node.sh&quot;</span><br><br>    <span class="hljs-string">connection</span> &#123;<br>      <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;ssh&quot;</span><br>      <span class="hljs-string">user</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>      <span class="hljs-string">password</span>    <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>      <span class="hljs-string">agent</span>       <span class="hljs-string">=</span> <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;<br><br>  <span class="hljs-string">provisioner</span> <span class="hljs-string">&quot;remote-exec&quot;</span> &#123;<br>    <span class="hljs-string">inline</span> <span class="hljs-string">=</span> [<span class="hljs-string">&quot;chmod a+x /tmp/configure-ansible-node.sh&quot;</span>,<br>              <span class="hljs-string">&quot;/tmp/configure-ansible-node.sh&quot;</span>,<br>              <span class="hljs-string">&quot;rm -f /tmp/configure-ansible-node.sh&quot;</span>]<br><br>    <span class="hljs-string">connection</span> &#123;<br>      <span class="hljs-string">type</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;ssh&quot;</span><br>      <span class="hljs-string">user</span>        <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>      <span class="hljs-string">password</span>    <span class="hljs-string">=</span> <span class="hljs-string">&quot;...&quot;</span><br>      <span class="hljs-string">agent</span>       <span class="hljs-string">=</span> <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;<br><br>  <span class="hljs-string">provisioner</span> <span class="hljs-string">&quot;local-exec&quot;</span> &#123;<br>    <span class="hljs-string">command</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;ansible-playbook -e host_name=default_art1 -e host_ip=$&#123;vsphere_virtual_machine.art1.default_ip_address&#125; terraform-ansible-inventory.yaml&quot;</span>,<br>    <span class="hljs-string">working_dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;../../ansible&quot;</span><br>  &#125;<br><br>  <span class="hljs-string">provisioner</span> <span class="hljs-string">&quot;local-exec&quot;</span> &#123;<br>    <span class="hljs-string">command</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;ansible-playbook  -e host=default_art1 artifactory.yaml&quot;</span>,<br>    <span class="hljs-string">working_dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;../../ansible&quot;</span><br>  &#125;<br><br>  <span class="hljs-string">provisioner</span> <span class="hljs-string">&quot;local-exec&quot;</span> &#123;<br>      <span class="hljs-string">command</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;rm -f inventory/devops/default_art1&quot;</span>,<br>      <span class="hljs-string">working_dir</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;../../ansible&quot;</span><br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><ul><li><p>line16 - line26ï¼šåˆ©ç”¨Terraformçš„â€fileâ€œprovisionerä¸Šä¼ å®‰è£…Pythonçš„Shellè„šæœ¬</p></li><li><p>line28 - line39ï¼šåˆ©ç”¨Terraformçš„â€remote-execâ€œprovisioneræ‰§è¡Œå®‰è£…Pythonçš„Shellè„šæœ¬</p></li><li><p>line41 - line44ï¼šè·å–æ–°ç”Ÿæˆçš„è™šæ‹ŸæœºIPåœ°å€ï¼Œåˆ©ç”¨Terraformçš„â€local-execâ€œprovisioneræœ¬åœ°æ‰§è¡Œâ€œterraform-ansible-inventory.yamlâ€ç”ŸæˆAnsibleçš„åŠ¨æ€èµ„æºæ–‡ä»¶</p></li><li><p>line46 - line49ï¼šåˆ©ç”¨Terraformçš„â€local-execâ€œprovisioneråŸºäºAnsibleçš„åŠ¨æ€èµ„æºæ–‡ä»¶æ‰§è¡ŒAnsibleè„šæœ¬å®Œæˆåº”ç”¨çš„éƒ¨ç½²å’Œé…ç½®</p></li><li><p>line51 - line54ï¼šåˆ©ç”¨Terraformçš„â€local-execâ€œprovisioneræ‰§è¡ŒShellå‘½ä»¤åˆ é™¤åŠ¨æ€èµ„æºæ–‡ä»¶</p></li></ul></li></ul><h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>è¿™ä¸ªæ–¹æ³•åŒæ ·ä¹Ÿé€‚ç”¨äºåœ¨å…¬æœ‰äº‘å¹³å°ä¸Šåˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹å¹¶è°ƒç”¨Ansibleè„šæœ¬å®Œæˆé…ç½®ï¼Œä½†éœ€è¦ä¸ºè™šæ‹Ÿæœºå®ä¾‹ç»‘å®šä¸€ä¸ªåŠ¨æ€çš„å…¬ç½‘IPåœ°å€ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>Infrastructure As Code</tag>
      
      <tag>Terraform</tag>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºJenkins Freestyle Jobæ„å»ºCI/CDæµæ°´çº¿</title>
    <link href="/2018/10/07/jenkins-freestyle-cicd-pipeline/"/>
    <url>/2018/10/07/jenkins-freestyle-cicd-pipeline/</url>
    
    <content type="html"><![CDATA[<p>å¯èƒ½æœ‰äººä¼šé—®ï¼šâ€œç°åœ¨æµè¡Œçš„æ˜¯Jenkins Pipeline 2.0(Jenkinsfile)ï¼Œæ‰€æœ‰äººéƒ½åœ¨è°ˆè®ºå’Œä½¿ç”¨, ä¸ºä»€ä¹ˆè¿˜åœ¨ç”¨Freestyle Job, æ˜¯ä¸æ˜¯å¤ªlowäº†ï¼â€ã€‚çš„ç¡®ï¼ŒJenkins Pipeline 2.0ç°åœ¨å¾ˆæµè¡Œï¼Œå‡ ä¹å°±ç­‰åŒäºJenkinså¹³å°ä¸Šæ„å»ºCI/CDæµæ°´çº¿çš„æ ‡å‡†ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨Jenkins Pipeline 2.0ï¼Œé‚£ä¹ˆå°±ç­‰äºä¸æ‡‚CI/CDã€‚æˆ‘æ‰¿è®¤Jenkins Pipeline 2.0å¸¦æ¥äº†å¾ˆå¤šé©å‘½æ€§çš„ç†å¿µï¼Œæ¯”å¦‚Build As Code, ä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯Jenkins Pipeline 2.0ä¸ç­‰äºCI/CD Pipeline,è€Œä¸”å®ƒçš„é©å‘½ä¹Ÿä¸æ˜¯å¾ˆå½»åº•ã€‚ä¸è¿‡æœ¬æ–‡ä¸ä¼šè¿‡å¤šåœ°å»è®®è®ºæ–¹æ³•æˆ–å·¥å…·çš„å¥½åï¼Œåªæ˜¯åœ¨Jenkinsä¸Šåˆ©ç”¨ä¸€ç§éJenkins Pipeline 2.0çš„æ–¹å¼å»æ„å»ºCI/CDæµæ°´çº¿ï¼Œå¹¶è¯´æ˜è¿™ç§æµæ°´çº¿çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥æœŸèƒ½å¤Ÿç»™è¯»è€…ä¸€æ¬¡æ€ç»´ä¸Šçš„åˆ·æ–°ã€‚</p><span id="more"></span><h1 id="ä¸€ä¸ªå…¸å‹çš„CI-CDæµæ°´çº¿"><a href="#ä¸€ä¸ªå…¸å‹çš„CI-CDæµæ°´çº¿" class="headerlink" title="ä¸€ä¸ªå…¸å‹çš„CI/CDæµæ°´çº¿"></a>ä¸€ä¸ªå…¸å‹çš„CI/CDæµæ°´çº¿</h1><p><img src="/2018/10/07/jenkins-freestyle-cicd-pipeline/2.png"></p><p>ä¸Šå›¾æ˜¯ä¸ªå…¸å‹çš„CI/CDæµæ°´çº¿ï¼Œç”±5ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ç»„æˆï¼šBuild/UTï¼ŒCode Static Checkï¼ŒQAï¼ŒSTAGEå’ŒPRODã€‚æ¯ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ç”±ä¸€åˆ°å¤šä¸ªä»»åŠ¡ï¼ˆTaskï¼‰ç»„æˆï¼Œæ¯ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰éƒ½æœ‰ä¸€ä¸ªä¸»ä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œé˜¶æ®µï¼ˆPhaseï¼‰ä¹‹é—´çš„æå‡ï¼ˆPromotionï¼‰æ˜¯ç”±ä¸»ä»»åŠ¡ï¼ˆTaskï¼‰çš„æå‡ï¼ˆPromotionï¼‰å®Œæˆã€‚åŒä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ä¹‹é—´çš„ä»»åŠ¡ï¼ˆTaskï¼‰å¯ä»¥ä¸²è¡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚</p><p>å¦‚æœä¸€ä¸ªä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯é€šè¿‡æå‡ï¼ˆPromotionï¼‰çš„æ–¹å¼è§¦å‘çš„ï¼Œé‚£ä¹ˆåœ¨å½“å‰æµæ°´çº¿ä¸­è¿™ä¸ªä»»åŠ¡ï¼ˆTaskï¼‰å¯ä»¥è¢«é‡å¤è§¦å‘ã€‚è¿™ä¸ºæµæ°´çº¿å¸¦æ¥äº†ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li><p>æµæ°´çº¿å¯ä»¥ä»å¤±è´¥çš„ç‚¹é‡æ–°å¯åŠ¨ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„æµæ°´çº¿å®ä¾‹ï¼š<br>å½“ä¸€ä¸ªä»»åŠ¡ï¼ˆTaskï¼‰çš„æ‰§è¡Œç”±äºæŸç§ä¸´æ—¶åŸå› å¤±è´¥äº†ï¼Œæ¯”å¦‚ç½‘ç»œä¸ç¨³å®šï¼Œç£ç›˜ç©ºé—´æ»¡äº†ï¼Œæ–­ç”µç­‰ï¼Œå¯ä»¥é€šè¿‡é‡æ–°æå‡ï¼ˆPromotionï¼‰å†æ¬¡è§¦å‘ã€‚å°¤å…¶æ˜¯åœ¨å‰ç½®é˜¶æ®µï¼ˆPhaseï¼‰å’Œä»»åŠ¡ï¼ˆTaskï¼‰æ¯”è¾ƒè€—æ—¶ï¼Œæˆ–è€…éœ€è¦å¾ç”¨å¤–éƒ¨èµ„æºçš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹æ›´æ˜¾å¾—é‡è¦ã€‚</p></li><li><p>è°ƒè¯•CI/CDæµæ°´çº¿æ—¶ï¼Œæ— éœ€é‡å¤å¯åŠ¨ä¸€ä¸ªæ–°çš„æµæ°´çº¿å®ä¾‹ï¼š<br>è¿™ä¸€ç‚¹å…¶å®æ˜¯ä¸Šä¼˜ç‚¹çš„å»¶ä¼¸ã€‚è°ƒè¯•æµæ°´çº¿æ—¶å¾€å¾€æ˜¯ä»å‰å¾€åä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰çš„è°ƒè¯•ï¼Œæ­£æ˜¯ç”±äºæµæ°´çº¿å¯ä»¥ä»å¤±è´¥çš„ç‚¹é‡æ–°å¯åŠ¨ï¼Œå¯ä»¥ç›´æ¥ç•¥è¿‡é€šè¿‡çš„é˜¶æ®µï¼ˆPhaseï¼‰ï¼Œä»å¤±è´¥çš„é˜¶æ®µï¼ˆPhaseï¼‰å¼€å§‹è°ƒè¯•ã€‚</p></li></ul><p>æ‰‹åŠ¨æå‡ï¼ˆManual Promoteï¼‰ç­–ç•¥éœ€è¦æœ‰æƒé™çš„æ‰¹å‡†è€…æ ¹æ®æå‰åˆ¶å®šå¥½çš„è´¨é‡å…³å¡æ¥å†³å®šæ˜¯å¦éœ€è¦æå‡ï¼ˆPromoteï¼‰åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ã€‚åœ¨è¿™ä¸ªæµæ°´çº¿ä¸­ï¼ŒQAé˜¶æ®µï¼ˆPhaseï¼‰åˆ°STAGEé˜¶æ®µï¼ˆPhaseï¼‰ï¼ŒSTAGEé˜¶æ®µï¼ˆPhaseï¼‰åˆ°PRODé˜¶æ®µï¼ˆPhaseï¼‰éƒ½éœ€è¦æ‰‹åŠ¨æå‡ï¼ˆMannual Promoteï¼‰ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯åœ¨æ¯ä¸€ä¸ªæµæ°´çº¿å®ä¾‹ä¸­éƒ½éœ€è¦è¢«è§¦å‘ã€‚åœ¨å¼€å‘çš„æ—©æœŸï¼Œè½¯ä»¶è¿˜ä¸æ˜¯å¾ˆç¨³å®šçš„æ—¶å€™ï¼Œæ¯ä¸€æ¬¡çš„ä»£ç æäº¤éƒ½ä¼šè§¦å‘ä¸€ä¸ªæµæ°´çº¿å®ä¾‹ï¼Œæµæ°´çº¿å®ä¾‹å¾€å¾€ä¼šæ ¹æ®è‡ªåŠ¨æå‡ï¼ˆAuto Promoteï¼‰ç­–ç•¥æœ€å¤§é™åº¦åœ°å¾€åç»­é˜¶æ®µï¼ˆPhaseï¼‰æµè½¬ï¼Œå¦‚æœåœ¨æŸä¸€é˜¶æ®µï¼ˆPhaseï¼‰å¤±è´¥äº†ï¼Œåˆ™ä¼šåŠæ—¶é€šçŸ¥åˆ°ç›¸å…³å¼€å‘äººå‘˜ï¼Œä»è€Œå®ç°äº†åŠæ—¶åé¦ˆå½“å‰ä»£ç æäº¤å¯¹è½¯ä»¶è´¨é‡çš„å½±å“ã€‚</p><p>åªè¦æ²¡æœ‰è¢«æ¸…ç†æ‰ï¼Œ æµæ°´çº¿å®ä¾‹å¯ä»¥åœ¨ä»»ä½•æ—¶é—´è¢«é‡æ–°å¯åŠ¨ï¼ŒçŠ¶æ€ä¹Ÿä¼šè‡ªåŠ¨æ¢å¤ã€‚è¿™ä¸ºæµæ°´çº¿å¸¦æ¥äº†ä»¥ä¸‹çš„å¥½å¤„ï¼š</p><ul><li>æœ‰æ—¶å€™ç”±äºè´¨é‡å’Œæ—¶é—´çš„åŸå› ï¼Œä¸ä¸€å®šä¼šå°†æœ€æ–°ç‰ˆæœ¬çš„æµæ°´çº¿å®ä¾‹ä»STAGEé˜¶æ®µï¼ˆPhaseï¼‰æå‡åˆ°PRODé˜¶æ®µï¼ˆPhaseï¼‰ï¼Œè€Œæ˜¯éœ€è¦å°†å‡ å¤©å‰çš„å·²ç»å¤„äºSTAGEé˜¶æ®µï¼ˆPhaseï¼‰çš„æµæ°´çº¿å®ä¾‹æå‡åˆ°PRODé˜¶æ®µï¼ˆPhaseï¼‰ï¼›</li><li>æµæ°´çº¿åœ¨åœæ­¢çŠ¶æ€ä¸ä¼šå ç”¨ä»»ä½•Jenkins Master æˆ–è€… SlaveèŠ‚ç‚¹èµ„æºã€‚</li></ul><blockquote><p>å¾€å¾€æ˜¯åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰çš„æ„å»ºï¼ˆBuildï¼‰ä»»åŠ¡ï¼ˆTaskï¼‰ä¸­ç”ŸæˆçŠ¶æ€æ–‡ä»¶ï¼Œåç»­é˜¶æ®µï¼ˆPhaseï¼‰åªæ˜¯æ‹·è´å’Œæ¢å¤ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šæ·»åŠ æ›´å¤šçš„çŠ¶æ€ã€‚</p></blockquote><p>ä¸‹å›¾æ˜¯çŠ¶æ€å­˜å‚¨ä¸æ¢å¤çš„è¿‡ç¨‹ã€‚</p><p><img src="/2018/10/07/jenkins-freestyle-cicd-pipeline/3.png"></p><p>åœ¨ä¸Šæ¸¸é˜¶æ®µï¼ˆPhaseï¼‰çš„ä»»åŠ¡ï¼ˆTaskï¼‰ä¹Ÿå°±æ˜¯Jenkinsä½œä¸šï¼ˆJobï¼‰ä¸­å°†éœ€è¦æŒä¹…çš„çŠ¶æ€ä»¥key-valueçš„æ–¹å¼å­˜å‚¨åˆ°build-info.propæ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡Jenkins Jobçš„å­˜æ¡£åŠŸèƒ½ï¼ˆArchiveï¼‰å°†build-info.propå­˜åˆ°å½“å‰ä½œä¸šï¼ˆJobï¼‰ä¸Šï¼Œä¸‹æ¸¸è¢«è§¦å‘çš„Jenkinä½œä¸šï¼ˆjobï¼‰å°†ä¸Šæ¸¸ä½œä¸šï¼ˆJobï¼‰çš„build-info.propæ‹·è´åˆ°æœ¬åœ°å·¥ä½œåŒºï¼Œå°†å®ƒæ³¨å…¥ä¸ºç¯å¢ƒå˜é‡ã€‚</p><h1 id="åœ¨Jenkinsä¸Šå®ç°è¿™ä¸ªCI-CDæµæ°´çº¿"><a href="#åœ¨Jenkinsä¸Šå®ç°è¿™ä¸ªCI-CDæµæ°´çº¿" class="headerlink" title="åœ¨Jenkinsä¸Šå®ç°è¿™ä¸ªCI/CDæµæ°´çº¿"></a>åœ¨Jenkinsä¸Šå®ç°è¿™ä¸ªCI/CDæµæ°´çº¿</h1><h2 id="Jenkinså’Œå¿…è¦çš„æ’ä»¶"><a href="#Jenkinså’Œå¿…è¦çš„æ’ä»¶" class="headerlink" title="Jenkinså’Œå¿…è¦çš„æ’ä»¶"></a>Jenkinså’Œå¿…è¦çš„æ’ä»¶</h2><ol><li><p>Jenkins<br>ä»Jenkinså®˜ç½‘ï¼ˆ<a href="https://jenkins.io/">https://jenkins.io</a>ï¼‰ä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Jenkinså¹¶å®‰è£…ã€‚æˆ–è€…ï¼Œè‡³å°‘ä¿è¯ä½ çš„Jenkinsç‰ˆæœ¬åœ¨2.0ä»¥ä¸Šï¼Œ1.xç‰ˆæœ¬è¿˜æ˜¯å¤ªæ—§äº†ã€‚</p></li><li><p>å¿…è¦çš„æ’ä»¶</p><ul><li><p>Parameterized Trigger Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Parameterized+Trigger+Plugin">https://wiki.jenkins.io/display/JENKINS/Parameterized+Trigger+Plugin</a></p><p>åœ¨Jenkins pipeline2.0ä¹‹å‰ï¼ŒJobä¹‹å‰çš„è°ƒç”¨ä¸è¢«è°ƒç”¨å…³ç³»æ˜¯é€šè¿‡è¿™ä¸ªæ’ä»¶æˆ–è€…ä¸€ç³»åˆ—åŒç±»çš„æ’ä»¶å®ç°çš„ã€‚</p></li><li><p>Delivery Pipeline Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Delivery+Pipeline+Plugin">https://wiki.jenkins.io/display/JENKINS/Delivery+Pipeline+Plugin</a></p><p>å°†Jobçš„ä¸Šä¸‹æ¸¸è°ƒç”¨å…³ç³»å›¾å½¢åŒ–æ˜¾ç¤ºä¸ºæµæ°´çº¿ã€‚è¿™ä¸ªæ’ä»¶å®ç°äº†CI/CDæµæ°´çº¿çš„ä¸¤ä¸ªæ¦‚å¿µï¼šé˜¶æ®µï¼ˆPhaseï¼‰å’Œä»»åŠ¡ï¼ˆTaskï¼‰ã€‚ä¸€ä¸ªä»»åŠ¡ï¼ˆTaskï¼‰å°±æ˜¯ä¸€ä¸ªJenkins Freestyle Jobï¼ˆä½œä¸šï¼‰ï¼Œä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰å¯ä»¥åŒ…å«å¤šä¸ªä»»åŠ¡ï¼ˆTaskï¼‰ã€‚ä¸‹å›¾æ˜¯ä»æ’ä»¶çš„ç½‘ç«™ä¸Šæˆªå–å‡ºæ¥çš„æœ€ç»ˆCI/CDæµæ°´çº¿çš„æ ·å¼ï¼š<br><img src="/2018/10/07/jenkins-freestyle-cicd-pipeline/1.png"></p></li><li><p>Promte Builds Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Promoted+Builds+Plugin">https://wiki.jenkins.io/display/JENKINS/Promoted+Builds+Plugin</a></p><p>è¿™ä¸ªæ’ä»¶æä¾›äº†ä¸€ç³»åˆ—ä¸Šä¸‹æ¸¸ä½œä¸šï¼ˆJobï¼‰ä¹‹é—´çš„è§¦å‘ç­–ç•¥ï¼Œä¸»è¦åˆ†ä¸ºè‡ªåŠ¨è§¦å‘ï¼Œæ‰‹åŠ¨æ‰¹å‡†è§¦å‘å’Œè‡ªå®šä¹‰æ¡ä»¶è§¦å‘ã€‚é™¤äº†ä¸‰ç§ä¸»è¦çš„è§¦å‘ç­–ç•¥ï¼Œè¿˜æä¾›äº†ä¸€äº›æ›´ç²¾ç»†çš„æ§åˆ¶ç­–ç•¥ï¼Œæ¯”å¦‚å½“å‰çš„æå‡ï¼ˆpromotionï¼‰ä¾èµ–äºå¦ä¸€ä¸ªæå‡ï¼ˆpromotionï¼‰ã€‚å¯å‚è€ƒæ’ä»¶çš„wikiæ–‡æ¡£å’Œå†…è”çš„æ³¨é‡Šè¯¦ç»†äº†è§£æ¯ä¸€ä¸ªè§¦å‘ç­–ç•¥ï¼Œé€‰ä¸­é€‚åˆå½“å‰CI/CDæµæ°´çº¿å»ºè®¾çš„è¦æ±‚ã€‚</p></li><li><p>Copy Artifact Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Copy+Artifact+Plugin">https://wiki.jenkins.io/display/JENKINS/Copy+Artifact+Plugin</a></p><p>è¿™ä¸ªæ’ä»¶å®ç°äº†å®ç°äº†ä¸Šä¸‹æ¸¸ä½œä¸šï¼ˆJobï¼‰ä¼ é€’æ•°æ®çš„åŠŸèƒ½ã€‚åœ¨æ„å»ºCI/CDæµæ°´çº¿æ—¶ï¼Œä¼šå°†æµæ°´çº¿çš„çŠ¶æ€æ•°æ®ä»¥key-valueå€¼çš„æ–¹å¼è®°å½•åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œå¹¶å­˜æ¡£åœ¨å½“å‰çš„ä½œä¸šï¼ˆJobï¼‰ä¸­ã€‚ä¸‹æ¸¸çš„ä½œä¸šï¼ˆJobï¼‰å¯ä»¥é€šè¿‡è¿™ä¸ªæ’ä»¶ä»è§¦å‘å®ƒçš„ä¸Šæ¸¸ä½œä¸šï¼ˆJobï¼‰æ‹·è´è¿™ä¸ªçŠ¶æ€æ•°æ®æ–‡ä»¶ï¼ŒåŠ è½½æˆç¯å¢ƒå˜é‡ï¼Œä»è€Œå®ç°çŠ¶æ€çš„æ¢å¤ã€‚</p></li><li><p>EnvInject Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/EnvInject+Plugin">https://wiki.jenkins.io/display/JENKINS/EnvInject+Plugin</a></p><p>åˆ©ç”¨è¿™ä¸ªæ’ä»¶å¯ä»¥å°†æµæ°´çº¿çš„ä»¥key-valueå€¼çš„æ–¹å¼å­˜å‚¨çš„çŠ¶æ€æ–‡ä»¶åŠ è½½ä¸ºå½“å‰é˜¶æ®µï¼ˆPhaseï¼‰å½“å‰ä»»åŠ¡ï¼ˆTaskï¼‰çš„ç¯å¢ƒå˜é‡ã€‚</p><blockquote><p>æ³¨æ„ï¼Œkeyçš„åå­—ä¸è¦åŒ…å«ä¸­åˆ’çº¿ï¼Œå¦åˆ™Jenkins ä½œä¸šï¼ˆJobï¼‰ä¸è¯†åˆ«ã€‚<br>ä»¥ä¸Šäº”ä¸ªæ’ä»¶æ˜¯å®ç°CI/CDæµæ°´çº¿å¿…éœ€çš„æ’ä»¶ï¼Œè£…è¿™å››ä¸ªæ’ä»¶å¯èƒ½è¿˜ä¼šè‡ªåŠ¨å®‰è£…ä¸€äº›ä¾èµ–çš„æ’ä»¶ã€‚</p></blockquote></li><li><p>Description Setter Plugin<br><a href="http://wiki.jenkins-ci.org/display/JENKINS/Description+Setter+Plugin">http://wiki.jenkins-ci.org/display/JENKINS/Description+Setter+Plugin</a></p><p>è¿™ä¸ªæ’ä»¶æ¯”è¾ƒç®€å•äº†ï¼Œä¸»è¦æ˜¯ç”¨æ¥è®¾ç½®Job(Task)çš„æè¿°ï¼Œè¿™æ ·åœ¨CI/CDæµæ°´çº¿ä¸­èƒ½æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯ã€‚</p></li><li><p>Flexible Publish Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Flexible+Publish+Plugin">https://wiki.jenkins.io/display/JENKINS/Flexible+Publish+Plugin</a></p><p>è¿™ä¸ªæ’ä»¶ä¸»è¦æ˜¯ç”¨æ¥å®ç°ä½œä¸šï¼ˆJobï¼‰ä¸­çš„æ­¥éª¤ï¼ˆstepï¼‰çš„æ§åˆ¶æµï¼Œæ‰©å±•äº†Jenkins ä½œä¸šï¼ˆJobï¼‰çš„æ­¥éª¤ï¼ˆstepsï¼‰åªèƒ½é¡ºåºæ‰§è¡Œçš„æ–¹å¼ã€‚</p></li><li><p>Email-ext Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Email-ext+plugin">https://wiki.jenkins.io/display/JENKINS/Email-ext+plugin</a></p><p>æ‰©å±•çš„é‚®ä»¶æ’ä»¶ï¼Œèƒ½å¤Ÿå®šåˆ¶å¤æ‚çš„é‚®ä»¶å†…å®¹ã€‚é‚®ä»¶é€šçŸ¥æ˜¯ä¸€ä¸ªæˆç†Ÿçš„CI/CDæµæ°´çº¿å¿…è¦çš„ç‰¹å¾ã€‚</p></li><li><p>Token Macro Plugin<br><a href="https://wiki.jenkins.io/display/JENKINS/Token+Macro+Plugin">https://wiki.jenkins.io/display/JENKINS/Token+Macro+Plugin</a></p><p>åœ¨ä½œä¸šï¼ˆJobï¼‰çš„æè¿°æˆ–é€šçŸ¥é‚®ä»¶çš„å†…å®¹ä¸­å¯ä»¥é€šè¿‡å¼•ç”¨Jenkinså½“å‰æ„å»ºï¼ˆbuildï¼‰çš„ç¯å¢ƒå˜é‡å®ç°æè¿°æˆ–é‚®ä»¶å†…å®¹çš„æ¨¡æ¿åŒ–ã€‚Token Macroæ’ä»¶åˆ™è´Ÿè´£åœ¨è¿è¡Œæ—¶è§£æè¿™äº›å˜é‡å¼•ç”¨ã€‚</p></li></ul></li></ol><h2 id="Jenkins-Jobé…ç½®"><a href="#Jenkins-Jobé…ç½®" class="headerlink" title="Jenkins Jobé…ç½®"></a>Jenkins Jobé…ç½®</h2><p>ä¸ºäº†å®ç°è¿™ä¸ªCI/CDæµæ°´çº¿ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªJenkins Jobæ‰€éœ€çš„æ­¥éª¤ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„Jobéƒ½éœ€è¦å®ç°æ‰€æœ‰çš„æ­¥éª¤ã€‚æ¯”å¦‚Build/UTé˜¶æ®µï¼ˆPhaseï¼‰çš„Buildä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯æ•´ä¸ªæµæ°´çº¿çš„ç¬¬ä¸€ä¸ªJenkinsä½œä¸šï¼ˆJobï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦æ­¥éª¤3å»æ‹·è´æµæ°´çº¿çŠ¶æ€æ–‡ä»¶ï¼Œä¹Ÿä¸éœ€è¦æ­¥éª¤4å»åŠ è½½çŠ¶æ€æ–‡ä»¶ï¼Œè€Œæœ€åä¸€ä¸ªSmoke Testä»»åŠ¡ï¼ˆTaskï¼‰ä¹Ÿä¸è¦æ­¥éª¤2å»æå‡ï¼ˆPromoteï¼‰åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰æˆ–è€…ä»»åŠ¡ï¼ˆTaskï¼‰ã€‚</p><p><img src="/2018/10/07/jenkins-freestyle-cicd-pipeline/4.png"></p><p>æ­¥éª¤çš„ä¸€äº›è¯´æ˜ï¼š</p><ol><li><p>é…ç½®â€œDelivery Pipelineâ€èŠ‚ã€‚â€œStage Nameâ€æ˜¯é˜¶æ®µï¼ˆPhaseï¼‰åï¼Œâ€œTask Nameâ€æ˜¯è¿™ä¸ªJenkins Jobåœ¨è¿™ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ä¸­çš„ä»»åŠ¡ï¼ˆTaskï¼‰åå­—ï¼›</p></li><li><p>Jenkinsä½œä¸šï¼ˆJobï¼‰æå‡ï¼ˆPromotionï¼‰çš„é…ç½®ã€‚åœ¨â€œCriteriaâ€ä¸‹é€‰æ‹©æå‡ï¼ˆPromotionï¼‰çš„ç­–ç•¥ï¼Œåœ¨â€œActionsâ€ä¸­é€‰æ‹©å¾…è§¦å‘çš„ä¸‹æ¸¸Jenkinsä½œä¸šï¼ˆJobï¼‰ï¼›</p></li><li><p>ä»ä¸Šæ¸¸ä½œä¸šï¼ˆJobï¼‰æ‹·è´æµæ°´çº¿çŠ¶æ€æ–‡ä»¶ï¼›</p></li><li><p>å°†çŠ¶æ€æ–‡ä»¶åŠ è½½ä¸ºå½“å‰ä½œä¸šï¼ˆJobï¼‰çš„ç¯å¢ƒå˜é‡ã€‚</p></li></ol><h2 id="å¦‚ä½•æå‡ï¼ˆPromoteï¼‰é˜¶æ®µï¼ˆPhaseï¼‰æˆ–ä»»åŠ¡ï¼ˆTaskï¼‰"><a href="#å¦‚ä½•æå‡ï¼ˆPromoteï¼‰é˜¶æ®µï¼ˆPhaseï¼‰æˆ–ä»»åŠ¡ï¼ˆTaskï¼‰" class="headerlink" title="å¦‚ä½•æå‡ï¼ˆPromoteï¼‰é˜¶æ®µï¼ˆPhaseï¼‰æˆ–ä»»åŠ¡ï¼ˆTaskï¼‰"></a>å¦‚ä½•æå‡ï¼ˆPromoteï¼‰é˜¶æ®µï¼ˆPhaseï¼‰æˆ–ä»»åŠ¡ï¼ˆTaskï¼‰</h2><p>ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•æå‡ï¼ˆPromoteï¼‰é˜¶æ®µï¼ˆPhaseï¼‰æˆ–ä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œä¹Ÿå°±æ˜¯Jenkinsä½œä¸šï¼ˆJobï¼‰ï¼š<br><img src="/2018/10/07/jenkins-freestyle-cicd-pipeline/5.png"></p><p>æ­¥éª¤çš„ä¸€äº›è¯´æ˜ï¼š</p><ol><li><p>åœ¨å½“å‰çš„æµæ°´çº¿å®ä¾‹ä¸­æ‰“å¼€ä¸Šæ¸¸ä½œä¸šï¼ˆJobï¼‰çš„æ„å»ºï¼ˆBuildï¼‰é¡µé¢ï¼Œç‚¹å‡»å·¦ä¾§é“¾æ¥â€œPromotions Statusâ€ï¼›</p></li><li><p>åªæœ‰åœ¨â€œApproversâ€åˆ—è¡¨é‡Œçš„ç”¨æˆ·æœ‰æƒæ‰‹åŠ¨æ‰¹å‡†æå‡ï¼ˆPromotionï¼‰ï¼›</p></li><li><p>ç‚¹å‡»â€œApproveâ€æŒ‰é’®è§¦å‘æå‡ï¼ˆPromotionï¼‰ï¼›</p></li><li><p>Jenkinsç®¡ç†å‘˜æœ‰æƒé™å¼ºåˆ¶æå‡ï¼ˆPromotionï¼‰ï¼›</p></li><li><p>é€šè¿‡ç‚¹å‡»â€œRe-execute promotionâ€å¯é‡å¤æå‡ï¼ˆPromoteï¼‰å½“å‰çš„ä½œä¸šï¼ˆJobï¼‰ã€‚</p></li></ol><h1 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h1><p>æ¯ä¸€ç§æ–¹æ³•æœ‰å®ƒçš„ä¼˜ç‚¹ï¼Œå¿…å®šä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ³•æ˜¯é“¶å¼¹ï¼Œå¯ä»¥è§£å†³ä¸€åˆ‡é—®é¢˜ï¼Œæ‰“è´¥å¤©ä¸‹æ— æ•Œæ‰‹ã€‚æ˜¯å¦ä½¿ç”¨å®ƒï¼Œå°±è¦è‡ªå·±å»æƒè¡¡ï¼šæ˜¯å®ƒçš„ä¼˜ç‚¹ç»™ä½ å¸¦æ¥äº†æ›´å¤šï¼Œè¿˜æ˜¯å®ƒçš„ç¼ºç‚¹æ˜¯å½“å‰çš„æœ€å¤§éšœç¢ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li><p>ä»…ç®¡â€œDelivery Pipeline Pluginâ€å¯ä»¥å›¾å½¢åŒ–æ˜¾ç¤ºJenkins Pipeline 2.0ï¼ˆJenkinsfileï¼‰ä½œä¸šï¼ˆJobï¼‰çš„ä¸Šä¸‹æ¸¸è°ƒç”¨å…³ç³»ï¼Œä½†æ˜¯â€œPromotes Builds Pluginâ€ä¸æ”¯æŒJenkins Pipeline 2.0ï¼ˆJenkinsfileï¼‰ï¼Œæ‰€ä»¥å¤ªå¤šçš„Freestyle Jobè¦å»åˆ›å»ºï¼Œè®¾ç½®å’Œç»´æŠ¤ï¼Œè¿™äº›Jobåªèƒ½ä½œä¸ºé…ç½®å­˜å‚¨åœ¨Jenkins MasteræœåŠ¡å™¨ä¸Šï¼Œè€Œä¸èƒ½ä½œä¸ºä»£ç å­˜å‚¨åœ¨Gitä¸­ï¼›</p></li><li><p>ä¼šå¤šå ç”¨ä¸€äº›SlaveèŠ‚ç‚¹çš„çº¿ç¨‹ï¼Œå› ä¸ºä½œä¸šï¼ˆJobï¼‰çš„æå‡å…¶å®ä¹Ÿæ˜¯ä½œä¸šï¼ˆJobï¼‰éœ€è¦å ç”¨ä¸€ä¸ªSlaveçº¿ç¨‹ã€‚</p></li></ol><p>æœŸå¾…â€œPromotes Builds Pluginâ€èƒ½å¤Ÿæ”¯æŒJenkins Pipeline 2.0 ï¼ˆJenkinfileï¼‰ï¼Œè¿™æ ·æ‰€æœ‰çš„ä»»åŠ¡ï¼ˆTaskï¼‰ä¹Ÿå°±æ˜¯Jenkinsä½œä¸šï¼ˆJobï¼‰å…¨éƒ¨å¯ä»¥ä½œä¸ºä»£ç å­˜å‚¨åœ¨Gitä¸­ï¼Œè€Œä¸”ç»´æŠ¤èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>DevOps</tag>
      
      <tag>CI/CD</tag>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo+Gitee(ç äº‘)æ­å»ºé™æ€åšå®¢ç½‘ç«™</title>
    <link href="/2018/08/17/setup-blog-hexo-gitee/"/>
    <url>/2018/08/17/setup-blog-hexo-gitee/</url>
    
    <content type="html"><![CDATA[<p>ç›´æ¥æ³¨å†Œå’Œä½¿ç”¨å½“ä¸‹æ¯”è¾ƒæµè¡Œçš„åšå®¢ç½‘ç«™æ¯”å¦‚csdn, oschina, åšå®¢å›­ç­‰ç­‰ï¼Œè§‰å¾—ä¸æ˜¯è‡ªå·±ä¸“å±ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šå¹¿å‘Šã€‚é€‰æ‹©ä¸€æ¬¾å¼€æºæˆ–å…è´¹çš„CMS(å†…å®¹ç®¡ç†ç³»ç»Ÿ)ï¼Œè‡ªå·±ä¹°äº‘ä¸»æœºå’ŒåŸŸåæ­å»ºåšå®¢ï¼Œè´¹é’±åˆè´¹æ—¶ã€‚æœ‰æ—¶æˆ‘ä»¬åªæ˜¯å¸Œæœ›æœ‰ä¸€ä¸ªåŠŸèƒ½ä¸å¤ªå¤æ‚ï¼Œè‡ªå·±ä¸“å±çš„æˆ–è€…çœ‹èµ·æ¥è‡ªå·±ä¸“å±çš„ï¼ˆè‡³å°‘æ²¡æœ‰ä¸€å †å¹¿å‘Šï¼‰åšå®¢ç½‘ç«™æ¥å†™å†™å’Œåˆ†äº«è‡ªå·±çš„æ–‡ç« ã€‚ä¸éœ€è¦èŠ±è´¹å¤ªå¤šçš„æ—¶é—´å’Œé’±ï¼Œé™¤éä½ çš„åšå®¢å’Œæ–‡ç« å·²ç»è¶³å¤Ÿçƒ­é—¨ã€‚åŸºäºä»¥ä¸Šçš„æœŸæœ›ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Hexoæ­å»ºé™æ€åšå®¢ç½‘ç«™ï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ°GITEE(ç äº‘)å…è´¹æä¾›çš„é™æ€ç½‘é¡µç©ºé—´é‡Œã€‚</p><span id="more"></span><h1 id="Hexoæ˜¯ä»€ä¹ˆ"><a href="#Hexoæ˜¯ä»€ä¹ˆ" class="headerlink" title="Hexoæ˜¯ä»€ä¹ˆ"></a>Hexoæ˜¯ä»€ä¹ˆ</h1><p>Hexoæ˜¯ä¸€æ¬¾å…è´¹çš„ç”¨æ¥å¿«é€Ÿæ­å»ºé™æ€åšå®¢ç½‘ç«™çš„æ¡†æ¶ã€‚æ”¯æŒæ’ä»¶æœºåˆ¶ï¼Œç®€å•åˆä¸å¤±å¼ºå¤§ã€‚Hexoæ˜¯åŸºäºNode.jså¼€å‘çš„ï¼Œæä¾›äº†ä¸€ç»„å‘½ä»¤ç”¨æ¥åˆ›å»ºå’Œç®¡ç†åšå®¢åº”ç”¨ï¼Œåˆ›å»ºå’Œç®¡ç†åšå®¢æ–‡ç« ï¼Œå°†åšå®¢åº”ç”¨å’Œæ–‡ç« å‘å¸ƒæˆé™æ€åšå®¢ç½‘ç«™ã€‚Hexoä½¿ç”¨Markdownè¯­è¨€æ¥å†™åšå®¢ï¼Œæ–¹ä¾¿ã€å¿«æ·ï¼Œä¸éœ€è¦ä»€ä¹ˆé¢å¤–çš„æ’ç‰ˆå·¥å…·å°±èƒ½ä½¿ä½ çš„æ–‡ç« å¸ƒå±€çœ‹èµ·æ¥å¾ˆç¾è§‚ã€‚ä¸‹å›¾æ˜¯Hexoåšå®¢ç½‘ç«™çš„ç»“æ„ï¼š<br><img src="/2018/08/17/setup-blog-hexo-gitee/1.png"></p><h1 id="Giteeæ˜¯ä»€ä¹ˆ"><a href="#Giteeæ˜¯ä»€ä¹ˆ" class="headerlink" title="Giteeæ˜¯ä»€ä¹ˆ"></a>Giteeæ˜¯ä»€ä¹ˆ</h1><p>Giteeï¼ˆç äº‘ <a href="https://gitee.com/">gitee.com</a>ï¼‰æ˜¯å›½å†…çš„ä¸€æ¬¾åŸºäºGitçš„ä»£ç æ‰˜ç®¡å’Œåä½œå¼€å‘å¹³å°ï¼Œå’ŒGitHub, GitLabå±äºåŒä¸€ç±»å‹çš„äº§å“ã€‚åŒGitHubå’ŒGitLabç›¸æ¯”ï¼ŒGiteeå…·æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ï¼š</p><ul><li>æ”¯æŒå…è´¹çš„ç§æœ‰Gitä»£ç ä»“åº“</li><li>åœ¨å›½å†…ï¼Œä¸éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œè®¿é—®é€Ÿåº¦å¿«  </li></ul><p>Giteeå¹³å°ä¹Ÿæä¾›äº†å…è´¹çš„é™æ€é¡µé¢æ‰˜ç®¡æœåŠ¡â€œç äº‘Pagesâ€ï¼Œå¯ä»¥ç”¨æ¥æ‰˜ç®¡åšå®¢ï¼Œé¡¹ç›®å®˜ç½‘ç­‰é™æ€ç½‘é¡µã€‚â€œç äº‘Pages Proâ€æ˜¯è¿™ä¸ªæœåŠ¡çš„é«˜é˜¶æ”¶è´¹ç‰ˆï¼Œæ”¯æŒå‘å¸ƒä»£ç ä»“åº“ä¸­çš„æŸä¸ªç›®å½•ï¼Œæ”¯æŒè‡ªå®šä¹‰åŸŸåã€‚</p><blockquote><p>è¦è¯¦ç»†äº†è§£Giteeçš„æ¦‚å¿µå’Œä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒGiteeçš„å®˜æ–¹åœ¨çº¿å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://gitee.com/help">https://gitee.com/help</a></p></blockquote><p>æœ¬æ–‡å°†ä¼šåœ¨Giteeä¸Šåˆ›å»ºGitä»£ç ä»“åº“ç®¡ç†Hexoåšå®¢åº”ç”¨çš„ä»£ç å’Œé™æ€åšå®¢ç½‘ç«™ï¼ŒåŒæ—¶å°†é™æ€åšå®¢ç½‘é¡µæ‰˜ç®¡åˆ°â€œç äº‘Pagesâ€ã€‚</p><h1 id="ä»é›¶å¼€å§‹æ­å»ºä¸“å±åšå®¢"><a href="#ä»é›¶å¼€å§‹æ­å»ºä¸“å±åšå®¢" class="headerlink" title="ä»é›¶å¼€å§‹æ­å»ºä¸“å±åšå®¢"></a>ä»é›¶å¼€å§‹æ­å»ºä¸“å±åšå®¢</h1><p>ä»‹ç»å®ŒHexoå’ŒGiteeåï¼Œæ˜ç™½äº†å®ƒä»¬çš„æ¦‚å¿µå’Œç”¨é€”ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä»é›¶å¼€å§‹å®Œæ•´åœ°æ­å»ºä¸€ä¸ªè‡ªå·±ä¸“å±çš„åšå®¢ã€‚</p><h2 id="å®‰è£…å¿…å¤‡çš„è½¯ä»¶"><a href="#å®‰è£…å¿…å¤‡çš„è½¯ä»¶" class="headerlink" title="å®‰è£…å¿…å¤‡çš„è½¯ä»¶"></a>å®‰è£…å¿…å¤‡çš„è½¯ä»¶</h2><ul><li>å®‰è£…Node.js<ul><li>Macä¸Šå®‰è£…</li><li>Linuxä¸Šå®‰è£…</li><li>Windowsä¸Šå®‰è£…</li></ul></li><li>å®‰è£…Gitå®¢æˆ·ç«¯<ul><li>Macä¸Šå®‰è£…</li><li>Linuxä¸Šå®‰è£…</li><li>Windowsä¸Šå®‰è£…</li></ul></li></ul><h2 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h2><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…Hexoï¼ˆHexoå‘½ä»¤è¡Œï¼‰åˆ°Node.jsçš„å…¨å±€ç©ºé—´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><blockquote><p>Hexoæ˜¯ç”¨Node.jså¼€å‘çš„ï¼Œæ‰€ä»¥å®ƒä»¥npmåŒ…æ ¼å¼å‘å¸ƒã€‚</p></blockquote><h2 id="åˆ›å»ºä¸€ä¸ªæ–°çš„åšå®¢åº”ç”¨"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„åšå®¢åº”ç”¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„åšå®¢åº”ç”¨"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„åšå®¢åº”ç”¨</h2><ol><li><p>ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹shellå‘½ä»¤åˆ›å»ºä¸€ä¸ªç¼ºçœçš„åšå®¢åº”ç”¨ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo init hexo-test-blog<br><span class="hljs-built_in">cd</span> hexo-test-blog<br>npm install<br></code></pre></td></tr></table></figure><blockquote><p>åšå®¢åº”ç”¨çš„æ–‡ä»¶ç»“æ„ï¼š<br>.<br>â”œâ”€â”€ _config.yml<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ scaffolds<br>â”‚Â Â  â”œâ”€â”€ draft.md<br>â”‚Â Â  â”œâ”€â”€ page.md<br>â”‚Â Â  â””â”€â”€ post.md<br>â”œâ”€â”€ source<br>â”‚Â Â  â””â”€â”€ _posts<br>â”‚Â Â  â””â”€â”€ _drafts<br>â””â”€â”€ themes<br>â”‚   â””â”€â”€ landscape  </p><ul><li>_config.yml<br>åšå®¢ç«™ç‚¹é…ç½®æ–‡ä»¶ã€‚</li><li>package.json<br>åšå®¢åº”ç”¨å¼•ç”¨çš„ç¬¬ä¸‰æ–¹Node.jsåŒ…ã€‚</li><li>scaffolds<br>è„šæ‰‹æ¶æ˜¯ç”¨æ¥å¿«é€Ÿåˆ›å»ºåšå®¢é¡µé¢çš„æ¨¡æ¿ã€‚æœ‰ä¸‰ç±»æ¨¡æ¿ï¼Œâ€œæ–‡ç« â€ï¼Œâ€œè‰ç¨¿â€å’Œâ€œé¡µé¢â€ã€‚è„šæ‰‹æ¶ä¸æ˜¯æœ€ç»ˆåšå®¢é¡µé¢æ˜¾ç¤ºçš„æ¨¡æ¿ï¼Œæ˜¾ç¤ºæ˜¯ç”±å½“å‰ä¸»é¢˜çš„layoutæ–‡ä»¶å¤¹ä¸­çš„æ¨¡æ¿è´Ÿè´£ã€‚</li><li>source<br>åšå®¢æ–‡ç« çš„å­˜æ”¾ç›®å½•ã€‚åˆ†ä¸ºâ€œ_postsâ€å’Œâ€œ_draftsâ€ä¸¤ä¸ªå­ç›®å½•ï¼Œåˆ†åˆ«å­˜æ”¾æ­£å¼æ–‡ç« å’Œè‰ç¨¿æ–‡ç« ã€‚</li><li>themes<br>Hexoåšå®¢çš„ä¸»é¢˜ã€‚ç¼ºçœå®‰è£…çš„ä¸»é¢˜æ˜¯â€œlandscapeâ€ã€‚</li></ul></blockquote></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ„å»ºåšå®¢åº”ç”¨ï¼Œç”Ÿæˆé™æ€åšå®¢ç½‘ç«™</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm intall<br>hexo generate<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªæœ¬åœ°httpæœåŠ¡æŸ¥çœ‹é™æ€åšå®¢ç½‘ç«™  </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo server<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http<nolink>://localhost:4000æ‰“å¼€åšå®¢ç½‘ç«™ã€‚</p></blockquote></li><li><p>è®¾ç½®ä¸€äº›â€œåº”ç”¨é…ç½®â€(_config.yml)</p><blockquote><p>è¿™é‡Œå°†æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶â€_config.ymlâ€œç§°ä¸ºâ€åº”ç”¨é…ç½®â€œä»¥ä¾¿ä¸åé¢çš„â€œä¸»é¢˜é…ç½®â€åŒºåˆ†çœ‹æ¥ã€‚â€ä¸»é¢˜é…ç½®â€œæ˜¯ä½äºåšå®¢åº”ç”¨çš„ä¸»é¢˜æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œåå­—ä¹Ÿæ˜¯â€_config.ymlâ€œã€‚</p></blockquote><ul><li><p>title: è‹¥ä¸€æ‹¾å¾—</p></li><li><p>subtitle: è‹¥ä¸€ä¸ä¸€ï¼ŒçŸ¥ä¹‹ä¸çŸ¥</p></li><li><p>description:</p></li><li><p>keywords: DevOps, Infrastructure As Code(IAC), CI/CD, Operation, Monitor, Python</p></li><li><p>author: è‹¥ä¸€</p></li><li><p>language: zh-Hans</p></li><li><p>timezone: Asia/Shanghai</p></li><li><p>url: <a href="http://www.ruokiy.com/">http://www.ruokiy.com</a></p></li><li><p>root: /</p></li><li><p>permalink: :year/:month/:day/:title/ =&gt; æ–‡ç« é¡µé¢çš„æ°¸ä¹…é“¾æ¥</p></li><li><p>permalink_defaults:</p><blockquote><p>å¯ä»¥å‚è€ƒHexoçš„å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šçš„Hexoå‘½ä»¤ã€‚</p></blockquote></li></ul></li></ol><h2 id="ä¸ºåšå®¢åº”ç”¨å®‰è£…æ–°çš„ä¸»é¢˜"><a href="#ä¸ºåšå®¢åº”ç”¨å®‰è£…æ–°çš„ä¸»é¢˜" class="headerlink" title="ä¸ºåšå®¢åº”ç”¨å®‰è£…æ–°çš„ä¸»é¢˜"></a>ä¸ºåšå®¢åº”ç”¨å®‰è£…æ–°çš„ä¸»é¢˜</h2><p>Hexoè‡ªå¸¦çš„ä¸»é¢˜â€œlandscapeâ€çœ‹èµ·æ¥å¹³å¹³ï¼Œä¸å¤Ÿç®€æ´ä¹Ÿä¸å¤Ÿå¯Œä¸½ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†äººå®‰è£…å’Œåˆå§‹åŒ–å®ŒHexoåšå®¢åº”ç”¨åï¼Œæ¥ä¸‹æ¥çš„ä¸€æ­¥å°±æ˜¯å®‰è£…é…ç½®è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ã€‚ä¸‹é¢å°±ä»¥ä»¥ç®€æ´è‘—ç§°çš„â€œNexTâ€ä¸»é¢˜ä¸ºä¾‹ï¼Œä»‹ç»å®‰è£…å’Œé…ç½®ä¸»é¢˜çš„æ­¥éª¤ã€‚</p><p>â€œNexTâ€ä¸»é¢˜åœ¨GitHubä¸Šï¼Œåœ°å€ä¸º<a href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a>ã€‚</p><blockquote><p>æ³¨æ„ï¼šGitHubä¸Šè¿˜æœ‰å¾ˆå¤šâ€œNexTâ€çš„forkç‰ˆ, ä¸Šé¢çš„åœ°å€æ˜¯å®˜æ–¹æœ€æ–°çš„ç‰ˆæœ¬ã€‚<a href="https://github.com/iissnan/hexo-theme-next">https://github.com/iissnan/hexo-theme-next</a>æ˜¯â€œNexTâ€çš„ä¸€ä¸ªè€ç‰ˆæœ¬ã€‚</p></blockquote><h3 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h3><ol><li><p>å…‹éš†â€œNexTâ€ä¸»é¢˜åˆ°åšå®¢åº”ç”¨çš„themesç›®å½•</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹â€œåº”ç”¨é…ç½®â€ä½¿ç”¨â€œNexTâ€ä¸»é¢˜</p><ul><li>theme: next</li></ul></li></ol><h3 id="å¯¹â€œNexTâ€ä¸»é¢˜çš„ä¸€äº›é…ç½®"><a href="#å¯¹â€œNexTâ€ä¸»é¢˜çš„ä¸€äº›é…ç½®" class="headerlink" title="å¯¹â€œNexTâ€ä¸»é¢˜çš„ä¸€äº›é…ç½®"></a>å¯¹â€œNexTâ€ä¸»é¢˜çš„ä¸€äº›é…ç½®</h3><p>è¿™ä¸ªæ®µè½åŠ ä¸Šåé¢çš„å¯¹æ¥ç¬¬ä¸‰å‘ç³»ç»Ÿéƒ¨åˆ†å°†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„é…ç½®ã€‚å¦‚æœéœ€è¦æ›´å¤šçš„è®¾ç½®ï¼Œå¯è¯¦ç»†æµè§ˆâ€œåº”ç”¨é…ç½®â€å’Œâ€œä¸»é¢˜é…ç½®â€ä¸­çš„æ¯ä¸€ä¸ªå¯æ›´æ”¹çš„é…ç½®ï¼Œå¹¶å‚è€ƒå¯¹åº”çš„æ–‡æ¡£ï¼Œæˆ–è€…Googleã€Baiduæ¥äº†è§£é…ç½®çš„ä½œç”¨ï¼Œåˆ†ææ˜¯å¦èƒ½æ»¡è¶³ä½ çš„è¦æ±‚ã€‚</p><ul><li><p>å»é™¤é¡µè„šä¸­çš„æœ‰å…³â€œNexTâ€çš„ä¿¡æ¯å’Œé“¾æ¥</p><p>ç¼–è¾‘â€œä¸»é¢˜é…ç½®â€ï¼Œå°†â€œfooter|powered|enableâ€ï¼Œâ€œfooter|powerer|versionâ€ï¼Œâ€œfooter|theme|enableâ€ä»¥åŠâ€œfooter|theme|versionâ€éƒ½è®¾æˆâ€œfalseâ€ã€‚</p></li><li><p>æ·»åŠ â€œaboutâ€å’Œâ€œtagsâ€é¡µ<br>Hexoç¼ºçœæ”¯æŒè¿™ä¸¤ä¸ªç±»å‹çš„é¡µé¢ã€‚<br>(1) æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨æ ¹ç›®å½•ä¸‹çš„sourceç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºâ€œaboutâ€å’Œâ€œtagsâ€æ–‡ä»¶å¤¹</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new page about<br>hexo new page tags<br></code></pre></td></tr></table></figure><p>(2) ç¼–è¾‘â€œæ ¹ç›®å½•/source/tags/index.mdâ€ï¼Œåœ¨å¤´éƒ¨åŠ ä¸Šâ€œtype: tagsâ€</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">tags</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-08-17 14:57:19</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">tags</span><br><span class="hljs-attr">comments:</span> <span class="hljs-literal">false</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>(3) ç¼–è¾‘â€œä¸»é¢˜é…ç½®â€ï¼Œå°†â€œmenu|aboutâ€å’Œâ€œmenu|tagsâ€æ‰“å¼€</p></li><li><p>è®¾ç½®åšå®¢ç‰ˆé¢æ ·å¼<br>ä¹Ÿå°±æ˜¯åšå®¢ç½‘ç«™çš„æ ·å¼ï¼Œæ¯”å¦‚ä¸€åˆ—æˆ–è€…ä¸¤åˆ—ã€‚å¯ä»¥é€šè¿‡â€œä¸»é¢˜é…ç½®â€ä¸­çš„â€œschemeâ€æ¥è®¾ç½®ã€‚</p></li><li><p>å¼€å¯åšå®¢é¦–é¡µæ–‡ç« è‡ªåŠ¨æ‘˜å½•ï¼Œä»¥åŠæ‘˜å½•å­—æ•°é™åˆ¶<br>ç¼–è¾‘â€œä¸»é¢˜é…ç½®â€ï¼Œå°†â€œauto_excerpt|enableâ€è®¾æˆâ€œtrueâ€ï¼Œè®¾ç½®â€œauto_excerpt|lengthâ€ä¸ºæŒ‡å®šçš„æ‘˜å½•å­—æ•°ã€‚</p><blockquote><p>æ ¹æ®æè¿°ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ç¬¦å·â€œ&lt;!-- more --&gt;â€æ¥ç²¾ç¡®æ§åˆ¶è‡ªåŠ¨æ‘˜å½•çš„ç»“æŸç‚¹ã€‚</p></blockquote></li></ul><h2 id="å¯¹æ¥ç¬¬ä¸‰å‘ç³»ç»Ÿå®Œå–„åšå®¢åº”ç”¨"><a href="#å¯¹æ¥ç¬¬ä¸‰å‘ç³»ç»Ÿå®Œå–„åšå®¢åº”ç”¨" class="headerlink" title="å¯¹æ¥ç¬¬ä¸‰å‘ç³»ç»Ÿå®Œå–„åšå®¢åº”ç”¨"></a>å¯¹æ¥ç¬¬ä¸‰å‘ç³»ç»Ÿå®Œå–„åšå®¢åº”ç”¨</h2><p>ç”±äºHexoäº§ç”Ÿçš„æ˜¯é™æ€åšå®¢ç½‘ç«™ï¼Œæ²¡æœ‰è‡ªå·±çš„ç‹¬ç«‹æ•°æ®åº“ï¼Œæ‰€ä»¥å¾ˆå¤šåŠŸèƒ½éœ€è¦åˆ©ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–è€…æ’ä»¶æ¥å®Œæˆã€‚</p><h3 id="è¯„è®ºç³»ç»Ÿ"><a href="#è¯„è®ºç³»ç»Ÿ" class="headerlink" title="è¯„è®ºç³»ç»Ÿ"></a>è¯„è®ºç³»ç»Ÿ</h3><p>å¦‚æœä¸èƒ½ç§‘å­¦ä¸Šç½‘çš„è¯ï¼ŒåŸºæœ¬ä¸Šä¸å¤ªå¯èƒ½ä½¿ç”¨å›½å¤–çš„è¯„è®ºç³»ç»Ÿæ¯”å¦‚Disqusï¼ŒHypercommentsï¼ŒLiveReç­‰ï¼Œè¦ä¹ˆè®¿é—®é€Ÿåº¦æ…¢ï¼Œè¦ä¹ˆè¢«å¢™ã€‚è€Œå›½å†…å¯ç”¨çš„ç¬¬ä¸‰æ–¹è¯„è®ºç³»ç»Ÿä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œå¤šè¯´å’Œç½‘æ˜“äº‘è·Ÿå¸–å·²ç»å…³é—­ï¼Œç•…è¨€éœ€è¦æä¾›ä½ çš„ç½‘ç«™ICPå¤‡æ¡ˆå·ï¼Œå¦åˆ™åªæœ‰15å¤©çš„è¯•ç”¨æœŸã€‚ç»è¿‡æ¯”è¾ƒï¼Œå‘ç°Valineæ˜¯ä¸€ä¸ªæ¯”è¾ƒè½»é‡çº§çš„è¯„è®ºç³»ç»Ÿï¼Œé€Ÿåº¦å¿«ï¼Œä¸éœ€è¦ç½‘ç«™å¤‡æ¡ˆï¼ˆè¯´ä¸å®šä»¥åéœ€è¦ï¼Œå…ˆç”¨ç€å†è¯´ï¼ï¼‰ã€‚</p><blockquote><p>å¦‚æœéè¦å°è¯•ç•…è¨€çš„è¯ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªåšå®¢æ–‡ç« <a href="https://blog.csdn.net/qq_32518231/article/details/78080184">https://blog.csdn.net/qq_32518231/article/details/78080184</a></p></blockquote><p>ç»™ä½ çš„åšå®¢åº”ç”¨è®¾ç½®Valineè¯„è®ºç³»ç»Ÿçš„æ­¥éª¤ï¼š<br>(1) åœ¨LeanCloud<a href="https://www.leancloud.cn/">https://www.leancloud.cn</a>ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ï¼›</p><pre><code>åšå®¢çš„è¯„è®ºå°†å­˜å‚¨åœ¨LeadCloudä¸­ã€‚</code></pre><p>(2) è¿›å…¥æ§åˆ¶å°ï¼Œåˆ›å»ºä¸€ä¸ªå¼€å‘ç‰ˆçš„åº”ç”¨ï¼›</p><p>(3) ç‚¹å‡»è¿›å…¥è¿™ä¸ªåº”ç”¨ï¼Œå¹¶è¿›å…¥è®¾ç½®|åº”ç”¨keyé¡µé¢è·å–APP IDå’ŒAPP KEYï¼›</p><p>(4) ä¿®æ”¹ä¸»é¢˜é…ç½®ï¼Œå°†valine|enableè®¾ä¸ºtrueï¼Œvaline|appidè®¾ä¸ºä¸Šä¸€æ­¥è·å–çš„APP IDï¼Œvaline|appkeyè®¾ä¸ºä¸Šä¸€æ­¥è·å–çš„APP KEYã€‚</p><pre><code>éœ€è¦å°†ä½ çš„é™æ€åšå®¢å‘å¸ƒåˆ°çº¿ä¸Šæ‰ä¼šçœ‹åˆ°æ–‡ç« æœ«å°¾çš„valineè¯„è®ºæ¨¡å—</code></pre><h3 id="æ–‡ç« ç»Ÿè®¡"><a href="#æ–‡ç« ç»Ÿè®¡" class="headerlink" title="æ–‡ç« ç»Ÿè®¡"></a>æ–‡ç« ç»Ÿè®¡</h3><ul><li><p>æ·»åŠ â€œæ–‡ç« å­—æ•°â€å’Œâ€œæ–‡ç« å¹³å‡é˜…è¯»æ—¶é—´â€ç»Ÿè®¡ã€‚</p><p>  (1) åœ¨åšå®¢åº”ç”¨çš„æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…â€œhexo-sysmbols-count-timeâ€æ’ä»¶</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-symbols-count-time --save<br></code></pre></td></tr></table></figure><p>  (2) ä¿®æ”¹<strong>åº”ç”¨é…ç½®</strong>æ·»åŠ ä»¥ä¸‹é…ç½®åŠ è½½â€œhexo-symbols-count-timeâ€æ’ä»¶</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">symbols_count_time:</span><br><span class="hljs-attr">symbols:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">time:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">total_symbols:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">total_time:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>  (3) ä¿®æ”¹<strong>ä¸»é¢˜é…ç½®</strong>ä¸­çš„ä»¥ä¸‹é…ç½®</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">symbols_count_time:</span><br><span class="hljs-attr">separated_meta:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">item_text_post:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">item_text_total:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">awl:</span> <span class="hljs-number">4</span><br><span class="hljs-attr">wpm:</span> <span class="hljs-number">275</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="ç¤¾äº¤åˆ†äº«"><a href="#ç¤¾äº¤åˆ†äº«" class="headerlink" title="ç¤¾äº¤åˆ†äº«"></a>ç¤¾äº¤åˆ†äº«</h3><p>æ·»åŠ æ¨¡å—<a href="https://github.com/theme-next/theme-next-needmoreshare2">https://github.com/theme-next/theme-next-needmoreshare2</a>è·å¾—åšå®¢æ–‡ç« ç¤¾äº¤åˆ†äº«çš„åŠŸèƒ½ã€‚</p><p>(1) æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…needmoreshareæ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> themes/next<br>git <span class="hljs-built_in">clone</span> https://github.com/theme-next/theme-next-needmoreshare2 <span class="hljs-built_in">source</span>/lib/needsharebutton<br></code></pre></td></tr></table></figure><pre><code>æ³¨æ„ï¼Œè¿™é‡Œä¸€å®šå¾—æ˜¯å…‹éš†åˆ°â€œsource/lib/needsharebuttonâ€ç›®å½•ï¼Œåå­—ä¸èƒ½é”™ã€‚</code></pre><p>(2) ä¿®æ”¹â€œä¸»é¢˜é…ç½®â€â€œneedmoreshare2â€çš„å­é€‰é¡¹å¼€å¯ç¤¾äº¤åˆ†äº«åŠŸèƒ½</p><h3 id="åšå®¢æœç´¢"><a href="#åšå®¢æœç´¢" class="headerlink" title="åšå®¢æœç´¢"></a>åšå®¢æœç´¢</h3><p>(1) åœ¨åšå®¢åº”ç”¨çš„æ ¹ç›®å½•å®‰è£…æ’ä»¶<a href="https://github.com/theme-next/hexo-generator-searchdb">https://github.com/theme-next/hexo-generator-searchdb</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-generator-searchdb --save<br></code></pre></td></tr></table></figure><p>(2) åœ¨â€œåº”ç”¨é…ç½®â€ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®å¼€å¯åšå®¢æœç´¢åŠŸèƒ½</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">symbols:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">time:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_symbols:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_time:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h2 id="éƒ¨ç½²é™æ€åšå®¢ç½‘ç«™åˆ°ç äº‘-Gitee-é™æ€é¡µé¢ç©ºé—´"><a href="#éƒ¨ç½²é™æ€åšå®¢ç½‘ç«™åˆ°ç äº‘-Gitee-é™æ€é¡µé¢ç©ºé—´" class="headerlink" title="éƒ¨ç½²é™æ€åšå®¢ç½‘ç«™åˆ°ç äº‘(Gitee)é™æ€é¡µé¢ç©ºé—´"></a>éƒ¨ç½²é™æ€åšå®¢ç½‘ç«™åˆ°ç äº‘(Gitee)é™æ€é¡µé¢ç©ºé—´</h2><ol><li><p>åœ¨ç äº‘ä¸Šåˆ›å»ºä¸€ä¸ªä¸ä½ è´¦å·åŒåçš„Gitä»£ç ä»“åº“ï¼Œæ¯”å¦‚â€ruokiyâ€;</p><blockquote><p>åœ¨åˆ›å»ºæ—¶é€‰æ‹©ç”¨READMEåˆå§‹åŒ–ä»“åº“ï¼Œè¿™æ ·åˆ›å»ºå‡ºæ¥çš„ä»£ç ä»“åº“ç¼ºçœä¼šå¸¦æœ‰masteråˆ†æ”¯</p></blockquote></li><li><p>å®‰è£…æ’ä»¶hexo-deployer-git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure></li><li><p>åœ¨â€œåº”ç”¨é…ç½®â€ä¸­æ·»åŠ ä¸€ä¸‹é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>   <span class="hljs-attr">repo:</span> <span class="hljs-string">https://gitee.com/ruokiy/ruokiy.git</span><br>   <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œæœ€ç»ˆdeployè¿‡ç¨‹æ˜¯å°†äº§ç”Ÿçš„é™æ€åšå®¢ç½‘ç«™æ–‡ä»¶æäº¤åˆ°æ–°åˆ›å»ºçš„Gitä»£ç ä»“åº“çš„masteråˆ†æ”¯ä¸Šï¼Œæ‰€ä»¥åšdeployçš„æœºå­ä¸Šéœ€è¦èƒ½å¤Ÿå†™è®¿é—®Gitä»£ç ä»“åº“ã€‚è¿™é‡Œæ˜¯é€šè¿‡httpsåè®®è®¿é—®Gitä»£ç ä»“åº“çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨deployçš„æœºå­ä¸Šï¼Œä¹Ÿå°±æ˜¯è£…æœ‰Gitå®¢æˆ·ç«¯çš„æœºå­ä¸Šè®¾ç½®ä»¥ä¸‹çš„Gité…ç½®ï¼š<br>git config â€“global credential.helper store<br>å°è¯•æ‰‹åŠ¨å…‹éš†ä¸€æ¬¡ä»£ç ä»“åº“ï¼Œæ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™æ ·ä½ çš„ç”¨æˆ·åå’Œå¯†ç å°±ä¼šè¢«ç¼“å­˜åˆ°æœºå­ä¸Šäº†ã€‚ä¹‹åçš„è®¿é—®éƒ½ä¸è¦ç”¨æˆ·åå’Œå¯†ç äº†ã€‚</p></blockquote></li><li><p>åœ¨åšå®¢åº”ç”¨çš„æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆé™æ€åšå®¢æ–‡ä»¶çš„ä¸Šä¼ </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo clean<br>hexo deploy<br></code></pre></td></tr></table></figure></li><li><p>å¦‚ä¸‹å›¾ï¼Œåœ¨ç äº‘ä¸Šç‚¹å‡»åˆšåˆ›å»ºçš„ä»£ç ä»“åº“é¡µé¢ï¼Œç‚¹å‡»èœå•â€œService|Gitee Pagesâ€ï¼Œåœ¨å·¦ä¾§é€‰æ‹©â€œmasterâ€åˆ†æ”¯ï¼Œç‚¹å‡»â€œcreateâ€æŒ‰é’®<br> <img src="/2018/08/17/setup-blog-hexo-gitee/2.png"></p></li></ol><p>ä¸åˆ°ä¸€åˆ†é’Ÿï¼Œä½ çš„é™æ€åšå®¢ç½‘ç«™å°±ç”Ÿæˆäº†ã€‚å¯ä»¥æ‹·è´ç”Ÿæˆçš„ç½‘å€è¾“å…¥åˆ°æµè§ˆå™¨æ‰“å¼€ä½ çš„åšå®¢äº†ï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªç½‘å€åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œæˆ–è€…æ”¾åœ¨ä½ çš„ä¸ªäººç®€ä»‹ä¸­ã€‚</p><h1 id="æœ€åä¸€å…¬é‡Œ-å°†åšå®¢åº”ç”¨çš„ä»£ç æ‰˜ç®¡åˆ°ç äº‘"><a href="#æœ€åä¸€å…¬é‡Œ-å°†åšå®¢åº”ç”¨çš„ä»£ç æ‰˜ç®¡åˆ°ç äº‘" class="headerlink" title="æœ€åä¸€å…¬é‡Œ - å°†åšå®¢åº”ç”¨çš„ä»£ç æ‰˜ç®¡åˆ°ç äº‘"></a>æœ€åä¸€å…¬é‡Œ - å°†åšå®¢åº”ç”¨çš„ä»£ç æ‰˜ç®¡åˆ°ç äº‘</h1><p>è¿™é‡Œä¼šç”¨åˆ°Git submoduleçš„æ¦‚å¿µã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Gitee</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
